!function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}}()({1:[function(e,t,r){(function(r){const n=e("path"),i=e("arch"),o=e("./package").version;t.exports={APP_NAME:"dhtStream",APP_VERSION:o,OS_SYSARCH:"x64"===i()?"x64":"ia32",POSTER_PATH:n.join("","posters"),ROOT_PATH:n.join(r,".."),STATIC_PATH:n.join(r,"..","static"),TORRENT_PATH:n.join("","torrents"),DEFAULT_DOWNLOAD_PATH:n.join("/Users/baidu/Downloads","datas"),DELAYED_INIT:3e3,STORAGE_TIMEOUT_MILLS:504e5,PUT_CONCURRENCY:2}}).call(this,"/")},{"./package":180,arch:11,path:94}],2:[function(e,t,r){document.addEventListener("DOMContentLoaded",function(){e("./render/main");e("./render/ipc-renderer").on("ipcReady",()=>{e("./web/feeds"),e("./web/stream"),e("./web/upload"),e("./web/cms")})},!1)},{"./render/ipc-renderer":184,"./render/main":192,"./web/cms":193,"./web/feeds":195,"./web/stream":196,"./web/upload":197}],3:[function(e,t,r){t.exports=u;var n=e("safe-buffer").Buffer,i=e("debug")("webtorrent:webconn"),o=e("simple-get"),a=e("../package.json").version,s=e("zlib");function u(e,t){this.url=e,this._torrent=t}u.prototype.httpRequest=function(e,t,r,u){var c,l=this,f=e*l._torrent.pieceLength+t,d=f+r-1,h=l._torrent.files;if(h.length<=1)c=[{url:l.url,start:f,end:d}];else{var p=h.filter(function(e){return e.offset<=d&&e.offset+e.length>f});if(p.length<1)return u(new Error("Could not find file corresponnding to web seed range request"));c=p.map(function(e){var t=e.offset+e.length-1;return{url:l.url+("/"===l.url[l.url.length-1]?"":"/")+e.path,fileOffsetInRange:Math.max(e.offset-f,0),start:Math.max(f-e.offset,0),end:Math.min(t,d-e.offset)}})}var m,g=0,y=!1;c.length>1&&(m=n.alloc(r)),c.forEach(function(l){var f=l.url,d=l.start,h=l.end;f.indexOf("?")<0&&(f+="?"),f.indexOf("&")>0&&(f+="&"),i("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",f=f+"start="+d+"&index="+e,e,t,r,d,h);var p={url:f,method:"GET",headers:{"user-agent":"dhstream/"+a+" (https://lezomao.com)"}};function v(e,t){if(e.statusCode<200||e.statusCode>=300)return y=!0,u(new Error("Unexpected HTTP status code "+e.statusCode));t=t.toString().trim();var r=new n(t,"base64");function o(e){1===c.length?u(null,e):(e.copy(m,l.fileOffsetInRange),++g===c.length&&u(null,m))}i("Got data of length %d,buffer %d",t.length,r.length),!function(e){if(!e||e.length<3)return!1;return 31===e[0]&&139===e[1]&&8===e[2]}(r)?o(r):s.gunzip(r,(e,t)=>{o(t)})}delete p.headers.range,o.concat(p,function(e,t,r){if(!y)return e?"undefined"==typeof window||f.startsWith(window.location.origin+"/")?(y=!0,u(e)):o.head(f,function(t,r){if(!y){if(t)return y=!0,u(t);if(r.statusCode<200||r.statusCode>=300)return y=!0,u(new Error("Unexpected HTTP status code "+r.statusCode));if(r.url===f)return y=!0,u(e);p.url=r.url,o.concat(p,function(e,t,r){if(!y)return e?(y=!0,u(e)):void v(t,r)})}}):void v(t,r)})})}},{"../package.json":180,debug:41,"safe-buffer":128,"simple-get":130,zlib:28}],4:[function(e,t,r){(function(r,n){console.time("init");const i=e("deep-equal"),o=e("path"),a=e("simple-sha1"),s=e("bitfield"),u=(e("run-parallel-limit"),e("./client")),c=e("./state"),l=(e("./storage"),e("./indexer")),f=e("./utils"),d=e("./../config"),h=e("./../render/ipc-renderer"),p=e("./../render/lib/torrent-poster"),m=e("./WebConn"),g=e("debug")("dhtstream:client"),y=e("parse-torrent");let v=null,_=null,b=null;t.exports={init:function(e){u.getClient((t,r)=>{if(t)return f.error("getClient:cause:"+t),e(t);v=r,function(e){w(),h.on("wt-start-torrenting",(e,t,r,n,i,o,a)=>(function(e,t,r,n,i,o){console.log("starting torrentKey:%s,torrentID:%s",e,t);var a=o||{};a.path=r;const s=v.add(t,a);s.key=e,E(s),s.once("ready",()=>A(s,i))})(t,r,n,0,o,a)),h.on("wt-stop-torrenting",(e,t)=>(function(e){console.log("--- STOP TORRENTING: ",e);const t=v.get(e);t&&t.destroy()})(t)),h.on("wt-pause-torrenting",(e,t)=>(function(e){console.log("--- PAUSE TORRENTING: ",e);const t=v.get(e);t&&!t.done&&t.pause()})(t)),h.on("wt-resume-torrenting",(e,t)=>(function(e){console.log("--- RESUME TORRENTING: ",e);const t=v.get(e);t&&t.paused&&t.resume()})(t)),h.on("wt-create-torrent",(e,t,r)=>(function(e,t){console.log("creating torrent",e,t);const r=t.files.map(e=>e.path),n=v.seed(r,t);n.key=e,E(n),h.send("wt-new-torrent")})(t,r)),h.on("wt-save-torrent-file",(e,t)=>(function(e){const t=R(e);o.join(d.TORRENT_PATH,t.infoHash);var r=y(t.torrentFile);r.announce&&(r.announce=r.announce.filter(function(e){return!(e.indexOf("localhost")>0||e.indexOf("lezomao.com")>0)&&(0===e.indexOf("wss://")||0===e.indexOf("ws://"))}));r.urlList&&(r.urlList=r.urlList.filter(function(e){if(e.indexOf("localhost")>0||e.indexOf("lezomao.com")>0)return!1}));var n=y.toTorrentFile(r).toString("base64");l.metaPut(t.infoHash,n,e=>{}),h.send("wt-file-saved",e,t.infoHash)})(t)),h.on("wt-generate-torrent-poster",(e,t)=>(function(e){const t=R(e);p(t,function(r,n,i){if(r)return console.log("error generating poster: %o",r);mkdirp(d.POSTER_PATH,function(r){if(r)return console.log("error creating poster dir: %o",r);const a=t.infoHash+i,s=o.join(d.POSTER_PATH,a);fs.writeFile(s,n,function(t){if(t)return console.log("error saving poster: %o",t);h.send("wt-poster",e,a)})})})})(t)),h.on("wt-get-audio-metadata",(e,t,r)=>(function(e,t){const r=v.get(e),n=r.files[t],i={title:n.name};h.send("wt-audio-metadata",e,t,i);const a={native:!1,skipCovers:!0,fileSize:n.length};(n.done?mm.parseFile(o.join(r.path,n.path),a):mm.parseStream(n.createReadStream(),n.name,a)).then(function(r){console.log("got audio metadata for %s (length=%s): %o",n.name,n.length,r),h.send("wt-audio-metadata",e,t,r)}).catch(function(r){return console.log("error getting audio metadata for "+e+":"+t,r)})})(t,r)),h.on("wt-start-server",(e,t)=>void 0),h.on("wt-stop-server",e=>(function(){if(!_)return;_.destroy(),_=null})()),h.on("wt-select-files",(e,t,r)=>A(t,r)),h.on("wt-render-to",(e,t,r,n,i,o)=>(function(e,t,r,n,i){let o;o="string"==typeof e?v.get(e):e;if(!o)throw new Error("renderTo: missing torrent "+e);o.files[t].renderTo(r,n,i)})(t,r,n,i,o)),h.send("ipcReadyWebTorrent"),window.addEventListener("error",e=>{e.message||e.stack?h.send("wt-uncaught-error",{message:e.message,stack:e.stack}):h.send("wt-uncaught-error",e)},!0),setInterval(k,1e3),console.timeEnd("init"),e()}(()=>{c.load(e)})})}};function w(){v.on("warning",e=>h.send("wt-warning",null,e.message)),v.on("error",e=>h.send("wt-error",null,e.message))}function E(e){e.on("warning",t=>h.send("wt-warning",e.key,t.message)),e.on("error",t=>h.send("wt-error",e.key,t.message)),e.on("infoHash",()=>h.send("wt-infohash",e.key,e.infoHash)),e.on("metadata",function(){const t=S(e);h.send("wt-metadata",e.key,t),k()}),e.on("ready",function(){const t=S(e);h.send("wt-ready",e.key,t),h.send("wt-ready-"+e.infoHash,e.key,t),e.discovery.removeAllListeners("error"),k()}),e.on("done",function(){const t=S(e);h.send("wt-done",e.key,t),e.putBits=null,k()}),e.on("wire",function(t,n){t.on("piece",(t,n,i)=>{(function(e){return e?e._chunks-e._reservations:0})(e.pieces[t])>2||r.nextTick(function(){!function(t,r,n){if(!e.putBits||e.putBits.get(t))return;a(n,function(r){r===e._hashes[t]?l.piecePut(e.infoHash,t,n,r=>{r?console.error("piecePut["+e.infoHash+","+t+"]",r):g("piecePut=%s,pieceIndex=%d,length=%d",e.infoHash,t,n.length)}):g("piecePut=%s,pieceIndex=%d,length=%d,hashErr",e.infoHash,t,n.length)})}(t,0,i)})}),e.putBits=new s(e.pieces.length)}),e.on("peer",function(t){var r=e._peers[t];if(!r||"webSeed"!=r.type)return;const i=r.conn,o=new m(i.url,i._torrent);i.httpRequest=function(t,r,i,a){l.pieceGet(e.infoHash,t,(s,u)=>{if(u&&u.data){var c=new n(u.data,"base64");return g("pieceGet=%s,pieceIndex=%d,length=%d",e.infoHash,t,c.length),e.putBits.set(t,!0),a(null,c)}return o.httpRequest(t,r,i,a)})}})}function S(e){return{infoHash:e.infoHash,magnetURI:e.magnetURI,name:e.name,path:e.path,files:e.files.map(T),bytesReceived:e.received}}function T(e){return{name:e.name,length:e.length,path:e.path}}function k(){const e=function(){const e=v.progress,t=v.torrents.some(function(e){return 1!==e.progress});return{torrents:v.torrents.map(function(e){const t=e.files&&e.files.map(function(t,r){const n=t._endPiece-t._startPiece+1;let i=0;for(let r=t._startPiece;r<=t._endPiece;r++)e.bitfield.get(r)&&i++;return{startPiece:t._startPiece,endPiece:t._endPiece,numPieces:n,numPiecesPresent:i}});return{torrentKey:e.key,ready:e.ready,progress:e.progress,downloaded:e.downloaded,downloadSpeed:e.downloadSpeed,uploadSpeed:e.uploadSpeed,numPeers:e.numPeers,length:e.length,files:t}}),progress:e,hasActiveTorrents:t}}();b&&i(e,b,{strict:!0})||(h.send("wt-progress",e),b=e)}function A(e,t){let r;if(!(r="string"==typeof e?v.get(e):e))throw new Error("selectFiles: missing torrent "+e);if(t||(t=r.files.map(e=>!0)),t.length!==r.files.length)throw new Error("got "+t.length+" file selections, but the torrent contains "+r.files.length+" files");r.deselect(0,r.pieces.length-1,!1);for(let e=0;e<t.length;e++){const n=r.files[e];t[e]?n.select():(console.log("deselecting file "+e+" of torrent "+r.name),n.deselect())}}function R(e){const t=v.torrents.find(t=>t.key===e);if(!t)throw new Error(`Can't resolve torrent key ${e}`);return t}console.log("Initializing..."),window.testOfflineMode=function(){console.log("Test, going OFFLINE"),v=window.client=new WebTorrent({tracker:!1,dht:!1,webSeeds:!1}),w()}}).call(this,e("_process"),e("buffer").Buffer)},{"./../config":1,"./../render/ipc-renderer":184,"./../render/lib/torrent-poster":190,"./WebConn":3,"./client":5,"./indexer":6,"./state":7,"./storage":8,"./utils":9,_process:98,bitfield:18,buffer:34,debug:41,"deep-equal":43,"parse-torrent":93,path:94,"run-parallel-limit":125,"simple-sha1":132}],5:[function(e,t,r){(function(r){var n=e("webtorrent-hybrid"),i=e("create-torrent"),o=e("thunky"),a=e("simple-get"),s=e("./utils");r.WEBTORRENT_ANNOUNCE=i.announceList.map(function(e){return e[0]}).filter(function(e){return 0===e.indexOf("wss://")||0===e.indexOf("ws://")});var u=o(function(e){!function(e){var t={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]};a.concat({url:"/api/movie/rtcconfig.json",timeout:5e3},function(r,n,i){if(!r&&200==n.statusCode)try{var o=JSON.parse(i);o&&o.data&&(t=o.data)}catch(r){console.error("getRtcConfig,cause:",r)}e(null,t)})}(function(t,i){t&&s.error(t),console.info("useConfig:"+JSON.stringify(i));var o=new n({maxConns:30,webSeeds:!0,tracker:{announce:r.WEBTORRENT_ANNOUNCE,rtcConfig:i}});window.client=o,o.on("warning",s.warning),o.on("error",s.error),e(null,o)})});t.exports={getClient:u}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":9,"create-torrent":40,"simple-get":130,thunky:147,"webtorrent-hybrid":166}],6:[function(e,t,r){const{EventEmitter:n}=e("events"),i="torrentDB",o=9,a="pieces",s="meta",u=[{name:s,keyOption:{autoIncrement:!0},overwrite:!0,createIndex:function(e){e.createIndex("by_key","key",{unique:!0})}},{name:a,keyOption:{autoIncrement:!0},overwrite:!1,createIndex:function(e){e.createIndex("by_key","key",{unique:!0})}}];t.exports=Object.assign(new n,{dataBase:f,table:function(e,t,r,n,i){if(!database)return i(new Error("database is null"));if(!t)return i(new Error("tableName is null"));if(!r)return i(new Error("keyOption is null"));if(!n&&e.objectStoreNames.contains(e.objectStoreNames))return;e.objectStoreNames.remove(t),e.createObjectStore(t,r)},put:d,remove:h,get:p,indexGet:m,piecePut:function(e,t,r,n){f(i,o,(i,o)=>{if(i)return n(i);if(!o)return n(new Error("Get dataBase fail"));var s={};s.key=e+":"+t,s.data=r.toString("base64"),d(o,a,s,n)})},pieceDel:function(e,t,r){f(i,o,(n,i)=>{if(n)return r(n);if(!i)return r(new Error("Get dataBase fail"));const o=e+":"+t;h(i,a,o,r)})},pieceGet:function(e,t,r){f(i,o,(n,i)=>{if(n)return r(n);if(!i)return r(new Error("Get dataBase fail"));const o=e+":"+t;m(i,a,{name:"by_key",value:o},r)})},metaPut:function(e,t,r){f(i,o,(n,i)=>{if(n)return r(n);if(!i)return r(new Error("Get dataBase fail"));var o={};o.key=e,o.data=t,o.ctime=(new Date).getTime(),d(i,s,o,r)})},metaGet:function(e,t){f(i,o,(r,n)=>r?t(r):n?void m(n,s,{name:"by_key",value:e},t):t(new Error("Get dataBase fail")))},metaGetId:function(e,t){f(i,o,(r,n)=>r?t(r):n?void p(n,s,e,t):t(new Error("Get dataBase fail")))},metaAllKeys:function(e,t){f(i,o,(r,n)=>r?t(r):n?void function(e,t,r,n){if(!e)return n(new Error("database is null"));if(!t)return n(new Error("tableName is null"));if(!e.objectStoreNames.contains(t))return n(new Error("miss table:"+t));r=r||{},e.transaction([t],"readonly").objectStore(t).getAllKeys(r.query,r.count).onsuccess=function(e){n(null,this.result)}}(n,s,e,t):t(new Error("Get dataBase fail")))}});function c(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB}const l={};function f(e,t,r){var n=e+":"+t;if(!c())return r("unsupport indexedDB");if(l[n])return r(null,l[n]);var i=c().open(e,t);i.onsuccess=function(e){r(null,this.result)},i.onerror=function(t){console.error("open dataBase["+e+"],cause:",i.error),r(i.error)},i.onupgradeneeded=function(e){var t=this.result;u.map(e=>{var r=e.name;if(e.overwrite&&t.objectStoreNames.contains(r)&&t.deleteObjectStore(r),!t.objectStoreNames.contains(r)){var n=e.keyOption,i=t.createObjectStore(r,n);e.createIndex(i)}});var r=t.name+":"+e.oldVersion;delete l[r],l[n]=t,t.onversionchange=function(e){t.close(),console.error("onversionchange:"+e.oldVersion+",version:"+e.version+",reload ")}}}function d(e,t,r,n){return e?t?e.objectStoreNames.contains(t)?void(e.transaction([t],"readwrite").objectStore(t).put(r).onsuccess=function(e){n(null,this.result)}):n(new Error("miss table:"+t)):n(new Error("tableName is null")):n(new Error("database is null"))}function h(e,t,r,n){return e?t?r?e.objectStoreNames.contains(t)?void(e.transaction([t],"readwrite").objectStore(t).delete(r).onsuccess=function(e){n(null,this.result)}):n(new Error("miss table:"+t)):n(new Error("id is null")):n(new Error("tableName is null")):n(new Error("database is null"))}function p(e,t,r,n){return e?t?r?e.objectStoreNames.contains(t)?void(e.transaction([t],"readonly").objectStore(t).get(r).onsuccess=function(e){n(null,this.result)}):n(new Error("miss table:"+t)):n(new Error("id is null")):n(new Error("tableName is null")):n(new Error("database is null"))}function m(e,t,r,n){return e?t?r?e.objectStoreNames.contains(t)?void(e.transaction([t],"readonly").objectStore(t).index(r.name).get(r.value).onsuccess=function(e){n(null,this.result)}):n(new Error("miss table:"+t)):n(new Error("indexOpt is null")):n(new Error("tableName is null")):n(new Error("database is null"))}},{events:51}],7:[function(e,t,r){(function(r){const{EventEmitter:n}=e("events"),i=e("run-parallel-limit"),o=e("../config"),a=(e("./storage"),e("./indexer"));t.exports=Object.assign(new n,{getDefaultPlayState:s,load:function(t){!function(t){e("path");const n=e("parse-torrent"),s={},u={prefs:{downloadPath:o.DEFAULT_DOWNLOAD_PATH,isFileHandler:!1,openExternalPlayer:!1,externalPlayerPath:null,startup:!1,autoAddTorrents:!1,torrentsFolderPath:"",highestPlaybackPriority:!0},torrents:[],torrentsToResume:[],version:o.APP_VERSION};var c={};function l(e){if(e){var t=new r(e,"base64"),i=n(t),o=function(e){return{status:"paused",infoHash:e.infoHash,posterFileName:e.infoHash+".jpg",magnetURI:n.toMagnetURI(e),files:e.files}}(i);s[o.infoHash]=o}}a.metaAllKeys(null,(e,r)=>{r&&r.forEach(e=>{c[e]=function(t){a.metaGetId(e,(e,r)=>{l(r.data),t()})}}),i(c,2,function(e,r){for(var n in s)u.torrents.push(s[n]);t(null,u)})})}(function(r,n){if(r)return t(r);const i={client:null,server:null,prev:{title:null,progress:-1,badge:null},location:new(e("location-history")),window:{bounds:null,isFocused:!0,isFullScreen:!1,title:o.APP_WINDOW_TITLE},selectedInfoHash:null,playing:{infoHash:null,fileIndex:null,location:"local",type:null,currentTime:0,duration:1,isReady:!1,isPaused:!0,isStalled:!1,lastTimeUpdate:0,mouseStationarySince:0,playbackRate:1,volume:1,subtitles:{tracks:[],selectedIndex:-1,showMenu:!1},aspectRatio:0},devices:{},dock:{badge:0,progress:0},modal:null,errors:[],nextTorrentKey:1,saved:{}};i.saved=n,t(null,i)})},saveImmediate:function(){}});function s(){return{infoHash:null,fileIndex:null,location:"local",type:null,currentTime:0,duration:1,isReady:!1,isPaused:!0,isStalled:!1,lastTimeUpdate:0,mouseStationarySince:0,playbackRate:1,volume:1,subtitles:{tracks:[],selectedIndex:-1,showMenu:!1},aspectRatio:0}}}).call(this,e("buffer").Buffer)},{"../config":1,"./indexer":6,"./storage":8,buffer:34,events:51,"location-history":67,"parse-torrent":93,path:94,"run-parallel-limit":125}],8:[function(e,t,r){const{EventEmitter:n}=e("events");t.exports=Object.assign(new n,{set:function(e,t,r){var n={value:t};r&&(n._expire=(new Date).getTime()+r);var o=JSON.stringify(n);i().setItem(e,o)},get:function(e,t){var r=i().getItem(e);if(!r)return;var n,s=JSON.parse(r);o(s)?(t&&(n=s.value),a(e)):n=s.value;return n},length:function(){return i().length},expire:function(e){var t=i().getItem(e);if(!t)return!1;return o(JSON.parse(t))},remove:a,keys:function(e){var t=[];for(var r in i())e&&!e(r)||t.push(r);return t},selectDB:i});function i(){return window.localStorage?window.localStorage:(Object.defineProperty(window,"localStorage",new function(){var e=[],t={};Object.defineProperty(t,"getItem",{value:function(e){return e?this[e]:null},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"key",{value:function(t){return e[t]},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"setItem",{value:function(e,t){e&&(document.cookie=escape(e)+"="+escape(t)+"; path=/")},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(t,"length",{get:function(){return e.length},configurable:!1,enumerable:!1}),Object.defineProperty(t,"removeItem",{value:function(e){if(e){var t=new Date;t.setDate(t.getDate()-1),document.cookie=escape(e)+"=; expires="+t.toGMTString()+"; path=/"}},writable:!1,configurable:!1,enumerable:!1}),this.get=function(){var r;for(var n in t)-1===(r=e.indexOf(n))?t.setItem(n,t[n]):e.splice(r,1),delete t[n];for(;e.length>0;e.splice(0,1))t.removeItem(e[0]);for(var i,o,a=0,s=document.cookie.split(/\s*;\s*/);a<s.length;a++)(i=s[a].split(/\s*=\s*/)).length>1&&(t[o=unescape(i[0])]=unescape(i[1]),e.push(o));return t},this.configurable=!1,this.enumerable=!0}),window.localStorage)}function o(e){return!(!e||!e._expire)&&(new Date).getTime()>e._expire}function a(e){return i().removeItem(e)}},{events:51}],9:[function(e,t,r){r.log=function(e){console.log(e)},r.info=function(e){console.info(e)},r.warning=function(e){console.error(e.stack||e.message||e)},r.error=function(e){console.error(e.stack||e.message||e)}},{}],10:[function(e,t,r){var n=/^\[?([^\]]+)\]?:(\d+)$/,i={},o=0;t.exports=function(e){if(1e5===o&&t.exports.reset(),!i[e]){var r=n.exec(e);if(!r)throw new Error("invalid addr: "+e);i[e]=[r[1],Number(r[2])],o+=1}return i[e]},t.exports.reset=function(){i={},o=0}},{}],11:[function(e,t,r){t.exports=function(){var e=navigator.userAgent;if(["x86_64","x86-64","Win64","x64;","amd64","AMD64","WOW64","x64_64"].some(function(t){return e.indexOf(t)>-1}))return"x64";var t=navigator.platform;return"MacIntel"===t||"Linux x86_64"===t?"x64":"x64"===navigator.cpuClass?"x64":"x86"}},{}],12:[function(e,t,r){(function(r){"use strict";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function i(e){return r.Buffer&&"function"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=e("util/"),a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,u="foo"===function(){}.name;function c(e){return Object.prototype.toString.call(e)}function l(e){return!i(e)&&("function"==typeof r.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var f=t.exports=y,d=/\s*function\s+([^\(\s]*)\s*/;function h(e){if(o.isFunction(e)){if(u)return e.name;var t=e.toString().match(d);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(u||!o.isFunction(e))return o.inspect(e);var t=h(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,r,n,i){throw new f.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function y(e,t){e||g(e,!0,t,"==",f.ok)}function v(e,t,r,a){if(e===t)return!0;if(i(e)&&i(t))return 0===n(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(l(e)&&l(t)&&c(e)===c(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var u=(a=a||{actual:[],expected:[]}).actual.indexOf(e);return-1!==u&&u===a.expected.indexOf(t)||(a.actual.push(e),a.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=_(e),a=_(t);if(i&&!a||!i&&a)return!1;if(i)return e=s.call(e),t=s.call(t),v(e,t,r);var u,c,l=E(e),f=E(t);if(l.length!==f.length)return!1;for(l.sort(),f.sort(),c=l.length-1;c>=0;c--)if(l[c]!==f[c])return!1;for(c=l.length-1;c>=0;c--)if(u=l[c],!v(e[u],t[u],r,n))return!1;return!0}(e,t,r,a))}return r?e===t:e==t}function _(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&g(i,r,"Missing expected exception"+n);var a="string"==typeof n,s=!e&&i&&!r;if((!e&&o.isError(i)&&a&&b(i,r)||s)&&g(i,r,"Got unwanted exception"+n),e&&i&&r&&!b(i,r)||!e&&i)throw i}f.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m((t=this).actual),128)+" "+t.operator+" "+p(m(t.expected),128),this.generatedMessage=!0);var r=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var n=new Error;if(n.stack){var i=n.stack,o=h(r),a=i.indexOf("\n"+o);if(a>=0){var s=i.indexOf("\n",a+1);i=i.substring(s+1)}this.stack=i}}},o.inherits(f.AssertionError,Error),f.fail=g,f.ok=y,f.equal=function(e,t,r){e!=t&&g(e,t,r,"==",f.equal)},f.notEqual=function(e,t,r){e==t&&g(e,t,r,"!=",f.notEqual)},f.deepEqual=function(e,t,r){v(e,t,!1)||g(e,t,r,"deepEqual",f.deepEqual)},f.deepStrictEqual=function(e,t,r){v(e,t,!0)||g(e,t,r,"deepStrictEqual",f.deepStrictEqual)},f.notDeepEqual=function(e,t,r){v(e,t,!1)&&g(e,t,r,"notDeepEqual",f.notDeepEqual)},f.notDeepStrictEqual=function e(t,r,n){v(t,r,!0)&&g(t,r,n,"notDeepStrictEqual",e)},f.strictEqual=function(e,t,r){e!==t&&g(e,t,r,"===",f.strictEqual)},f.notStrictEqual=function(e,t,r){e===t&&g(e,t,r,"!==",f.notStrictEqual)},f.throws=function(e,t,r){w(!0,e,t,r)},f.doesNotThrow=function(e,t,r){w(!1,e,t,r)},f.ifError=function(e){if(e)throw e};var E=Object.keys||function(e){var t=[];for(var r in e)a.call(e,r)&&t.push(r);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":162}],13:[function(e,t,r){"use strict";r.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){for(var t,r=c(e),n=r[0],a=r[1],s=new o(function(e,t,r){return 3*(t+r)/4-r}(0,n,a)),u=0,l=a>0?n-4:n,f=0;f<l;f+=4)t=i[e.charCodeAt(f)]<<18|i[e.charCodeAt(f+1)]<<12|i[e.charCodeAt(f+2)]<<6|i[e.charCodeAt(f+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;2===a&&(t=i[e.charCodeAt(f)]<<2|i[e.charCodeAt(f+1)]>>4,s[u++]=255&t);1===a&&(t=i[e.charCodeAt(f)]<<10|i[e.charCodeAt(f+1)]<<4|i[e.charCodeAt(f+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t);return s},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(l(e,a,a+16383>s?s:a+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],14:[function(e,t,r){(function(e){function r(e,t,r){for(var n=0,i=1,o=t;o<r;o++){var a=e[o];if(a<58&&a>=48)n=10*n+(a-48);else if(o!==t||43!==a){if(o!==t||45!==a){if(46===a)break;throw new Error("not a number: buffer["+o+"] = "+a)}i=-1}}return n*i}function n(t,r,i,o){return null==t||0===t.length?null:("number"!=typeof r&&null==o&&(o=r,r=void 0),"number"!=typeof i&&null==o&&(o=i,i=void 0),n.position=0,n.encoding=o||null,n.data=e.isBuffer(t)?t.slice(r,i):new e(t),n.bytes=n.data.length,n.next())}n.bytes=0,n.position=0,n.data=null,n.encoding=null,n.next=function(){switch(n.data[n.position]){case 100:return n.dictionary();case 108:return n.list();case 105:return n.integer();default:return n.buffer()}},n.find=function(e){for(var t=n.position,r=n.data.length,i=n.data;t<r;){if(i[t]===e)return t;t++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(e)+'" [0x'+e.toString(16)+"]")},n.dictionary=function(){n.position++;for(var e={};101!==n.data[n.position];)e[n.buffer()]=n.next();return n.position++,e},n.list=function(){n.position++;for(var e=[];101!==n.data[n.position];)e.push(n.next());return n.position++,e},n.integer=function(){var e=n.find(101),t=r(n.data,n.position+1,e);return n.position+=e+1-n.position,t},n.buffer=function(){var e=n.find(58),t=r(n.data,n.position,e),i=++e+t;return n.position=i,n.encoding?n.data.toString(n.encoding,e,i):n.data.slice(e,i)},t.exports=n}).call(this,e("buffer").Buffer)},{buffer:34}],15:[function(e,t,r){var n=e("safe-buffer").Buffer;function i(e,t,r){var o=[],a=null;return i._encode(o,e),a=n.concat(o),i.bytes=a.length,n.isBuffer(t)?(a.copy(t,r),t):a}i.bytes=-1,i._floatConversionDetected=!1,i.getType=function(e){return n.isBuffer(e)?"buffer":Array.isArray(e)?"array":ArrayBuffer.isView(e)?"arraybufferview":e instanceof Number?"number":e instanceof Boolean?"boolean":e instanceof ArrayBuffer?"arraybuffer":typeof e},i._encode=function(e,t){if(null!=t)switch(i.getType(t)){case"buffer":i.buffer(e,t);break;case"object":i.dict(e,t);break;case"array":i.list(e,t);break;case"string":i.string(e,t);break;case"number":case"boolean":i.number(e,t);break;case"arraybufferview":i.buffer(e,n.from(t.buffer,t.byteOffset,t.byteLength));break;case"arraybuffer":i.buffer(e,n.from(t))}};var o=n.from("e"),a=n.from("d"),s=n.from("l");i.buffer=function(e,t){e.push(new n(t.length+":"),t)},i.string=function(e,t){e.push(n.from(n.byteLength(t)+":"+t))},i.number=function(e,t){var r=2147483648*(t/2147483648<<0)+(t%2147483648<<0);e.push(n.from("i"+r+"e")),r===t||i._floatConversionDetected||(i._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+t+'":','Bencoding only defines support for integers, value was converted to "'+r+'"'),console.trace())},i.dict=function(e,t){e.push(a);for(var r,n=0,s=Object.keys(t).sort(),u=s.length;n<u;n++)null!=t[r=s[n]]&&(i.string(e,r),i._encode(e,t[r]));e.push(o)},i.list=function(e,t){var r=0,n=t.length;for(e.push(s);r<n;r++)null!=t[r]&&i._encode(e,t[r]);e.push(o)},t.exports=i},{"safe-buffer":128}],16:[function(e,t,r){var n=t.exports;n.encode=e("./encode"),n.decode=e("./decode"),n.byteLength=n.encodingLength=function(e){return n.encode(e).length}},{"./decode":14,"./encode":15}],17:[function(e,t,r){t.exports=function(e,t,r,n,i){var o,a;if(void 0===n)n=0;else if((n|=0)<0||n>=e.length)throw new RangeError("invalid lower bound");if(void 0===i)i=e.length-1;else if((i|=0)<n||i>=e.length)throw new RangeError("invalid upper bound");for(;n<=i;)if((a=+r(e[o=n+(i-n>>1)],t,o,e))<0)n=o+1;else{if(!(a>0))return o;i=o-1}return~n}},{}],18:[function(e,t,r){(function(e){var r=void 0!==e?e:Uint8Array;function n(e,t){if(!(this instanceof n))return new n(e,t);0===arguments.length&&(e=0),this.grow=t&&(isFinite(t.grow)&&i(t.grow)||t.grow)||0,"number"!=typeof e&&void 0!==e||(e=new r(i(e))).fill&&!e._isBuffer&&e.fill(0),this.buffer=e}function i(e){var t=e>>3;return e%8!=0&&t++,t}n.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},n.prototype.set=function(e,t){var r=e>>3;t||1===arguments.length?(this.buffer.length<r+1&&this._grow(Math.max(r+1,Math.min(2*this.buffer.length,this.grow))),this.buffer[r]|=128>>e%8):r<this.buffer.length&&(this.buffer[r]&=~(128>>e%8))},n.prototype._grow=function(e){if(this.buffer.length<e&&e<=this.grow){var t=new r(e);if(t.fill&&t.fill(0),this.buffer.copy)this.buffer.copy(t,0);else for(var n=0;n<this.buffer.length;n++)t[n]=this.buffer[n];this.buffer=t}},void 0!==t&&(t.exports=n)}).call(this,e("buffer").Buffer)},{buffer:34}],19:[function(e,t,r){t.exports=S;var n=e("unordered-array-remove"),i=e("bencode"),o=e("bitfield"),a=e("safe-buffer").Buffer,s=e("debug")("bittorrent-protocol"),u=e("xtend"),c=e("inherits"),l=e("randombytes"),f=e("speedometer"),d=e("readable-stream"),h=4e5,p=a.from("BitTorrent protocol"),m=a.from([0,0,0,0]),g=a.from([0,0,0,1,0]),y=a.from([0,0,0,1,1]),v=a.from([0,0,0,1,2]),_=a.from([0,0,0,1,3]),b=[0,0,0,0,0,0,0,0],w=[0,0,0,3,9,0,0];function E(e,t,r,n){this.piece=e,this.offset=t,this.length=r,this.callback=n}function S(){if(!(this instanceof S))return new S;d.Duplex.call(this),this._debugId=l(4).toString("hex"),this._debug("new wire"),this.peerId=null,this.peerIdBuffer=null,this.type=null,this.amChoking=!0,this.amInterested=!1,this.peerChoking=!0,this.peerInterested=!1,this.peerPieces=new o(0,{grow:h}),this.peerExtensions={},this.requests=[],this.peerRequests=[],this.extendedMapping={},this.peerExtendedMapping={},this.extendedHandshake={},this.peerExtendedHandshake={},this._ext={},this._nextExt=1,this.uploaded=0,this.downloaded=0,this.uploadSpeed=f(),this.downloadSpeed=f(),this._keepAliveInterval=null,this._timeout=null,this._timeoutMs=0,this.destroyed=!1,this._finished=!1,this._parserSize=0,this._parser=null,this._buffer=[],this._bufferSize=0,this.on("finish",this._onFinish),this._parseHandshake()}function T(e,t,r,i){for(var o=0;o<e.length;o++){var a=e[o];if(a.piece===t&&a.offset===r&&a.length===i)return n(e,o),a}return null}c(S,d.Duplex),S.prototype.setKeepAlive=function(e){var t=this;t._debug("setKeepAlive %s",e),clearInterval(t._keepAliveInterval),!1!==e&&(t._keepAliveInterval=setInterval(function(){t.keepAlive()},55e3))},S.prototype.setTimeout=function(e,t){this._debug("setTimeout ms=%d unref=%s",e,t),this._clearTimeout(),this._timeoutMs=e,this._timeoutUnref=!!t,this._updateTimeout()},S.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this._debug("destroy"),this.emit("close"),this.end())},S.prototype.end=function(){this._debug("end"),this._onUninterested(),this._onChoke(),d.Duplex.prototype.end.apply(this,arguments)},S.prototype.use=function(e){var t=e.prototype.name;if(!t)throw new Error('Extension class requires a "name" property on the prototype');this._debug("use extension.name=%s",t);var r=this._nextExt,n=new e(this);function i(){}"function"!=typeof n.onHandshake&&(n.onHandshake=i),"function"!=typeof n.onExtendedHandshake&&(n.onExtendedHandshake=i),"function"!=typeof n.onMessage&&(n.onMessage=i),this.extendedMapping[r]=t,this._ext[t]=n,this[t]=n,this._nextExt+=1},S.prototype.keepAlive=function(){this._debug("keep-alive"),this._push(m)},S.prototype.handshake=function(e,t,r){var n,i;if("string"==typeof e?(e=e.toLowerCase(),n=a.from(e,"hex")):e=(n=e).toString("hex"),"string"==typeof t?i=a.from(t,"hex"):t=(i=t).toString("hex"),20!==n.length||20!==i.length)throw new Error("infoHash and peerId MUST have length 20");this._debug("handshake i=%s p=%s exts=%o",e,t,r);var o=a.from(b);o[5]|=16,r&&r.dht&&(o[7]|=1),this._push(a.concat([p,o,n,i])),this._handshakeSent=!0,this.peerExtensions.extended&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},S.prototype._sendExtendedHandshake=function(){var e=u(this.extendedHandshake);for(var t in e.m={},this.extendedMapping){var r=this.extendedMapping[t];e.m[r]=Number(t)}this.extended(0,i.encode(e)),this._extendedHandshakeSent=!0},S.prototype.choke=function(){if(!this.amChoking){for(this.amChoking=!0,this._debug("choke");this.peerRequests.length;)this.peerRequests.pop();this._push(g)}},S.prototype.unchoke=function(){this.amChoking&&(this.amChoking=!1,this._debug("unchoke"),this._push(y))},S.prototype.interested=function(){this.amInterested||(this.amInterested=!0,this._debug("interested"),this._push(v))},S.prototype.uninterested=function(){this.amInterested&&(this.amInterested=!1,this._debug("uninterested"),this._push(_))},S.prototype.have=function(e){this._debug("have %d",e),this._message(4,[e],null)},S.prototype.bitfield=function(e){this._debug("bitfield"),a.isBuffer(e)||(e=e.buffer),this._message(5,[],e)},S.prototype.request=function(e,t,r,n){return n||(n=function(){}),this._finished?n(new Error("wire is closed")):this.peerChoking?n(new Error("peer is choking")):(this._debug("request index=%d offset=%d length=%d",e,t,r),this.requests.push(new E(e,t,r,n)),this._updateTimeout(),void this._message(6,[e,t,r],null))},S.prototype.piece=function(e,t,r){this._debug("piece index=%d offset=%d",e,t),this.uploaded+=r.length,this.uploadSpeed(r.length),this.emit("upload",r.length),this._message(7,[e,t],r)},S.prototype.cancel=function(e,t,r){this._debug("cancel index=%d offset=%d length=%d",e,t,r),this._callback(T(this.requests,e,t,r),new Error("request was cancelled"),null),this._message(8,[e,t,r],null)},S.prototype.port=function(e){this._debug("port %d",e);var t=a.from(w);t.writeUInt16BE(e,5),this._push(t)},S.prototype.extended=function(e,t){if(this._debug("extended ext=%s",e),"string"==typeof e&&this.peerExtendedMapping[e]&&(e=this.peerExtendedMapping[e]),"number"!=typeof e)throw new Error("Unrecognized extension: "+e);var r=a.from([e]),n=a.isBuffer(t)?t:i.encode(t);this._message(20,[],a.concat([r,n]))},S.prototype._read=function(){},S.prototype._message=function(e,t,r){var n=r?r.length:0,i=a.allocUnsafe(5+4*t.length);i.writeUInt32BE(i.length+n-4,0),i[4]=e;for(var o=0;o<t.length;o++)i.writeUInt32BE(t[o],5+4*o);this._push(i),r&&this._push(r)},S.prototype._push=function(e){if(!this._finished)return this.push(e)},S.prototype._onKeepAlive=function(){this._debug("got keep-alive"),this.emit("keep-alive")},S.prototype._onHandshake=function(e,t,r){var n,i=e.toString("hex"),o=t.toString("hex");for(n in this._debug("got handshake i=%s p=%s exts=%o",i,o,r),this.peerId=o,this.peerIdBuffer=t,this.peerExtensions=r,this.emit("handshake",i,o,r),this._ext)this._ext[n].onHandshake(i,o,r);r.extended&&this._handshakeSent&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},S.prototype._onChoke=function(){for(this.peerChoking=!0,this._debug("got choke"),this.emit("choke");this.requests.length;)this._callback(this.requests.pop(),new Error("peer is choking"),null)},S.prototype._onUnchoke=function(){this.peerChoking=!1,this._debug("got unchoke"),this.emit("unchoke")},S.prototype._onInterested=function(){this.peerInterested=!0,this._debug("got interested"),this.emit("interested")},S.prototype._onUninterested=function(){this.peerInterested=!1,this._debug("got uninterested"),this.emit("uninterested")},S.prototype._onHave=function(e){this.peerPieces.get(e)||(this._debug("got have %d",e),this.peerPieces.set(e,!0),this.emit("have",e))},S.prototype._onBitField=function(e){this.peerPieces=new o(e),this._debug("got bitfield"),this.emit("bitfield",this.peerPieces)},S.prototype._onRequest=function(e,t,r){var n=this;if(!n.amChoking){n._debug("got request index=%d offset=%d length=%d",e,t,r);var i=function(i,a){if(o===T(n.peerRequests,e,t,r))return i?n._debug("error satisfying request index=%d offset=%d length=%d (%s)",e,t,r,i.message):void n.piece(e,t,a)},o=new E(e,t,r,i);n.peerRequests.push(o),n.emit("request",e,t,r,i)}},S.prototype._onPiece=function(e,t,r){this._debug("got piece index=%d offset=%d",e,t),this._callback(T(this.requests,e,t,r.length),null,r),this.downloaded+=r.length,this.downloadSpeed(r.length),this.emit("download",r.length),this.emit("piece",e,t,r)},S.prototype._onCancel=function(e,t,r){this._debug("got cancel index=%d offset=%d length=%d",e,t,r),T(this.peerRequests,e,t,r),this.emit("cancel",e,t,r)},S.prototype._onPort=function(e){this._debug("got port %d",e),this.emit("port",e)},S.prototype._onExtended=function(e,t){if(0===e){var r,n;try{r=i.decode(t)}catch(e){this._debug("ignoring invalid extended handshake: %s",e.message||e)}if(!r)return;if(this.peerExtendedHandshake=r,"object"==typeof r.m)for(n in r.m)this.peerExtendedMapping[n]=Number(r.m[n].toString());for(n in this._ext)this.peerExtendedMapping[n]&&this._ext[n].onExtendedHandshake(this.peerExtendedHandshake);this._debug("got extended handshake"),this.emit("extended","handshake",this.peerExtendedHandshake)}else this.extendedMapping[e]&&(e=this.extendedMapping[e],this._ext[e]&&this._ext[e].onMessage(t)),this._debug("got extended message ext=%s",e),this.emit("extended",e,t)},S.prototype._onTimeout=function(){this._debug("request timed out"),this._callback(this.requests.shift(),new Error("request has timed out"),null),this.emit("timeout")},S.prototype._write=function(e,t,r){for(this._bufferSize+=e.length,this._buffer.push(e);this._bufferSize>=this._parserSize;){var n=1===this._buffer.length?this._buffer[0]:a.concat(this._buffer);this._bufferSize-=this._parserSize,this._buffer=this._bufferSize?[n.slice(this._parserSize)]:[],this._parser(n.slice(0,this._parserSize))}r(null)},S.prototype._callback=function(e,t,r){e&&(this._clearTimeout(),this.peerChoking||this._finished||this._updateTimeout(),e.callback(t,r))},S.prototype._clearTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},S.prototype._updateTimeout=function(){var e=this;e._timeoutMs&&e.requests.length&&!e._timeout&&(e._timeout=setTimeout(function(){e._onTimeout()},e._timeoutMs),e._timeoutUnref&&e._timeout.unref&&e._timeout.unref())},S.prototype._parse=function(e,t){this._parserSize=e,this._parser=t},S.prototype._onMessageLength=function(e){var t=e.readUInt32BE(0);t>0?this._parse(t,this._onMessage):(this._onKeepAlive(),this._parse(4,this._onMessageLength))},S.prototype._onMessage=function(e){switch(this._parse(4,this._onMessageLength),e[0]){case 0:return this._onChoke();case 1:return this._onUnchoke();case 2:return this._onInterested();case 3:return this._onUninterested();case 4:return this._onHave(e.readUInt32BE(1));case 5:return this._onBitField(e.slice(1));case 6:return this._onRequest(e.readUInt32BE(1),e.readUInt32BE(5),e.readUInt32BE(9));case 7:return this._onPiece(e.readUInt32BE(1),e.readUInt32BE(5),e.slice(9));case 8:return this._onCancel(e.readUInt32BE(1),e.readUInt32BE(5),e.readUInt32BE(9));case 9:return this._onPort(e.readUInt16BE(1));case 20:return this._onExtended(e.readUInt8(1),e.slice(2));default:return this._debug("got unknown message"),this.emit("unknownmessage",e)}},S.prototype._parseHandshake=function(){var e=this;e._parse(1,function(t){var r=t.readUInt8(0);e._parse(r+48,function(t){var n=t.slice(0,r);if("BitTorrent protocol"!==n.toString())return e._debug("Error: wire not speaking BitTorrent protocol (%s)",n.toString()),void e.end();t=t.slice(r),e._onHandshake(t.slice(8,28),t.slice(28,48),{dht:!!(1&t[7]),extended:!!(16&t[5])}),e._parse(4,e._onMessageLength)})})},S.prototype._onFinish=function(){for(this._finished=!0,this.push(null);this.read(););for(clearInterval(this._keepAliveInterval),this._parse(Number.MAX_VALUE,function(){});this.peerRequests.length;)this.peerRequests.pop();for(;this.requests.length;)this._callback(this.requests.pop(),new Error("wire was closed"),null)},S.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._debugId+"] "+e[0],s.apply(null,e)}},{bencode:16,bitfield:18,debug:41,inherits:60,randombytes:105,"readable-stream":117,"safe-buffer":128,speedometer:134,"unordered-array-remove":155,xtend:177}],20:[function(e,t,r){(function(r){t.exports=y;var n=e("safe-buffer").Buffer,i=e("debug")("bittorrent-tracker:client"),o=e("events").EventEmitter,a=e("xtend"),s=e("inherits"),u=e("once"),c=e("run-parallel"),l=e("simple-peer"),f=e("uniq"),d=e("url"),h=e("./lib/common"),p=e("./lib/client/http-tracker"),m=e("./lib/client/udp-tracker"),g=e("./lib/client/websocket-tracker");function y(e){var t=this;if(!(t instanceof y))return new y(e);if(o.call(t),e||(e={}),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");if(!r.browser&&!e.port)throw new Error("Option `port` is required");t.peerId="string"==typeof e.peerId?e.peerId:e.peerId.toString("hex"),t._peerIdBuffer=n.from(t.peerId,"hex"),t._peerIdBinary=t._peerIdBuffer.toString("binary"),t.infoHash="string"==typeof e.infoHash?e.infoHash.toLowerCase():e.infoHash.toString("hex"),t._infoHashBuffer=n.from(t.infoHash,"hex"),t._infoHashBinary=t._infoHashBuffer.toString("binary"),i("new client %s",t.infoHash),t.destroyed=!1,t._port=e.port,t._getAnnounceOpts=e.getAnnounceOpts,t._rtcConfig=e.rtcConfig,t._userAgent=e.userAgent,t._wrtc="function"==typeof e.wrtc?e.wrtc():e.wrtc;var a="string"==typeof e.announce?[e.announce]:null==e.announce?[]:e.announce;a=a.map(function(e){return"/"===(e=e.toString())[e.length-1]&&(e=e.substring(0,e.length-1)),e}),a=f(a);var s=!1!==t._wrtc&&(!!t._wrtc||l.WEBRTC_SUPPORT);function u(e){r.nextTick(function(){t.emit("warning",e)})}t._trackers=a.map(function(e){var r=d.parse(e).protocol;return"http:"!==r&&"https:"!==r||"function"!=typeof p?"udp:"===r&&"function"==typeof m?new m(t,e):"ws:"!==r&&"wss:"!==r||!s?(u(new Error("Unsupported tracker protocol: "+e)),null):"ws:"===r&&"undefined"!=typeof window&&"https:"===window.location.protocol?(u(new Error("Unsupported tracker protocol: "+e)),null):new g(t,e):new p(t,e)}).filter(Boolean)}s(y,o),y.scrape=function(e,t){if(t=u(t),!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");var r=new y(a(e,{infoHash:Array.isArray(e.infoHash)?e.infoHash[0]:e.infoHash,peerId:n.from("01234567890123456789"),port:6881}));r.once("error",t),r.once("warning",t);var i=Array.isArray(e.infoHash)?e.infoHash.length:1,o={};return r.on("scrape",function(e){if(i-=1,o[e.infoHash]=e,0===i){r.destroy();var n=Object.keys(o);1===n.length?t(null,o[n[0]]):t(null,o)}}),e.infoHash=Array.isArray(e.infoHash)?e.infoHash.map(function(e){return n.from(e,"hex")}):n.from(e.infoHash,"hex"),r.scrape({infoHash:e.infoHash}),r},y.prototype.start=function(e){i("send `start`"),(e=this._defaultAnnounceOpts(e)).event="started",this._announce(e),this._trackers.forEach(function(e){e.setInterval()})},y.prototype.stop=function(e){i("send `stop`"),(e=this._defaultAnnounceOpts(e)).event="stopped",this._announce(e)},y.prototype.complete=function(e){i("send `complete`"),e||(e={}),(e=this._defaultAnnounceOpts(e)).event="completed",this._announce(e)},y.prototype.update=function(e){i("send `update`"),(e=this._defaultAnnounceOpts(e)).event&&delete e.event,this._announce(e)},y.prototype._announce=function(e){this._trackers.forEach(function(t){t.announce(e)})},y.prototype.scrape=function(e){i("send `scrape`"),e||(e={}),this._trackers.forEach(function(t){t.scrape(e)})},y.prototype.setInterval=function(e){i("setInterval %d",e),this._trackers.forEach(function(t){t.setInterval(e)})},y.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0,i("destroy");var t=this._trackers.map(function(e){return function(t){e.destroy(t)}});c(t,e),this._trackers=[],this._getAnnounceOpts=null}},y.prototype._defaultAnnounceOpts=function(e){return e||(e={}),null==e.numwant&&(e.numwant=h.DEFAULT_ANNOUNCE_PEERS),null==e.uploaded&&(e.uploaded=0),null==e.downloaded&&(e.downloaded=0),this._getAnnounceOpts&&(e=a(e,this._getAnnounceOpts())),e}}).call(this,e("_process"))},{"./lib/client/http-tracker":26,"./lib/client/udp-tracker":26,"./lib/client/websocket-tracker":22,"./lib/common":23,_process:98,debug:41,events:51,inherits:60,once:81,"run-parallel":126,"safe-buffer":128,"simple-peer":131,uniq:154,url:156,xtend:177}],21:[function(e,t,r){t.exports=i;var n=e("events").EventEmitter;function i(e,t){n.call(this),this.client=e,this.announceUrl=t,this.interval=null,this.destroyed=!1}e("inherits")(i,n),i.prototype.setInterval=function(e){var t=this;null==e&&(e=t.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(t.interval),e&&(t.interval=setInterval(function(){t.announce(t.client._defaultAnnounceOpts())},e),t.interval.unref&&t.interval.unref())}},{events:51,inherits:60}],22:[function(e,t,r){t.exports=h;var n=e("debug")("bittorrent-tracker:websocket-tracker"),i=e("xtend"),o=e("inherits"),a=e("simple-peer"),s=e("randombytes"),u=e("simple-websocket"),c=e("../common"),l=e("./tracker"),f={},d=5e4;function h(e,t,r){l.call(this,e,t),n("new websocket tracker %s",t),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}function p(){}o(h,l),h.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,h.prototype.announce=function(e){var t=this;if(!t.destroyed&&!t.reconnecting)if(t.socket.connected){var r=i(e,{action:"announce",info_hash:t.client._infoHashBinary,peer_id:t.client._peerIdBinary});if(t._trackerId&&(r.trackerid=t._trackerId),"stopped"===e.event||"completed"===e.event)t._send(r);else{var n=Math.min(e.numwant,10);t._generateOffers(n,function(e){r.numwant=n,r.offers=e,t._send(r)})}}else t.socket.once("connect",function(){t.announce(e)})},h.prototype.scrape=function(e){var t=this;if(!t.destroyed&&!t.reconnecting)if(t.socket.connected){var r={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(function(e){return e.toString("binary")}):e.infoHash&&e.infoHash.toString("binary")||t.client._infoHashBinary};t._send(r)}else t.socket.once("connect",function(){t.scrape(e)})},h.prototype.destroy=function(e){if(e||(e=p),this.destroyed)return e(null);for(var t in this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer),this.peers){var r=this.peers[t];clearTimeout(r.trackerTimeout),r.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,f[this.announceUrl]&&(f[this.announceUrl].consumers-=1),f[this.announceUrl].consumers>0)return e();var n=f[this.announceUrl];if(delete f[this.announceUrl],n.on("error",p),n.once("close",e),!this.expectingResponse)return o();var i=setTimeout(o,c.DESTROY_TIMEOUT);function o(){i&&(clearTimeout(i),i=null),n.removeListener("data",o),n.destroy(),n=null}n.once("data",o)},h.prototype._openSocket=function(){var e=this;e.destroyed=!1,e.peers||(e.peers={}),e._onSocketConnectBound=function(){e._onSocketConnect()},e._onSocketErrorBound=function(t){e._onSocketError(t)},e._onSocketDataBound=function(t){e._onSocketData(t)},e._onSocketCloseBound=function(){e._onSocketClose()},e.socket=f[e.announceUrl],e.socket?f[e.announceUrl].consumers+=1:(e.socket=f[e.announceUrl]=new u(e.announceUrl),e.socket.consumers=1,e.socket.once("connect",e._onSocketConnectBound)),e.socket.on("data",e._onSocketDataBound),e.socket.once("close",e._onSocketCloseBound),e.socket.once("error",e._onSocketErrorBound)},h.prototype._onSocketConnect=function(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))},h.prototype._onSocketData=function(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch(e){return void this.client.emit("warning",new Error("Invalid tracker response"))}"announce"===e.action?this._onAnnounceResponse(e):"scrape"===e.action?this._onScrapeResponse(e):this._onSocketError(new Error("invalid action in WS response: "+e.action))}},h.prototype._onAnnounceResponse=function(e){var t=this;if(e.info_hash===t.client._infoHashBinary){if(!e.peer_id||e.peer_id!==t.client._peerIdBinary){n("received %s from %s for %s",JSON.stringify(e),t.announceUrl,t.client.infoHash);var r=e["failure reason"];if(r)return t.client.emit("warning",new Error(r));var i=e["warning message"];i&&t.client.emit("warning",new Error(i));var o=e.interval||e["min interval"];o&&t.setInterval(1e3*o);var a,s=e["tracker id"];if(s&&(t._trackerId=s),null!=e.complete){var u=Object.assign({},e,{announce:t.announceUrl,infoHash:c.binaryToHex(e.info_hash)});t.client.emit("update",u)}if(e.offer&&e.peer_id&&(n("creating peer (from remote offer)"),(a=t._createPeer()).id=c.binaryToHex(e.peer_id),a.once("signal",function(r){var n={action:"announce",info_hash:t.client._infoHashBinary,peer_id:t.client._peerIdBinary,to_peer_id:e.peer_id,answer:r,offer_id:e.offer_id};t._trackerId&&(n.trackerid=t._trackerId),t._send(n)}),a.signal(e.offer),t.client.emit("peer",a)),e.answer&&e.peer_id){var l=c.binaryToHex(e.offer_id);(a=t.peers[l])?(a.id=c.binaryToHex(e.peer_id),a.signal(e.answer),t.client.emit("peer",a),clearTimeout(a.trackerTimeout),a.trackerTimeout=null,delete t.peers[l]):n("got unexpected answer: "+JSON.stringify(e.answer))}}}else n("ignoring websocket data from %s for %s (looking for %s: reused socket)",t.announceUrl,c.binaryToHex(e.info_hash),t.client.infoHash)},h.prototype._onScrapeResponse=function(e){var t=this;e=e.files||{};var r=Object.keys(e);0!==r.length?r.forEach(function(r){var n=Object.assign(e[r],{announce:t.announceUrl,infoHash:c.binaryToHex(r)});t.client.emit("scrape",n)}):t.client.emit("warning",new Error("invalid scrape response"))},h.prototype._onSocketClose=function(){this.destroyed||(this.destroy(),this._startReconnectTimer())},h.prototype._onSocketError=function(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())},h.prototype._startReconnectTimer=function(){var e=this,t=Math.floor(3e4*Math.random())+Math.min(15e3*Math.pow(2,e.retries),18e5);e.reconnecting=!0,clearTimeout(e.reconnectTimer),e.reconnectTimer=setTimeout(function(){e.retries++,e._openSocket()},t),e.reconnectTimer.unref&&e.reconnectTimer.unref(),n("reconnecting socket in %s ms",t)},h.prototype._send=function(e){if(!this.destroyed){this.expectingResponse=!0;var t=JSON.stringify(e);n("send %s",t),this.socket.send(t)}},h.prototype._generateOffers=function(e,t){var r=this,i=[];n("generating %s offers",e);for(var o=0;o<e;++o)a();function a(){var e=s(20).toString("hex");n("creating peer (from _generateOffers)");var t=r.peers[e]=r._createPeer({initiator:!0});t.once("signal",function(t){i.push({offer:t,offer_id:c.hexToBinary(e)}),u()}),t.trackerTimeout=setTimeout(function(){n("tracker timeout: destroying peer"),t.trackerTimeout=null,delete r.peers[e],t.destroy()},d),t.trackerTimeout.unref&&t.trackerTimeout.unref()}function u(){i.length===e&&(n("generated %s offers",e),t(i))}u()},h.prototype._createPeer=function(e){var t=this;e=Object.assign({trickle:!1,config:t.client._rtcConfig,wrtc:t.client._wrtc},e);var r=new a(e);return r.once("error",n),r.once("connect",function e(){r.removeListener("error",n);r.removeListener("connect",e)}),r;function n(e){t.client.emit("warning",new Error("Connection error: "+e.message)),r.destroy()}}},{"../common":23,"./tracker":21,debug:41,inherits:60,randombytes:105,"simple-peer":131,"simple-websocket":133,xtend:177}],23:[function(e,t,r){var n=e("safe-buffer").Buffer,i=e("xtend/mutable");r.DEFAULT_ANNOUNCE_PEERS=50,r.MAX_ANNOUNCE_PEERS=82,r.binaryToHex=function(e){return"string"!=typeof e&&(e=String(e)),n.from(e,"binary").toString("hex")},r.hexToBinary=function(e){return"string"!=typeof e&&(e=String(e)),n.from(e,"hex").toString("binary")},i(r,e("./common-node"))},{"./common-node":26,"safe-buffer":128,"xtend/mutable":178}],24:[function(e,t,r){(function(e){t.exports=function(t,r){if("undefined"==typeof Blob||!(t instanceof Blob))throw new Error("first argument must be a Blob");if("function"!=typeof r)throw new Error("second argument must be a function");var n=new FileReader;n.addEventListener("loadend",function t(i){n.removeEventListener("loadend",t,!1),i.error?r(i.error):r(null,e.from(n.result))},!1),n.readAsArrayBuffer(t)}}).call(this,e("buffer").Buffer)},{buffer:34}],25:[function(e,t,r){(function(r){var n=e("inherits"),i=e("readable-stream").Transform,o=e("defined");function a(e,t){if(!(this instanceof a))return new a(e,t);i.call(this),t||(t={}),"object"==typeof e&&(e=(t=e).size),this.size=e||512,t.nopad?this._zeroPadding=!1:this._zeroPadding=o(t.zeroPadding,!0),this._buffered=[],this._bufferedBytes=0}t.exports=a,n(a,i),a.prototype._transform=function(e,t,n){for(this._bufferedBytes+=e.length,this._buffered.push(e);this._bufferedBytes>=this.size;){var i=r.concat(this._buffered);this._bufferedBytes-=this.size,this.push(i.slice(0,this.size)),this._buffered=[i.slice(this.size,i.length)]}n()},a.prototype._flush=function(){if(this._bufferedBytes&&this._zeroPadding){var e=new r(this.size-this._bufferedBytes);e.fill(0),this._buffered.push(e),this.push(r.concat(this._buffered)),this._buffered=null}else this._bufferedBytes&&(this.push(r.concat(this._buffered)),this._buffered=null);this.push(null)}}).call(this,e("buffer").Buffer)},{buffer:34,defined:46,inherits:60,"readable-stream":117}],26:[function(e,t,r){},{}],27:[function(e,t,r){(function(t,n){"use strict";var i=e("assert"),o=e("pako/lib/zlib/zstream"),a=e("pako/lib/zlib/deflate.js"),s=e("pako/lib/zlib/inflate.js"),u=e("pako/lib/zlib/constants");for(var c in u)r[c]=u[c];r.NONE=0,r.DEFLATE=1,r.INFLATE=2,r.GZIP=3,r.GUNZIP=4,r.DEFLATERAW=5,r.INFLATERAW=6,r.UNZIP=7;function l(e){if("number"!=typeof e||e<r.DEFLATE||e>r.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}l.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=r.UNZIP),this.mode===r.DEFLATE||this.mode===r.GZIP||this.mode===r.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==r.INFLATE&&this.mode!==r.GUNZIP&&this.mode!==r.INFLATERAW&&this.mode!==r.UNZIP||s.inflateEnd(this.strm),this.mode=r.NONE,this.dictionary=null)},l.prototype.write=function(e,t,r,n,i,o,a){return this._write(!0,e,t,r,n,i,o,a)},l.prototype.writeSync=function(e,t,r,n,i,o,a){return this._write(!1,e,t,r,n,i,o,a)},l.prototype._write=function(e,o,a,s,u,c,l,f){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==r.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===o,"must provide flush value"),this.write_in_progress=!0,o!==r.Z_NO_FLUSH&&o!==r.Z_PARTIAL_FLUSH&&o!==r.Z_SYNC_FLUSH&&o!==r.Z_FULL_FLUSH&&o!==r.Z_FINISH&&o!==r.Z_BLOCK)throw new Error("Invalid flush value");if(null==a&&(a=n.alloc(0),u=0,s=0),this.strm.avail_in=u,this.strm.input=a,this.strm.next_in=s,this.strm.avail_out=f,this.strm.output=c,this.strm.next_out=l,this.flush=o,!e)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return t.nextTick(function(){d._process(),d._after()}),this},l.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},l.prototype._process=function(){var e=null;switch(this.mode){case r.DEFLATE:case r.GZIP:case r.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case r.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=r.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=r.GUNZIP):this.mode=r.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case r.INFLATE:case r.GUNZIP:case r.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===r.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===r.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===r.Z_DATA_ERROR&&(this.err=r.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===r.GUNZIP&&this.err===r.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},l.prototype._checkError=function(){switch(this.err){case r.Z_OK:case r.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===r.Z_FINISH)return this._error("unexpected end of file"),!1;break;case r.Z_STREAM_END:break;case r.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},l.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},l.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},l.prototype.init=function(e,t,n,o,a){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(t>=-1&&t<=9,"invalid compression level"),i(n>=1&&n<=9,"invalid memlevel"),i(o===r.Z_FILTERED||o===r.Z_HUFFMAN_ONLY||o===r.Z_RLE||o===r.Z_FIXED||o===r.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(t,e,n,o,a),this._setDictionary()},l.prototype.params=function(){throw new Error("deflateParams Not supported")},l.prototype.reset=function(){this._reset(),this._setDictionary()},l.prototype._init=function(e,t,n,i,u){switch(this.level=e,this.windowBits=t,this.memLevel=n,this.strategy=i,this.flush=r.Z_NO_FLUSH,this.err=r.Z_OK,this.mode!==r.GZIP&&this.mode!==r.GUNZIP||(this.windowBits+=16),this.mode===r.UNZIP&&(this.windowBits+=32),this.mode!==r.DEFLATERAW&&this.mode!==r.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new o,this.mode){case r.DEFLATE:case r.GZIP:case r.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,r.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case r.INFLATE:case r.GUNZIP:case r.INFLATERAW:case r.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==r.Z_OK&&this._error("Init error"),this.dictionary=u,this.write_in_progress=!1,this.init_done=!0},l.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=r.Z_OK,this.mode){case r.DEFLATE:case r.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==r.Z_OK&&this._error("Failed to set dictionary")}},l.prototype._reset=function(){switch(this.err=r.Z_OK,this.mode){case r.DEFLATE:case r.DEFLATERAW:case r.GZIP:this.err=a.deflateReset(this.strm);break;case r.INFLATE:case r.INFLATERAW:case r.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==r.Z_OK&&this._error("Failed to reset stream")},r.Zlib=l}).call(this,e("_process"),e("buffer").Buffer)},{_process:98,assert:12,buffer:34,"pako/lib/zlib/constants":84,"pako/lib/zlib/deflate.js":86,"pako/lib/zlib/inflate.js":88,"pako/lib/zlib/zstream":92}],28:[function(e,t,r){(function(t){"use strict";var n=e("buffer").Buffer,i=e("stream").Transform,o=e("./binding"),a=e("util"),s=e("assert").ok,u=e("buffer").kMaxLength,c="Cannot create final Buffer. It would be larger than 0x"+u.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var l=Object.keys(o),f=0;f<l.length;f++){var d=l[f];d.match(/^Z/)&&Object.defineProperty(r,d,{enumerable:!0,value:o[d],writable:!1})}for(var h={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},p=Object.keys(h),m=0;m<p.length;m++){var g=p[m];h[h[g]]=g}function y(e,t,r){var i=[],o=0;function a(){for(var t;null!==(t=e.read());)i.push(t),o+=t.length;e.once("readable",a)}function s(){var t,a=null;o>=u?a=new RangeError(c):t=n.concat(i,o),i=[],e.close(),r(a,t)}e.on("error",function(t){e.removeListener("end",s),e.removeListener("readable",a),r(t)}),e.on("end",s),e.end(t),a()}function v(e,t){if("string"==typeof t&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=e._finishFlushFlag;return e._processChunk(t,r)}function _(e){if(!(this instanceof _))return new _(e);R.call(this,e,o.DEFLATE)}function b(e){if(!(this instanceof b))return new b(e);R.call(this,e,o.INFLATE)}function w(e){if(!(this instanceof w))return new w(e);R.call(this,e,o.GZIP)}function E(e){if(!(this instanceof E))return new E(e);R.call(this,e,o.GUNZIP)}function S(e){if(!(this instanceof S))return new S(e);R.call(this,e,o.DEFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);R.call(this,e,o.INFLATERAW)}function k(e){if(!(this instanceof k))return new k(e);R.call(this,e,o.UNZIP)}function A(e){return e===o.Z_NO_FLUSH||e===o.Z_PARTIAL_FLUSH||e===o.Z_SYNC_FLUSH||e===o.Z_FULL_FLUSH||e===o.Z_FINISH||e===o.Z_BLOCK}function R(e,t){var a=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||r.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!A(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!A(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:o.Z_FINISH,e.chunkSize&&(e.chunkSize<r.Z_MIN_CHUNK||e.chunkSize>r.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<r.Z_MIN_WINDOWBITS||e.windowBits>r.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<r.Z_MIN_LEVEL||e.level>r.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<r.Z_MIN_MEMLEVEL||e.memLevel>r.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=r.Z_FILTERED&&e.strategy!=r.Z_HUFFMAN_ONLY&&e.strategy!=r.Z_RLE&&e.strategy!=r.Z_FIXED&&e.strategy!=r.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(t);var s=this;this._hadError=!1,this._handle.onerror=function(e,t){x(s),s._hadError=!0;var n=new Error(e);n.errno=t,n.code=r.codes[t],s.emit("error",n)};var u=r.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(u=e.level);var c=r.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(c=e.strategy),this._handle.init(e.windowBits||r.Z_DEFAULT_WINDOWBITS,u,e.memLevel||r.Z_DEFAULT_MEMLEVEL,c,e.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=u,this._strategy=c,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!a._handle},configurable:!0,enumerable:!0})}function x(e,r){r&&t.nextTick(r),e._handle&&(e._handle.close(),e._handle=null)}function L(e){e.emit("close")}Object.defineProperty(r,"codes",{enumerable:!0,value:Object.freeze(h),writable:!1}),r.Deflate=_,r.Inflate=b,r.Gzip=w,r.Gunzip=E,r.DeflateRaw=S,r.InflateRaw=T,r.Unzip=k,r.createDeflate=function(e){return new _(e)},r.createInflate=function(e){return new b(e)},r.createDeflateRaw=function(e){return new S(e)},r.createInflateRaw=function(e){return new T(e)},r.createGzip=function(e){return new w(e)},r.createGunzip=function(e){return new E(e)},r.createUnzip=function(e){return new k(e)},r.deflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new _(t),e,r)},r.deflateSync=function(e,t){return v(new _(t),e)},r.gzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new w(t),e,r)},r.gzipSync=function(e,t){return v(new w(t),e)},r.deflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new S(t),e,r)},r.deflateRawSync=function(e,t){return v(new S(t),e)},r.unzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new k(t),e,r)},r.unzipSync=function(e,t){return v(new k(t),e)},r.inflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new b(t),e,r)},r.inflateSync=function(e,t){return v(new b(t),e)},r.gunzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new E(t),e,r)},r.gunzipSync=function(e,t){return v(new E(t),e)},r.inflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),y(new T(t),e,r)},r.inflateRawSync=function(e,t){return v(new T(t),e)},a.inherits(R,i),R.prototype.params=function(e,n,i){if(e<r.Z_MIN_LEVEL||e>r.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(n!=r.Z_FILTERED&&n!=r.Z_HUFFMAN_ONLY&&n!=r.Z_RLE&&n!=r.Z_FIXED&&n!=r.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==e||this._strategy!==n){var a=this;this.flush(o.Z_SYNC_FLUSH,function(){s(a._handle,"zlib binding closed"),a._handle.params(e,n),a._hadError||(a._level=e,a._strategy=n,i&&i())})}else t.nextTick(i)},R.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},R.prototype._flush=function(e){this._transform(n.alloc(0),"",e)},R.prototype.flush=function(e,r){var i=this,a=this._writableState;("function"==typeof e||void 0===e&&!r)&&(r=e,e=o.Z_FULL_FLUSH),a.ended?r&&t.nextTick(r):a.ending?r&&this.once("end",r):a.needDrain?r&&this.once("drain",function(){return i.flush(e,r)}):(this._flushFlag=e,this.write(n.alloc(0),"",r))},R.prototype.close=function(e){x(this,e),t.nextTick(L,this)},R.prototype._transform=function(e,t,r){var i,a=this._writableState,s=(a.ending||a.ended)&&(!e||a.length===e.length);return null===e||n.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(e,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},R.prototype._processChunk=function(e,t,r){var i=e&&e.length,o=this._chunkSize-this._offset,a=0,l=this,f="function"==typeof r;if(!f){var d,h=[],p=0;this.on("error",function(e){d=e}),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,a,i,this._buffer,this._offset,o)}while(!this._hadError&&v(m[0],m[1]));if(this._hadError)throw d;if(p>=u)throw x(this),new RangeError(c);var g=n.concat(h,p);return x(this),g}s(this._handle,"zlib binding closed");var y=this._handle.write(t,e,a,i,this._buffer,this._offset,o);function v(u,c){if(this&&(this.buffer=null,this.callback=null),!l._hadError){var d=o-c;if(s(d>=0,"have should not go down"),d>0){var m=l._buffer.slice(l._offset,l._offset+d);l._offset+=d,f?l.push(m):(h.push(m),p+=m.length)}if((0===c||l._offset>=l._chunkSize)&&(o=l._chunkSize,l._offset=0,l._buffer=n.allocUnsafe(l._chunkSize)),0===c){if(a+=i-u,i=u,!f)return!0;var g=l._handle.write(t,e,a,i,l._buffer,l._offset,l._chunkSize);return g.callback=v,void(g.buffer=e)}if(!f)return!1;r()}}y.buffer=e,y.callback=v},a.inherits(_,R),a.inherits(b,R),a.inherits(w,R),a.inherits(E,R),a.inherits(S,R),a.inherits(T,R),a.inherits(k,R)}).call(this,e("_process"))},{"./binding":27,_process:98,assert:12,buffer:34,stream:135,util:162}],29:[function(e,t,r){arguments[4][26][0].apply(r,arguments)},{dup:26}],30:[function(e,t,r){(function(e){t.exports=function(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative');return e.allocUnsafe?e.allocUnsafe(t):new e(t)}}).call(this,e("buffer").Buffer)},{buffer:34}],31:[function(e,t,r){(function(r){var n=e("buffer-fill"),i=e("buffer-alloc-unsafe");t.exports=function(e,t,o){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative');if(r.alloc)return r.alloc(e,t,o);var a=i(e);return 0===e?a:void 0===t?n(a,0):("string"!=typeof o&&(o=void 0),n(a,t,o))}}).call(this,e("buffer").Buffer)},{buffer:34,"buffer-alloc-unsafe":30,"buffer-fill":32}],32:[function(e,t,r){(function(e){var r=function(){try{if(!e.isEncoding("latin1"))return!1;var t=e.alloc?e.alloc(4):new e(4);return t.fill("ab","ucs2"),"61006200"===t.toString("hex")}catch(e){return!1}}();function n(e,t,r,n){if(r<0||n>e.length)throw new RangeError("Out of range index");return r>>>=0,(n=void 0===n?e.length:n>>>0)>r&&e.fill(t,r,n),e}t.exports=function(t,i,o,a,s){if(r)return t.fill(i,o,a,s);if("number"==typeof i)return n(t,i,o,a);if("string"==typeof i){if("string"==typeof o?(s=o,o=0,a=t.length):"string"==typeof a&&(s=a,a=t.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("latin1"===s&&(s="binary"),"string"==typeof s&&!e.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(""===i)return n(t,0,o,a);if(function(e){return 1===e.length&&e.charCodeAt(0)<256}(i))return n(t,i.charCodeAt(0),o,a);i=new e(i,s)}return e.isBuffer(i)?function(e,t,r,n){if(r<0||n>e.length)throw new RangeError("Out of range index");if(n<=r)return e;r>>>=0,n=void 0===n?e.length:n>>>0;for(var i=r,o=t.length;i<=n-o;)t.copy(e,i),i+=o;return i!==n&&t.copy(e,i,0,n-i),e}(t,i,o,a):n(t,0,o,a)}}).call(this,e("buffer").Buffer)},{buffer:34}],33:[function(e,t,r){(function(e){var r=Object.prototype.toString,n="function"==typeof e.alloc&&"function"==typeof e.allocUnsafe&&"function"==typeof e.from;t.exports=function(t,i,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return a=t,"ArrayBuffer"===r.call(a).slice(8,-1)?function(t,r,i){r>>>=0;var o=t.byteLength-r;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=o;else if((i>>>=0)>o)throw new RangeError("'length' is out of bounds");return n?e.from(t.slice(r,r+i)):new e(new Uint8Array(t.slice(r,r+i)))}(t,i,o):"string"==typeof t?function(t,r){if("string"==typeof r&&""!==r||(r="utf8"),!e.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');return n?e.from(t,r):new e(t,r)}(t,i):n?e.from(t):new e(t);var a}}).call(this,e("buffer").Buffer)},{buffer:34}],34:[function(e,t,r){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=s,r.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function a(e){if(e>o)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=s.prototype,t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(e)}return u(e,t,r)}function u(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return j(e)||e&&j(e.buffer)?function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=s.prototype,n}(e,t,r):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|h(e,t),n=a(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t):function(e){if(s.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||H(e.length)?a(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e){return c(e),a(e<0?0:0|d(e))}function f(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function d(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function h(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||j(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(n)return N(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var f=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){f=!1;break}if(f)return o}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(H(s))return a;e[r+a]=s}return a}function v(e,t,r,n){return B(N(t,e.length-r),e,r,n)}function _(e,t,r,n){return B(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return _(e,t,r,n)}function w(e,t,r,n){return B(U(t),e,r,n)}function E(e,t,r,n){return B(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function T(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}r.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{get:function(){if(this instanceof s)return this.buffer}}),Object.defineProperty(s.prototype,"offset",{get:function(){if(this instanceof s)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(e,t,r){return u(e,t,r)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(e,t,r){return function(e,t,r){return c(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=s.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(ArrayBuffer.isView(o)&&(o=s.from(o)),!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},s.byteLength=h,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,r);case"utf8":case"utf-8":return T(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,r,n,i){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),u=Math.min(o,a),c=this.slice(n,i),l=e.slice(t,r),f=0;f<u;++f)if(c[f]!==l[f]){o=c[f],a=l[f];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function x(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=F(e[o]);return i}function L(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,n,o){return t=+t,r>>>=0,o||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function P(e,t,r,n,o){return t=+t,r>>>=0,o||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}s.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=s.prototype,n},s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},s.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return P(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return P(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;o>=0;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},s.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=s.isBuffer(e)?e:new s(e,n),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=a[o%u]}return this};var M=/[^+/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function U(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function j(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function H(e){return e!=e}},{"base64-js":13,ieee754:58}],35:[function(e,t,r){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],36:[function(e,t,r){(function(e){"use strict";t.exports=function(t,r){"string"==typeof t&&(t=document.querySelector(t));if(null==t||"VIDEO"!==t.nodeName)throw new TypeError("First argument must be a <video> element or selector");null==r&&(r="png");if("png"!==r&&"jpeg"!==r&&"webp"!==r)throw new TypeError('Second argument must be one of "png", "jpeg", or "webp"');const n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight,n.getContext("2d").drawImage(t,0,0);const i=n.toDataURL("image/"+r).split(",")[1];return e.from(i,"base64")}}).call(this,e("buffer").Buffer)},{buffer:34}],37:[function(e,t,r){t.exports=a;var n=e("block-stream2"),i=e("inherits"),o=e("readable-stream");function a(e,t,r){var i=this;if(!(i instanceof a))return new a(e,t,r);if(o.Writable.call(i,r),r||(r={}),!e||!e.put||!e.get)throw new Error("First argument must be an abstract-chunk-store compliant store");if(!(t=Number(t)))throw new Error("Second argument must be a chunk length");i._blockstream=new n(t,{zeroPadding:!1}),i._blockstream.on("data",function(t){if(i.destroyed)return;e.put(s,t),s+=1}).on("error",function(e){i.destroy(e)});var s=0;i.on("finish",function(){this._blockstream.end()})}i(a,o.Writable),a.prototype._write=function(e,t,r){this._blockstream.write(e,t,r)},a.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"))}},{"block-stream2":25,inherits:60,"readable-stream":117}],38:[function(e,t,r){var n=Math.abs;t.exports=function(e,t,r){var i,o,a,s=1/0,u=0,c=t.length-1;for(;u<=c&&((a=t[i=u+(c-u>>1)]-e)<0?u=i+1:a>0&&(c=i-1),(a=n(a))<s&&(s=a,o=i),t[i]!==e););return r?o:t[o]}},{}],39:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":62}],40:[function(e,t,r){(function(r,n,i){t.exports=function e(r,u,l){if("function"==typeof u)return e(r,null,u);u=u?c(u):{};b(r,u,function(e,r,c){if(e)return l(e);u.singleFileTorrent=c,function(e,r,u){var c=r.announceList;c||("string"==typeof r.announce?c=[[r.announce]]:Array.isArray(r.announce)&&(c=r.announce.map(function(e){return[e]})));c||(c=[]);n.WEBTORRENT_ANNOUNCE&&("string"==typeof n.WEBTORRENT_ANNOUNCE?c.push([[n.WEBTORRENT_ANNOUNCE]]):Array.isArray(n.WEBTORRENT_ANNOUNCE)&&(c=c.concat(n.WEBTORRENT_ANNOUNCE.map(function(e){return[e]}))));void 0===r.announce&&void 0===r.announceList&&(c=c.concat(t.exports.announceList));"string"==typeof r.urlList&&(r.urlList=[r.urlList]);var l={info:{name:r.name},"creation date":Math.ceil((Number(r.creationDate)||Date.now())/1e3),encoding:"UTF-8"};0!==c.length&&(l.announce=c[0][0],l["announce-list"]=c);void 0!==r.comment&&(l.comment=r.comment);void 0!==r.createdBy&&(l["created by"]=r.createdBy);void 0!==r.private&&(l.info.private=Number(r.private));void 0!==r.sslCert&&(l.info["ssl-cert"]=r.sslCert);void 0!==r.urlList&&(l["url-list"]=r.urlList);var f=r.pieceLength||s(e.reduce(S,0));l.info["piece length"]=f,function(e,t,r){r=g(r);var n=[],o=0,s=e.map(function(e){return e.getStream}),u=0,c=0,l=!1,f=new m(s),d=new a(t,{zeroPadding:!1});function h(e){o+=e.length;var t=c;v(e,function(e){n[t]=e,u-=1,b()}),u+=1,c+=1}function p(){l=!0,b()}function y(e){_(),r(e)}function _(){f.removeListener("error",y),d.removeListener("data",h),d.removeListener("end",p),d.removeListener("error",y)}function b(){l&&0===u&&(_(),r(null,i.from(n.join(""),"hex"),o))}f.on("error",y),f.pipe(d).on("data",h).on("end",p).on("error",y)}(e,f,function(t,n,i){if(t)return u(t);l.info.pieces=n,e.forEach(function(e){delete e.getStream}),r.singleFileTorrent?l.info.length=i:l.info.files=e,u(null,o.encode(l))})}(r,u,l)})},t.exports.parseInput=function e(t,r,n){if("function"==typeof r)return e(t,null,r);r=r?c(r):{};b(t,r,n)},t.exports.announceList=[["udp://tracker.leechers-paradise.org:6969"],["udp://tracker.coppersurfer.tk:6969"],["udp://tracker.opentrackr.org:1337"],["udp://explodie.org:6969"],["udp://tracker.empire-js.us:1337"],["wss://tracker.btorrent.xyz"],["wss://tracker.openwebtorrent.com"],["wss://tracker.fastcast.nz"]];var o=e("bencode"),a=e("block-stream2"),s=e("piece-length"),u=e("path"),c=e("xtend"),l=e("filestream/read"),f=e("flatten"),d=e("fs"),h=e("is-file"),p=e("junk"),m=e("multistream"),g=e("once"),y=e("run-parallel"),v=e("simple-sha1"),_=e("readable-stream");function b(e,t,n){var o;if(o=e,"undefined"!=typeof FileList&&o instanceof FileList&&(e=Array.prototype.slice.call(e)),Array.isArray(e)||(e=[e]),0===e.length)throw new Error("invalid input type");e.forEach(function(e){if(null==e)throw new Error("invalid input type: "+e)}),1!==(e=e.map(function(e){return T(e)&&"string"==typeof e.path&&"function"==typeof d.stat?e.path:e})).length||"string"==typeof e[0]||e[0].name||(e[0].name=t.name);var a=null;e.forEach(function(t,r){if("string"!=typeof t){var n=t.fullPath||t.name;n||(n="Unknown File "+(r+1),t.unknownName=!0),t.path=n.split("/"),t.path[0]||t.path.shift(),t.path.length<2?a=null:0===r&&e.length>1?a=t.path[0]:t.path[0]!==a&&(a=null)}}),e=e.filter(function(e){if("string"==typeof e)return!0;var t=e.path[e.path.length-1];return E(t)&&p.not(t)}),a&&e.forEach(function(e){var t=(i.isBuffer(e)||k(e))&&!e.path;"string"==typeof e||t||e.path.shift()}),!t.name&&a&&(t.name=a),t.name||e.some(function(e){return"string"==typeof e?(t.name=u.basename(e),!0):e.unknownName?void 0:(t.name=e.path[e.path.length-1],!0)}),t.name||(t.name="Unnamed Torrent "+Date.now());var s=e.reduce(function(e,t){return e+Number("string"==typeof t)},0),c=1===e.length;if(1===e.length&&"string"==typeof e[0]){if("function"!=typeof d.stat)throw new Error("filesystem paths do not work in the browser");h(e[0],function(e,t){if(e)return n(e);c=t,m()})}else r.nextTick(function(){m()});function m(){y(e.map(function(e){return function(t){var r,n={};if(T(e))n.getStream=function(e){return function(){return new l(e)}}(e),n.length=e.size;else if(i.isBuffer(e))n.getStream=(r=e,function(){var e=new _.PassThrough;return e.end(r),e}),n.length=e.length;else{if(!k(e)){if("string"==typeof e){if("function"!=typeof d.stat)throw new Error("filesystem paths do not work in the browser");return void function(e,t,r){!function e(t,r,n){d.stat(t,function(i,o){if(i)return n(i);o.isDirectory()?d.readdir(t,function(i,o){if(i)return n(i);y(o.filter(E).filter(p.not).map(function(n){return function(i){e(u.join(t,n),r,i)}}),n)}):o.isFile()&&r(t,n)})}(e,w,function(n,i){if(n)return r(n);i=Array.isArray(i)?f(i):[i],e=u.normalize(e),t&&(e=e.slice(0,e.lastIndexOf(u.sep)+1)),e[e.length-1]!==u.sep&&(e+=u.sep),i.forEach(function(t){t.getStream=function(e){return function(){return d.createReadStream(e)}}(t.path),t.path=t.path.replace(e,"").split(u.sep)}),r(null,i)})}(e,s>1||c,t)}throw new Error("invalid input type")}n.getStream=function(e,t){return function(){var r=new _.Transform;return r._transform=function(e,r,n){t.length+=e.length,this.push(e),n()},e.pipe(r),r}}(e,n),n.length=0}n.path=e.path,t(null,n)}}),function(e,t){if(e)return n(e);t=f(t),n(null,t,c)})}}function w(e,t){t=g(t),d.stat(e,function(r,n){if(r)return t(r);var i={length:n.size,path:e};t(null,i)})}function E(e){return"."!==e[0]}function S(e,t){return e+t.length}function T(e){return"undefined"!=typeof Blob&&e instanceof Blob}function k(e){return"object"==typeof e&&null!=e&&"function"==typeof e.pipe}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{_process:98,bencode:16,"block-stream2":25,buffer:34,"filestream/read":52,flatten:53,fs:29,"is-file":63,junk:66,multistream:79,once:81,path:94,"piece-length":95,"readable-stream":117,"run-parallel":126,"simple-sha1":132,xtend:177}],41:[function(e,t,r){(function(n){function i(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=i,r.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(i())}).call(this,e("_process"))},{"./debug":42,_process:98}],42:[function(e,t,r){function n(e){var t;function n(){if(n.enabled){var e=n,i=+new Date,o=i-(t||i);e.diff=o,e.prev=t,e.curr=i,t=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=r.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;u++;var i=r.formatters[n];if("function"==typeof i){var o=a[u];t=i.call(e,o),a.splice(u,1),u--}return t}),r.formatArgs.call(e,a),(n.log||r.log||console.log.bind(console)).apply(e,a)}}return n.namespace=e,n.enabled=r.enabled(e),n.useColors=r.useColors(),n.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}(e),n.destroy=i,"function"==typeof r.init&&r.init(n),r.instances.push(n),n}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}(r=t.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.instances=[],r.names=[],r.skips=[],r.formatters={}},{ms:78}],43:[function(e,t,r){var n=Array.prototype.slice,i=e("./lib/keys.js"),o=e("./lib/is_arguments.js"),a=t.exports=function(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:function(e,t,r){var c,l;if(s(e)||s(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=n.call(e),t=n.call(t),a(e,t,r));if(u(e)){if(!u(t))return!1;if(e.length!==t.length)return!1;for(c=0;c<e.length;c++)if(e[c]!==t[c])return!1;return!0}try{var f=i(e),d=i(t)}catch(e){return!1}if(f.length!=d.length)return!1;for(f.sort(),d.sort(),c=f.length-1;c>=0;c--)if(f[c]!=d[c])return!1;for(c=f.length-1;c>=0;c--)if(l=f[c],!a(e[l],t[l],r))return!1;return typeof e==typeof t}(e,t,r))};function s(e){return null==e}function u(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},{"./lib/is_arguments.js":44,"./lib/keys.js":45}],44:[function(e,t,r){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function i(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function o(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(r=t.exports=n?i:o).supported=i,r.unsupported=o},{}],45:[function(e,t,r){function n(e){var t=[];for(var r in e)t.push(r);return t}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n},{}],46:[function(e,t,r){t.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},{}],47:[function(e,t,r){t.exports=function(e,t){if("string"==typeof e){var r=e;if(!(e=window.document.querySelector(e)))throw new Error('"'+r+'" does not match any HTML elements')}if(!e)throw new Error('"'+e+'" is not a valid HTML element');"function"==typeof t&&(t={onDrop:t});var a;return e.addEventListener("dragenter",s,!1),e.addEventListener("dragover",u,!1),e.addEventListener("dragleave",c,!1),e.addEventListener("drop",l,!1),function(){f(),e.removeEventListener("dragenter",s,!1),e.removeEventListener("dragover",u,!1),e.removeEventListener("dragleave",c,!1),e.removeEventListener("drop",l,!1)};function s(e){return t.onDragEnter&&t.onDragEnter(e),e.stopPropagation(),e.preventDefault(),!1}function u(r){if(r.stopPropagation(),r.preventDefault(),t.onDragOver&&t.onDragOver(r),r.dataTransfer.items){var n=Array.from(r.dataTransfer.items),i=n.filter(function(e){return"file"===e.kind}),o=n.filter(function(e){return"string"===e.kind});if(0===i.length&&!t.onDropText)return;if(0===o.length&&!t.onDrop)return;if(0===i.length&&0===o.length)return}return e.classList.add("drag"),clearTimeout(a),r.dataTransfer.dropEffect="copy",!1}function c(e){return e.stopPropagation(),e.preventDefault(),t.onDragLeave&&t.onDragLeave(e),clearTimeout(a),a=setTimeout(f,50),!1}function l(e){e.stopPropagation(),e.preventDefault(),t.onDragLeave&&t.onDragLeave(e),clearTimeout(a),f();var r={x:e.clientX,y:e.clientY},s=e.dataTransfer.getData("text");if(s&&t.onDropText&&t.onDropText(s,r),t.onDrop&&e.dataTransfer.items){var u=e.dataTransfer.files,c=Array.from(e.dataTransfer.items).filter(function(e){return"file"===e.kind});if(0===c.length)return;i(c.map(function(e){return function(t){!function(e,t){var r=[];if(e.isFile)e.file(function(r){r.fullPath=e.fullPath,t(null,r)},function(e){t(e)});else if(e.isDirectory){var n=e.createReader();!function e(){n.readEntries(function(n){n.length>0?(r=r.concat(Array.from(n)),e()):i(r.map(function(e){return function(t){o(e,t)}}),t)})}()}}(e.webkitGetAsEntry(),t)}}),function(e,i){if(e)throw e;t.onDrop(n(i),r,u)})}return!1}function f(){e.classList.remove("drag")}};var n=e("flatten"),i=e("run-parallel");function o(e,t){var r=[];if(e.isFile){e.file(function(r){r.fullPath=e.fullPath;t(null,r)},function(e){t(e)})}else if(e.isDirectory){var n=e.createReader();a()}function a(){n.readEntries(function(e){if(e.length>0){r=r.concat(Array.from(e));a()}else{s()}})}function s(){i(r.map(function(e){return function(t){o(e,t)}}),t)}}},{flatten:53,"run-parallel":126}],48:[function(e,t,r){var n=e("events").EventEmitter,i=e("get-browser-rtc");t.exports=function(e){var t=new n;return Object.assign(t,i(),{close:function(){},electronDaemon:t})}},{events:51,"get-browser-rtc":55}],49:[function(e,t,r){var n=e("once"),i=function(){},o=function(e,t,r){if("function"==typeof t)return o(e,null,t);t||(t={}),r=n(r||i);var a=e._writableState,s=e._readableState,u=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,l=function(){e.writable||f()},f=function(){c=!1,u||r.call(e)},d=function(){u=!1,c||r.call(e)},h=function(t){r.call(e,t?new Error("exited with error code: "+t):null)},p=function(t){r.call(e,t)},m=function(){return(!u||s&&s.ended)&&(!c||a&&a.ended)?void 0:r.call(e,new Error("premature close"))},g=function(){e.req.on("finish",f)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?c&&!a&&(e.on("end",l),e.on("close",l)):(e.on("complete",f),e.on("abort",m),e.req?g():e.on("request",g)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(e)&&e.on("exit",h),e.on("end",d),e.on("finish",f),!1!==t.error&&e.on("error",p),e.on("close",m),function(){e.removeListener("complete",f),e.removeListener("abort",m),e.removeListener("request",g),e.req&&e.req.removeListener("finish",f),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",f),e.removeListener("exit",h),e.removeListener("end",d),e.removeListener("error",p),e.removeListener("close",m)}};t.exports=o},{once:81}],50:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}Object.defineProperty(r,"__esModule",{value:!0});var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(r,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:r.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(r,r.constructor),n(r)):(Object.defineProperty(r,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i(Error)),t}();r.default=o,t.exports=r.default},{}],51:[function(e,t,r){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var s,u=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),s=0===c.x}catch(e){s=!1}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function f(e,t,r,i){var o,a,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]):(a=e._events=n(null),e._eventsCount=0),s){if("function"==typeof s?s=a[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),!s.warned&&(o=l(e))&&o>0&&s.length>o){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else s=a[t]=r,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=o.call(d,n);return i.listener=r,n.wrapFn=i,i}function p(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}s?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');u=e}}):a.defaultMaxListeners=u,a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){var t,r,n,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(r=a[e]))return!1;var c="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=m(e,n),o=0;o<n;++o)i[o].call(r)}(r,c,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=m(e,i),a=0;a<i;++a)o[a].call(r,n)}(r,c,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,a=m(e,o),s=0;s<o;++s)a[s].call(r,n,i)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var a=e.length,s=m(e,a),u=0;u<a;++u)s[u].call(r,n,i,o)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=m(e,i),a=0;a<i;++a)o[a].apply(r,n)}(r,c,this,i)}return!0},a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return f(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,i,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(i[e]=r[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,r,o;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var a,s=i(r);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],52:[function(e,t,r){var n=e("readable-stream").Readable,i=e("inherits"),o=e("typedarray-to-buffer");function a(e,t){var r=this;if(!(this instanceof a))return new a(e,t);t=t||{},n.call(this,t),this._offset=0,this._ready=!1,this._file=e,this._size=e.size,this._chunkSize=t.chunkSize||Math.max(this._size/1e3,204800),this.reader=new FileReader,this._generateHeaderBlocks(e,t,function(e,t){if(e)return r.emit("error",e);Array.isArray(t)&&t.forEach(function(e){r.push(e)}),r._ready=!0,r.emit("_ready")})}i(a,n),t.exports=a,a.prototype._generateHeaderBlocks=function(e,t,r){r(null,[])},a.prototype._read=function(){if(this._ready){var e=this,t=this.reader,r=this._offset,n=this._offset+this._chunkSize;if(n>this._size&&(n=this._size),r===this._size)return this.destroy(),void this.push(null);t.onload=function(){e._offset=n,e.push(o(t.result))},t.onerror=function(){e.emit("error",t.error)},t.readAsArrayBuffer(this._file.slice(r,n))}else this.once("_ready",this._read.bind(this))},a.prototype.destroy=function(){if(this._file=null,this.reader){this.reader.onload=null,this.reader.onerror=null;try{this.reader.abort()}catch(e){}}this.reader=null}},{inherits:60,"readable-stream":117,"typedarray-to-buffer":152}],53:[function(e,t,r){t.exports=function(e,t){return(t="number"==typeof t?t:1/0)?function e(r,n){return r.reduce(function(r,i){return Array.isArray(i)&&n<t?r.concat(e(i,n+1)):r.concat(i)},[])}(e,1):Array.isArray(e)?e.map(function(e){return e}):e}},{}],54:[function(e,t,r){"use strict";t.exports=(e=>{let t=null;return()=>null!=t?t:t=e()})},{}],55:[function(e,t,r){t.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},{}],56:[function(e,t,r){var n,i;"undefined"!=typeof window&&(n=this,i=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=11)}([function(e,t,r){"use strict";r.d(t,"a",function(){return l}),r.d(t,"b",function(){return f});var n=r(4),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(){}var a={trace:o,debug:o,log:o,warn:o,info:o,error:o},s=a;var u=Object(n.a)();function c(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach(function(t){s[t]=e[t]?e[t].bind(e):function(e){var t=u.console[e];return t?function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];n[0]&&(n[0]=function(e,t){return t="["+e+"] > "+t}(e,n[0])),t.apply(u.console,n)}:o}(t)})}var l=function(e){if(!0===e||"object"===(void 0===e?"undefined":i(e))){c(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=a}}else s=a},f=s},function(e,t,r){"use strict";t.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return i});var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},i={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},function(e,t,r){"use strict";t.a=function(){return"undefined"==typeof window?self:window}},function(e,t,r){var n,i,o,a,s;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/;?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=this.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var o=this.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return r.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=this.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=i.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var c={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var l=a.path,f=l.substring(0,l.lastIndexOf("/")+1)+o.path;c.path=s.normalizePath(f)}else c.path=a.path,o.params||(c.params=a.params,o.query||(c.query=a.query));return null===c.path&&(c.path=r.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(c)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},function(e,t,r){"use strict";r.d(t,"b",function(){return i});var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,r){for(var n=r,i=0;e.isHeader(t,r);){i+=10,i+=e._readSize(t,r+6),e.isFooter(t,r+10)&&(i+=10),r+=i}if(i>0)return t.subarray(n,n+i)},e._readSize=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},e.getTimeStamp=function(t){for(var r=e.getID3Frames(t),n=0;n<r.length;n++){var i=r[n];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:r,size:n,data:t.subarray(10,10+n)}},e.getID3Frames=function(t){for(var r=0,n=[];e.isHeader(t,r);){for(var i=e._readSize(t,r+6),o=(r+=10)+i;r+8<o;){var a=e._getFrameData(t.subarray(r)),s=e._decodeFrame(a);s&&n.push(s),r+=a.size+10}e.isFooter(t,r)&&(r+=10)}return n},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var r=e._utf8ArrayToStr(t.data,!0),n=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:n.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var r=1,n=e._utf8ArrayToStr(t.data.subarray(r));r+=n.length+1;var i=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:n,data:i}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var r=1,n=e._utf8ArrayToStr(t.data.subarray(r));r+=n.length+1;var i=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:n,data:i}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.length,n=void 0,i=void 0,o=void 0,a="",s=0;s<r;){if(0===(n=e[s++])&&t)return a;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=e[s++],a+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=e[s++],o=e[s++],a+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&o)<<0)}}return a},e}(),i=n._utf8ArrayToStr;t.a=n},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,a,s,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(i(r))for(s=Array.prototype.slice.call(arguments,1),a=(c=r.slice()).length,u=0;u<a;u++)c[u].apply(this,s);return!0},r.prototype.addListener=function(e,t){var a;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(a=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,o,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(r=this._events[e]).length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(s=a;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=s;break}if(o<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";var n=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.aesIV=r}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();var i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.key=r}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],o=r[2],a=r[3],s=this.invSubMix,u=s[0],c=s[1],l=s[2],f=s[3],d=new Uint32Array(256),h=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[h]=g,t[g]=h;var y=d[h],v=d[y],_=d[v],b=257*d[g]^16843008*g;n[h]=b<<24|b>>>8,i[h]=b<<16|b>>>16,o[h]=b<<8|b>>>24,a[h]=b,b=16843009*_^65537*v^257*y^16843008*h,u[g]=b<<24|b>>>8,c[g]=b<<16|b>>>16,l[g]=b<<8|b>>>24,f[g]=b,h?(h=y^d[d[d[_^y]]],p^=d[d[p]]):h=p=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o=this.ksRows=4*(i+6+1),a=void 0,s=void 0,u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),l=this.sBox,f=this.rcon,d=this.invSubMix,h=d[0],p=d[1],m=d[2],g=d[3],y=void 0,v=void 0;for(a=0;a<o;a++)a<i?y=u[a]=t[a]:(v=y,a%i==0?(v=l[(v=v<<8|v>>>24)>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[255&v],v^=f[a/i|0]<<24):i>6&&a%i==4&&(v=l[v>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[255&v]),u[a]=y=(u[a-i]^v)>>>0);for(s=0;s<o;s++)a=o-s,v=3&s?u[a]:u[a-4],c[s]=s<4||a<=4?v:h[l[v>>>24]]^p[l[v>>>16&255]]^m[l[v>>>8&255]]^g[l[255&v]],c[s]=c[s]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,r,n){for(var i,o,a,s=this.keySize+6,u=this.invKeySchedule,c=this.invSBox,l=this.invSubMix,f=l[0],d=l[1],h=l[2],p=l[3],m=this.uint8ArrayToUint32Array_(r),g=m[0],y=m[1],v=m[2],_=m[3],b=new Int32Array(e),w=new Int32Array(b.length),E=void 0,S=void 0,T=void 0,k=void 0,A=void 0,R=void 0,x=void 0,L=void 0,I=void 0,C=void 0,O=void 0,D=void 0,P=void 0,M=void 0,F=this.networkToHostOrderSwap;t<b.length;){for(I=F(b[t]),C=F(b[t+1]),O=F(b[t+2]),D=F(b[t+3]),A=I^u[0],R=D^u[1],x=O^u[2],L=C^u[3],P=4,M=1;M<s;M++)E=f[A>>>24]^d[R>>16&255]^h[x>>8&255]^p[255&L]^u[P],S=f[R>>>24]^d[x>>16&255]^h[L>>8&255]^p[255&A]^u[P+1],T=f[x>>>24]^d[L>>16&255]^h[A>>8&255]^p[255&R]^u[P+2],k=f[L>>>24]^d[A>>16&255]^h[R>>8&255]^p[255&x]^u[P+3],A=E,R=S,x=T,L=k,P+=4;E=c[A>>>24]<<24^c[R>>16&255]<<16^c[x>>8&255]<<8^c[255&L]^u[P],S=c[R>>>24]<<24^c[x>>16&255]<<16^c[L>>8&255]<<8^c[255&A]^u[P+1],T=c[x>>>24]<<24^c[L>>16&255]<<16^c[A>>8&255]<<8^c[255&R]^u[P+2],k=c[L>>>24]<<24^c[A>>16&255]<<16^c[R>>8&255]<<8^c[255&x]^u[P+3],P+=3,w[t]=F(E^g),w[t+1]=F(k^y),w[t+2]=F(T^v),w[t+3]=F(S^_),g=I,y=C,v=O,_=D,t+=4}return n?(i=w.buffer,o=i.byteLength,(a=o&&new DataView(i).getUint8(o-1))?i.slice(0,o-a):i):w.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),a=r(2),s=r(0),u=r(1),c=r(4);var l=Object(c.a)(),f=function(){function e(t,r){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,i=void 0===n||n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logEnabled=!0,this.observer=t,this.config=r,this.removePKCS7Padding=i,i)try{var o=l.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,r,a){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.b.log("JS AES decrypt"),this.logEnabled=!1);var c=this.decryptor;c||(this.decryptor=c=new o),c.expandKey(t),a(c.decrypt(e,0,r,this.removePKCS7Padding))}else{this.logEnabled&&(s.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(l,t)),this.fastAesKey.expandKey().then(function(i){new n(l,r).decrypt(e,i).catch(function(n){u.onWebCryptoError(n,e,t,r,a)}).then(function(e){a(e)})}).catch(function(n){u.onWebCryptoError(n,e,t,r,a)})}},e.prototype.onWebCryptoError=function(e,t,r,n,i){this.config.enableSoftwareAES?(s.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,n,i)):(s.b.error("decrypting error : "+e.message),this.observer.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.a=f},function(e,t,r){"use strict";var n=r(0),i=r(1);var o=Math.pow(2,32)-1,a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.remuxer=r}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,r,n,o){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==r&&(r="mp4a.40.5"),null==n&&(n="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:r+","+n,initSegment:o?t:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:r,initSegment:o?t:null}),a.video&&(s.video={container:"video/mp4",codec:n,initSegment:o?t:null})),this.observer.trigger(i.a.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else r&&(this.audioCodec=r),n&&(this.videoCodec=n)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r},e.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},e.findBox=function(t,r){var n=[],i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0;if(t.data?(u=t.start,a=t.end,t=t.data):(u=0,a=t.byteLength),!r.length)return null;for(i=u;i<a;)c=(o=e.readUint32(t,i))>1?i+o:a,e.bin2str(t.subarray(i+4,i+8))===r[0]&&(1===r.length?n.push({data:t,start:i+8,end:c}):(s=e.findBox({data:t,start:i+8,end:c},r.slice(1))).length&&(n=n.concat(s))),i=c;return n},e.parseSegmentIndex=function(t){var r=e.findBox(t,["moov"])[0],n=r?r.end:null,i=0,o=e.findBox(t,["sidx"]),a=void 0;if(!o||!o[0])return null;a=[];var s=(o=o[0]).data[0];i=0===s?8:16;var u=e.readUint32(o,i);i+=4;i+=0===s?8:16,i+=2;var c=o.end+0,l=e.readUint16(o,i);i+=2;for(var f=0;f<l;f++){var d=i,h=e.readUint32(o,d);d+=4;var p=2147483647&h;if(1===(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var m=e.readUint32(o,d);d+=4,a.push({referenceSize:p,subsegmentDuration:m,info:{duration:m/u,start:c,end:c+p-1}}),c+=p,i=d+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:l,references:a,moovEndOffset:n}},e.parseInitSegment=function(t){var r=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var o=i.data[i.start],a=0===o?12:20,s=e.readUint32(i,a),u=e.findBox(t,["mdia","mdhd"])[0];if(u){a=0===(o=u.data[u.start])?12:20;var c=e.readUint32(u,a),l=e.findBox(t,["mdia","hdlr"])[0];if(l){var f={soun:"audio",vide:"video"}[e.bin2str(l.data.subarray(l.start+8,l.start+12))];if(f){var d=e.findBox(t,["mdia","minf","stbl","stsd"]);if(d.length){d=d[0];var h=e.bin2str(d.data.subarray(d.start+12,d.start+16));n.b.log("MP4Demuxer:"+f+":"+h+" found")}r[s]={timescale:c,type:f},r[f]={timescale:c,id:s}}}}}}),r},e.getStartDTS=function(t,r){var n,i,o=void 0;return o=e.findBox(r,["moof","traf"]),n=[].concat.apply([],o.map(function(r){return e.findBox(r,["tfhd"]).map(function(n){var i,o;return i=e.readUint32(n,4),o=t[i].timescale||9e4,e.findBox(r,["tfdt"]).map(function(t){var r,n=void 0;return r=t.data[t.start],n=e.readUint32(t,4),1===r&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n})[0]/o})})),i=Math.min.apply(null,n),isFinite(i)?i:0},e.offsetStartDTS=function(t,r,n){e.findBox(r,["moof","traf"]).map(function(r){return e.findBox(r,["tfhd"]).map(function(i){var a=e.readUint32(i,4),s=t[a].timescale||9e4;e.findBox(r,["tfdt"]).map(function(t){var r=t.data[t.start],i=e.readUint32(t,4);if(0===r)e.writeUint32(t,4,i-n*s);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=n*s,i=Math.max(i,0);var a=Math.floor(i/(o+1)),u=Math.floor(i%(o+1));e.writeUint32(t,4,a),e.writeUint32(t,8,u)}})})})},e.prototype.append=function(t,r,n,o){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var s,u=this.initPTS;if(void 0===u){var c=e.getStartDTS(a,t);this.initPTS=u=c-r,this.observer.trigger(i.a.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(a,t,u),s=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,s,n,o,t)},e.prototype.destroy=function(){},e}();t.a=a},function(e,t,r){"use strict";var n=r(1),i=r(2),o=r(8),a=r(3),s=r(0),u=r(4);function c(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function f(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function d(e,t){return!!(t+1<e.length&&c(e,t))}function h(e,t){if(t+1<e.length&&c(e,t)){var r=l(e,t);t+5<e.length&&(r=f(e,t));var n=t+r;if(n===e.length||n+1<e.length&&c(e,n))return!0}return!1}function p(e,t,r,o,a){if(!e.samplerate){var u=function(e,t,r,o){var a,u=void 0,c=void 0,l=void 0,f=void 0,d=navigator.userAgent.toLowerCase(),h=o,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(u=1+((192&t[r+2])>>>6),!((a=(60&t[r+2])>>>2)>p.length-1))return l=(1&t[r+2])<<2,l|=(192&t[r+3])>>>6,s.b.log("manifest codec:"+o+",ADTS data:type:"+u+",sampleingIndex:"+a+"["+p[a]+"Hz],channelConfig:"+l),/firefox/i.test(d)?a>=6?(u=5,f=new Array(4),c=a-3):(u=2,f=new Array(2),c=a):-1!==d.indexOf("android")?(u=2,f=new Array(2),c=a):(u=5,f=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&a>=6?c=a-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(a>=6&&1===l||/vivaldi/i.test(d))||!o&&1===l)&&(u=2,f=new Array(2)),c=a)),f[0]=u<<3,f[0]|=(14&a)>>1,f[1]|=(1&a)<<7,f[1]|=l<<3,5===u&&(f[1]|=(14&c)>>1,f[2]=(1&c)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:p[a],channelCount:l,codec:"mp4a.40."+u,manifestCodec:h};e.trigger(n.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a})}(t,r,o,a);e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,s.b.log("parsed codec:"+e.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount)}}function m(e){return 9216e4/e}function g(e,t,r,n,i){var o=function(e,t,r,n,i){var o,a=void 0,s=e.length;if(o=l(e,t),a=f(e,t),(a-=o)>0&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:r+n*i}}(t,r,n,i,m(e.samplerate));if(o){var a=o.stamp,s=o.headerLength,u=o.frameLength,c={unit:t.subarray(r+s,r+s+u),pts:a,dts:a};return e.samples.push(c),e.len+=u,{sample:c,length:u+s}}}var y=r(6);var v=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=n,this.remuxer=r}return e.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(y.a.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(h(e,t))return s.b.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,t,r,n){for(var i=this._audioTrack,o=y.a.getID3Data(e,0)||[],u=y.a.getTimeStamp(o),c=Object(a.a)(u)?90*u:9e4*t,l=0,f=c,h=e.length,m=o.length,v=[{pts:f,dts:f,data:o}];m<h-1;)if(d(e,m)&&m+5<h){p(i,this.observer,e,m,i.manifestCodec);var _=g(i,e,m,c,l);if(!_){s.b.log("Unable to parse AAC frame");break}m+=_.length,f=_.sample.pts,l++}else y.a.isHeader(e,m)?(o=y.a.getID3Data(e,m),v.push({pts:f,dts:f,data:o}),m+=o.length):m++;this.remuxer.remux(i,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},t,r,n)},e.prototype.destroy=function(){},e}(),_=r(9),b={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,n,i){if(!(r+24>t.length)){var o=this.parseHeader(t,r);if(o&&r+o.frameLength<=t.length){var a=n+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(r,r+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),e.len+=o.frameLength,{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,o=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!==r&&0!==i&&15!==i&&3!==o){var s=3===r?3-n:3===n?3:4,u=1e3*b.BitratesMap[14*s+i-1],c=3===r?0:2===r?1:2,l=b.SamplingRateMap[3*c+o],f=e[t+3]>>6==3?1:2,d=b.SamplesCoefficients[r][n],h=b.BytesInSlot[n],p=8*d*h;return{sampleRate:l,channelCount:f,frameLength:parseInt(d*u/l+a,10)*h,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),n=4;r&&r.frameLength&&(n=r.frameLength);var i=t+n;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},w=b;var E=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},e.prototype.skipBits=function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&s.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},e.prototype.skipLZ=function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t=8,r=8,n=void 0;for(n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},e.prototype.readSPS=function(){var e,t,r,n,i=0,o=0,a=0,s=0,u=void 0,c=void 0,l=void 0,f=this.readUByte.bind(this),d=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),g=this.skipEG.bind(this),y=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(f(),e=f(),d(5),m(3),f(),y(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=h();if(3===_&&m(1),y(),y(),m(1),p())for(c=3!==_?8:12,l=0;l<c;l++)p()&&v(l<6?16:64)}y();var b=h();if(0===b)h();else if(1===b)for(m(1),g(),g(),u=h(),l=0;l<u;l++)g();y(),m(1),t=h(),r=h(),0===(n=d(1))&&m(1),m(1),p()&&(i=h(),o=h(),a=h(),s=h());var w=[1,1];if(p()&&p())switch(f()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:w=[f()<<8|f(),f()<<8|f()]}return{width:Math.ceil(16*(t+1)-2*i-2*o),height:(2-n)*(r+1)*16-(n?2:4)*(a+s),pixelRatio:w}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();var S=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.decryptdata=n,this.discardEPB=i,this.decrypter=new o.a(t,r,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,r,n){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,function(o){o=new Uint8Array(o),i.set(o,16),n||s.decryptAacSamples(e,t+1,r)})},e.prototype.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<=e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(t.subarray(r,r+16),n);return e},e.prototype.decryptAvcSample=function(e,t,r,n,i,o){var a=this.discardEPB(i.data),s=this.getAvcEncryptedData(a),u=this;this.decryptBuffer(s.buffer,function(s){i.data=u.getAvcDecryptedUnit(a,s),o||u.decryptAvcSamples(e,t,r+1,n)})},e.prototype.decryptAvcSamples=function(e,t,r,n){for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var o=i[r];if(!(o.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,o,a),!a)return}}}},e}();var T={video:1,audio:2,id3:3,text:4},k=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=n,this.typeSupported=i,this.remuxer=r,this.sampleAes=null}return e.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new S(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var r=e._syncOffset(t);return!(r<0)&&(r&&s.b.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:T[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,r,n,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=n,this._duration=i},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,r,o,a){var u=void 0,c=t.length,l=void 0,f=void 0,d=void 0,h=void 0,p=!1;this.contiguous=o;var m=this.pmtParsed,g=this._avcTrack,y=this._audioTrack,v=this._id3Track,_=g.pid,b=y.pid,w=v.pid,E=this._pmtId,S=g.pesData,T=y.pesData,k=v.pesData,A=this._parsePAT,R=this._parsePMT,x=this._parsePES,L=this._parseAVCPES.bind(this),I=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),D=e._syncOffset(t);for(c-=(c+D)%188,u=D;u<c;u+=188)if(71===t[u]){if(l=!!(64&t[u+1]),f=((31&t[u+1])<<8)+t[u+2],(48&t[u+3])>>4>1){if((d=u+5+t[u+4])===u+188)continue}else d=u+4;switch(f){case _:l&&(S&&(h=x(S))&&void 0!==h.pts&&L(h,!1),S={data:[],size:0}),S&&(S.data.push(t.subarray(d,u+188)),S.size+=u+188-d);break;case b:l&&(T&&(h=x(T))&&void 0!==h.pts&&(y.isAAC?I(h):C(h)),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,u+188)),T.size+=u+188-d);break;case w:l&&(k&&(h=x(k))&&void 0!==h.pts&&O(h),k={data:[],size:0}),k&&(k.data.push(t.subarray(d,u+188)),k.size+=u+188-d);break;case 0:l&&(d+=t[d]+1),E=this._pmtId=A(t,d);break;case E:l&&(d+=t[d]+1);var P=R(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(_=P.avc)>0&&(g.pid=_),(b=P.audio)>0&&(y.pid=b,y.isAAC=P.isAAC),(w=P.id3)>0&&(v.pid=w),p&&!m&&(s.b.log("reparse from beginning"),p=!1,u=D-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(n.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(h=x(S))&&void 0!==h.pts?(L(h,!0),g.pesData=null):g.pesData=S,T&&(h=x(T))&&void 0!==h.pts?(y.isAAC?I(h):C(h),y.pesData=null):(T&&T.size&&s.b.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=T),k&&(h=x(k))&&void 0!==h.pts?(O(h),v.pesData=null):v.pesData=k,null==this.sampleAes?this.remuxer.remux(y,g,v,this._txtTrack,r,o,a):this.decryptAndRemux(y,g,v,this._txtTrack,r,o,a)},e.prototype.decryptAndRemux=function(e,t,r,n,i,o,a){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,r,n,i,o,a)})}else this.decryptAndRemuxAvc(e,t,r,n,i,o,a)},e.prototype.decryptAndRemuxAvc=function(e,t,r,n,i,o,a){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,r,n,i,o,a)})}else this.remuxer.remux(e,t,r,n,i,o,a)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,r,n){var i,o=void 0,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){s.b.log("unkown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!n){s.b.log("unkown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:r?-1===a.audio&&(a.audio=o,a.isAAC=!1):s.b.log("MPEG audio found, not supported in this browser for now");break;case 36:s.b.warn("HEVC stream type found, not supported for now");break;default:s.b.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},e.prototype._parsePES=function(e){var t=0,r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,u=void 0,c=void 0,l=void 0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var d=new Uint8Array(f[0].length+f[1].length);d.set(f[0]),d.set(f[1],f[0].length),f[0]=d,f.splice(1,1)}if(1===((r=f[0])[0]<<16)+(r[1]<<8)+r[2]){if((i=(r[4]<<8)+r[5])&&i>e.size-6)return null;192&(n=r[7])&&((u=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2)>4294967295&&(u-=8589934592),64&n?((c=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>4294967295&&(c-=8589934592),u-c>54e5&&(s.b.warn(Math.round((u-c)/9e4)+"s delta between PTS and DTS, align them"),u=c)):c=u),l=(o=r[8])+9,e.size-=l,a=new Uint8Array(e.size);for(var h=0,p=f.length;h<p;h++){var m=(r=f[h]).byteLength;if(l){if(l>m){l-=m;continue}r=r.subarray(l),m-=l,l=0}a.set(r,t),t+=m}return i&&(i-=o+3),{data:a,pts:u,dts:c,len:i}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,n=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,r.push(e)):t.dropped++}e.debug.length&&s.b.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var r=this,n=this._avcTrack,i=this._parseAVCNALu(e.data),o=void 0,a=this.avcSample,s=void 0,u=!1,c=void 0,l=this.pushAccesUnit.bind(this),f=function(e,t,r,n){return{key:e,pts:t,dts:r,units:[],debug:n}};e.data=null,a&&i.length&&!n.audFound&&(l(a,n),a=this.avcSample=f(!1,e.pts,e.dts,"")),i.forEach(function(t){switch(t.type){case 1:s=!0,a||(a=r.avcSample=f(!0,e.pts,e.dts,"")),a.frame=!0;var i=t.data;if(u&&i.length>4){var d=new E(i).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(a.key=!0)}break;case 5:s=!0,a||(a=r.avcSample=f(!0,e.pts,e.dts,"")),a.key=!0,a.frame=!0;break;case 6:s=!0,(o=new E(r.discardEPB(t.data))).readUByte();for(var h=0,p=0,m=!1,g=0;!m&&o.bytesAvailable>1;){h=0;do{h+=g=o.readUByte()}while(255===g);p=0;do{p+=g=o.readUByte()}while(255===g);if(4===h&&0!==o.bytesAvailable){if(m=!0,181===o.readUByte())if(49===o.readUShort())if(1195456820===o.readUInt())if(3===o.readUByte()){var y=o.readUByte(),v=31&y,_=[y,o.readUByte()];for(c=0;c<v;c++)_.push(o.readUByte()),_.push(o.readUByte()),_.push(o.readUByte());r._insertSampleInOrder(r._txtTrack.samples,{type:3,pts:e.pts,bytes:_})}}else if(p<o.bytesAvailable)for(c=0;c<p;c++)o.readUByte()}break;case 7:if(s=!0,u=!0,!n.sps){var b=(o=new E(t.data)).readSPS();n.width=b.width,n.height=b.height,n.pixelRatio=b.pixelRatio,n.sps=[t.data],n.duration=r._duration;var w=t.data.subarray(1,4),S="avc1.";for(c=0;c<3;c++){var T=w[c].toString(16);T.length<2&&(T="0"+T),S+=T}n.codec=S}break;case 8:s=!0,n.pps||(n.pps=[t.data]);break;case 9:s=!1,n.audFound=!0,a&&l(a,n),a=r.avcSample=f(!1,e.pts,e.dts,"");break;case 12:s=!1;break;default:s=!1,a&&(a.debug+="unknown NAL "+t.type+" ")}a&&s&&a.units.push(t)}),t&&a&&(l(a,n),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var r=this._avcTrack.samples;e=r[r.length-1]}if(e){var n=e.units;t=n[n.length-1]}return t},e.prototype._parseAVCNALu=function(e){var t=0,r=e.byteLength,n=void 0,i=void 0,o=this._avcTrack,a=o.naluState||0,s=a,u=[],c=void 0,l=-1,f=void 0;for(-1===a&&(l=0,f=31&e[0],a=0,t=1);t<r;)if(n=e[t++],a)if(1!==a)if(n)if(1===n){if(l>=0)c={data:e.subarray(l,t-a-1),type:f},u.push(c);else{var d=this._getLastNalUnit();if(d&&(s&&t<=4-s&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-s)),(i=t-a-1)>0)){var h=new Uint8Array(d.data.byteLength+i);h.set(d.data,0),h.set(e.subarray(0,i),d.data.byteLength),d.data=h}}t<r?(l=t,f=31&e[t],a=0):a=-1}else a=0;else a=3;else a=n?0:2;else a=n?0:1;if(l>=0&&a>=0&&(c={data:e.subarray(l,r),type:f,state:a},u.push(c)),0===u.length){var p=this._getLastNalUnit();if(p){var m=new Uint8Array(p.data.byteLength+e.byteLength);m.set(p.data,0),m.set(e,p.data.byteLength),p.data=m}}return o.naluState=a,u},e.prototype.discardEPB=function(e){for(var t,r=e.byteLength,n=[],i=1,o=void 0;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;t=r-n.length,o=new Uint8Array(t);var a=0;for(i=0;i<t;a++,i++)a===n[0]&&(a++,n.shift()),o[i]=e[a];return o},e.prototype._parseAACPES=function(e){var t,r,o=this._audioTrack,a=e.data,u=e.pts,c=this.aacOverFlow,l=this.aacLastPTS,f=void 0,h=void 0,y=void 0;if(c){var v=new Uint8Array(c.byteLength+a.byteLength);v.set(c,0),v.set(a,c.byteLength),a=v}for(h=0,r=a.length;h<r-1&&!d(a,h);h++);if(h){var _=void 0,b=void 0;if(h<r-1?(_="AAC PES did not start with ADTS header,offset:"+h,b=!1):(_="no ADTS header found in AAC PES",b=!0),s.b.warn("parsing error:"+_),this.observer.trigger(n.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:b,reason:_}),b)return}if(p(o,this.observer,a,h,this.audioCodec),f=0,t=m(o.samplerate),c&&l){var w=l+t;Math.abs(w-u)>1&&(s.b.log("AAC: align PTS for overlapping frames by "+Math.round((w-u)/90)),u=w)}for(;h<r;)if(d(a,h)&&h+5<r){var E=g(o,a,h,u,f);if(!E)break;h+=E.length,y=E.sample.pts,f++}else h++;c=h<r?a.subarray(h,r):null,this.aacOverFlow=c,this.aacLastPTS=y},e.prototype._parseMPEGPES=function(e){for(var t=e.data,r=t.length,n=0,i=0,o=e.pts;i<r;)if(w.isHeader(t,i)){var a=w.appendFrame(this._audioTrack,t,i,o,n);if(!a)break;i+=a.length,n++}else i++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}();var A=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=n,this.remuxer=r}return e.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t=void 0,r=void 0,n=y.a.getID3Data(e,0);if(n&&void 0!==y.a.getTimeStamp(n))for(t=n.length,r=Math.min(e.length-1,t+100);t<r;t++)if(w.probe(e,t))return s.b.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,r,n){for(var i=y.a.getID3Data(e,0),o=y.a.getTimeStamp(i),a=o?90*o:9e4*t,s=i.length,u=e.length,c=0,l=0,f=this._audioTrack,d=[{pts:a,dts:a,data:i}];s<u;)if(w.isHeader(e,s)){var h=w.appendFrame(f,e,s,a,c);if(!h)break;s+=h.length,l=h.sample.pts,c++}else y.a.isHeader(e,s)?(i=y.a.getID3Data(e,s),d.push({pts:l,dts:l,data:i}),s+=i.length):s++;this.remuxer.remux(f,{samples:[]},{samples:d,inputTimeScale:9e4},{samples:[]},t,r,n)},e.prototype.destroy=function(){},e}();var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();var x=Math.pow(2,32)-1,L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t=Array.prototype.slice.call(arguments,1),r=8,n=t.length,i=n,o=void 0;n--;)r+=t[n].byteLength;for((o=new Uint8Array(r))[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=255&r,o.set(e,4),n=0,r=8;n<i;n++)o.set(t[n],r),r+=t[n].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var n=Math.floor(r/(x+1)),i=Math.floor(r%(x+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))},e.moov=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,r){r*=t;var n=Math.floor(r/(x+1)),i=Math.floor(r%(x+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var r=t.samples||[],n=new Uint8Array(4+r.length),i=void 0,o=void 0;for(o=0;o<r.length;o++)i=r[o].flags,n[o+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,n)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r=[],n=[],i=void 0,o=void 0,a=void 0;for(i=0;i<t.sps.length;i++)a=(o=t.sps[i]).byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(o));for(i=0;i<t.pps.length;i++)a=(o=t.pps[i]).byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(o));var s=e.box(e.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(n))),u=t.width,c=t.height,l=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,f>>24,f>>16&255,f>>8&255,255&f])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,n=t.duration*t.timescale,i=t.width,o=t.height,a=Math.floor(n/(x+1)),s=Math.floor(n%(x+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))},e.traf=function(t,r){var n=e.sdtp(t),i=t.id,o=Math.floor(r/(x+1)),a=Math.floor(r%(x+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var n=t.samples||[],i=n.length,o=12+16*i,a=new Uint8Array(o),s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,d=void 0;for(r+=8+o,a.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),s=0;s<i;s++)c=(u=n[s]).duration,l=u.size,f=u.flags,d=u.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,255&c,l>>>24&255,l>>>16&255,l>>>8&255,255&l,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*s);return e.box(e.types.trun,a)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t),n=void 0;return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}();var I=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.typeSupported=n;var o=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&o&&!o.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,r,i,o,a,u){if(this.ISGenerated||this.generateIS(e,t,o),this.ISGenerated){var c=e.samples.length,l=t.samples.length,f=o,d=o;if(c&&l){var h=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale;f+=Math.max(0,h),d+=Math.max(0,-h)}if(c){e.timescale||(s.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,o));var p=this.remuxAudio(e,f,a,u);if(l){var m=void 0;p&&(m=p.endPTS-p.startPTS),t.timescale||(s.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,o)),this.remuxVideo(t,d,a,m,u)}}else if(l){var g=this.remuxVideo(t,d,a,0,u);g&&e.codec&&this.remuxEmptyAudio(e,f,a,g)}}r.samples.length&&this.remuxID3(r,o),i.samples.length&&this.remuxText(i,o),this.observer.trigger(n.a.FRAG_PARSED)},e.prototype.generateIS=function(e,t,r){var o=this.observer,a=e.samples,u=t.samples,c=this.typeSupported,l="audio/mp4",f={},d={tracks:f},h=void 0===this._initPTS,p=void 0,m=void 0;if(h&&(p=m=1/0),e.config&&a.length&&(e.timescale=e.samplerate,s.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(c.mpeg?(l="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),f.audio={container:l,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array:L.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(p=m=a[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&u.length){var g=t.inputTimeScale;t.timescale=g,f.video={container:"video/mp4",codec:t.codec,initSegment:L.initSegment([t]),metadata:{width:t.width,height:t.height}},h&&(p=Math.min(p,u[0].pts-g*r),m=Math.min(m,u[0].dts-g*r),this.observer.trigger(n.a.INIT_PTS_FOUND,{initPTS:p}))}Object.keys(f).length?(o.trigger(n.a.FRAG_PARSING_INIT_SEGMENT,d),this.ISGenerated=!0,h&&(this._initPTS=p,this._initDTS=m)):o.trigger(n.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,r,o,a){var u,c,l,f=8,d=e.timescale,h=void 0,p=void 0,m=void 0,g=void 0,y=e.samples,v=[],_=y.length,b=this._PTSNormalize,w=this._initDTS,E=this.nextAvcDts,S=this.isSafari;if(0!==_){S&&(r|=y.length&&E&&(a&&Math.abs(t-E/d)<.1||Math.abs(y[0].pts-E-w)<d/5)),r||(E=t*d),y.forEach(function(e){e.pts=b(e.pts-w,E),e.dts=b(e.dts-w,E)}),y.sort(function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n||e.id-t.id});var T=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(T<0){s.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var k=0;k<y.length;k++)y[k].dts+=T}var A=y[0];g=Math.max(A.dts,0),m=Math.max(A.pts,0);var R=Math.round((g-E)/90);r&&R&&(R>1?s.b.log("AVC:"+R+" ms hole between fragments detected,filling it"):R<-1&&s.b.log("AVC:"+-R+" ms overlapping between fragments detected"),g=E,y[0].dts=g,m=Math.max(m-R,E),y[0].pts=m,s.b.log("Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(g/90)+",delta:"+R+" ms")),g,A=y[y.length-1],l=Math.max(A.dts,0),c=Math.max(A.pts,0,l),S&&(h=Math.round((l-g)/(y.length-1)));for(var x=0,I=0,C=0;C<_;C++){for(var O=y[C],D=O.units,P=D.length,M=0,F=0;F<P;F++)M+=D[F].data.length;I+=M,x+=P,O.length=M,O.dts=S?g+C*h:Math.max(O.dts,g),O.pts=Math.max(O.pts,O.dts)}var N=I+4*x+8;try{p=new Uint8Array(N)}catch(e){return void this.observer.trigger(n.a.ERROR,{type:i.b.MUX_ERROR,details:i.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating video mdat "+N})}var U=new DataView(p.buffer);U.setUint32(0,N),p.set(L.types.mdat,4);for(var B=0;B<_;B++){for(var j=y[B],H=j.units,G=0,z=void 0,W=0,q=H.length;W<q;W++){var Y=H[W],K=Y.data,V=Y.data.byteLength;U.setUint32(f,V),f+=4,p.set(K,f),f+=V,G+=4+V}if(S)z=Math.max(0,h*Math.round((j.pts-j.dts)/h));else{if(B<_-1)h=y[B+1].dts-j.dts;else{var Z=this.config,X=j.dts-y[B>0?B-1:B].dts;if(Z.stretchShortVideoTrack){var $=Z.maxBufferHole,J=Math.floor($*d),Q=(o?m+o*d:this.nextAudioPts)-j.pts;Q>J?((h=Q-X)<0&&(h=X),s.b.log("It is approximately "+Q/90+" ms to the next segment; using duration "+h/90+" ms for the last video frame.")):h=X}else h=X}z=Math.round(j.pts-j.dts)}v.push({size:G,duration:h,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=l+h;var ee=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,v.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var te=v[0].flags;te.dependsOn=2,te.isNonSync=0}e.samples=v,u=L.moof(e.sequenceNumber++,g,e),e.samples=[];var re={data1:u,data2:p,startPTS:m/d,endPTS:(c+h)/d,startDTS:g/d,endDTS:this.nextAvcDts/d,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:ee};return this.observer.trigger(n.a.FRAG_PARSING_DATA,re),re}},e.prototype.remuxAudio=function(e,t,r,o){var a=e.inputTimeScale,u=e.timescale,c=a/u,l=(e.isAAC?1024:1152)*c,f=this._PTSNormalize,d=this._initDTS,h=!e.isAAC&&this.typeSupported.mpeg,p=void 0,m=void 0,g=void 0,y=void 0,v=void 0,_=void 0,b=void 0,w=e.samples,E=[],S=this.nextAudioPts;if(r|=w.length&&S&&(o&&Math.abs(t-S/a)<.1||Math.abs(w[0].pts-S-d)<20*l),w.forEach(function(e){e.pts=e.dts=f(e.pts-d,t*a)}),0!==(w=w.filter(function(e){return e.pts>=0})).length){if(r||(S=o?t*a:w[0].pts),e.isAAC)for(var T=this.config.maxAudioFramesDrift,k=0,A=S;k<w.length;){var x,I=w[k];x=I.pts-A;var C=Math.abs(1e3*x/a);if(x<=-T*l)s.b.warn("Dropping 1 audio frame @ "+(A/a).toFixed(3)+"s due to "+Math.round(C)+" ms overlap."),w.splice(k,1),e.len-=I.unit.length;else if(x>=T*l&&C<1e4&&A){var O=Math.round(x/l);s.b.warn("Injecting "+O+" audio frame @ "+(A/a).toFixed(3)+"s due to "+Math.round(1e3*x/a)+" ms gap.");for(var D=0;D<O;D++){var P=Math.max(A,0);(g=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=I.unit.subarray()),w.splice(k,0,{unit:g,pts:P,dts:P}),e.len+=g.length,A+=l,k++}I.pts=I.dts=A,A+=l,k++}else Math.abs(x),I.pts=I.dts=A,A+=l,k++}for(var M=0,F=w.length;M<F;M++){var N=w[M],U=N.unit,B=N.pts;if(void 0!==b)m.duration=Math.round((B-b)/c);else{var j=Math.round(1e3*(B-S)/a),H=0;if(r&&e.isAAC&&j){if(j>0&&j<1e4)H=Math.round((B-S)/l),s.b.log(j+" ms hole between AAC samples detected,filling it"),H>0&&((g=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(g=U.subarray()),e.len+=H*g.length);else if(j<-12){s.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(S/a).toFixed(3)+"s/"+(B/a).toFixed(3)+"s/"+-j+"ms"),e.len-=U.byteLength;continue}B=S}if(_=B,!(e.len>0))return;var G=h?e.len:e.len+8;p=h?0:8;try{y=new Uint8Array(G)}catch(e){return void this.observer.trigger(n.a.ERROR,{type:i.b.MUX_ERROR,details:i.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}h||(new DataView(y.buffer).setUint32(0,G),y.set(L.types.mdat,4));for(var z=0;z<H;z++)(g=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=U.subarray()),y.set(g,p),p+=g.byteLength,m={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(m)}y.set(U,p);var W=U.byteLength;p+=W,m={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(m),b=B}var q=0,Y=E.length;if(Y>=2&&(q=E[Y-2].duration,m.duration=q),Y){this.nextAudioPts=S=b+c*q,e.len=0,e.samples=E,v=h?new Uint8Array:L.moof(e.sequenceNumber++,_/c,e),e.samples=[];var K=_/a,V=S/a,Z={data1:v,data2:y,startPTS:K,endPTS:V,startDTS:K,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:Y};return this.observer.trigger(n.a.FRAG_PARSING_DATA,Z),Z}return null}},e.prototype.remuxEmptyAudio=function(e,t,r,n){var i=e.inputTimeScale,o=i/(e.samplerate?e.samplerate:i),a=this.nextAudioPts,u=(void 0!==a?a:n.startDTS*i)+this._initDTS,c=n.endDTS*i+this._initDTS,l=1024*o,f=Math.ceil((c-u)/l),d=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.b.warn("remux empty Audio"),d){for(var h=[],p=0;p<f;p++){var m=u+p*l;h.push({unit:d,pts:m,dts:m}),e.len+=d.length}e.samples=h,this.remuxAudio(e,t,r)}else s.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.prototype.remuxID3=function(e,t){var r=e.samples.length,i=void 0,o=e.inputTimeScale,a=this._initPTS,s=this._initDTS;if(r){for(var u=0;u<r;u++)(i=e.samples[u]).pts=(i.pts-a)/o,i.dts=(i.dts-s)/o;this.observer.trigger(n.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},e.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r=e.samples.length,i=void 0,o=e.inputTimeScale,a=this._initPTS;if(r){for(var s=0;s<r;s++)(i=e.samples[s]).pts=(i.pts-a)/o;this.observer.trigger(n.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},e.prototype._PTSNormalize=function(e,t){var r=void 0;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e},e}();var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,r,i,o,a,s,u){var c=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),c.trigger(n.a.FRAG_PARSING_DATA,{data1:u,startPTS:o,startDTS:o,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),c.trigger(n.a.FRAG_PARSED)},e}();var O=Object(u.a)().performance,D=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.typeSupported=r,this.config=n,this.vendor=i}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,r,i,a,s,u,c,l,f,d,h){if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new o.a(this.observer,this.config));var m=this,g=void 0;try{g=O.now()}catch(e){g=Date.now()}p.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var o=void 0;try{o=O.now()}catch(e){o=Date.now()}m.observer.trigger(n.a.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:o}}),m.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,a,s,u,c,l,f,d,h)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,a,s,u,c,l,f,d,h)},e.prototype.pushDecrypted=function(e,t,r,o,a,s,u,c,l,f,d,h){var p=this.demuxer;if(!p||(u||c)&&!this.probe(e)){for(var m=this.observer,g=this.typeSupported,y=this.config,b=[{demux:k,remux:I},{demux:_.a,remux:C},{demux:v,remux:I},{demux:A,remux:I}],w=0,E=b.length;w<E;w++){var S=b[w],T=S.demux.probe;if(T(e)){var R=this.remuxer=new S.remux(m,y,g,this.vendor);p=new S.demux(m,R,y,g),this.probe=T;break}}if(!p)return void m.trigger(n.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=p}var x=this.remuxer;(u||c)&&(p.resetInitSegment(r,o,a,f),x.resetInitSegment()),u&&(p.resetTimeStamp(h),x.resetTimeStamp(h)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,s,l,d)},e}();t.a=D},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};r.d(n,"newCue",function(){return tt});var i=r(5),o=r.n(i),a=r(2),s=r(3),u=r(1),c=r(0),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var f=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return"object"===l(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(f.has(e))throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){try{(function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)}).call(this,e,t).call()}catch(t){c.b.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),h=r(9),p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return p(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=o.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),g=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var y=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((t={})[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return e.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},e.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new m).method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r},g(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=o.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function(){if(!Object(s.a)(this.programDateTime))return null;var e=Object(s.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}(),v=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return v(e,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(s.a)(this.fragments[0].programDateTime))}}]),e}();var b=/^(\d+)x(\d+)$/,w=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,E=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}return e.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=b.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t=void 0,r={};for(w.lastIndex=0;null!==(t=w.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},e}(),S={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function T(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var k=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,A=/#EXT-X-MEDIA:(.*)/g,R=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),x=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,L=/\.(mp4|m4s|m4v|m4a)$/i,I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.findGroup=function(e,t){if(!e)return null;for(var r=null,n=0;n<e.length;n++){var i=e[n];i.id===t&&(r=i)}return r},e.convertAVC1ToAVCOTI=function(e){var t=void 0,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return o.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var n=[],i=void 0;function o(e,t){["video","audio"].forEach(function(r){var n=e.filter(function(e){return function(e,t){var r=S[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)});if(n.length){var i=n.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[r+"Codec"]=i.length>0?i[0]:n[0],e=e.filter(function(e){return-1===n.indexOf(e)})}}),t.unknownCodecs=e}for(k.lastIndex=0;null!=(i=k.exec(t));){var a={},s=a.attrs=new E(i[1]);a.url=e.resolve(i[2],r);var u=s.decimalResolution("RESOLUTION");u&&(a.width=u.width,a.height=u.height),a.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),a.name=s.NAME,o([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),n.push(a)}return n},e.parseMasterPlaylistMedia=function(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,a=[],s=0;for(A.lastIndex=0;null!==(o=A.exec(t));){var u={},c=new E(o[1]);if(c.TYPE===n){if(u.groupId=c["GROUP-ID"],u.name=c.NAME,u.type=n,u.default="YES"===c.DEFAULT,u.autoselect="YES"===c.AUTOSELECT,u.forced="YES"===c.FORCED,c.URI&&(u.url=e.resolve(c.URI,r)),u.lang=c.LANGUAGE,u.name||(u.name=u.lang),i.length){var l=e.findGroup(i,u.groupId);u.audioCodec=l?l.codec:i[0].codec}u.id=s++,a.push(u)}}return a},e.parseLevelPlaylist=function(e,t,r,n,i){var o=0,a=0,u=new _(t),l=new m,f=0,d=null,h=new y,p=void 0,g=void 0,v=null;for(R.lastIndex=0;null!==(p=R.exec(e));){var b=p[1];if(b){h.duration=parseFloat(b);var w=(" "+p[2]).slice(1);h.title=w||null,h.tagList.push(w?["INF",b,w]:["INF",b])}else if(p[3]){if(Object(s.a)(h.duration)){var S=o++;h.type=n,h.start=a,h.levelkey=l,h.sn=S,h.level=r,h.cc=f,h.urlId=i,h.baseurl=t,h.relurl=(" "+p[3]).slice(1),C(h,d),u.fragments.push(h),d=h,a+=h.duration,h=new y}}else if(p[4]){if(h.rawByteRange=(" "+p[4]).slice(1),d){var T=d.byteRangeEndOffset;T&&(h.lastByteRangeEndOffset=T)}}else if(p[5])h.rawProgramDateTime=(" "+p[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),null===v&&(v=u.fragments.length);else{for(p=p[0].match(x),g=1;g<p.length&&void 0===p[g];g++);var k=(" "+p[g+1]).slice(1),A=(" "+p[g+2]).slice(1);switch(p[g]){case"#":h.tagList.push(A?[k,A]:[k]);break;case"PLAYLIST-TYPE":u.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":o=u.startSN=parseInt(k);break;case"TARGETDURATION":u.targetduration=parseFloat(k);break;case"VERSION":u.version=parseInt(k);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":f++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(k);break;case"KEY":var I=new E(k),O=I.enumeratedString("METHOD"),D=I.URI,P=I.hexadecimalInteger("IV");O&&(l=new m,D&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(O)>=0&&(l.method=O,l.baseuri=t,l.reluri=D,l.key=null,l.iv=P));break;case"START":var M=new E(k).decimalFloatingPoint("TIME-OFFSET");Object(s.a)(M)&&(u.startTimeOffset=M);break;case"MAP":var F=new E(k);h.relurl=F.URI,h.rawByteRange=F.BYTERANGE,h.baseurl=t,h.level=r,h.type=n,h.sn="initSegment",u.initSegment=h,(h=new y).rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:c.b.warn("line parsed but not handled: "+p)}}}return(h=d)&&!h.relurl&&(u.fragments.pop(),a-=h.duration),u.totalduration=a,u.averagetargetduration=a/u.fragments.length,u.endSN=o-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=f,!u.initSegment&&u.fragments.length&&u.fragments.every(function(e){return L.test(e.relurl)})&&(c.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(h=new y).relurl=u.fragments[0].relurl,h.baseurl=t,h.level=r,h.type=n,h.sn="initSegment",u.initSegment=h,u.needSidxRanges=!0),v&&function(e,t){for(var r=e[t],n=t-1;n>=0;n--){var i=e[n];i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(u.fragments,v),u},e}();function C(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(s.a)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var O=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var D=window.performance,P={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},M={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},F=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MANIFEST_LOADING,u.a.LEVEL_LOADING,u.a.AUDIO_TRACK_LOADING,u.a.SUBTITLE_TRACK_LOADING));return n.loaders={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.canHaveQualityLevels=function(e){return e!==P.AUDIO_TRACK&&e!==P.SUBTITLE_TRACK},t.mapContextToLevelType=function(e){switch(e.type){case P.AUDIO_TRACK:return M.AUDIO;case P.SUBTITLE_TRACK:return M.SUBTITLE;default:return M.MAIN}},t.getResponseUrl=function(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r},t.prototype.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return e.loader=i,this.loaders[e.type]=i,i},t.prototype.getInternalLoader=function(e){return this.loaders[e.type]},t.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:P.MANIFEST,level:0,id:null})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:P.LEVEL,level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:P.AUDIO_TRACK,level:null,id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:P.SUBTITLE_TRACK,level:null,id:e.id})},t.prototype.load=function(e,t){var r=this.hls.config;c.b.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n=this.getInternalLoader(t);if(n){var i=n.context;if(i&&i.url===e)return c.b.trace("playlist request ongoing"),!1;c.b.warn("aborting previous loader for type: "+t.type),n.abort()}var o=void 0,a=void 0,s=void 0,u=void 0;switch(t.type){case P.MANIFEST:o=r.manifestLoadingMaxRetry,a=r.manifestLoadingTimeOut,s=r.manifestLoadingRetryDelay,u=r.manifestLoadingMaxRetryTimeout;break;case P.LEVEL:o=0,a=r.levelLoadingTimeOut;break;default:o=r.levelLoadingMaxRetry,a=r.levelLoadingTimeOut,s=r.levelLoadingRetryDelay,u=r.levelLoadingMaxRetryTimeout}n=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var l={timeout:a,maxRetry:o,retryDelay:s,maxRetryDelay:u},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.b.debug("Calling internal loader delegate for URL: "+e),n.load(t,l,f),!0},t.prototype.loadsuccess=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,n);this.resetInternalLoader(r.type);var i=e.data;t.tload=D.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,r,n):this._handleMasterPlaylist(e,t,r,n):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},t.prototype.loaderror=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,r)},t.prototype.loadtimeout=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,r,!0)},t.prototype._handleMasterPlaylist=function(e,r,n,i){var o=this.hls,a=e.data,s=t.getResponseUrl(e,n),l=I.parseMasterPlaylist(a,s);if(l.length){var f=l.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),d=I.parseMasterPlaylistMedia(a,s,"AUDIO",f),h=I.parseMasterPlaylistMedia(a,s,"SUBTITLES");if(d.length){var p=!1;d.forEach(function(e){e.url||(p=!0)}),!1===p&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(c.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main"}))}o.trigger(u.a.MANIFEST_LOADED,{levels:l,audioTracks:d,subtitles:h,url:s,stats:r,networkDetails:i})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},t.prototype._handleTrackOrLevelPlaylist=function(e,r,n,i){var o=this.hls,a=n.id,c=n.level,l=n.type,f=t.getResponseUrl(e,n),d=Object(s.a)(a)?a:0,h=Object(s.a)(c)?c:d,p=t.mapContextToLevelType(n),m=I.parseLevelPlaylist(e.data,f,h,p,d);if(m.tload=r.tload,l===P.MANIFEST){var g={url:f,details:m};o.trigger(u.a.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:f,stats:r,networkDetails:i})}if(r.tparsed=D.now(),m.needSidxRanges){var y=m.initSegment.url;this.load(y,{isSidxRequest:!0,type:l,level:c,levelDetails:m,id:a,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=m,this._handlePlaylistLoaded(e,r,n,i)},t.prototype._handleSidxRequest=function(e,t){var r=h.a.parseSegmentIndex(new Uint8Array(e.data));r.references.forEach(function(e,r){var n=e.info,i=t.levelDetails.fragments[r];0===i.byteRange.length&&(i.rawByteRange=String(1+n.end-n.start)+"@"+String(n.start))}),t.levelDetails.initSegment.rawByteRange=String(r.moovEndOffset)+"@0"},t.prototype._handleManifestParsingError=function(e,t,r,n){this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:n})},t.prototype._handleNetworkError=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c.b.info("A network error occured while loading a "+e.type+"-type playlist");var n=void 0,i=void 0,o=this.getInternalLoader(e);switch(e.type){case P.MANIFEST:n=r?a.a.MANIFEST_LOAD_TIMEOUT:a.a.MANIFEST_LOAD_ERROR,i=!0;break;case P.LEVEL:n=r?a.a.LEVEL_LOAD_TIMEOUT:a.a.LEVEL_LOAD_ERROR,i=!1;break;case P.AUDIO_TRACK:n=r?a.a.AUDIO_TRACK_LOAD_TIMEOUT:a.a.AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}o&&(o.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:n,fatal:i,url:o.url,loader:o,context:e,networkDetails:t})},t.prototype._handlePlaylistLoaded=function(e,r,n,i){var o=n.type,a=n.level,s=n.id,c=n.levelDetails;if(c.targetduration)if(t.canHaveQualityLevels(n.type))this.hls.trigger(u.a.LEVEL_LOADED,{details:c,level:a||0,id:s||0,stats:r,networkDetails:i});else switch(o){case P.AUDIO_TRACK:this.hls.trigger(u.a.AUDIO_TRACK_LOADED,{details:c,id:s,stats:r,networkDetails:i});break;case P.SUBTITLE_TRACK:this.hls.trigger(u.a.SUBTITLE_TRACK_LOADED,{details:c,id:s,stats:r,networkDetails:i})}else this._handleManifestParsingError(e,n,"invalid target duration",i)},O(t,null,[{key:"ContextType",get:function(){return P}},{key:"LevelType",get:function(){return M}}]),t}(d);var N=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.FRAG_LOADING));return n.loaders={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){var t=this.loaders;for(var r in t){var n=t[r];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,r=t.type,n=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;t.loaded=0;var u=n[r];u&&(c.b.warn("abort previous fragment loader for type: "+r),u.abort()),u=n[r]=t.loader=i.fLoader?new o(i):new a(i);var l,f,d=void 0;d={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var h=t.byteRangeStartOffset,p=t.byteRangeEndOffset;Object(s.a)(h)&&Object(s.a)(p)&&(d.rangeStart=h,d.rangeEnd=p),l={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},u.load(d,l,f)},t.prototype.loadsuccess=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e.data,o=r.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(u.a.FRAG_LOADED,{payload:i,frag:o,stats:t,networkDetails:n})},t.prototype.loaderror=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},t.prototype.loadtimeout=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},t.prototype.loadprogress=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.a.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:n})},t}(d);var U=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},d.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,r=t.type,n=this.loaders[r],i=t.decryptdata,o=i.uri;if(o!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;n&&(c.b.warn("abort previous key loader for type:"+r),n.abort()),t.loader=this.loaders[r]=new a.loader(a),this.decrypturl=o,this.decryptkey=null;var s,l,f;s={url:o,frag:t,responseType:"arraybuffer"},l={timeout:a.fragLoadingTimeOut,maxRetry:a.fragLoadingMaxRetry,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,l,f)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(u.a.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,r){var n=r.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(u.a.KEY_LOADED,{frag:n})},t.prototype.loaderror=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},t.prototype.loadtimeout=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.a.ERROR,{type:a.b.NETWORK_ERROR,details:a.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},t}(d);var B="NOT_LOADED",j="APPENDING",H="PARTIAL",G="OK",z=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.BUFFER_APPENDED,u.a.FRAG_BUFFERED,u.a.FRAG_LOADED));return n.bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=r.config,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,d.prototype.destroy.call(this),e.prototype.destroy.call(this)},t.prototype.getBufferedFrag=function(e,t){var r=this.fragments,n=Object.keys(r).filter(function(n){var i=r[n];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=e&&e<=o.endPTS});if(0===n.length)return null;var i=n.pop();return r[i].body},t.prototype.detectEvictedFragments=function(e,t){var r=this,n=void 0,i=void 0;Object.keys(this.fragments).forEach(function(o){var a=r.fragments[o];if(!0===a.buffered){var s=a.range[e];if(s){n=s.time;for(var u=0;u<n.length;u++)if(i=n[u],!1===r.isTimeBuffered(i.startPTS,i.endPTS,t)){r.removeFragment(a.body);break}}}})},t.prototype.detectPartialFragments=function(e){var t=this,r=this.getFragmentKey(e),n=this.fragments[r];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(r){if(e.hasElementaryStream(r)){var i=t.timeRanges[r];n.range[r]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}}))},t.prototype.getBufferedTimes=function(e,t,r){for(var n=[],i=void 0,o=void 0,a=!1,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,o=r.end(s)+this.bufferPadding,e>=i&&t<=o){n.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))});break}if(e<o&&t>i)n.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))}),a=!0;else if(t<=i)break}return{time:n,partial:a}},t.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},t.prototype.getPartialFragment=function(e){var t=this,r=void 0,n=void 0,i=void 0,o=null,a=0;return Object.keys(this.fragments).forEach(function(s){var u=t.fragments[s];t.isPartial(u)&&(n=u.body.startPTS-t.bufferPadding,i=u.body.endPTS+t.bufferPadding,e>=n&&e<=i&&(r=Math.min(e-n,i-e),a<=r&&(o=u.body,a=r)))}),o},t.prototype.getState=function(e){var t=this.getFragmentKey(e),r=this.fragments[t],n=B;return void 0!==r&&(n=r.buffered?!0===this.isPartial(r)?H:G:j),n},t.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},t.prototype.isTimeBuffered=function(e,t,r){for(var n=void 0,i=void 0,o=0;o<r.length;o++){if(n=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1},t.prototype.onFragLoaded=function(e){var t=e.frag;Object(s.a)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},t.prototype.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var r=t.timeRanges[e];t.detectEvictedFragments(e,r)})},t.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},t.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},t.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},t.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},t}(d),W={search:function(e,t){for(var r=0,n=e.length-1,i=null,o=null;r<=n;){var a=t(o=e[i=(r+n)/2|0]);if(a>0)r=i+1;else{if(!(a<0))return o;n=i-1}}return null}};var q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,n=0;n<r.length;n++)if(t>=r.start(n)&&t<=r.end(n))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,r){try{if(e){var n=e.buffered,i=[],o=void 0;for(o=0;o<n.length;o++)i.push({start:n.start(o),end:n.end(o)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,r){var n=[],i=void 0,o=void 0,a=void 0,s=void 0,u=void 0;for(e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),u=0;u<e.length;u++){var c=n.length;if(c){var l=n[c-1].end;e[u].start-l<r?e[u].end>l&&(n[c-1].end=e[u].end):n.push(e[u])}else n.push(e[u])}for(u=0,i=0,o=a=t;u<n.length;u++){var f=n[u].start,d=n[u].end;if(t+r>=f&&t<d)o=f,i=(a=d)-t;else if(t+r<f){s=f;break}}return{len:i,start:o,end:a,nextStart:s}},e}(),Y=r(7),K=r.n(Y),V=r(12),Z=r.n(V),X=r(10);function $(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}var J=r(4);var Q=Object(J.a)(),ee=$(),te=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.id=r;var n=this.observer=new K.a,i=t.config;n.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.emit.apply(n,[e,e].concat(r))},n.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[e].concat(r))};var o=function(e,r){(r=r||{}).frag=this.frag,r.id=this.id,t.trigger(e,r)}.bind(this);n.on(u.a.FRAG_DECRYPTED,o),n.on(u.a.FRAG_PARSING_INIT_SEGMENT,o),n.on(u.a.FRAG_PARSING_DATA,o),n.on(u.a.FRAG_PARSED,o),n.on(u.a.ERROR,o),n.on(u.a.FRAG_PARSING_METADATA,o),n.on(u.a.FRAG_PARSING_USERDATA,o),n.on(u.a.INIT_PTS_FOUND,o);var s={mp4:ee.isTypeSupported("video/mp4"),mpeg:ee.isTypeSupported("audio/mpeg"),mp3:ee.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){c.b.log("demuxing in webworker");var f=void 0;try{f=this.w=Z()(13),this.onwmsg=this.onWorkerMessage.bind(this),f.addEventListener("message",this.onwmsg),f.onerror=function(e){t.trigger(u.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},f.postMessage({cmd:"init",typeSupported:s,vendor:l,id:r,config:JSON.stringify(i)})}catch(e){c.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),f&&Q.URL.revokeObjectURL(f.objectURL),this.demuxer=new X.a(n,s,i,l),this.w=void 0}}else this.demuxer=new X.a(n,s,i,l)}return e.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,r,n,i,o,a,u){var l=this.w,f=Object(s.a)(i.startDTS)?i.startDTS:i.start,d=i.decryptdata,h=this.frag,p=!(h&&i.cc===h.cc),m=!(h&&i.level===h.level),g=h&&i.sn===h.sn+1,y=!m&&g;if(p&&c.b.log(this.id+":discontinuity detected"),m&&c.b.log(this.id+":switch detected"),this.frag=i,l)l.postMessage({cmd:"demux",data:e,decryptdata:d,initSegment:t,audioCodec:r,videoCodec:n,timeOffset:f,discontinuity:p,trackSwitch:m,contiguous:y,duration:o,accurateTimeOffset:a,defaultInitPTS:u},e instanceof ArrayBuffer?[e]:[]);else{var v=this.demuxer;v&&v.push(e,d,t,r,n,f,p,m,y,o,a,u)}},e.prototype.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":Q.URL.revokeObjectURL(this.w.objectURL);break;case u.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},e}();function re(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function ne(e,t,r){var n=e[t],i=e[r],o=i.startPTS;Object(s.a)(o)?r>t?(n.duration=o-n.start,n.duration<0&&c.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(i.duration=n.start-o,i.duration<0&&c.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):i.start=r>t?n.start+n.duration:Math.max(n.start-i.duration,0)}function ie(e,t,r,n,i,o){var a=r;if(Object(s.a)(t.startPTS)){var u=Math.abs(t.startPTS-r);Object(s.a)(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,a=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),n=Math.max(n,t.endPTS),i=Math.min(i,t.startDTS),o=Math.max(o,t.endDTS)}var c=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=a,t.endPTS=n,t.startDTS=i,t.endDTS=o,t.duration=n-r;var l=t.sn;if(!e||l<e.startSN||l>e.endSN)return 0;var f,d=void 0,h=void 0;for(f=l-e.startSN,(d=e.fragments)[f]=t,h=f;h>0;h--)ne(d,h,h-1);for(h=f;h<d.length-1;h++)ne(d,h,h+1);return e.PTSKnown=!0,c}function oe(e,t){var r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,i=t.startSN-e.startSN,o=e.fragments,a=t.fragments,u=0,l=void 0;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),n<r)t.PTSKnown=!1;else{for(var f=r;f<=n;f++){var d=o[i+f],h=a[f];h&&d&&(u=d.cc-h.cc,Object(s.a)(d.startPTS)&&(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,h.backtracked=d.backtracked,h.dropped=d.dropped,l=h))}if(u)for(c.b.log("discontinuity sliding from playlist, take drift into account"),f=0;f<a.length;f++)a[f].cc+=u;if(l)ie(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS);else if(i>=0&&i<o.length){var p=o[i].start;for(f=0;f<a.length;f++)a[f].start+=p}t.PTSKnown=e.PTSKnown}}var ae={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}};function se(e,t){t.fragments.forEach(function(t){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}}),t.PTSKnown=!0}function ue(e,t,r){!function(e,t,r){if(function(e,t,r){var n=!1;return t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC)&&(n=!0),n}(e,r,t)){var n=function(e,t){var r=e.fragments,n=t.fragments;if(n.length&&r.length){var i=function(e,t){for(var r=null,n=0;n<e.length;n+=1){var i=e[n];if(i&&i.cc===t){r=i;break}}return r}(r,n[0].cc);if(i&&(!i||i.startPTS))return i;c.b.log("No frag in previous level to align on")}else c.b.log("No fragments to align")}(r.details,t);n&&(c.b.log("Adjusting PTS using last level due to CC increase within current level"),se(n.start,t))}}(e,r,t),!r.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,n=e.fragments[0].programDateTime,i=(n-r)/1e3+t.fragments[0].start;Object(s.a)(i)&&(c.b.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),se(i,e))}}(r,t.details)}var ce=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call.apply(e,[this,r].concat(i)));return a._tickInterval=null,a._tickTimer=null,a._tickCallCount=0,a._boundTick=a.tick.bind(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.prototype.hasInterval=function(){return!!this._tickInterval},t.prototype.hasNextTick=function(){return!!this._tickTimer},t.prototype.setInterval=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)}),t.prototype.clearInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),t.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.prototype.doTick=function(){},t}(d);function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2],n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function fe(e,t,r){var n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.endProgramDateTime-n>e}var de=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.media=r,this.fragmentTracker=n,this.hls=i,this.stallReported=!1}return e.prototype.poll=function(e,t){var r=this.config,n=this.media,i=n.currentTime,o=window.performance.now();if(i!==e)return this.stallReported&&(c.b.warn("playback not stuck anymore @"+i+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||n.readyState>2||n.seeking&&q.isBuffered(n,i))){var a=o-this.stalled,s=q.bufferInfo(n,i,r.maxBufferHole);this.stalled?(a>=1e3&&this._reportStall(s.len),this._tryFixBufferStall(s,a)):this.stalled=o}},e.prototype._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media.currentTime,o=n.getPartialFragment(i);o&&this._trySkipBufferHole(o),e.len>.5&&t>1e3*r.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},e.prototype._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,c.b.warn("Playback stalling at @"+r.currentTime+" due to low buffer"),t.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},e.prototype._trySkipBufferHole=function(e){for(var t=this.hls,r=this.media,n=r.currentTime,i=0,o=0;o<r.buffered.length;o++){var s=r.buffered.start(o);if(n>=i&&n<s)return r.currentTime=Math.max(s,r.currentTime+.1),c.b.warn("skipping hole, adjusting currentTime from "+n+" to "+r.currentTime),this.stalled=null,void t.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+r.currentTime,frag:e});i=r.buffered.end(o)}},e.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var o=n+i*e.nudgeOffset;c.b.log("adjust currentTime from "+n+" to "+o),r.currentTime=o,t.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.b.error("still stuck in high buffer @"+n+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!0})},e}(),he=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var pe={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},me=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.MEDIA_DETACHING,u.a.MANIFEST_LOADING,u.a.MANIFEST_PARSED,u.a.LEVEL_LOADED,u.a.KEY_LOADED,u.a.FRAG_LOADED,u.a.FRAG_LOAD_EMERGENCY_ABORTED,u.a.FRAG_PARSING_INIT_SEGMENT,u.a.FRAG_PARSING_DATA,u.a.FRAG_PARSED,u.a.ERROR,u.a.AUDIO_TRACK_SWITCHING,u.a.AUDIO_TRACK_SWITCHED,u.a.BUFFER_CREATED,u.a.BUFFER_APPENDED,u.a.BUFFER_FLUSHED));return i.fragmentTracker=n,i.config=r.config,i.audioCodecSwap=!1,i._state=pe.STOPPED,i.stallReported=!1,i.gapController=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},t.prototype.onHandlerDestroyed=function(){this.state=pe.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},t.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=r.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(c.b.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=pe.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=pe.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=pe.STOPPED,this.forceStartLoad=!1},t.prototype.doTick=function(){switch(this.state){case pe.BUFFER_FLUSHING:this.fragLoadError=0;break;case pe.IDLE:this._doTickIdle();break;case pe.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=pe.IDLE);break;case pe.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(c.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=pe.IDLE);break;case pe.ERROR:case pe.STOPPED:case pe.FRAG_LOADING:case pe.PARSING:case pe.PARSED:case pe.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},t.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var n=void 0;n=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,o=this.levels[i];if(o){var a=o.bitrate,s=void 0;s=a?Math.max(8*t.maxBufferSize/a,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=q.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,n,t.maxBufferHole),f=l.len;if(!(f>=s)){c.b.trace("buffer length of "+f.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var d=o.details;if(!d||d.live&&this.levelLastLoaded!==i)this.state=pe.WAITING_LEVEL;else{var h=this.fragPrevious;if(!d.live&&h&&!h.backtracked&&h.sn===d.endSN&&!l.nextStart)if(Math.min(r.duration,h.start+h.duration)-Math.max(l.end,h.start)<=Math.max(.2,h.duration)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(u.a.BUFFER_EOS,p),void(this.state=pe.ENDED)}this._fetchPayloadOrEos(n,l,d)}}}}},t.prototype._fetchPayloadOrEos=function(e,t,r){var n=this.fragPrevious,i=this.level,o=r.fragments,a=o.length;if(0!==a){var s=o[0].start,u=o[a-1].start+o[a-1].duration,l=t.end,f=void 0;if(r.initSegment&&!r.initSegment.data)f=r.initSegment;else if(r.live){var d=this.config.initialLiveManifestSize;if(a<d)return void c.b.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+d);if(null===(f=this._ensureFragmentAtLivePoint(r,l,s,u,n,o,a)))return}else l<s&&(f=o[0]);f||(f=this._findFragment(s,n,a,o,l,u,r)),f&&(f.encrypted?(c.b.log("Loading key for "+f.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i),this._loadKey(f)):(c.b.log("Loading "+f.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+l.toFixed(3)),this._loadFragment(f)))}},t.prototype._ensureFragmentAtLivePoint=function(e,t,r,n,i,o,a){var u=this.hls.config,l=this.media,f=void 0,d=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-u.maxFragLookUpTolerance,n-d)){var h=this.liveSyncPosition=this.computeLivePosition(r,e);c.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),t=h,l&&l.readyState&&l.duration>h&&(l.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>n&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i)if(e.hasProgramDateTime)c.b.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),f=function(e,t,r){if(!Array.isArray(e)||!e.length||!Object(s.a)(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(fe(t,r,i))return i}return null}(o,i.endProgramDateTime,u.maxFragLookUpTolerance);else{var p=i.sn+1;if(p>=e.startSN&&p<=e.endSN){var m=o[p-e.startSN];i.cc===m.cc&&(f=m,c.b.log("live playlist, switching playlist, load frag with next SN: "+f.sn))}f||(f=W.search(o,function(e){return i.cc-e.cc}))&&c.b.log("live playlist, switching playlist, load frag with same CC: "+f.sn)}f||(f=o[Math.min(a-1,Math.round(a/2))],c.b.log("live playlist, switching playlist, unknown, load middle frag : "+f.sn))}return f},t.prototype._findFragment=function(e,t,r,n,i,o,a){var s=this.hls.config,u=void 0;i<o?u=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e?t[e.sn-t[0].sn+1]:null;return i&&!le(r,n,i)?i:W.search(t,le.bind(null,r,n))}(t,n,i,i>o-s.maxFragLookUpTolerance?0:s.maxFragLookUpTolerance):u=n[r-1];if(u){var l=u.sn-a.startSN,f=t&&u.level===t.level,d=n[l-1],h=n[l+1];if(t&&u.sn===t.sn)if(f&&!u.backtracked)if(u.sn<a.endSN){var p=t.deltaPTS;p&&p>s.maxBufferHole&&t.dropped&&l?(u=d,c.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(u=h,c.b.log("SN just loaded, load next one: "+u.sn,u))}else u=null;else u.backtracked&&(h&&h.backtracked?(c.b.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+h.sn),u=h):(c.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,d?(u=d).backtracked=!0:l&&(u=null)))}return u},t.prototype._loadKey=function(e){this.state=pe.KEY_LOADING,this.hls.trigger(u.a.KEY_LOADING,{frag:e})},t.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,Object(s.a)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===B||t===H?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(u.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new te(this.hls,"main")),this.state=pe.FRAG_LOADING):t===j&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},t.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,F.LevelType.MAIN)},t.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t.prototype._checkFragmentChanged=function(){var e=void 0,t=void 0,r=this.media;if(r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),q.isBuffered(r,t)?e=this.getBufferedFrag(t):q.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(u.a.FRAG_CHANGED,{frag:n});var i=n.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(u.a.LEVEL_SWITCHED,{level:i}),this.fragPlaying=n}}},t.prototype.immediateLevelSwitch=function(){if(c.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,q.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},t.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,r=void 0,n=void 0;if((t=this.getBufferedFrag(e.currentTime))&&t.startPTS>1&&this.flushMainBuffer(0,t.startPTS-1),e.paused)r=0;else{var i=this.hls.nextLoadLevel,o=this.levels[i],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*a)+1:0}if((n=this.getBufferedFrag(e.currentTime+r))&&(n=this.followingBufferedFrag(n))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}},t.prototype.flushMainBuffer=function(e,t){this.state=pe.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(u.a.BUFFER_FLUSHING,r)},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition),this.gapController=new de(r,t,this.fragmentTracker,this.hls)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;Object(s.a)(t)&&c.b.log("media seeking to "+t.toFixed(3));var n=this.mediaBuffer?this.mediaBuffer:e,i=q.bufferInfo(n,t,this.config.maxBufferHole);if(this.state===pe.FRAG_LOADING){var o=this.fragCurrent;if(0===i.len&&o){var a=r.maxFragLookUpTolerance,u=o.start-a,l=o.start+o.duration+a;t<u||t>l?(o.loader&&(c.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=pe.IDLE):c.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===pe.ENDED&&(0===i.len&&(this.fragPrevious=0),this.state=pe.IDLE);e&&(this.lastCurrentTime=t),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},t.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(s.a)(t)&&c.b.log("media seeked to "+t.toFixed(3)),this.tick()},t.prototype.onMediaEnded=function(){c.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestLoading=function(){c.b.log("trigger BUFFER_RESET"),this.hls.trigger(u.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestParsed=function(e){var t=!1,r=!1,n=void 0;e.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(t=!0),-1!==n.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=t&&r,this.audioCodecSwitch&&c.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},t.prototype.onLevelLoaded=function(e){var t=e.details,r=e.level,n=this.levels[this.levelLastLoaded],i=this.levels[r],o=t.totalduration,a=0;if(c.b.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var l=i.details;l&&t.fragments.length>0?(oe(l,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,l),t.PTSKnown&&Object(s.a)(a)?c.b.log("live playlist sliding:"+a.toFixed(3)):(c.b.log("live playlist - outdated PTS, unknown sliding"),ue(this.fragPrevious,n,t))):(c.b.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,ue(this.fragPrevious,n,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=r,this.hls.trigger(u.a.LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var f=t.startTimeOffset;Object(s.a)(f)?(f<0&&(c.b.log("negative start time offset "+f+", count from end of last fragment"),f=a+o+f),c.b.log("start time offset found in playlist, adjust startPosition to "+f),this.startPosition=f):t.live?(this.startPosition=this.computeLivePosition(a,t),c.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===pe.WAITING_LEVEL&&(this.state=pe.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===pe.KEY_LOADING&&(this.state=pe.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=this.hls,n=this.levels,i=this.media,o=e.frag;if(this.state===pe.FRAG_LOADING&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var a=e.stats,s=n[t.level],l=s.details;if(this.bitrateTest=!1,this.stats=a,c.b.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),o.bitrateTest&&r.nextLoadLevel)this.state=pe.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),r.trigger(u.a.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=pe.IDLE,a.tparsed=a.tbuffered=window.performance.now(),l.initSegment.data=e.payload,r.trigger(u.a.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else{c.b.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=pe.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var f=!(i&&i.seeking)&&(l.PTSKnown||!l.live),d=l.initSegment?l.initSegment.data:[],h=this._getAudioCodec(s);(this.demuxer=this.demuxer||new te(this.hls,"main")).push(e.payload,d,h,s.videoCodec,t,l.totalduration,f)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===pe.PARSING){var n=e.tracks,i=void 0,o=void 0;if(n.audio&&this.altAudio&&delete n.audio,o=n.audio){var a=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(c.b.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===s.indexOf("firefox")&&(a="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==o.container&&(a="mp4a.40.2",c.b.log("Android: force audio codec to "+a)),o.levelCodec=a,o.id=e.id}for(i in(o=n.video)&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(u.a.BUFFER_CODECS,n),n){o=n[i],c.b.log("main track:"+i+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var l=o.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.a.BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}},t.prototype.onFragParsingData=function(e){var t=this,r=this.fragCurrent,n=e.frag;if(r&&"main"===e.id&&n.sn===r.sn&&n.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===pe.PARSING){var i=this.levels[this.level],o=r;if(Object(s.a)(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),!0===e.hasAudio&&o.addElementaryStream(y.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(y.ElementaryStreamTypes.VIDEO),c.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)c.b.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return c.b.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=pe.IDLE,this.fragPrevious=o,void this.tick();c.b.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var l=ie(i.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),f=this.hls;f.trigger(u.a.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:l,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(r){r&&r.length&&t.state===pe.PARSING&&(t.appended=!0,t.pendingBuffering=!0,f.trigger(u.a.BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))}),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===pe.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=pe.PARSED,this._checkAppendedParsed())},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){c.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(c.b.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=pe.IDLE}var i=this.hls;i.trigger(u.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(u.a.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},t.prototype.onAudioTrackSwitched=function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(c.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r,this.tick()},t.prototype.onBufferCreated=function(e){var t=e.tracks,r=void 0,n=void 0,i=!1;for(var o in t){var a=t[o];"main"===a.id?(n=o,r=a,"video"===o&&(this.videoBuffer=t[o].buffer)):i=!0}i&&r?(c.b.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},t.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==pe.PARSING&&t!==pe.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==pe.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.b.log("main buffered : "+ae.toString(t.buffered)),this.fragPrevious=e;var r=this.stats;r.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(u.a.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.state=pe.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=!!this.media&&q.isBuffered(this.media,this.media.currentTime)&&q.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.b.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=pe.FRAG_LOADING_WAITING_RETRY}else c.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=pe.ERROR;break;case a.a.LEVEL_LOAD_ERROR:case a.a.LEVEL_LOAD_TIMEOUT:this.state!==pe.ERROR&&(e.fatal?(this.state=pe.ERROR,c.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==pe.WAITING_LEVEL||(this.state=pe.IDLE));break;case a.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==pe.PARSING&&this.state!==pe.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=pe.IDLE):(c.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},t.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,c.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},t.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},t.prototype.onFragLoadEmergencyAborted=function(){this.state=pe.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(y.ElementaryStreamTypes.VIDEO,e.buffered),this.state=pe.IDLE,this.fragPrevious=null},t.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.prototype.computeLivePosition=function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)},t.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,r=e.seeking?t:this.startPosition;t!==r&&(c.b.log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" "),e.currentTime=r)},t.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.b.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},he(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.b.log("main stream:"+t+"->"+e),this.hls.trigger(u.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(ce),ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var ve=window.performance,_e=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MANIFEST_LOADED,u.a.LEVEL_LOADED,u.a.AUDIO_TRACK_SWITCHED,u.a.FRAG_LOADED,u.a.ERROR));return n.canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},t.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t=[],r=void 0,n={},i=null,o=!1,s=!1,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),f=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,s=s||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),l&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(i=n[e.bitrate])?i.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,t.push(e)),e.attrs&&e.attrs.AUDIO&&re(i||e,"audio",e.attrs.AUDIO),e.attrs&&e.attrs.SUBTITLES&&re(i||e,"text",e.attrs.SUBTITLES)}),o&&s&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||T(t))&&(!r||T(r))}),e.audioTracks&&(f=e.audioTracks.filter(function(e){return!e.audioCodec||T(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),t.length>0){r=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var d=0;d<t.length;d++)if(t[d].bitrate===r){this._firstLevel=d,c.b.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+r);break}this.hls.trigger(u.a.MANIFEST_PARSED,{levels:t,audioTracks:f,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:o,altAudio:f.length>0&&o})}else this.hls.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},t.prototype.setLevelInternal=function(e){var t=this._levels,r=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.b.log("switching to level "+e),this.currentLevelIndex=e;var n=t[e];n.level=e,r.trigger(u.a.LEVEL_SWITCHING,n)}var i=t[e],o=i.details;if(!o||o.live){var s=i.urlId;r.trigger(u.a.LEVEL_LOADING,{url:i.url[s],level:e,id:s})}}else r.trigger(u.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},t.prototype.onError=function(e){if(e.fatal)e.type===a.b.NETWORK_ERROR&&this.clearTimer();else{var t=!1,r=!1,n=void 0;switch(e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:n=e.frag.level,r=!0;break;case a.a.LEVEL_LOAD_ERROR:case a.a.LEVEL_LOAD_TIMEOUT:n=e.context.level,t=!0;break;case a.a.REMUX_ALLOC_ERROR:n=e.level,t=!0}void 0!==n&&this.recoverLevel(e,n,t,r)}},t.prototype.recoverLevel=function(e,t,r,n){var i=this,o=this.hls.config,a=e.details,s=this._levels[t],u=void 0,l=void 0,f=void 0;if(s.loadError++,s.fragmentError=n,r){if(!(this.levelRetryCount+1<=o.levelLoadingMaxRetry))return c.b.error("level controller, cannot recover from "+a+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);l=Math.min(Math.pow(2,this.levelRetryCount)*o.levelLoadingRetryDelay,o.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return i.loadLevel()},l),e.levelRetry=!0,this.levelRetryCount++,c.b.warn("level controller, "+a+", retry in "+l+" ms, current retry count is "+this.levelRetryCount)}(r||n)&&((u=s.url.length)>1&&s.loadError<u?(s.urlId=(s.urlId+1)%u,s.details=void 0,c.b.warn("level controller, "+a+" for level "+t+": switching to redundant URL-id "+s.urlId)):-1===this.manualLevelIndex?(f=0===t?this._levels.length-1:t-1,c.b.warn("level controller, "+a+": switch to "+f),this.hls.nextAutoLevel=this.currentLevelIndex=f):n&&(c.b.warn("level controller, "+a+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var r=this._levels[t.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,r=e.level;if(r===this.currentLevelIndex){var n=this._levels[r];n.fragmentError||(n.loadError=0,this.levelRetryCount=0);var i=e.details;if(i.live){var o=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),a=o,s=n.details;s&&i.endSN===s.endSN&&(a/=2,c.b.log("same live playlist, reload twice faster")),a-=ve.now()-e.stats.trequest,a=Math.max(o/2,Math.round(a)),c.b.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},a)}else this.clearTimer()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){var n=r.audioGroupIds.findIndex(function(e){return e===t});n!==r.urlId&&(r.urlId=n,this.startLoad())}},t.prototype.loadLevel=function(){if(c.b.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"===(void 0===e?"undefined":ge(e))&&e.url.length>0){var t=this.currentLevelIndex,r=e.urlId,n=e.url[r];c.b.log("Attempt loading level index "+t+" with URL-id "+r),this.hls.trigger(u.a.LEVEL_LOADING,{url:n,level:t,id:r})}}},ye(t,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(d),be=r(6);function we(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Ee(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var Se=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.MEDIA_DETACHING,u.a.FRAG_PARSING_METADATA));return n.id3Track=void 0,n.media=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){d.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){Ee(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return we(r,this.media),r}return this.media.addTextTrack("metadata","id3")},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<r.length;i++){var o=be.a.getID3Frames(r[i].data);if(o){var a=r[i].pts,s=i<r.length-1?r[i+1].pts:t.endPTS;a===s&&(s+=1e-4);for(var u=0;u<o.length;u++){var c=o[u];if(!be.a.isTimeStampFrame(c)){var l=new n(a,s,"");l.value=c,this.id3Track.addCue(l)}}}}},t}(d);var Te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}();var ke=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Te(r),this.fast_=new Te(n)}return e.prototype.sample=function(e,t){var r=8e3*t/(e=Math.max(e,this.minDelayMs_)),n=e/1e3;this.fast_.sample(n,r),this.slow_.sample(n,r)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}(),Ae=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var Re=window.performance,xe=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.FRAG_LOADING,u.a.FRAG_LOADED,u.a.FRAG_BUFFERED,u.a.ERROR));return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=r,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.clearTimer(),d.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var r=this.hls,n=r.config,i=t.level,o=void 0,a=void 0;r.levels[i].details.live?(o=n.abrEwmaFastLive,a=n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,a=n.abrEwmaSlowVoD),this._bwEstimator=new ke(r,a,o,n.abrEwmaDefaultEstimate)}},t.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var n=r.loader,i=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return c.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=n.stats;if(t&&o&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var a=Re.now()-o.trequest,s=Math.abs(t.playbackRate);if(a>500*r.duration/s){var l=e.levels,f=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/a),d=l[r.level],h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,p=o.total?o.total:Math.max(o.loaded,Math.round(r.duration*h/8)),m=t.currentTime,g=(p-o.loaded)/f,y=(q.bufferInfo(t,m,e.config.maxBufferHole).end-m)/s;if(y<2*r.duration/s&&g>y){var v=void 0,_=void 0;for(_=r.level-1;_>i;_--){var b=l[_].realBitrate?Math.max(l[_].realBitrate,l[_].bitrate):l[_].bitrate;if((v=r.duration*b/(6.4*f))<y)break}v<g&&(c.b.warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+g.toFixed(1)+":"+y.toFixed(1)),e.nextLoadLevel=_,this._bwEstimator.sample(a,o.loaded),n.abort(),this.clearTimer(),e.trigger(u.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:o}))}}}}},t.prototype.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(s.a)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,i=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:n,duration:i},r.realBitrate=Math.round(8*n/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},t.prototype.onFragBuffered=function(e){var t=e.stats,r=e.frag;if(!0!==t.aborted&&"main"===r.type&&Object(s.a)(r.sn)&&(!r.bitrateTest||t.tload===t.tbuffered)){var n=t.tparsed-t.trequest;c.b.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(n,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},t.prototype.onError=function(e){switch(e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},t.prototype._findBestLevel=function(e,t,r,n,i,o,a,s,u){for(var l=i;l>=n;l--){var f=u[l];if(f){var d=f.details,h=d?d.totalduration/d.fragments.length:t,p=!!d&&d.live,m=void 0;m=l<=e?a*r:s*r;var g=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,y=g*h/m;if(c.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(m)+"/"+g+"/"+h+"/"+o+"/"+y),m>g&&(!y||p&&!this.bitrateTestDelay||y<o))return l}}return-1},Ae(t,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this._nextABRAutoLevel;return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,n=e.config,i=e.minAutoLevel,o=e.media,a=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=o?o.currentTime:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,d=(q.bufferInfo(o,u,n.maxBufferHole).end-u)/l,h=this._findBestLevel(a,s,f,i,t,d,n.abrBandWidthFactor,n.abrBandWidthUpFactor,r);if(h>=0)return h;c.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay,m=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(0===d){var y=this.bitrateTestDelay;if(y)p=(s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay)-y,c.b.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),m=g=1}return h=this._findBestLevel(a,s,f,i,t,d+p,m,g,r),Math.max(h,0)}}]),t}(d);var Le=$(),Ie=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHING,u.a.MEDIA_DETACHING,u.a.MANIFEST_PARSED,u.a.BUFFER_RESET,u.a.BUFFER_APPENDING,u.a.BUFFER_CODECS,u.a.BUFFER_EOS,u.a.BUFFER_FLUSHING,u.a.LEVEL_PTS_UPDATED,u.a.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n._live=null,n._objectUrl=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){d.prototype.destroy.call(this)},t.prototype.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-e.start)>.1){var i=n.updating;try{n.abort()}catch(e){i=!0,c.b.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(c.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},t.prototype.onManifestParsed=function(e){var t=e.audio,r=e.video||e.levels.length&&e.altAudio,n=0;e.altAudio&&(t||r)&&(n=(t?1:0)+(r?1:0),c.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},t.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new Le;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(r),this._objectUrl=t.src}},t.prototype.onMediaDetaching=function(){c.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.b.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.a.MEDIA_DETACHED)},t.prototype.onMediaSourceOpen=function(){c.b.log("media source opened"),this.hls.trigger(u.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},t.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},t.prototype.onMediaSourceClose=function(){c.b.log("media source closed")},t.prototype.onMediaSourceEnded=function(){c.b.log("media source ended")},t.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;c.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,r=this.segments.reduce(function(e,r){return r.parent===t?e+1:e},0),n={},i=this.sourceBuffer;for(var o in i)n[o]=i[o].buffered;this.hls.trigger(u.a.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},t.prototype.onSBUpdateError=function(e){c.b.error("sourceBuffer error:",e),this.hls.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},t.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},t.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var n in e)if(!t[n]){var i=e[n],o=i.levelCodec||i.codec,s=i.container+";codecs="+o;c.b.log("creating sourceBuffer("+s+")");try{var l=t[n]=r.addSourceBuffer(s);l.addEventListener("updateend",this.onsbue),l.addEventListener("error",this.onsbe),this.tracks[n]={codec:o,container:i.container},i.buffer=l}catch(e){c.b.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.a.BUFFER_CREATED,{tracks:e})},t.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},t.prototype.onBufferAppendFail=function(e){c.b.error("sourceBuffer error:",e.event),this.hls.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferEos=function(e){var t=this.sourceBuffer,r=e.type;for(var n in t)r&&n!==r||t[n].ended||(t[n].ended=!0,c.b.log(n+" sourceBuffer now EOS"));this.checkEos()},t.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var n=e[r];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}c.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},t.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},t.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},t.prototype.updateMediaElementDuration=function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(c.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(s.a)(e))&&(c.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},t.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r)t+=r[n].buffered.length}catch(e){c.b.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.a.BUFFER_FLUSHED)}},t.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void c.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var n=r.shift();try{var i=t[n.type];i?i.updating?r.unshift(n):(i.ended=!1,this.parent=n.parent,i.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){c.b.error("error while trying to append buffer:"+t.message),r.unshift(n);var o={type:a.b.MEDIA_ERROR,parent:n.parent};22!==t.code?(this.appendError?this.appendError++:this.appendError=1,o.details=a.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(c.b.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],o.fatal=!0,e.trigger(u.a.ERROR,o)):(o.fatal=!1,e.trigger(u.a.ERROR,o))):(this.segments=[],o.details=a.a.BUFFER_FULL_ERROR,o.fatal=!1,e.trigger(u.a.ERROR,o))}}}},t.prototype.flushBuffer=function(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=this.sourceBuffer;if(Object.keys(l).length){if(c.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var f in l)if(!r||f===r){if((n=l[f]).ended=!1,n.updating)return c.b.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<n.buffered.length;i++)if(o=n.buffered.start(i),a=n.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(s=e,u=t):(s=Math.max(o,e),u=Math.min(a,t)),Math.min(u,a)-s>.5)return this.flushBufferCounter++,c.b.log("flush "+f+" ["+s+","+u+"], of ["+o+","+a+"], pos:"+this.media.currentTime),n.remove(s,u),!1}catch(e){c.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else c.b.warn("abort flushing too many retries");c.b.log("buffer flushed")}return!0},t}(d),Ce=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var Oe=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.FPS_DROP_LEVEL_CAPPING,u.a.MEDIA_ATTACHING,u.a.MANIFEST_PARSED,u.a.BUFFER_CODECS,u.a.MEDIA_DETACHING));return n.autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},t.prototype.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&(e.video||e.levels.length&&e.altAudio)&&this._startCapping()},t.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},t.prototype.onLevelsUpdated=function(e){this.levels=e.levels},t.prototype.onMediaDetaching=function(){this._stopCapping()},t.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.prototype.getMaxLevel=function(e){var r=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,i){return t.isLevelAllowed(i,r.restrictedLevels)&&i<=e});return t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},t.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},t.isLevelAllowed=function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var n,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=r)&&(n=s,!(i=e[a+1])||n.width!==i.width||n.height!==i.height)){o=a;break}}return o},Ce(t,[{key:"mediaWidth",get:function(){var e=void 0,r=this.media;return r&&(e=r.width||r.clientWidth||r.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,r=this.media;return r&&(e=r.height||r.clientHeight||r.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),t}(d);var De=window.performance,Pe=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHING))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,r){var n=De.now();if(t){if(this.lastTime){var i=n-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*o/i,l=this.hls;if(l.trigger(u.a.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),s>0&&o>l.config.fpsDroppedMonitoringThreshold*a){var f=l.currentLevel;c.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=f)&&(f-=1,l.trigger(u.a.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:l.currentLevel}),l.autoLevelCapping=f,l.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(d);var Me=window,Fe=Me.performance,Ne=Me.XMLHttpRequest,Ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:Fe.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e=void 0,t=this.context;e=this.loader=new Ne;var r=this.stats;r.tfirst=0,r.loaded=0;var n=this.xhrSetup;try{if(n)try{n(e,t.url)}catch(r){e.open("GET",t.url,!0),n(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(r){return void this.callbacks.onError({code:e.status,text:r.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,n=this.stats,i=this.context,o=this.config;if(!n.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(Fe.now(),n.trequest)),4===r){var a=t.status;if(a>=200&&a<300){n.tload=Math.max(n.tfirst,Fe.now());var s=void 0,u=void 0;u="arraybuffer"===i.responseType?(s=t.response).byteLength:(s=t.responseText).length,n.loaded=n.total=u;var l={url:t.responseURL,data:s};this.callbacks.onSuccess(l,n,i,t)}else n.retry>=o.maxRetry||a>=400&&a<499?(c.b.error(a+" while loading "+i.url),this.callbacks.onError({code:a,text:t.statusText},i,t)):(c.b.warn(a+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},e.prototype.loadtimeout=function(){c.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total);var n=this.callbacks.onProgress;n&&n(r,this.context,null,t)},e}(),Be=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var je=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MANIFEST_LOADING,u.a.MANIFEST_PARSED,u.a.AUDIO_TRACK_LOADED,u.a.AUDIO_TRACK_SWITCHED,u.a.LEVEL_LOADED,u.a.ERROR));return n._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},t.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u.a.AUDIO_TRACKS_UPDATED,{audioTracks:t})},t.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)c.b.warn("Invalid audio track id:",e.id);else{if(c.b.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},t.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var r=t.audioGroupIds[t.urlId];this.audioGroupId!==r&&(this.audioGroupId=r,this._selectInitialAudioTrack())}},t.prototype.onError=function(e){e.type===a.b.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===a.a.AUDIO_TRACK_LOAD_ERROR&&(c.b.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},t.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)c.b.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)c.b.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];c.b.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var r=t.url,n=t.type,i=t.id;this.hls.trigger(u.a.AUDIO_TRACK_SWITCHING,{id:i,type:n,url:r}),this._loadTrackDetailsIfNeeded(t)}},t.prototype.doTick=function(){this._updateTrack(this._trackId)},t.prototype._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var r=this.tracks[this._trackId],n=null;if(r&&(n=r.name),this._selectDefaultTrack){var i=t.filter(function(e){return e.default});i.length?t=i:c.b.warn("No default audio tracks defined")}var o=!1,s=function(){t.forEach(function(t){o||e.audioGroupId&&t.groupId!==e.audioGroupId||n&&n!==t.name||(e._setAudioTrack(t.id),o=!0)})};s(),o||(n=null,s()),o||(c.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},t.prototype._needsTrackLoading=function(e){var t=e.details;return!t||(!!t.live||void 0)},t.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,r=e.id;c.b.log("loading audio-track playlist for id: "+r),this.hls.trigger(u.a.AUDIO_TRACK_LOADING,{url:t,id:r})}},t.prototype._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.b.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},t.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],r=t.name,n=t.language,i=t.groupId;c.b.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+r+'" / "'+n+'"');for(var o=e,a=0;a<this.tracks.length;a++){if(!this.trackIdBlacklist[a])if(this.tracks[a].name===r){o=a;break}}o!==e?(c.b.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):c.b.warn('No fallback audio-track found for name/language: "'+r+'" / "'+n+'"')},Be(t,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),t}(ce),He=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var Ge=window.performance,ze={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},We=function(e){function t(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.MEDIA_DETACHING,u.a.AUDIO_TRACKS_UPDATED,u.a.AUDIO_TRACK_SWITCHING,u.a.AUDIO_TRACK_LOADED,u.a.KEY_LOADED,u.a.FRAG_LOADED,u.a.FRAG_PARSING_INIT_SEGMENT,u.a.FRAG_PARSING_DATA,u.a.FRAG_PARSED,u.a.ERROR,u.a.BUFFER_RESET,u.a.BUFFER_CREATED,u.a.BUFFER_APPENDED,u.a.BUFFER_FLUSHED,u.a.INIT_PTS_FOUND));return i.fragmentTracker=n,i.config=r.config,i.audioCodecSwap=!1,i._state=ze.STOPPED,i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},t.prototype.onHandlerDestroyed=function(){this.state=ze.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},t.prototype.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc,n=e.initPTS;"main"===t&&(this.initPTS[r]=n,this.videoTrackCC=r,c.b.log("InitPTS for cc: "+r+" found from video track: "+n),this.state===ze.WAITING_INIT_PTS&&this.tick())},t.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(c.b.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ze.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=ze.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=ze.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ze.STOPPED},t.prototype.doTick=function(){var e=void 0,t=void 0,r=void 0,n=this.hls,i=n.config;switch(this.state){case ze.ERROR:case ze.PAUSED:case ze.BUFFER_FLUSHING:break;case ze.STARTING:this.state=ze.WAITING_TRACK,this.loadedmetadata=!1;break;case ze.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var a=this.mediaBuffer?this.mediaBuffer:this.media,l=this.videoBuffer?this.videoBuffer:this.media,f=q.bufferInfo(a,e,i.maxBufferHole),d=q.bufferInfo(l,e,i.maxBufferHole),h=f.len,p=f.end,m=this.fragPrevious,g=Math.min(i.maxBufferLength,i.maxMaxBufferLength),y=Math.max(g,d.len),v=this.audioSwitch,_=this.trackId;if((h<y||v)&&_<o.length){if(void 0===(r=o[_].details)){this.state=ze.WAITING_TRACK;break}if(!v&&!r.live&&m&&m.sn===r.endSN&&!f.nextStart&&(!this.media.seeking||this.media.duration-p<m.duration/2)){this.hls.trigger(u.a.BUFFER_EOS,{type:"audio"}),this.state=ze.ENDED;break}var b=r.fragments,w=b.length,E=b[0].start,S=b[w-1].start+b[w-1].duration,T=void 0;if(v)if(r.live&&!r.PTSKnown)c.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,r.PTSKnown&&e<E){if(!(f.end>E||f.nextStart))return;c.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=E+.05}if(r.initSegment&&!r.initSegment.data)T=r.initSegment;else if(p<=E){if(T=b[0],null!==this.videoTrackCC&&T.cc!==this.videoTrackCC&&(T=function(e,t){return W.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}(b,this.videoTrackCC)),r.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var k=f.nextStart?f.nextStart:E;return c.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(k+.05)),void(this.media.currentTime=k+.05)}}else{var A=void 0,R=i.maxFragLookUpTolerance,x=m?b[m.sn-b[0].sn+1]:void 0,L=function(e){var t=Math.min(R,e.duration);return e.start+e.duration-t<=p?1:e.start-t>p&&e.start?-1:0};p<S?(p>S-R&&(R=0),A=x&&!L(x)?x:W.search(b,L)):A=b[w-1],A&&(T=A,E=A.start,m&&T.level===m.level&&T.sn===m.sn&&(T.sn<r.endSN?(T=b[T.sn+1-r.startSN],c.b.log("SN just loaded, load next one: "+T.sn)):T=null))}T&&(T.encrypted?(c.b.log("Loading key for "+T.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+_),this.state=ze.KEY_LOADING,n.trigger(u.a.KEY_LOADING,{frag:T})):(c.b.log("Loading "+T.sn+", cc: "+T.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+_+", currentTime:"+e+",bufferEnd:"+p.toFixed(3)),(v||this.fragmentTracker.getState(T)===B)&&(this.fragCurrent=T,this.startFragRequested=!0,Object(s.a)(T.sn)&&(this.nextLoadPosition=T.start+T.duration),n.trigger(u.a.FRAG_LOADING,{frag:T}),this.state=ze.FRAG_LOADING)))}break;case ze.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=ze.IDLE);break;case ze.FRAG_LOADING_WAITING_RETRY:var I=Ge.now(),C=this.retryDate,O=(a=this.media)&&a.seeking;(!C||I>=C||O)&&(c.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ze.IDLE);break;case ze.WAITING_INIT_PTS:var D=this.videoTrackCC;if(void 0===this.initPTS[D])break;var P=this.waitingFragment;if(P){var M=P.frag.cc;D!==M?(t=this.tracks[this.trackId]).details&&t.details.live&&(c.b.warn("Waiting fragment CC ("+M+") does not match video track CC ("+D+")"),this.waitingFragment=null,this.state=ze.IDLE):(this.state=ze.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=ze.IDLE;break;case ze.STOPPED:case ze.FRAG_LOADING:case ze.PARSING:case ze.PARSED:case ze.ENDED:}},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){this.state===ze.ENDED&&(this.state=ze.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.prototype.onAudioTracksUpdated=function(e){c.b.log("audio tracks updated"),this.tracks=e.audioTracks},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=ze.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ze.IDLE),this.tick()},t.prototype.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,n=this.tracks[r],i=t.totalduration,o=0;if(c.b.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var a=n.details;a&&t.fragments.length>0?(oe(a,t),o=t.fragments[0].start,t.PTSKnown?c.b.log("live audio playlist sliding:"+o.toFixed(3)):c.b.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.b.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(n.details=t,!this.startFragRequested){if(-1===this.startPosition){var u=t.startTimeOffset;Object(s.a)(u)?(c.b.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===ze.WAITING_TRACK&&(this.state=ze.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===ze.KEY_LOADING&&(this.state=ze.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag;if(this.state===ze.FRAG_LOADING&&t&&"audio"===r.type&&r.level===t.level&&r.sn===t.sn){var n=this.tracks[this.trackId],i=n.details,o=i.totalduration,a=t.level,s=t.sn,l=t.cc,f=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",d=this.stats=e.stats;if("initSegment"===s)this.state=ze.IDLE,d.tparsed=d.tbuffered=Ge.now(),i.initSegment.data=e.payload,this.hls.trigger(u.a.FRAG_BUFFERED,{stats:d,frag:t,id:"audio"}),this.tick();else{this.state=ze.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new te(this.hls,"audio"));var h=this.initPTS[l],p=i.initSegment?i.initSegment.data:[];if(i.initSegment||void 0!==h){this.pendingBuffering=!0,c.b.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a);this.demuxer.push(e.payload,p,f,null,t,o,!1,h)}else c.b.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.waitingFragment=e,this.state=ze.WAITING_INIT_PTS}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===ze.PARSING){var n=e.tracks,i=void 0;if(n.video&&delete n.video,i=n.audio){i.levelCodec=i.codec,i.id=e.id,this.hls.trigger(u.a.BUFFER_CODECS,n),c.b.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.a.BUFFER_APPENDING,a))}this.tick()}}},t.prototype.onFragParsingData=function(e){var t=this,r=this.fragCurrent,n=e.frag;if(r&&"audio"===e.id&&"audio"===e.type&&n.sn===r.sn&&n.level===r.level&&this.state===ze.PARSING){var i=this.trackId,o=this.tracks[i],l=this.hls;Object(s.a)(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),r.addElementaryStream(y.ElementaryStreamTypes.AUDIO),c.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),ie(o.details,r,e.startPTS,e.endPTS);var f=this.audioSwitch,d=this.media,h=!1;if(f&&d)if(d.readyState){var p=d.currentTime;c.b.log("switching audio track : currentTime:"+p),p>=e.startPTS&&(c.b.log("switching audio track : flushing all audio"),this.state=ze.BUFFER_FLUSHING,l.trigger(u.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h=!0,this.audioSwitch=!1,l.trigger(u.a.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,l.trigger(u.a.AUDIO_TRACK_SWITCHED,{id:i});var m=this.pendingData;if(!m)return c.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void l.trigger(u.a.ERROR,{type:a.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&m.push({type:e.type,data:t,parent:"audio",content:"data"})}),!h&&m.length&&(m.forEach(function(e){t.state===ze.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(u.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===ze.PARSING&&(this.stats.tparsed=Ge.now(),this.state=ze.PARSED,this._checkAppendedParsed())},t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==ze.PARSING&&t!==ze.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==ze.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Ge.now(),r.trigger(u.a.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;c.b.log("audio buffered : "+ae.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(u.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ze.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&"audio"!==r.type)break;if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var i=this.config;if(n<=i.fragLoadingMaxRetry){this.fragLoadError=n;var o=Math.min(Math.pow(2,n-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);c.b.warn("AudioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=Ge.now()+o,this.state=ze.FRAG_LOADING_WAITING_RETRY}else c.b.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=ze.ERROR}break;case a.a.AUDIO_TRACK_LOAD_ERROR:case a.a.AUDIO_TRACK_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:this.state!==ze.ERROR&&(this.state=e.fatal?ze.ERROR:ze.IDLE,c.b.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case a.a.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===ze.PARSING||this.state===ze.PARSED)){var s=this.mediaBuffer,l=this.media.currentTime;if(s&&q.isBuffered(s,l)&&q.isBuffered(s,l+.5)){var f=this.config;f.maxMaxBufferLength>=f.maxBufferLength&&(f.maxMaxBufferLength/=2,c.b.warn("AudioStreamController: reduce max buffer length to "+f.maxMaxBufferLength+"s")),this.state=ze.IDLE}else c.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=ze.BUFFER_FLUSHING,this.hls.trigger(u.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},t.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.b.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(u.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=ze.PARSED):(this.state=ze.IDLE,this.fragPrevious=null,this.tick())},He(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.b.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(ce),qe=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&(!!r[e.toLowerCase()]&&e.toLowerCase())}function i(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function o(r,o,a){var s=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),c={};u?s=document.createElement("custom"):c.enumerable=!0,s.hasBeenReset=!1;var l="",f=!1,d=r,h=o,p=a,m=null,g="",y=!0,v="auto",_="start",b=50,w="middle",E=50,S="middle";if(Object.defineProperty(s,"id",i({},c,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},c,{get:function(){return f},set:function(e){f=!!e}})),Object.defineProperty(s,"startTime",i({},c,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},c,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},c,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},c,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},c,{get:function(){return g},set:function(e){var r=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");g=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},c,{get:function(){return y},set:function(e){y=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},c,{get:function(){return v},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},c,{get:function(){return _},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},c,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},c,{get:function(){return w},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},c,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},c,{get:function(){return S},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),s.displayState=void 0,u)return s}return o.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},o}(),Ye=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function Ke(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Ye,this.regionList=[]}function Ve(){this.values=Object.create(null)}function Ze(e,t,r,n){var i=n?e.split(n):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(r);if(2===a.length)t(a[0],a[1])}}Ve.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var Xe=new qe(0,0,0),$e="middle"===Xe.align?"middle":"center";function Je(e,t,r){var n=e;function i(){var t=function(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+(0|n)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=i(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var n=new Ve;Ze(e,function(e,t){switch(e){case"region":for(var i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),a=o[0];n.integer(e,a),n.percent(e,a)&&n.set("snapToLines",!1),n.alt(e,a,["auto"]),2===o.length&&n.alt("lineAlign",o[1],["start",$e,"end"]);break;case"position":o=t.split(","),n.percent(e,o[0]),2===o.length&&n.alt("positionAlign",o[1],["start",$e,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",$e,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var i=n.get("line","auto");"auto"===i&&-1===Xe.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",$e);var o=n.get("position","auto");"auto"===o&&50===Xe.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function Qe(e){return e.replace(/<br(?: \/)?>/gi,"\n")}Ke.prototype={parse:function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=Qe(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var n=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n=void 0;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(n=r()).match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:n=r(),t.state){case"HEADER":/:/.test(n)?Ze(n,function(e,t){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new qe(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{Je(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==n.indexOf("--\x3e");if(!n||a&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var et=Ke;function tt(e,t,r,n){for(var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=window.VTTCue||window.TextTrackCue,l=0;l<n.rows.length;l++)if(a=!0,s=0,u="",!(i=n.rows[l]).isEmpty()){for(var f=0;f<i.chars.length;f++)i.chars[f].uchar.match(/\s/)&&a?s++:(u+=i.chars[f].uchar,a=!1);i.cueStartTime=t,t===r&&(r+=1e-4),o=new c(t,r,Qe(u.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?o.line=l+1:o.line=l>7?l-2:l+1,o.align="left",o.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(o)}}function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var nt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},it=function(e){var t=e;return nt.hasOwnProperty(e)&&(t=nt[e]),String.fromCharCode(t)},ot=15,at=100,st={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ut={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ct={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},lt={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ft=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],dt={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},ht=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},pt=function(){function e(t,r,n,i,o){rt(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=n||!1,this.background=i||"black",this.flash=o||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),mt=function(){function e(t,r,n,i,o,a){rt(this,e),this.uchar=t||" ",this.penState=new pt(r,n,i,o,a)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),gt=function(){function e(){rt(this,e),this.chars=[];for(var t=0;t<at;t++)this.chars.push(new mt);this.pos=0,this.currPenState=new pt}return e.prototype.equals=function(e){for(var t=!0,r=0;r<at;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<at;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<at;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(dt.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>at&&(dt.log("ERROR","Too large cursor position "+this.pos),this.pos=at)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=it(e);this.pos>=at?dt.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t=void 0;for(t=e;t<at;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,r=0;r<at;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),yt=function(){function e(){rt(this,e),this.rows=[];for(var t=0;t<ot;t++)this.rows.push(new gt);this.currRow=ot-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<ot;e++)this.rows[e].clear();this.currRow=ot-1},e.prototype.equals=function(e){for(var t=!0,r=0;r<ot;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<ot;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<ot;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){dt.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){dt.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<ot;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[n].cueStartTime;if(o&&o<dt.time)for(var a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(i.rows[n+a])}}this.currRow=t;var s=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,c=Math.max(u-1,0);s.setCursor(e.indent),e.color=s.chars[c].penState.foreground}var l={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(l)},e.prototype.setBkgData=function(e){dt.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null!==this.nrRollUpRows){dt.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),dt.log("INFO","Rolling up")}else dt.log("DEBUG","roll_up but nrRollUpRows not set yet")},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<ot;i++){var o=this.rows[i].getTextString();o&&(n=i+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},e.prototype.getTextAndFormat=function(){return this.rows},e}(),vt=function(){function e(t,r){rt(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new yt,this.nonDisplayedMemory=new yt,this.lastOutputScreen=new yt,this.currRollUpRow=this.displayedMemory.rows[ot-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[ot-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,dt.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";dt.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(dt.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){dt.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){dt.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){dt.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){dt.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){dt.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){dt.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){dt.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){dt.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){dt.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){dt.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){dt.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(dt.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,dt.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){dt.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}dt.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=dt.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),_t=function(){function e(t,r,n){rt(this,e),this.field=t||1,this.outputs=[r,n],this.channels=[new vt(1,r),new vt(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var r=void 0,n=void 0,i=void 0,o=!1;this.lastTime=e,dt.setTime(e);for(var a=0;a<t.length;a+=2)if(n=127&t[a],i=127&t[a+1],0!==n||0!==i){if(dt.log("DATA","["+ht([t[a],t[a+1]])+"] -> ("+ht([n,i])+")"),(r=this.parseCmd(n,i))||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),!r)if(o=this.parseChars(n,i))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(o);else dt.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,dt.log("WARNING","Couldn't parse cleaned data "+ht([n,i])+" orig: "+ht([t[a],t[a+1]])))}else this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var r=null;if(!((20===e||28===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,dt.log("DEBUG","Repeated command ("+ht([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},e.prototype.parseMidrow=function(e,t){var r=null;return(17===e||25===e)&&t>=32&&t<=47&&((r=17===e?1:2)!==this.currChNr?(dt.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[r-1].ccMIDROW(t),dt.log("DEBUG","MIDROW ("+ht([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var r,n=null;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,n=t>=64&&t<=95?1===r?st[e]:ct[e]:1===r?ut[e]:lt[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},e.prototype.interpretPAC=function(e,t){var r=t,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},e.prototype.parseChars=function(e,t){var r=null,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,dt.log("INFO","Special char '"+it(o)+"' in channel "+r),n=[o]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);if(n){var a=ht(n);dt.log("DEBUG","Char codes =  "+a.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},e.prototype.parseBackgroundAttributes=function(e,t){var r,n=void 0,i=void 0;return((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47)&&(n={},16===e||24===e?(i=Math.floor((t-32)/2),n.background=ft[i],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),r=e<24?1:2,this.channels[r-1].setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}();var bt=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timelineController=t,this.trackName=r,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e}(),wt=function(e,t,r){return e.substr(r||0,t.length)===t},Et=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()},St={parse:function(e,t,r,n,i,o){var a=Object(be.b)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",c=0,l=0,f=0,d=[],h=void 0,p=!0,m=new et;m.oncue=function(e){var t=r[n],i=r.ccOffset;t&&t.new&&(void 0!==l?i=r.ccOffset=t.start:function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;i&&i.new;)e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC];e.presentationOffset=r}(r,n,f)),f&&(i=f+r.ccOffset-r.presentationOffset),e.startTime+=i-l,e.endTime+=i-l,e.id=Et(e.startTime.toString())+Et(e.endTime.toString())+Et(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&d.push(e)},m.onparsingerror=function(e){h=e},m.onflush=function(){h&&o?o(h):i(d)},a.forEach(function(e){if(p){if(wt(e,"X-TIMESTAMP-MAP=")){p=!1,e.substr(16).split(",").forEach(function(e){wt(e,"LOCAL:")?u=e.substr(6):wt(e,"MPEGTS:")&&(c=parseInt(e.substr(7)))});try{c-=t=t<0?t+8589934592:t,r=u,n=parseInt(r.substr(-3)),i=parseInt(r.substr(-6,2)),o=parseInt(r.substr(-9,2)),a=r.length>9?parseInt(r.substr(0,r.indexOf(":"))):0,l=(Object(s.a)(n)&&Object(s.a)(i)&&Object(s.a)(o)&&Object(s.a)(a)?(n+=1e3*i,n+=6e4*o,n+=36e5*a):-1)/1e3,f=c/9e4,-1===l&&(h=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){h=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(p=!1)}var r,n,i,o,a;m.parse(e+"\n")}),m.flush()}};var Tt=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHING,u.a.MEDIA_DETACHING,u.a.FRAG_PARSING_USERDATA,u.a.FRAG_DECRYPTED,u.a.MANIFEST_LOADING,u.a.MANIFEST_LOADED,u.a.FRAG_LOADED,u.a.LEVEL_SWITCHING,u.a.INIT_PTS_FOUND));if(n.hls=r,n.config=r.config,n.enabled=!0,n.Cues=r.config.cueHandler,n.textTracks=[],n.tracks=[],n.unparsedVttFrags=[],n.initPTS=void 0,n.cueRanges=[],n.captionsTracks={},n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode}},n.config.enableCEA708Captions){var i=new bt(n,"textTrack1"),o=new bt(n,"textTrack2");n.cea608Parser=new _t(0,i,o)}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addCues=function(e,t,r,n){for(var i,o,a,s,u=this.cueRanges,c=!1,l=u.length;l--;){var f=u[l],d=(i=f[0],o=f[1],a=t,s=r,Math.min(o,s)-Math.max(i,a));if(d>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],r),c=!0,d/(r-t)>.5))return}c||u.push([t,r]),this.Cues.newCue(this.captionsTracks[e],t,r,n)},t.prototype.onInitPtsFound=function(e){var t=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},t.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null},t.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],r=t.label,n=t.languageCode,i=this.captionsTracks;if(!i[e]){var o=this.getExistingTrack(e);if(o)i[e]=o,Ee(i[e]),we(i[e],this.media);else{var a=this.createTextTrack("captions",r,n);a&&(a[e]=!0,i[e]=a)}}},t.prototype.createTextTrack=function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)},t.prototype.destroy=function(){d.prototype.destroy.call(this)},t.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Ee(e[t]),delete e[t]})},t.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},t.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Ee(t[r])}},t.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var r=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,n){var i=void 0;if(n<r.length){var o=r[n];(function(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)})(o,e)&&(i=o)}i||(i=t.createTextTrack("subtitles",e.name,e.lang)),e.default?i.mode=t.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",t.textTracks.push(i)})}},t.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},t.prototype.onFragLoaded=function(e){var t=e.frag,r=e.payload;if("main"===t.type){var n=t.sn;if(n!==this.lastSn+1){var i=this.cea608Parser;i&&i.reset()}this.lastSn=n}else if("subtitle"===t.type)if(r.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);var o=t.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(t,r)}else this.hls.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t.prototype._parseVTTs=function(e,t){var r=this.vttCCs;r[e.cc]||(r[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,i=this.hls;St.parse(t,this.initPTS,r,e.cc,function(t){var r=n[e.trackId];"disabled"!==r.mode?(t.forEach(function(e){if(!r.cues.getCueById(e.id))try{r.addCue(e)}catch(n){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,r.addCue(t)}}),i.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):i.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){c.b.log("Failed to parse VTT cue: "+t),i.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},t.prototype.onFragDecrypted=function(e){var t=e.payload,r=e.frag;if("subtitle"===r.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(r,t)}},t.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}},t.prototype.extractCea608Data=function(e){for(var t=31&e[0],r=2,n=void 0,i=void 0,o=void 0,a=[],s=0;s<t;s++)n=e[r++],i=127&e[r++],o=127&e[r++],0===i&&0===o||0!=(4&n)&&0===(3&n)&&(a.push(i),a.push(o));return a},t}(d),kt=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function At(e){for(var t=[],r=0;r<e.length;r++)"subtitles"===e[r].kind&&t.push(e[r]);return t}var Rt=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.MEDIA_DETACHING,u.a.MANIFEST_LOADING,u.a.MANIFEST_LOADED,u.a.SUBTITLE_TRACK_LOADED));return n.tracks=[],n.trackId=-1,n.media=null,n.subtitleDisplay=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=At(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack=e}},t.prototype.destroy=function(){d.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,r=e.subtitles||[];this.tracks=r,this.trackId=-1,this.hls.trigger(u.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var e=this.trackId,t=this.tracks[e];if(t){var r=t.details;r&&!r.live||(c.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(u.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(c.b.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&this._stopTimer())},t.prototype.setSubtitleTrackInternal=function(e){var t=this.hls,r=this.tracks;if(!("number"!=typeof e||e<-1||e>=r.length)&&(this._stopTimer(),this.trackId=e,c.b.log("switching to subtitle track "+e),t.trigger(u.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e)){var n=r[e],i=n.details;i&&!i.live||(c.b.log("(re)loading playlist for subtitle track "+e),t.trigger(u.a.SUBTITLE_TRACK_LOADING,{url:n.url,id:e}))}},t.prototype._stopTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t.prototype._toggleTrackModes=function(e){var t=this.media,r=this.subtitleDisplay,n=this.trackId;if(t){var i=At(t.textTracks);if(-1===e)[].slice.call(i).forEach(function(e){e.mode="disabled"});else{var o=i[n];o&&(o.mode="disabled")}var a=i[e];a&&(a.mode=r?"showing":"hidden")}},kt(t,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this.setSubtitleTrackInternal(e))}}]),t}(d),xt=r(8);var Lt=window.performance,It={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Ct=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.ERROR,u.a.KEY_LOADED,u.a.FRAG_LOADED,u.a.SUBTITLE_TRACKS_UPDATED,u.a.SUBTITLE_TRACK_SWITCH,u.a.SUBTITLE_TRACK_LOADED,u.a.SUBTITLE_FRAG_PROCESSED));return n.config=r.config,n.vttFragSNsProcessed={},n.vttFragQueues=void 0,n.currentlyProcessing=null,n.state=It.STOPPED,n.currentTrackId=-1,n.decrypter=new xt.a(r.observer,r.config),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.onHandlerDestroyed=function(){this.state=It.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(u.a.FRAG_LOADING,{frag:e}),this.state=It.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=It.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=It.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.doTick=function(){var e=this;switch(this.state){case It.IDLE:var t,r=this.tracks,n=this.currentTrackId,i=this.vttFragSNsProcessed[n],o=this.vttFragQueues[n],a=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!r)break;if(n<r.length&&(t=r[n].details),void 0===t)break;t.fragments.forEach(function(t){(function(e){return i.indexOf(e.sn)>-1})(t)||t.sn===a||function(e){return o.some(function(t){return t.sn===e.sn})}(t)||(t.encrypted?(c.b.log("Loading key for "+t.sn),e.state=It.KEY_LOADING,e.hls.trigger(u.a.KEY_LOADING,{frag:t})):(t.trackId=n,o.push(t),e.nextFrag()))})}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;c.b.log("subtitle tracks updated"),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.tick()}},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===It.KEY_LOADING&&(this.state=It.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag.decryptdata,n=e.frag,i=this.hls;if(this.state===It.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var o=void 0;try{o=Lt.now()}catch(e){o=Date.now()}this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,function(e){var t=void 0;try{t=Lt.now()}catch(e){t=Date.now()}i.trigger(u.a.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:o,tdecrypt:t}})})}},t}(ce),Ot=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var Dt=window.XMLHttpRequest,Pt="com.widevine.alpha",Mt="com.microsoft.playready",Ft=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r,u.a.MEDIA_ATTACHED,u.a.MANIFEST_PARSED));return n._widevineLicenseUrl=r.config.widevineLicenseUrl,n._licenseXhrSetup=r.config.licenseXhrSetup,n._emeEnabled=r.config.emeEnabled,n._requestMediaKeySystemAccess=r.config.requestMediaKeySystemAccessFunc,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._isMediaEncrypted=!1,n._requestLicenseFailureCount=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getLicenseServerUrl=function(e){var t=void 0;switch(e){case Pt:t=this._widevineLicenseUrl;break;default:t=null}return t||(c.b.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,r){var n=this,i=function(e,t,r){switch(e){case Pt:return function(e,t,r){var n={videoCapabilities:[]};return t.forEach(function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[n]}(0,r);default:throw Error("Unknown key-system: "+e)}}(e,0,r);i?(c.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,i).then(function(t){n._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){c.b.error('Failed to obtain key-system "'+e+'" access:',t)})):c.b.warn("Can not create config for key-system (maybe because platform is not supported):",e)},t.prototype._onMediaKeySystemAccessObtained=function(e,t){var r=this;c.b.log('Access for key-system "'+e+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n),t.createMediaKeys().then(function(t){n.mediaKeys=t,c.b.log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated()}).catch(function(e){c.b.error("Failed to create media-keys:",e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;c.b.log("New key-system session "+e.sessionId),e.addEventListener("message",function(r){t._onKeySessionMessage(e,r.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){c.b.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){c.b.log("Received license data, updating key-session"),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){c.b.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return c.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_KEYS,fatal:!0});c.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){var e=this,t=this._mediaKeysList[0];if(!t)return c.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)c.b.warn("Key-Session already initialized but requested again");else{var r=t.mediaKeysSession;r||(c.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,i=this._mediaEncryptionInitData;c.b.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,r.generateRequest(n,i).then(function(){c.b.debug("Key-session generation succeeded")}).catch(function(t){c.b.error("Error generating key-session request:",t),e.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t.prototype._createLicenseXhr=function(e,t,r){var n=new Dt,i=this._licenseXhrSetup;try{if(i)try{i(n,e)}catch(t){n.open("POST",e,!0),i(n,e)}n.readyState||n.open("POST",e,!0)}catch(e){return c.b.error("Error setting up key-system license XHR",e),void this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,r),n},t.prototype._onLicenseRequestReadyStageChange=function(e,t,r,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,c.b.log("License request succeeded"),n(e.response);else{if(c.b.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var i=3-this._requestLicenseFailureCount+1;return c.b.warn("Retrying license request, "+i+" attempts left"),void this._requestLicense(r,n)}this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var r=void 0;return e.mediaKeySystemDomain===Mt?c.b.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===Pt?r=t:c.b.error("Unsupported key-system:",e.mediaKeySystemDomain),r},t.prototype._requestLicense=function(e,t){c.b.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return c.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.a.ERROR,{type:a.b.KEY_SYSTEM_ERROR,details:a.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(r.mediaKeySystemDomain),i=this._createLicenseXhr(n,e,t);c.b.log("Sending license request to URL: "+n),i.send(this._generateLicenseRequestChallenge(r,e))},t.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),r=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(Pt,t,r)}},Ot(t,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}(d),Nt={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ue,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:xe,bufferController:Ie,capLevelController:Oe,fpsController:Pe,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null};Nt.subtitleStreamController=Ct,Nt.subtitleTrackController=Rt,Nt.timelineController=Tt,Nt.cueHandler=n,Nt.enableCEA708Captions=!0,Nt.enableWebVTT=!0,Nt.captionsTextTrack1Label="English",Nt.captionsTextTrack1LanguageCode="en",Nt.captionsTextTrack2Label="Spanish",Nt.captionsTextTrack2LanguageCode="es",Nt.audioStreamController=We,Nt.audioTrackController=je,Nt.emeController=Ft;var Ut=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(14);var Bt=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in n)i in r||(r[i]=n[i]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.a)(r.debug),this.config=r,this._autoLevelCapping=-1;var o=this.observer=new K.a;o.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];o.emit.apply(o,[e,e].concat(r))},o.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];o.removeListener.apply(o,[e].concat(r))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.once=o.once.bind(o),this.trigger=o.trigger.bind(o);var a=this.abrController=new r.abrController(this),s=new r.bufferController(this),u=new r.capLevelController(this),l=new r.fpsController(this),f=new F(this),d=new N(this),h=new U(this),p=new Se(this),m=this.levelController=new _e(this),g=new z(this),y=[m,this.streamController=new me(this,g)],v=r.audioStreamController;v&&y.push(new v(this,g)),this.networkControllers=y;var _=[f,d,h,a,s,u,l,p,g];if(v=r.audioTrackController){var b=new v(this);this.audioTrackController=b,_.push(b)}if(v=r.subtitleTrackController){var w=new v(this);this.subtitleTrackController=w,_.push(w)}if(v=r.emeController){var E=new v(this);this.emeController=E,_.push(E)}[r.subtitleStreamController,r.timelineController].forEach(function(e){e&&_.push(new e(t))}),this.coreComponents=_}return e.isSupported=function(){return e=$(),t=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,!!r&&!!n;var e,t,r,n},Ut(e,null,[{key:"version",get:function(){return"0.11.0"}},{key:"Events",get:function(){return u.a}},{key:"ErrorTypes",get:function(){return a.b}},{key:"ErrorDetails",get:function(){return a.a}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:Nt},set:function(t){e.defaultConfig=t}}]),e.prototype.destroy=function(){c.b.log("destroy"),this.trigger(u.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(e){c.b.log("attachMedia"),this.media=e,this.trigger(u.a.MEDIA_ATTACHING,{media:e})},e.prototype.detachMedia=function(){c.b.log("detachMedia"),this.trigger(u.a.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(e){e=o.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.b.log("loadSource:"+e),this.url=e,this.trigger(u.a.MANIFEST_LOADING,{url:e})},e.prototype.startLoad=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;c.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},e.prototype.stopLoad=function(){c.b.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.prototype.swapAudioCodec=function(){c.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){c.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},Ut(e,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.b.log("set startLevel:"+e);-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,n=0;n<r;n++){if((e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate)>t)return n}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),e}();t.default=Bt},function(e,t,r){function n(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\((/\\*.*?\\*/)?s?.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,n){var s={};s[n]=[];var u=t.toString(),c=u.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return s;for(var l,f=c[1],d=new RegExp("(\\\\n|\\W)"+a(f)+o,"g");l=d.exec(u);)"dll-reference"!==l[3]&&s[n].push(l[3]);for(d=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");l=d.exec(u);)e[l[2]]||(s[n].push(l[1]),e[l[2]]=r(l[1]).m),s[l[2]]=s[l[2]]||[],s[l[2]].push(l[4]);return s}function u(e){return Object.keys(e).reduce(function(t,r){return t||e[r].length>0},!1)}e.exports=function(e,t){t=t||{};var i={main:r.m},o=t.all?{main:Object.keys(i)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};u(r);)for(var o=Object.keys(r),a=0;a<o.length;a++){var c=o[a],l=r[c].pop();if(i[c]=i[c]||{},!i[c][l]&&e[c][l]){i[c][l]=!0,n[c]=n[c]||[],n[c].push(l);for(var f=s(e,e[c][l],c),d=Object.keys(f),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(f[d[h]])}}return n}(i,e),a="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),a=a+"("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"})(self);";var c=new window.Blob([a],{type:"text/javascript"});if(t.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),f=new window.Worker(l);return f.objectURL=l,f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10),i=r(1),o=r(0),a=r(7),s=r.n(a);t.default=function(e){var t=new s.a;t.trigger=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(n))},t.off=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(n))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new n.a(t,a.typeSupported,s,a.vendor);try{Object(o.a)(!0===s.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(i.a.FRAG_DECRYPTED,r),t.on(i.a.FRAG_PARSING_INIT_SEGMENT,r),t.on(i.a.FRAG_PARSED,r),t.on(i.a.ERROR,r),t.on(i.a.FRAG_PARSING_METADATA,r),t.on(i.a.FRAG_PARSING_USERDATA,r),t.on(i.a.INIT_PTS_FOUND,r),t.on(i.a.FRAG_PARSING_DATA,function(t,r){var n=[],i={event:t,data:r};r.data1&&(i.data1=r.data1.buffer,n.push(r.data1.buffer),delete r.data1),r.data2&&(i.data2=r.data2.buffer,n.push(r.data2.buffer),delete r.data2),e.postMessage(i,n)})}},function(e,t){String.prototype.endsWith||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t={}.toString,r=function(e){if(null==this)throw TypeError();var r=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=r.length,i=String(e),o=i.length,a=n;if(arguments.length>1){var s=arguments[1];void 0!==s&&(a=s?Number(s):0)!=a&&(a=0)}var u=Math.min(Math.max(a,0),n)-o;if(u<0)return!1;for(var c=-1;++c<o;)if(r.charCodeAt(u+c)!=i.charCodeAt(c))return!1;return!0};e?e(String.prototype,"endsWith",{value:r,configurable:!0,writable:!0}):String.prototype.endsWith=r}()}]).default},"object"==typeof r&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof r?r.Hls=i():n.Hls=i())},{}],57:[function(e,t,r){var n=e("http"),i=e("url"),o=t.exports;for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a]);function s(e){if("string"==typeof e&&(e=i.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}o.request=function(e,t){return e=s(e),n.request.call(this,e,t)},o.get=function(e,t){return e=s(e),n.get.call(this,e,t)}},{http:136,url:156}],58:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,d=r?-1:1,h=e[t+f];for(f+=d,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=c}return(h?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+h]=255&a,h+=p,a/=256,c-=8);e[r+h-p]|=128*m}},{}],59:[function(e,t,r){(function(e){function r(e){if(!(this instanceof r))return new r(e);if(this.store=e,this.chunkLength=e.chunkLength,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.mem=[]}t.exports=r,r.prototype.put=function(e,t,r){var n=this;n.mem[e]=t,n.store.put(e,t,function(t){n.mem[e]=null,r&&r(t)})},r.prototype.get=function(t,r,n){if("function"==typeof r)return this.get(t,null,r);var i=r&&r.offset||0,o=r&&r.length&&i+r.length,a=this.mem[t];if(a)return function(t,r,n){e.nextTick(function(){t&&t(r,n)})}(n,null,r?a.slice(i,o):a);this.store.get(t,r,n)},r.prototype.close=function(e){this.store.close(e)},r.prototype.destroy=function(e){this.store.destroy(e)}}).call(this,e("_process"))},{_process:98}],60:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],61:[function(e,t,r){t.exports=function(e){for(var t=0,r=e.length;t<r;++t)if(e.charCodeAt(t)>127)return!1;return!0}},{}],62:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],63:[function(e,t,r){"use strict";var n=e("fs");function i(e){return n.existsSync(e)&&n.statSync(e).isFile()}t.exports=function(e,t){if(!t)return i(e);n.stat(e,function(e,r){return e?t(e):t(null,r.isFile())})},t.exports.sync=i},{fs:29}],64:[function(e,t,r){t.exports=o,o.strict=a,o.loose=s;var n=Object.prototype.toString,i={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function o(e){return a(e)||s(e)}function a(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return i[n.call(e)]}},{}],65:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],66:[function(e,t,r){"use strict";r.regex=r.re=/^npm-debug\.log$|^\..*\.swp$|^\.DS_Store$|^\.AppleDouble$|^\.LSOverride$|^Icon\r$|^\._.*|^\.Spotlight-V100(?:$|\/)|\.Trashes|^__MACOSX$|~$|^Thumbs\.db$|^ehthumbs\.db$|^Desktop\.ini$|^@eaDir$/,r.is=(e=>r.re.test(e)),r.not=(e=>!r.is(e))},{}],67:[function(e,t,r){function n(){if(!(this instanceof n))return new n;this._back=[],this._forward=[],this._current=null,this._pending=!1}function i(e,t,r){if(t||(t=u),0===e._back.length||e._pending)return t(null);var n=e._back.pop(),i=e.current();a(e,n,function(o){if(o)return t(o);r||e._forward.push(i);e._current=n,s(e,i),t(null)})}function o(e,t,r){r||(r=u);var n=e.current();a(e,t,function(i){if(i)return r(i);n&&e._back.push(n);e._current=t,s(e,n),r(null)})}function a(e,t,r){function n(t){e._pending=!1,r(t)}e._pending=!0,t&&"function"==typeof t.setup?t.setup(n):n(null)}function s(e,t){e._pending=!0,t&&"function"==typeof t.destroy&&t.destroy(),e._pending=!1}function u(){}t.exports=n,n.prototype.current=function(){return this._current},n.prototype.url=function(){return this.current()?this.current().url:null},n.prototype.go=function(e,t){if(t||(t=u),this._pending)return t(null);if(!("url"in e))throw new Error("Missing required `url` property");this.clearForward(),o(this,e,t)},n.prototype.cancel=function(e){i(this,e,!0)},n.prototype.back=function(e){i(this,e,!1)},n.prototype.forward=function(e){if(e||(e=u),0===this._forward.length||this._pending)return e(null);o(this,this._forward.pop(),e)},n.prototype.hasBack=function(){return this._back.length>0},n.prototype.hasForward=function(){return this._forward.length>0},n.prototype.clearForward=function(e){this._forward=null==e?[]:this._forward.filter(function(t){return t.url!==e})},n.prototype.backToFirst=function(e){var t=this;if(e||(e=u),0===t._back.length)return e(null);t.back(function(r){if(r)return e(r);t.backToFirst(e)})}},{}],68:[function(e,t,r){t.exports=s,t.exports.decode=s,t.exports.encode=function(e){(e=o(e)).infoHashBuffer&&(e.xt="urn:btih:"+e.infoHashBuffer.toString("hex"));e.infoHash&&(e.xt="urn:btih:"+e.infoHash);e.name&&(e.dn=e.name);e.keywords&&(e.kt=e.keywords);e.announce&&(e.tr=e.announce);e.urlList&&(e.ws=e.urlList,delete e.as);var t="magnet:?";return Object.keys(e).filter(function(e){return 2===e.length}).forEach(function(r,n){(Array.isArray(e[r])?e[r]:[e[r]]).forEach(function(e,i){!(n>0||i>0)||"kt"===r&&0!==i||(t+="&"),"dn"===r&&(e=encodeURIComponent(e).replace(/%20/g,"+")),"tr"!==r&&"xs"!==r&&"as"!==r&&"ws"!==r||(e=encodeURIComponent(e)),"kt"===r&&(e=encodeURIComponent(e)),t+="kt"===r&&i>0?"+"+e:r+"="+e})}),t};var n=e("thirty-two"),i=e("safe-buffer").Buffer,o=e("xtend"),a=e("uniq");function s(e){var t,r={},o=e.split("magnet:?")[1];((o&&o.length>=0?o.split("&"):[]).forEach(function(e){var t=e.split("=");if(2===t.length){var n=t[0],i=t[1];if("dn"===n&&(i=decodeURIComponent(i).replace(/\+/g," ")),"tr"!==n&&"xs"!==n&&"as"!==n&&"ws"!==n||(i=decodeURIComponent(i)),"kt"===n&&(i=decodeURIComponent(i).split("+")),"ix"===n&&(i=Number(i)),r[n])if(Array.isArray(r[n]))r[n].push(i);else{var o=r[n];r[n]=[o,i]}else r[n]=i}}),r.xt)&&(Array.isArray(r.xt)?r.xt:[r.xt]).forEach(function(e){if(t=e.match(/^urn:btih:(.{40})/))r.infoHash=t[1].toLowerCase();else if(t=e.match(/^urn:btih:(.{32})/)){var o=n.decode(t[1]);r.infoHash=i.from(o,"binary").toString("hex")}});return r.infoHash&&(r.infoHashBuffer=i.from(r.infoHash,"hex")),r.dn&&(r.name=r.dn),r.kt&&(r.keywords=r.kt),"string"==typeof r.tr?r.announce=[r.tr]:Array.isArray(r.tr)?r.announce=r.tr:r.announce=[],r.urlList=[],("string"==typeof r.as||Array.isArray(r.as))&&(r.urlList=r.urlList.concat(r.as)),("string"==typeof r.ws||Array.isArray(r.ws))&&(r.urlList=r.urlList.concat(r.ws)),a(r.announce),a(r.urlList),r}},{"safe-buffer":128,"thirty-two":144,uniq:154,xtend:177}],69:[function(e,t,r){t.exports=u;var n=e("inherits"),i=e("readable-stream"),o=e("to-arraybuffer"),a="undefined"!=typeof window&&window.MediaSource,s=60;function u(e,t){var r=this;if(!(r instanceof u))return new u(e,t);if(!a)throw new Error("web browser lacks MediaSource support");t||(t={}),r._debug=t.debug,r._bufferDuration=t.bufferDuration||s,r._elem=e,r._mediaSource=new a,r._streams=[],r.detailedError=null,r._errorHandler=function(){r._elem.removeEventListener("error",r._errorHandler),r._streams.slice().forEach(function(e){e.destroy(r._elem.error)})},r._elem.addEventListener("error",r._errorHandler),r._elem.src=window.URL.createObjectURL(r._mediaSource)}function c(e,t){var r=this;if(i.Writable.call(r),r._wrapper=e,r._elem=e._elem,r._mediaSource=e._mediaSource,r._allStreams=e._streams,r._allStreams.push(r),r._bufferDuration=e._bufferDuration,r._sourceBuffer=null,r._debugBuffers=[],r._openHandler=function(){r._onSourceOpen()},r._flowHandler=function(){r._flow()},r._errorHandler=function(e){r.destroyed||r.emit("error",e)},"string"==typeof t)r._type=t,"open"===r._mediaSource.readyState?r._createSourceBuffer():r._mediaSource.addEventListener("sourceopen",r._openHandler);else if(null===t._sourceBuffer)t.destroy(),r._type=t._type,r._mediaSource.addEventListener("sourceopen",r._openHandler);else{if(!t._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");t.destroy(),r._type=t._type,r._sourceBuffer=t._sourceBuffer,r._debugBuffers=t._debugBuffers,r._sourceBuffer.addEventListener("updateend",r._flowHandler),r._sourceBuffer.addEventListener("error",r._errorHandler)}r._elem.addEventListener("timeupdate",r._flowHandler),r.on("error",function(e){r._wrapper.error(e)}),r.on("finish",function(){if(!r.destroyed&&(r._finished=!0,r._allStreams.every(function(e){return e._finished}))){r._wrapper._dumpDebugData();try{r._mediaSource.endOfStream()}catch(e){}}})}u.prototype.createWriteStream=function(e){return new c(this,e)},u.prototype.error=function(e){this.detailedError||(this.detailedError=e),this._dumpDebugData();try{this._mediaSource.endOfStream("decode")}catch(e){}},u.prototype._dumpDebugData=function(){this._debug&&(this._debug=!1,this._streams.forEach(function(e,t){var r,n,i;r=e._debugBuffers,n="mediasource-stream-"+t,(i=document.createElement("a")).href=window.URL.createObjectURL(new window.Blob(r)),i.download=n,i.click()}))},n(c,i.Writable),c.prototype._onSourceOpen=function(){this.destroyed||(this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._createSourceBuffer())},c.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._allStreams.splice(this._allStreams.indexOf(this),1),this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._elem.removeEventListener("timeupdate",this._flowHandler),this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._flowHandler),this._sourceBuffer.removeEventListener("error",this._errorHandler),"open"===this._mediaSource.readyState&&this._sourceBuffer.abort()),e&&this.emit("error",e),this.emit("close"))},c.prototype._createSourceBuffer=function(){if(!this.destroyed)if(a.isTypeSupported(this._type)){if(this._sourceBuffer=this._mediaSource.addSourceBuffer(this._type),this._sourceBuffer.addEventListener("updateend",this._flowHandler),this._sourceBuffer.addEventListener("error",this._errorHandler),this._cb){var e=this._cb;this._cb=null,e()}}else this.destroy(new Error("The provided type is not supported"))},c.prototype._write=function(e,t,r){var n=this;if(!n.destroyed)if(n._sourceBuffer){if(n._sourceBuffer.updating)return r(new Error("Cannot append buffer while source buffer updating"));var i=o(e);n._wrapper._debug&&n._debugBuffers.push(i);try{n._sourceBuffer.appendBuffer(i)}catch(e){return void n.destroy(e)}n._cb=r}else n._cb=function(i){if(i)return r(i);n._write(e,t,r)}},c.prototype._flow=function(){if(!this.destroyed&&this._sourceBuffer&&!this._sourceBuffer.updating&&!("open"===this._mediaSource.readyState&&this._getBufferDuration()>this._bufferDuration)&&this._cb){var e=this._cb;this._cb=null,e()}};c.prototype._getBufferDuration=function(){for(var e=this._sourceBuffer.buffered,t=this._elem.currentTime,r=-1,n=0;n<e.length;n++){var i=e.start(n),o=e.end(n)+0;if(i>t)break;(r>=0||t<=o)&&(r=o)}var a=r-t;return a<0&&(a=0),a}},{inherits:60,"readable-stream":117,"to-arraybuffer":149}],70:[function(e,t,r){(function(e){function r(e,t){if(!(this instanceof r))return new r(e,t);if(t||(t={}),this.chunkLength=Number(e),!this.chunkLength)throw new Error("First argument must be a chunk length");this.chunks=[],this.closed=!1,this.length=Number(t.length)||1/0,this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}function n(t,r,n){e.nextTick(function(){t&&t(r,n)})}t.exports=r,r.prototype.put=function(e,t,r){if(this.closed)return n(r,new Error("Storage is closed"));var i=e===this.lastChunkIndex;return i&&t.length!==this.lastChunkLength?n(r,new Error("Last chunk length must be "+this.lastChunkLength)):i||t.length===this.chunkLength?(this.chunks[e]=t,void n(r,null)):n(r,new Error("Chunk length must be "+this.chunkLength))},r.prototype.get=function(e,t,r){if("function"==typeof t)return this.get(e,null,t);if(this.closed)return n(r,new Error("Storage is closed"));var i=this.chunks[e];if(!i){var o=new Error("Chunk not found");return o.notFound=!0,n(r,o)}if(!t)return n(r,null,i);var a=t.offset||0,s=t.length||i.length-a;n(r,null,i.slice(a,s+a))},r.prototype.close=r.prototype.destroy=function(e){if(this.closed)return n(e,new Error("Storage is closed"));this.closed=!0,this.chunks=null,n(e,null)}}).call(this,e("_process"))},{_process:98}],71:[function(e,t,r){var n,i;n=this,i=function(){"use strict";var r,n;function i(){return r.apply(null,arguments)}function o(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function a(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function s(e){return void 0===e}function u(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function c(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function l(e,t){var r,n=[];for(r=0;r<e.length;++r)n.push(t(e[r],r));return n}function f(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){for(var r in t)f(t,r)&&(e[r]=t[r]);return f(t,"toString")&&(e.toString=t.toString),f(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t,r,n){return Lt(e,t,r,n,!0).utc()}function p(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function m(e){if(null==e._isValid){var t=p(e),r=n.call(t.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return i;e._isValid=i}return e._isValid}function g(e){var t=h(NaN);return null!=e?d(p(t),e):p(t).userInvalidated=!0,t}n=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),r=t.length>>>0,n=0;n<r;n++)if(n in t&&e.call(this,t[n],n,t))return!0;return!1};var y=i.momentProperties=[];function v(e,t){var r,n,i;if(s(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),s(t._i)||(e._i=t._i),s(t._f)||(e._f=t._f),s(t._l)||(e._l=t._l),s(t._strict)||(e._strict=t._strict),s(t._tzm)||(e._tzm=t._tzm),s(t._isUTC)||(e._isUTC=t._isUTC),s(t._offset)||(e._offset=t._offset),s(t._pf)||(e._pf=p(t)),s(t._locale)||(e._locale=t._locale),y.length>0)for(r=0;r<y.length;r++)s(i=t[n=y[r]])||(e[n]=i);return e}var _=!1;function b(e){v(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===_&&(_=!0,i.updateOffset(this),_=!1)}function w(e){return e instanceof b||null!=e&&null!=e._isAMomentObject}function E(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function S(e){var t=+e,r=0;return 0!==t&&isFinite(t)&&(r=E(t)),r}function T(e,t,r){var n,i=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),a=0;for(n=0;n<i;n++)(r&&e[n]!==t[n]||!r&&S(e[n])!==S(t[n]))&&a++;return a+o}function k(e){!1===i.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function A(e,t){var r=!0;return d(function(){if(null!=i.deprecationHandler&&i.deprecationHandler(null,e),r){for(var n,o=[],a=0;a<arguments.length;a++){if(n="","object"==typeof arguments[a]){for(var s in n+="\n["+a+"] ",arguments[0])n+=s+": "+arguments[0][s]+", ";n=n.slice(0,-2)}else n=arguments[a];o.push(n)}k(e+"\nArguments: "+Array.prototype.slice.call(o).join("")+"\n"+(new Error).stack),r=!1}return t.apply(this,arguments)},t)}var R,x={};function L(e,t){null!=i.deprecationHandler&&i.deprecationHandler(e,t),x[e]||(k(t),x[e]=!0)}function I(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function C(e,t){var r,n=d({},e);for(r in t)f(t,r)&&(a(e[r])&&a(t[r])?(n[r]={},d(n[r],e[r]),d(n[r],t[r])):null!=t[r]?n[r]=t[r]:delete n[r]);for(r in e)f(e,r)&&!f(t,r)&&a(e[r])&&(n[r]=d({},n[r]));return n}function O(e){null!=e&&this.set(e)}i.suppressDeprecationWarnings=!1,i.deprecationHandler=null,R=Object.keys?Object.keys:function(e){var t,r=[];for(t in e)f(e,t)&&r.push(t);return r};var D={};function P(e,t){var r=e.toLowerCase();D[r]=D[r+"s"]=D[t]=e}function M(e){return"string"==typeof e?D[e]||D[e.toLowerCase()]:void 0}function F(e){var t,r,n={};for(r in e)f(e,r)&&(t=M(r))&&(n[t]=e[r]);return n}var N={};function U(e,t){N[e]=t}function B(e,t,r){var n=""+Math.abs(e),i=t-n.length;return(e>=0?r?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+n}var j=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,H=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,G={},z={};function W(e,t,r,n){var i=n;"string"==typeof n&&(i=function(){return this[n]()}),e&&(z[e]=i),t&&(z[t[0]]=function(){return B(i.apply(this,arguments),t[1],t[2])}),r&&(z[r]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function q(e,t){return e.isValid()?(t=Y(t,e.localeData()),G[t]=G[t]||function(e){var t,r,n,i=e.match(j);for(t=0,r=i.length;t<r;t++)z[i[t]]?i[t]=z[i[t]]:i[t]=(n=i[t]).match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"");return function(t){var n,o="";for(n=0;n<r;n++)o+=I(i[n])?i[n].call(t,e):i[n];return o}}(t),G[t](e)):e.localeData().invalidDate()}function Y(e,t){var r=5;function n(e){return t.longDateFormat(e)||e}for(H.lastIndex=0;r>=0&&H.test(e);)e=e.replace(H,n),H.lastIndex=0,r-=1;return e}var K=/\d/,V=/\d\d/,Z=/\d{3}/,X=/\d{4}/,$=/[+-]?\d{6}/,J=/\d\d?/,Q=/\d\d\d\d?/,ee=/\d\d\d\d\d\d?/,te=/\d{1,3}/,re=/\d{1,4}/,ne=/[+-]?\d{1,6}/,ie=/\d+/,oe=/[+-]?\d+/,ae=/Z|[+-]\d\d:?\d\d/gi,se=/Z|[+-]\d\d(?::?\d\d)?/gi,ue=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,ce={};function le(e,t,r){ce[e]=I(t)?t:function(e,n){return e&&r?r:t}}function fe(e,t){return f(ce,e)?ce[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,r,n,i){return t||r||n||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var he={};function pe(e,t){var r,n=t;for("string"==typeof e&&(e=[e]),u(t)&&(n=function(e,r){r[t]=S(e)}),r=0;r<e.length;r++)he[e[r]]=n}function me(e,t){pe(e,function(e,r,n,i){n._w=n._w||{},t(e,n._w,n,i)})}function ge(e,t,r){null!=t&&f(he,e)&&he[e](t,r._a,r,e)}var ye=0,ve=1,_e=2,be=3,we=4,Ee=5,Se=6,Te=7,ke=8;function Ae(e){return Re(e)?366:365}function Re(e){return e%4==0&&e%100!=0||e%400==0}W("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),W(0,["YY",2],0,function(){return this.year()%100}),W(0,["YYYY",4],0,"year"),W(0,["YYYYY",5],0,"year"),W(0,["YYYYYY",6,!0],0,"year"),P("year","y"),U("year",1),le("Y",oe),le("YY",J,V),le("YYYY",re,X),le("YYYYY",ne,$),le("YYYYYY",ne,$),pe(["YYYYY","YYYYYY"],ye),pe("YYYY",function(e,t){t[ye]=2===e.length?i.parseTwoDigitYear(e):S(e)}),pe("YY",function(e,t){t[ye]=i.parseTwoDigitYear(e)}),pe("Y",function(e,t){t[ye]=parseInt(e,10)}),i.parseTwoDigitYear=function(e){return S(e)+(S(e)>68?1900:2e3)};var xe,Le=Ie("FullYear",!0);function Ie(e,t){return function(r){return null!=r?(Oe(this,e,r),i.updateOffset(this,t),this):Ce(this,e)}}function Ce(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function Oe(e,t,r){e.isValid()&&!isNaN(r)&&("FullYear"===t&&Re(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](r,e.month(),De(r,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](r))}function De(e,t){if(isNaN(e)||isNaN(t))return NaN;var r,n=(t%(r=12)+r)%r;return e+=(t-n)/12,1===n?Re(e)?29:28:31-n%7%2}xe=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},W("M",["MM",2],"Mo",function(){return this.month()+1}),W("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),W("MMMM",0,0,function(e){return this.localeData().months(this,e)}),P("month","M"),U("month",8),le("M",J),le("MM",J,V),le("MMM",function(e,t){return t.monthsShortRegex(e)}),le("MMMM",function(e,t){return t.monthsRegex(e)}),pe(["M","MM"],function(e,t){t[ve]=S(e)-1}),pe(["MMM","MMMM"],function(e,t,r,n){var i=r._locale.monthsParse(e,n,r._strict);null!=i?t[ve]=i:p(r).invalidMonth=e});var Pe=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Me="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Fe="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ne(e,t){var r;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=S(t);else if(!u(t=e.localeData().monthsParse(t)))return e;return r=Math.min(e.date(),De(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,r),e}function Ue(e){return null!=e?(Ne(this,e),i.updateOffset(this,!0),this):Ce(this,"Month")}var Be=ue;var je=ue;function He(){function e(e,t){return t.length-e.length}var t,r,n=[],i=[],o=[];for(t=0;t<12;t++)r=h([2e3,t]),n.push(this.monthsShort(r,"")),i.push(this.months(r,"")),o.push(this.months(r,"")),o.push(this.monthsShort(r,""));for(n.sort(e),i.sort(e),o.sort(e),t=0;t<12;t++)n[t]=de(n[t]),i[t]=de(i[t]);for(t=0;t<24;t++)o[t]=de(o[t]);this._monthsRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function ze(e,t,r){var n=7+t-r;return-((7+Ge(e,0,n).getUTCDay()-t)%7)+n-1}function We(e,t,r,n,i){var o,a,s=1+7*(t-1)+(7+r-n)%7+ze(e,n,i);return s<=0?a=Ae(o=e-1)+s:s>Ae(e)?(o=e+1,a=s-Ae(e)):(o=e,a=s),{year:o,dayOfYear:a}}function qe(e,t,r){var n,i,o=ze(e.year(),t,r),a=Math.floor((e.dayOfYear()-o-1)/7)+1;return a<1?n=a+Ye(i=e.year()-1,t,r):a>Ye(e.year(),t,r)?(n=a-Ye(e.year(),t,r),i=e.year()+1):(i=e.year(),n=a),{week:n,year:i}}function Ye(e,t,r){var n=ze(e,t,r),i=ze(e+1,t,r);return(Ae(e)-n+i)/7}W("w",["ww",2],"wo","week"),W("W",["WW",2],"Wo","isoWeek"),P("week","w"),P("isoWeek","W"),U("week",5),U("isoWeek",5),le("w",J),le("ww",J,V),le("W",J),le("WW",J,V),me(["w","ww","W","WW"],function(e,t,r,n){t[n.substr(0,1)]=S(e)});W("d",0,"do","day"),W("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),W("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),W("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),W("e",0,0,"weekday"),W("E",0,0,"isoWeekday"),P("day","d"),P("weekday","e"),P("isoWeekday","E"),U("day",11),U("weekday",11),U("isoWeekday",11),le("d",J),le("e",J),le("E",J),le("dd",function(e,t){return t.weekdaysMinRegex(e)}),le("ddd",function(e,t){return t.weekdaysShortRegex(e)}),le("dddd",function(e,t){return t.weekdaysRegex(e)}),me(["dd","ddd","dddd"],function(e,t,r,n){var i=r._locale.weekdaysParse(e,n,r._strict);null!=i?t.d=i:p(r).invalidWeekday=e}),me(["d","e","E"],function(e,t,r,n){t[n]=S(e)});var Ke="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ve="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var Ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var Xe=ue;var $e=ue;var Je=ue;function Qe(){function e(e,t){return t.length-e.length}var t,r,n,i,o,a=[],s=[],u=[],c=[];for(t=0;t<7;t++)r=h([2e3,1]).day(t),n=this.weekdaysMin(r,""),i=this.weekdaysShort(r,""),o=this.weekdays(r,""),a.push(n),s.push(i),u.push(o),c.push(n),c.push(i),c.push(o);for(a.sort(e),s.sort(e),u.sort(e),c.sort(e),t=0;t<7;t++)s[t]=de(s[t]),u[t]=de(u[t]),c[t]=de(c[t]);this._weekdaysRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function et(){return this.hours()%12||12}function tt(e,t){W(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function rt(e,t){return t._meridiemParse}W("H",["HH",2],0,"hour"),W("h",["hh",2],0,et),W("k",["kk",2],0,function(){return this.hours()||24}),W("hmm",0,0,function(){return""+et.apply(this)+B(this.minutes(),2)}),W("hmmss",0,0,function(){return""+et.apply(this)+B(this.minutes(),2)+B(this.seconds(),2)}),W("Hmm",0,0,function(){return""+this.hours()+B(this.minutes(),2)}),W("Hmmss",0,0,function(){return""+this.hours()+B(this.minutes(),2)+B(this.seconds(),2)}),tt("a",!0),tt("A",!1),P("hour","h"),U("hour",13),le("a",rt),le("A",rt),le("H",J),le("h",J),le("k",J),le("HH",J,V),le("hh",J,V),le("kk",J,V),le("hmm",Q),le("hmmss",ee),le("Hmm",Q),le("Hmmss",ee),pe(["H","HH"],be),pe(["k","kk"],function(e,t,r){var n=S(e);t[be]=24===n?0:n}),pe(["a","A"],function(e,t,r){r._isPm=r._locale.isPM(e),r._meridiem=e}),pe(["h","hh"],function(e,t,r){t[be]=S(e),p(r).bigHour=!0}),pe("hmm",function(e,t,r){var n=e.length-2;t[be]=S(e.substr(0,n)),t[we]=S(e.substr(n)),p(r).bigHour=!0}),pe("hmmss",function(e,t,r){var n=e.length-4,i=e.length-2;t[be]=S(e.substr(0,n)),t[we]=S(e.substr(n,2)),t[Ee]=S(e.substr(i)),p(r).bigHour=!0}),pe("Hmm",function(e,t,r){var n=e.length-2;t[be]=S(e.substr(0,n)),t[we]=S(e.substr(n))}),pe("Hmmss",function(e,t,r){var n=e.length-4,i=e.length-2;t[be]=S(e.substr(0,n)),t[we]=S(e.substr(n,2)),t[Ee]=S(e.substr(i))});var nt,it=Ie("Hours",!0),ot={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Me,monthsShort:Fe,week:{dow:0,doy:6},weekdays:Ke,weekdaysMin:Ze,weekdaysShort:Ve,meridiemParse:/[ap]\.?m?\.?/i},at={},st={};function ut(e){return e?e.toLowerCase().replace("_","-"):e}function ct(r){var n=null;if(!at[r]&&void 0!==t&&t&&t.exports)try{n=nt._abbr,e("./locale/"+r),lt(n)}catch(e){}return at[r]}function lt(e,t){var r;return e&&((r=s(t)?dt(e):ft(e,t))?nt=r:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),nt._abbr}function ft(e,t){if(null!==t){var r,n=ot;if(t.abbr=e,null!=at[e])L("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=at[e]._config;else if(null!=t.parentLocale)if(null!=at[t.parentLocale])n=at[t.parentLocale]._config;else{if(null==(r=ct(t.parentLocale)))return st[t.parentLocale]||(st[t.parentLocale]=[]),st[t.parentLocale].push({name:e,config:t}),null;n=r._config}return at[e]=new O(C(n,t)),st[e]&&st[e].forEach(function(e){ft(e.name,e.config)}),lt(e),at[e]}return delete at[e],null}function dt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return nt;if(!o(e)){if(t=ct(e))return t;e=[e]}return function(e){for(var t,r,n,i,o=0;o<e.length;){for(t=(i=ut(e[o]).split("-")).length,r=(r=ut(e[o+1]))?r.split("-"):null;t>0;){if(n=ct(i.slice(0,t).join("-")))return n;if(r&&r.length>=t&&T(i,r,!0)>=t-1)break;t--}o++}return nt}(e)}function ht(e){var t,r=e._a;return r&&-2===p(e).overflow&&(t=r[ve]<0||r[ve]>11?ve:r[_e]<1||r[_e]>De(r[ye],r[ve])?_e:r[be]<0||r[be]>24||24===r[be]&&(0!==r[we]||0!==r[Ee]||0!==r[Se])?be:r[we]<0||r[we]>59?we:r[Ee]<0||r[Ee]>59?Ee:r[Se]<0||r[Se]>999?Se:-1,p(e)._overflowDayOfYear&&(t<ye||t>_e)&&(t=_e),p(e)._overflowWeeks&&-1===t&&(t=Te),p(e)._overflowWeekday&&-1===t&&(t=ke),p(e).overflow=t),e}function pt(e,t,r){return null!=e?e:null!=t?t:r}function mt(e){var t,r,n,o,a,s=[];if(!e._d){for(n=function(e){var t=new Date(i.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[_e]&&null==e._a[ve]&&function(e){var t,r,n,i,o,a,s,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)o=1,a=4,r=pt(t.GG,e._a[ye],qe(It(),1,4).year),n=pt(t.W,1),((i=pt(t.E,1))<1||i>7)&&(u=!0);else{o=e._locale._week.dow,a=e._locale._week.doy;var c=qe(It(),o,a);r=pt(t.gg,e._a[ye],c.year),n=pt(t.w,c.week),null!=t.d?((i=t.d)<0||i>6)&&(u=!0):null!=t.e?(i=t.e+o,(t.e<0||t.e>6)&&(u=!0)):i=o}n<1||n>Ye(r,o,a)?p(e)._overflowWeeks=!0:null!=u?p(e)._overflowWeekday=!0:(s=We(r,n,i,o,a),e._a[ye]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(a=pt(e._a[ye],n[ye]),(e._dayOfYear>Ae(a)||0===e._dayOfYear)&&(p(e)._overflowDayOfYear=!0),r=Ge(a,0,e._dayOfYear),e._a[ve]=r.getUTCMonth(),e._a[_e]=r.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=s[t]=n[t];for(;t<7;t++)e._a[t]=s[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[be]&&0===e._a[we]&&0===e._a[Ee]&&0===e._a[Se]&&(e._nextDay=!0,e._a[be]=0),e._d=(e._useUTC?Ge:function(e,t,r,n,i,o,a){var s=new Date(e,t,r,n,i,o,a);return e<100&&e>=0&&isFinite(s.getFullYear())&&s.setFullYear(e),s}).apply(null,s),o=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[be]=24),e._w&&void 0!==e._w.d&&e._w.d!==o&&(p(e).weekdayMismatch=!0)}}var gt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,yt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,vt=/Z|[+-]\d\d(?::?\d\d)?/,_t=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],bt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],wt=/^\/?Date\((\-?\d+)/i;function Et(e){var t,r,n,i,o,a,s=e._i,u=gt.exec(s)||yt.exec(s);if(u){for(p(e).iso=!0,t=0,r=_t.length;t<r;t++)if(_t[t][1].exec(u[1])){i=_t[t][0],n=!1!==_t[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,r=bt.length;t<r;t++)if(bt[t][1].exec(u[3])){o=(u[2]||" ")+bt[t][0];break}if(null==o)return void(e._isValid=!1)}if(!n&&null!=o)return void(e._isValid=!1);if(u[4]){if(!vt.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(o||"")+(a||""),Rt(e)}else e._isValid=!1}var St=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Tt(e,t,r,n,i,o){var a=[function(e){var t=parseInt(e,10);if(t<=49)return 2e3+t;if(t<=999)return 1900+t;return t}(e),Fe.indexOf(t),parseInt(r,10),parseInt(n,10),parseInt(i,10)];return o&&a.push(parseInt(o,10)),a}var kt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function At(e){var t=St.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(t){var r=Tt(t[4],t[3],t[2],t[5],t[6],t[7]);if(!function(e,t,r){return!e||Ve.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(p(r).weekdayMismatch=!0,r._isValid=!1,!1)}(t[1],r,e))return;e._a=r,e._tzm=function(e,t,r){if(e)return kt[e];if(t)return 0;var n=parseInt(r,10),i=n%100;return(n-i)/100*60+i}(t[8],t[9],t[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),p(e).rfc2822=!0}else e._isValid=!1}function Rt(e){if(e._f!==i.ISO_8601)if(e._f!==i.RFC_2822){e._a=[],p(e).empty=!0;var t,r,n,o,a,s=""+e._i,u=s.length,c=0;for(n=Y(e._f,e._locale).match(j)||[],t=0;t<n.length;t++)o=n[t],(r=(s.match(fe(o,e))||[])[0])&&((a=s.substr(0,s.indexOf(r))).length>0&&p(e).unusedInput.push(a),s=s.slice(s.indexOf(r)+r.length),c+=r.length),z[o]?(r?p(e).empty=!1:p(e).unusedTokens.push(o),ge(o,r,e)):e._strict&&!r&&p(e).unusedTokens.push(o);p(e).charsLeftOver=u-c,s.length>0&&p(e).unusedInput.push(s),e._a[be]<=12&&!0===p(e).bigHour&&e._a[be]>0&&(p(e).bigHour=void 0),p(e).parsedDateParts=e._a.slice(0),p(e).meridiem=e._meridiem,e._a[be]=function(e,t,r){var n;if(null==r)return t;return null!=e.meridiemHour?e.meridiemHour(t,r):null!=e.isPM?((n=e.isPM(r))&&t<12&&(t+=12),n||12!==t||(t=0),t):t}(e._locale,e._a[be],e._meridiem),mt(e),ht(e)}else At(e);else Et(e)}function xt(e){var t=e._i,r=e._f;return e._locale=e._locale||dt(e._l),null===t||void 0===r&&""===t?g({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),w(t)?new b(ht(t)):(c(t)?e._d=t:o(r)?function(e){var t,r,n,i,o;if(0===e._f.length)return p(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)o=0,t=v({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Rt(t),m(t)&&(o+=p(t).charsLeftOver,o+=10*p(t).unusedTokens.length,p(t).score=o,(null==n||o<n)&&(n=o,r=t));d(e,r||t)}(e):r?Rt(e):function(e){var t=e._i;s(t)?e._d=new Date(i.now()):c(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=wt.exec(e._i);null===t?(Et(e),!1===e._isValid&&(delete e._isValid,At(e),!1===e._isValid&&(delete e._isValid,i.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):o(t)?(e._a=l(t.slice(0),function(e){return parseInt(e,10)}),mt(e)):a(t)?function(e){if(!e._d){var t=F(e._i);e._a=l([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),mt(e)}}(e):u(t)?e._d=new Date(t):i.createFromInputFallback(e)}(e),m(e)||(e._d=null),e))}function Lt(e,t,r,n,i){var s,u={};return!0!==r&&!1!==r||(n=r,r=void 0),(a(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||o(e)&&0===e.length)&&(e=void 0),u._isAMomentObject=!0,u._useUTC=u._isUTC=i,u._l=r,u._i=e,u._f=t,u._strict=n,(s=new b(ht(xt(u))))._nextDay&&(s.add(1,"d"),s._nextDay=void 0),s}function It(e,t,r,n){return Lt(e,t,r,n,!1)}i.createFromInputFallback=A("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),i.ISO_8601=function(){},i.RFC_2822=function(){};var Ct=A("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=It.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:g()}),Ot=A("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=It.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:g()});function Dt(e,t){var r,n;if(1===t.length&&o(t[0])&&(t=t[0]),!t.length)return It();for(r=t[0],n=1;n<t.length;++n)t[n].isValid()&&!t[n][e](r)||(r=t[n]);return r}var Pt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Mt(e){var t=F(e),r=t.year||0,n=t.quarter||0,i=t.month||0,o=t.week||0,a=t.day||0,s=t.hour||0,u=t.minute||0,c=t.second||0,l=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===xe.call(Pt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var r=!1,n=0;n<Pt.length;++n)if(e[Pt[n]]){if(r)return!1;parseFloat(e[Pt[n]])!==S(e[Pt[n]])&&(r=!0)}return!0}(t),this._milliseconds=+l+1e3*c+6e4*u+1e3*s*60*60,this._days=+a+7*o,this._months=+i+3*n+12*r,this._data={},this._locale=dt(),this._bubble()}function Ft(e){return e instanceof Mt}function Nt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ut(e,t){W(e,0,0,function(){var e=this.utcOffset(),r="+";return e<0&&(e=-e,r="-"),r+B(~~(e/60),2)+t+B(~~e%60,2)})}Ut("Z",":"),Ut("ZZ",""),le("Z",se),le("ZZ",se),pe(["Z","ZZ"],function(e,t,r){r._useUTC=!0,r._tzm=jt(se,e)});var Bt=/([\+\-]|\d\d)/gi;function jt(e,t){var r=(t||"").match(e);if(null===r)return null;var n=((r[r.length-1]||[])+"").match(Bt)||["-",0,0],i=60*n[1]+S(n[2]);return 0===i?0:"+"===n[0]?i:-i}function Ht(e,t){var r,n;return t._isUTC?(r=t.clone(),n=(w(e)||c(e)?e.valueOf():It(e).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+n),i.updateOffset(r,!1),r):It(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function zt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}i.updateOffset=function(){};var Wt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,qt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Yt(e,t){var r,n,i,o=e,a=null;return Ft(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:u(e)?(o={},t?o[t]=e:o.milliseconds=e):(a=Wt.exec(e))?(r="-"===a[1]?-1:1,o={y:0,d:S(a[_e])*r,h:S(a[be])*r,m:S(a[we])*r,s:S(a[Ee])*r,ms:S(Nt(1e3*a[Se]))*r}):(a=qt.exec(e))?(r="-"===a[1]?-1:(a[1],1),o={y:Kt(a[2],r),M:Kt(a[3],r),w:Kt(a[4],r),d:Kt(a[5],r),h:Kt(a[6],r),m:Kt(a[7],r),s:Kt(a[8],r)}):null==o?o={}:"object"==typeof o&&("from"in o||"to"in o)&&(i=function(e,t){var r;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Ht(t,e),e.isBefore(t)?r=Vt(e,t):((r=Vt(t,e)).milliseconds=-r.milliseconds,r.months=-r.months);return r}(It(o.from),It(o.to)),(o={}).ms=i.milliseconds,o.M=i.months),n=new Mt(o),Ft(e)&&f(e,"_locale")&&(n._locale=e._locale),n}function Kt(e,t){var r=e&&parseFloat(e.replace(",","."));return(isNaN(r)?0:r)*t}function Vt(e,t){var r={milliseconds:0,months:0};return r.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(r.months,"M").isAfter(t)&&--r.months,r.milliseconds=+t-+e.clone().add(r.months,"M"),r}function Zt(e,t){return function(r,n){var i;return null===n||isNaN(+n)||(L(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=r,r=n,n=i),Xt(this,Yt(r="string"==typeof r?+r:r,n),e),this}}function Xt(e,t,r,n){var o=t._milliseconds,a=Nt(t._days),s=Nt(t._months);e.isValid()&&(n=null==n||n,s&&Ne(e,Ce(e,"Month")+s*r),a&&Oe(e,"Date",Ce(e,"Date")+a*r),o&&e._d.setTime(e._d.valueOf()+o*r),n&&i.updateOffset(e,a||s))}Yt.fn=Mt.prototype,Yt.invalid=function(){return Yt(NaN)};var $t=Zt(1,"add"),Jt=Zt(-1,"subtract");function Qt(e,t){var r=12*(t.year()-e.year())+(t.month()-e.month()),n=e.clone().add(r,"months");return-(r+(t-n<0?(t-n)/(n-e.clone().add(r-1,"months")):(t-n)/(e.clone().add(r+1,"months")-n)))||0}function er(e){var t;return void 0===e?this._locale._abbr:(null!=(t=dt(e))&&(this._locale=t),this)}i.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",i.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var tr=A("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function rr(){return this._locale}function nr(e,t){W(0,[e,e.length],0,t)}function ir(e,t,r,n,i){var o;return null==e?qe(this,n,i).year:(t>(o=Ye(e,n,i))&&(t=o),function(e,t,r,n,i){var o=We(e,t,r,n,i),a=Ge(o.year,0,o.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,r,n,i))}W(0,["gg",2],0,function(){return this.weekYear()%100}),W(0,["GG",2],0,function(){return this.isoWeekYear()%100}),nr("gggg","weekYear"),nr("ggggg","weekYear"),nr("GGGG","isoWeekYear"),nr("GGGGG","isoWeekYear"),P("weekYear","gg"),P("isoWeekYear","GG"),U("weekYear",1),U("isoWeekYear",1),le("G",oe),le("g",oe),le("GG",J,V),le("gg",J,V),le("GGGG",re,X),le("gggg",re,X),le("GGGGG",ne,$),le("ggggg",ne,$),me(["gggg","ggggg","GGGG","GGGGG"],function(e,t,r,n){t[n.substr(0,2)]=S(e)}),me(["gg","GG"],function(e,t,r,n){t[n]=i.parseTwoDigitYear(e)}),W("Q",0,"Qo","quarter"),P("quarter","Q"),U("quarter",7),le("Q",K),pe("Q",function(e,t){t[ve]=3*(S(e)-1)}),W("D",["DD",2],"Do","date"),P("date","D"),U("date",9),le("D",J),le("DD",J,V),le("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),pe(["D","DD"],_e),pe("Do",function(e,t){t[_e]=S(e.match(J)[0])});var or=Ie("Date",!0);W("DDD",["DDDD",3],"DDDo","dayOfYear"),P("dayOfYear","DDD"),U("dayOfYear",4),le("DDD",te),le("DDDD",Z),pe(["DDD","DDDD"],function(e,t,r){r._dayOfYear=S(e)}),W("m",["mm",2],0,"minute"),P("minute","m"),U("minute",14),le("m",J),le("mm",J,V),pe(["m","mm"],we);var ar=Ie("Minutes",!1);W("s",["ss",2],0,"second"),P("second","s"),U("second",15),le("s",J),le("ss",J,V),pe(["s","ss"],Ee);var sr,ur=Ie("Seconds",!1);for(W("S",0,0,function(){return~~(this.millisecond()/100)}),W(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),W(0,["SSS",3],0,"millisecond"),W(0,["SSSS",4],0,function(){return 10*this.millisecond()}),W(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),W(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),W(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),W(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),W(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),P("millisecond","ms"),U("millisecond",16),le("S",te,K),le("SS",te,V),le("SSS",te,Z),sr="SSSS";sr.length<=9;sr+="S")le(sr,ie);function cr(e,t){t[Se]=S(1e3*("0."+e))}for(sr="S";sr.length<=9;sr+="S")pe(sr,cr);var lr=Ie("Milliseconds",!1);W("z",0,0,"zoneAbbr"),W("zz",0,0,"zoneName");var fr=b.prototype;function dr(e){return e}fr.add=$t,fr.calendar=function(e,t){var r=e||It(),n=Ht(r,this).startOf("day"),o=i.calendarFormat(this,n)||"sameElse",a=t&&(I(t[o])?t[o].call(this,r):t[o]);return this.format(a||this.localeData().calendar(o,this,It(r)))},fr.clone=function(){return new b(this)},fr.diff=function(e,t,r){var n,i,o;if(!this.isValid())return NaN;if(!(n=Ht(e,this)).isValid())return NaN;switch(i=6e4*(n.utcOffset()-this.utcOffset()),t=M(t)){case"year":o=Qt(this,n)/12;break;case"month":o=Qt(this,n);break;case"quarter":o=Qt(this,n)/3;break;case"second":o=(this-n)/1e3;break;case"minute":o=(this-n)/6e4;break;case"hour":o=(this-n)/36e5;break;case"day":o=(this-n-i)/864e5;break;case"week":o=(this-n-i)/6048e5;break;default:o=this-n}return r?o:E(o)},fr.endOf=function(e){return void 0===(e=M(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},fr.format=function(e){e||(e=this.isUtc()?i.defaultFormatUtc:i.defaultFormat);var t=q(this,e);return this.localeData().postformat(t)},fr.from=function(e,t){return this.isValid()&&(w(e)&&e.isValid()||It(e).isValid())?Yt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},fr.fromNow=function(e){return this.from(It(),e)},fr.to=function(e,t){return this.isValid()&&(w(e)&&e.isValid()||It(e).isValid())?Yt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},fr.toNow=function(e){return this.to(It(),e)},fr.get=function(e){return I(this[e=M(e)])?this[e]():this},fr.invalidAt=function(){return p(this).overflow},fr.isAfter=function(e,t){var r=w(e)?e:It(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=M(s(t)?"millisecond":t))?this.valueOf()>r.valueOf():r.valueOf()<this.clone().startOf(t).valueOf())},fr.isBefore=function(e,t){var r=w(e)?e:It(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=M(s(t)?"millisecond":t))?this.valueOf()<r.valueOf():this.clone().endOf(t).valueOf()<r.valueOf())},fr.isBetween=function(e,t,r,n){return("("===(n=n||"()")[0]?this.isAfter(e,r):!this.isBefore(e,r))&&(")"===n[1]?this.isBefore(t,r):!this.isAfter(t,r))},fr.isSame=function(e,t){var r,n=w(e)?e:It(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=M(t||"millisecond"))?this.valueOf()===n.valueOf():(r=n.valueOf(),this.clone().startOf(t).valueOf()<=r&&r<=this.clone().endOf(t).valueOf()))},fr.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},fr.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},fr.isValid=function(){return m(this)},fr.lang=tr,fr.locale=er,fr.localeData=rr,fr.max=Ot,fr.min=Ct,fr.parsingFlags=function(){return d({},p(this))},fr.set=function(e,t){if("object"==typeof e)for(var r=function(e){var t=[];for(var r in e)t.push({unit:r,priority:N[r]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=F(e)),n=0;n<r.length;n++)this[r[n].unit](e[r[n].unit]);else if(I(this[e=M(e)]))return this[e](t);return this},fr.startOf=function(e){switch(e=M(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},fr.subtract=Jt,fr.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},fr.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},fr.toDate=function(){return new Date(this.valueOf())},fr.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,r=t?this.clone().utc():this;return r.year()<0||r.year()>9999?q(r,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):I(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",q(r,"Z")):q(r,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},fr.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var r="["+e+'("]',n=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(r+n+"-MM-DD[T]HH:mm:ss.SSS"+i)},fr.toJSON=function(){return this.isValid()?this.toISOString():null},fr.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},fr.unix=function(){return Math.floor(this.valueOf()/1e3)},fr.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},fr.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},fr.year=Le,fr.isLeapYear=function(){return Re(this.year())},fr.weekYear=function(e){return ir.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},fr.isoWeekYear=function(e){return ir.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},fr.quarter=fr.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},fr.month=Ue,fr.daysInMonth=function(){return De(this.year(),this.month())},fr.week=fr.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},fr.isoWeek=fr.isoWeeks=function(e){var t=qe(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},fr.weeksInYear=function(){var e=this.localeData()._week;return Ye(this.year(),e.dow,e.doy)},fr.isoWeeksInYear=function(){return Ye(this.year(),1,4)},fr.date=or,fr.day=fr.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},fr.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},fr.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},fr.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},fr.hour=fr.hours=it,fr.minute=fr.minutes=ar,fr.second=fr.seconds=ur,fr.millisecond=fr.milliseconds=lr,fr.utcOffset=function(e,t,r){var n,o=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=jt(se,e)))return this}else Math.abs(e)<16&&!r&&(e*=60);return!this._isUTC&&t&&(n=Gt(this)),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),o!==e&&(!t||this._changeInProgress?Xt(this,Yt(e-o,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,i.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?o:Gt(this)},fr.utc=function(e){return this.utcOffset(0,e)},fr.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},fr.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=jt(ae,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},fr.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?It(e).utcOffset():0,(this.utcOffset()-e)%60==0)},fr.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},fr.isLocal=function(){return!!this.isValid()&&!this._isUTC},fr.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},fr.isUtc=zt,fr.isUTC=zt,fr.zoneAbbr=function(){return this._isUTC?"UTC":""},fr.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},fr.dates=A("dates accessor is deprecated. Use date instead.",or),fr.months=A("months accessor is deprecated. Use month instead",Ue),fr.years=A("years accessor is deprecated. Use year instead",Le),fr.zone=A("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),fr.isDSTShifted=A("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!s(this._isDSTShifted))return this._isDSTShifted;var e={};if(v(e,this),(e=xt(e))._a){var t=e._isUTC?h(e._a):It(e._a);this._isDSTShifted=this.isValid()&&T(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted});var hr=O.prototype;function pr(e,t,r,n){var i=dt(),o=h().set(n,t);return i[r](o,e)}function mr(e,t,r){if(u(e)&&(t=e,e=void 0),e=e||"",null!=t)return pr(e,t,r,"month");var n,i=[];for(n=0;n<12;n++)i[n]=pr(e,n,r,"month");return i}function gr(e,t,r,n){"boolean"==typeof e?(u(t)&&(r=t,t=void 0),t=t||""):(r=t=e,e=!1,u(t)&&(r=t,t=void 0),t=t||"");var i,o=dt(),a=e?o._week.dow:0;if(null!=r)return pr(t,(r+a)%7,n,"day");var s=[];for(i=0;i<7;i++)s[i]=pr(t,(i+a)%7,n,"day");return s}hr.calendar=function(e,t,r){var n=this._calendar[e]||this._calendar.sameElse;return I(n)?n.call(t,r):n},hr.longDateFormat=function(e){var t=this._longDateFormat[e],r=this._longDateFormat[e.toUpperCase()];return t||!r?t:(this._longDateFormat[e]=r.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hr.invalidDate=function(){return this._invalidDate},hr.ordinal=function(e){return this._ordinal.replace("%d",e)},hr.preparse=dr,hr.postformat=dr,hr.relativeTime=function(e,t,r,n){var i=this._relativeTime[r];return I(i)?i(e,t,r,n):i.replace(/%d/i,e)},hr.pastFuture=function(e,t){var r=this._relativeTime[e>0?"future":"past"];return I(r)?r(t):r.replace(/%s/i,t)},hr.set=function(e){var t,r;for(r in e)I(t=e[r])?this[r]=t:this["_"+r]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hr.months=function(e,t){return e?o(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Pe).test(t)?"format":"standalone"][e.month()]:o(this._months)?this._months:this._months.standalone},hr.monthsShort=function(e,t){return e?o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Pe.test(t)?"format":"standalone"][e.month()]:o(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hr.monthsParse=function(e,t,r){var n,i,o;if(this._monthsParseExact)return function(e,t,r){var n,i,o,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],n=0;n<12;++n)o=h([2e3,n]),this._shortMonthsParse[n]=this.monthsShort(o,"").toLocaleLowerCase(),this._longMonthsParse[n]=this.months(o,"").toLocaleLowerCase();return r?"MMM"===t?-1!==(i=xe.call(this._shortMonthsParse,a))?i:null:-1!==(i=xe.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=xe.call(this._shortMonthsParse,a))?i:-1!==(i=xe.call(this._longMonthsParse,a))?i:null:-1!==(i=xe.call(this._longMonthsParse,a))?i:-1!==(i=xe.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,r);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;n<12;n++){if(i=h([2e3,n]),r&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),r||this._monthsParse[n]||(o="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[n]=new RegExp(o.replace(".",""),"i")),r&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(r&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!r&&this._monthsParse[n].test(e))return n}},hr.monthsRegex=function(e){return this._monthsParseExact?(f(this,"_monthsRegex")||He.call(this),e?this._monthsStrictRegex:this._monthsRegex):(f(this,"_monthsRegex")||(this._monthsRegex=je),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hr.monthsShortRegex=function(e){return this._monthsParseExact?(f(this,"_monthsRegex")||He.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(f(this,"_monthsShortRegex")||(this._monthsShortRegex=Be),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hr.week=function(e){return qe(e,this._week.dow,this._week.doy).week},hr.firstDayOfYear=function(){return this._week.doy},hr.firstDayOfWeek=function(){return this._week.dow},hr.weekdays=function(e,t){return e?o(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:o(this._weekdays)?this._weekdays:this._weekdays.standalone},hr.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hr.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hr.weekdaysParse=function(e,t,r){var n,i,o;if(this._weekdaysParseExact)return function(e,t,r){var n,i,o,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],n=0;n<7;++n)o=h([2e3,1]).day(n),this._minWeekdaysParse[n]=this.weekdaysMin(o,"").toLocaleLowerCase(),this._shortWeekdaysParse[n]=this.weekdaysShort(o,"").toLocaleLowerCase(),this._weekdaysParse[n]=this.weekdays(o,"").toLocaleLowerCase();return r?"dddd"===t?-1!==(i=xe.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=xe.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=xe.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=xe.call(this._weekdaysParse,a))?i:-1!==(i=xe.call(this._shortWeekdaysParse,a))?i:-1!==(i=xe.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=xe.call(this._shortWeekdaysParse,a))?i:-1!==(i=xe.call(this._weekdaysParse,a))?i:-1!==(i=xe.call(this._minWeekdaysParse,a))?i:null:-1!==(i=xe.call(this._minWeekdaysParse,a))?i:-1!==(i=xe.call(this._weekdaysParse,a))?i:-1!==(i=xe.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,r);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;n<7;n++){if(i=h([2e3,1]).day(n),r&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(i,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(i,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(i,"").replace(".",".?")+"$","i")),this._weekdaysParse[n]||(o="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[n]=new RegExp(o.replace(".",""),"i")),r&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(r&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(r&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!r&&this._weekdaysParse[n].test(e))return n}},hr.weekdaysRegex=function(e){return this._weekdaysParseExact?(f(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(f(this,"_weekdaysRegex")||(this._weekdaysRegex=Xe),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hr.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(f(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(f(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=$e),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hr.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(f(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(f(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hr.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hr.meridiem=function(e,t,r){return e>11?r?"pm":"PM":r?"am":"AM"},lt("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===S(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),i.lang=A("moment.lang is deprecated. Use moment.locale instead.",lt),i.langData=A("moment.langData is deprecated. Use moment.localeData instead.",dt);var yr=Math.abs;function vr(e,t,r,n){var i=Yt(t,r);return e._milliseconds+=n*i._milliseconds,e._days+=n*i._days,e._months+=n*i._months,e._bubble()}function _r(e){return e<0?Math.floor(e):Math.ceil(e)}function br(e){return 4800*e/146097}function wr(e){return 146097*e/4800}function Er(e){return function(){return this.as(e)}}var Sr=Er("ms"),Tr=Er("s"),kr=Er("m"),Ar=Er("h"),Rr=Er("d"),xr=Er("w"),Lr=Er("M"),Ir=Er("y");function Cr(e){return function(){return this.isValid()?this._data[e]:NaN}}var Or=Cr("milliseconds"),Dr=Cr("seconds"),Pr=Cr("minutes"),Mr=Cr("hours"),Fr=Cr("days"),Nr=Cr("months"),Ur=Cr("years");var Br=Math.round,jr={ss:44,s:45,m:45,h:22,d:26,M:11};var Hr=Math.abs;function Gr(e){return(e>0)-(e<0)||+e}function zr(){if(!this.isValid())return this.localeData().invalidDate();var e,t,r=Hr(this._milliseconds)/1e3,n=Hr(this._days),i=Hr(this._months);e=E(r/60),t=E(e/60),r%=60,e%=60;var o=E(i/12),a=i%=12,s=n,u=t,c=e,l=r?r.toFixed(3).replace(/\.?0+$/,""):"",f=this.asSeconds();if(!f)return"P0D";var d=f<0?"-":"",h=Gr(this._months)!==Gr(f)?"-":"",p=Gr(this._days)!==Gr(f)?"-":"",m=Gr(this._milliseconds)!==Gr(f)?"-":"";return d+"P"+(o?h+o+"Y":"")+(a?h+a+"M":"")+(s?p+s+"D":"")+(u||c||l?"T":"")+(u?m+u+"H":"")+(c?m+c+"M":"")+(l?m+l+"S":"")}var Wr=Mt.prototype;return Wr.isValid=function(){return this._isValid},Wr.abs=function(){var e=this._data;return this._milliseconds=yr(this._milliseconds),this._days=yr(this._days),this._months=yr(this._months),e.milliseconds=yr(e.milliseconds),e.seconds=yr(e.seconds),e.minutes=yr(e.minutes),e.hours=yr(e.hours),e.months=yr(e.months),e.years=yr(e.years),this},Wr.add=function(e,t){return vr(this,e,t,1)},Wr.subtract=function(e,t){return vr(this,e,t,-1)},Wr.as=function(e){if(!this.isValid())return NaN;var t,r,n=this._milliseconds;if("month"===(e=M(e))||"year"===e)return t=this._days+n/864e5,r=this._months+br(t),"month"===e?r:r/12;switch(t=this._days+Math.round(wr(this._months)),e){case"week":return t/7+n/6048e5;case"day":return t+n/864e5;case"hour":return 24*t+n/36e5;case"minute":return 1440*t+n/6e4;case"second":return 86400*t+n/1e3;case"millisecond":return Math.floor(864e5*t)+n;default:throw new Error("Unknown unit "+e)}},Wr.asMilliseconds=Sr,Wr.asSeconds=Tr,Wr.asMinutes=kr,Wr.asHours=Ar,Wr.asDays=Rr,Wr.asWeeks=xr,Wr.asMonths=Lr,Wr.asYears=Ir,Wr.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*S(this._months/12):NaN},Wr._bubble=function(){var e,t,r,n,i,o=this._milliseconds,a=this._days,s=this._months,u=this._data;return o>=0&&a>=0&&s>=0||o<=0&&a<=0&&s<=0||(o+=864e5*_r(wr(s)+a),a=0,s=0),u.milliseconds=o%1e3,e=E(o/1e3),u.seconds=e%60,t=E(e/60),u.minutes=t%60,r=E(t/60),u.hours=r%24,a+=E(r/24),s+=i=E(br(a)),a-=_r(wr(i)),n=E(s/12),s%=12,u.days=a,u.months=s,u.years=n,this},Wr.clone=function(){return Yt(this)},Wr.get=function(e){return e=M(e),this.isValid()?this[e+"s"]():NaN},Wr.milliseconds=Or,Wr.seconds=Dr,Wr.minutes=Pr,Wr.hours=Mr,Wr.days=Fr,Wr.weeks=function(){return E(this.days()/7)},Wr.months=Nr,Wr.years=Ur,Wr.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t=this.localeData(),r=function(e,t,r){var n=Yt(e).abs(),i=Br(n.as("s")),o=Br(n.as("m")),a=Br(n.as("h")),s=Br(n.as("d")),u=Br(n.as("M")),c=Br(n.as("y")),l=i<=jr.ss&&["s",i]||i<jr.s&&["ss",i]||o<=1&&["m"]||o<jr.m&&["mm",o]||a<=1&&["h"]||a<jr.h&&["hh",a]||s<=1&&["d"]||s<jr.d&&["dd",s]||u<=1&&["M"]||u<jr.M&&["MM",u]||c<=1&&["y"]||["yy",c];return l[2]=t,l[3]=+e>0,l[4]=r,function(e,t,r,n,i){return i.relativeTime(t||1,!!r,e,n)}.apply(null,l)}(this,!e,t);return e&&(r=t.pastFuture(+this,r)),t.postformat(r)},Wr.toISOString=zr,Wr.toString=zr,Wr.toJSON=zr,Wr.locale=er,Wr.localeData=rr,Wr.toIsoString=A("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",zr),Wr.lang=tr,W("X",0,0,"unix"),W("x",0,0,"valueOf"),le("x",oe),le("X",/[+-]?\d+(\.\d{1,3})?/),pe("X",function(e,t,r){r._d=new Date(1e3*parseFloat(e,10))}),pe("x",function(e,t,r){r._d=new Date(S(e))}),i.version="2.22.1",r=It,i.fn=fr,i.min=function(){return Dt("isBefore",[].slice.call(arguments,0))},i.max=function(){return Dt("isAfter",[].slice.call(arguments,0))},i.now=function(){return Date.now?Date.now():+new Date},i.utc=h,i.unix=function(e){return It(1e3*e)},i.months=function(e,t){return mr(e,t,"months")},i.isDate=c,i.locale=lt,i.invalid=g,i.duration=Yt,i.isMoment=w,i.weekdays=function(e,t,r){return gr(e,t,r,"weekdays")},i.parseZone=function(){return It.apply(null,arguments).parseZone()},i.localeData=dt,i.isDuration=Ft,i.monthsShort=function(e,t){return mr(e,t,"monthsShort")},i.weekdaysMin=function(e,t,r){return gr(e,t,r,"weekdaysMin")},i.defineLocale=ft,i.updateLocale=function(e,t){if(null!=t){var r,n,i=ot;null!=(n=ct(e))&&(i=n._config),(r=new O(t=C(i,t))).parentLocale=at[e],at[e]=r,lt(e)}else null!=at[e]&&(null!=at[e].parentLocale?at[e]=at[e].parentLocale:null!=at[e]&&delete at[e]);return at[e]},i.locales=function(){return R(at)},i.weekdaysShort=function(e,t,r){return gr(e,t,r,"weekdaysShort")},i.normalizeUnits=M,i.relativeTimeRounding=function(e){return void 0===e?Br:"function"==typeof e&&(Br=e,!0)},i.relativeTimeThreshold=function(e,t){return void 0!==jr[e]&&(void 0===t?jr[e]:(jr[e]=t,"s"===e&&(jr.ss=t-1),!0))},i.calendarFormat=function(e,t){var r=e.diff(t,"days",!0);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"},i.prototype=fr,i.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},i},"object"==typeof r&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):n.moment=i()},{}],72:[function(e,t,r){var n=e("./index"),i=e("./descriptor"),o=e("buffer-alloc"),a=e("buffer-from"),s=20828448e5;r.fullBoxes={};function u(e,t,r){for(var n=t;n<r;n++)e[n]=0}function c(e,t,r){t.writeUInt32BE(Math.floor((e.getTime()+s)/1e3),r)}function l(e,t,r){t.writeUInt16BE(Math.floor(e)%65536,r),t.writeUInt16BE(Math.floor(256*e*256)%65536,r+2)}function f(e,t,r){e||(e=[0,0,0,0,0,0,0,0,0]);for(var n=0;n<e.length;n++)l(e[n],t,r+4*n)}function d(e){for(var t=new Array(e.length/4),r=0;r<t.length;r++)t[r]=p(e,4*r);return t}function h(e,t){return new Date(1e3*e.readUInt32BE(t)-s)}function p(e,t){return e.readUInt16BE(t)+e.readUInt16BE(t+2)/65536}["mvhd","tkhd","mdhd","vmhd","smhd","stsd","esds","stsz","stco","stss","stts","ctts","stsc","dref","elst","hdlr","mehd","trex","mfhd","tfhd","tfdt","trun"].forEach(function(e){r.fullBoxes[e]=!0}),r.ftyp={},r.ftyp.encode=function(e,t,n){t=t?t.slice(n):o(r.ftyp.encodingLength(e));var i=e.compatibleBrands||[];t.write(e.brand,0,4,"ascii"),t.writeUInt32BE(e.brandVersion,4);for(var a=0;a<i.length;a++)t.write(i[a],8+4*a,4,"ascii");return r.ftyp.encode.bytes=8+4*i.length,t},r.ftyp.decode=function(e,t){for(var r=(e=e.slice(t)).toString("ascii",0,4),n=e.readUInt32BE(4),i=[],o=8;o<e.length;o+=4)i.push(e.toString("ascii",o,o+4));return{brand:r,brandVersion:n,compatibleBrands:i}},r.ftyp.encodingLength=function(e){return 8+4*(e.compatibleBrands||[]).length},r.mvhd={},r.mvhd.encode=function(e,t,n){return t=t?t.slice(n):o(96),c(e.ctime||new Date,t,0),c(e.mtime||new Date,t,4),t.writeUInt32BE(e.timeScale||0,8),t.writeUInt32BE(e.duration||0,12),l(e.preferredRate||0,t,16),function(e,t,r){t[r]=Math.floor(e)%256,t[r+1]=Math.floor(256*e)%256}(e.preferredVolume||0,t,20),u(t,22,32),f(e.matrix,t,32),t.writeUInt32BE(e.previewTime||0,68),t.writeUInt32BE(e.previewDuration||0,72),t.writeUInt32BE(e.posterTime||0,76),t.writeUInt32BE(e.selectionTime||0,80),t.writeUInt32BE(e.selectionDuration||0,84),t.writeUInt32BE(e.currentTime||0,88),t.writeUInt32BE(e.nextTrackId||0,92),r.mvhd.encode.bytes=96,t},r.mvhd.decode=function(e,t){return{ctime:h(e=e.slice(t),0),mtime:h(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),preferredRate:p(e,16),preferredVolume:function(e,t){return e[t]+e[t+1]/256}(e,20),matrix:d(e.slice(32,68)),previewTime:e.readUInt32BE(68),previewDuration:e.readUInt32BE(72),posterTime:e.readUInt32BE(76),selectionTime:e.readUInt32BE(80),selectionDuration:e.readUInt32BE(84),currentTime:e.readUInt32BE(88),nextTrackId:e.readUInt32BE(92)}},r.mvhd.encodingLength=function(e){return 96},r.tkhd={},r.tkhd.encode=function(e,t,n){return t=t?t.slice(n):o(80),c(e.ctime||new Date,t,0),c(e.mtime||new Date,t,4),t.writeUInt32BE(e.trackId||0,8),u(t,12,16),t.writeUInt32BE(e.duration||0,16),u(t,20,28),t.writeUInt16BE(e.layer||0,28),t.writeUInt16BE(e.alternateGroup||0,30),t.writeUInt16BE(e.volume||0,32),f(e.matrix,t,36),t.writeUInt32BE(e.trackWidth||0,72),t.writeUInt32BE(e.trackHeight||0,76),r.tkhd.encode.bytes=80,t},r.tkhd.decode=function(e,t){return{ctime:h(e=e.slice(t),0),mtime:h(e,4),trackId:e.readUInt32BE(8),duration:e.readUInt32BE(16),layer:e.readUInt16BE(28),alternateGroup:e.readUInt16BE(30),volume:e.readUInt16BE(32),matrix:d(e.slice(36,72)),trackWidth:e.readUInt32BE(72),trackHeight:e.readUInt32BE(76)}},r.tkhd.encodingLength=function(e){return 80},r.mdhd={},r.mdhd.encode=function(e,t,n){return t=t?t.slice(n):o(20),c(e.ctime||new Date,t,0),c(e.mtime||new Date,t,4),t.writeUInt32BE(e.timeScale||0,8),t.writeUInt32BE(e.duration||0,12),t.writeUInt16BE(e.language||0,16),t.writeUInt16BE(e.quality||0,18),r.mdhd.encode.bytes=20,t},r.mdhd.decode=function(e,t){return{ctime:h(e=e.slice(t),0),mtime:h(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),language:e.readUInt16BE(16),quality:e.readUInt16BE(18)}},r.mdhd.encodingLength=function(e){return 20},r.vmhd={},r.vmhd.encode=function(e,t,n){(t=t?t.slice(n):o(8)).writeUInt16BE(e.graphicsMode||0,0);var i=e.opcolor||[0,0,0];return t.writeUInt16BE(i[0],2),t.writeUInt16BE(i[1],4),t.writeUInt16BE(i[2],6),r.vmhd.encode.bytes=8,t},r.vmhd.decode=function(e,t){return{graphicsMode:(e=e.slice(t)).readUInt16BE(0),opcolor:[e.readUInt16BE(2),e.readUInt16BE(4),e.readUInt16BE(6)]}},r.vmhd.encodingLength=function(e){return 8},r.smhd={},r.smhd.encode=function(e,t,n){return(t=t?t.slice(n):o(4)).writeUInt16BE(e.balance||0,0),u(t,2,4),r.smhd.encode.bytes=4,t},r.smhd.decode=function(e,t){return{balance:(e=e.slice(t)).readUInt16BE(0)}},r.smhd.encodingLength=function(e){return 4},r.stsd={},r.stsd.encode=function(e,t,i){t=t?t.slice(i):o(r.stsd.encodingLength(e));var a=e.entries||[];t.writeUInt32BE(a.length,0);for(var s=4,u=0;u<a.length;u++){var c=a[u];n.encode(c,t,s),s+=n.encode.bytes}return r.stsd.encode.bytes=s,t},r.stsd.decode=function(e,t,r){for(var i=(e=e.slice(t)).readUInt32BE(0),o=new Array(i),a=4,s=0;s<i;s++){var u=n.decode(e,a,r);o[s]=u,a+=u.length}return{entries:o}},r.stsd.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var r=0;r<e.entries.length;r++)t+=n.encodingLength(e.entries[r]);return t},r.avc1=r.VisualSampleEntry={},r.VisualSampleEntry.encode=function(e,t,i){u(t=t?t.slice(i):o(r.VisualSampleEntry.encodingLength(e)),0,6),t.writeUInt16BE(e.dataReferenceIndex||0,6),u(t,8,24),t.writeUInt16BE(e.width||0,24),t.writeUInt16BE(e.height||0,26),t.writeUInt32BE(e.hResolution||4718592,28),t.writeUInt32BE(e.vResolution||4718592,32),u(t,36,40),t.writeUInt16BE(e.frameCount||1,40);var a=e.compressorName||"",s=Math.min(a.length,31);t.writeUInt8(s,42),t.write(a,43,s,"utf8"),t.writeUInt16BE(e.depth||24,74),t.writeInt16BE(-1,76);var c=78;(e.children||[]).forEach(function(e){n.encode(e,t,c),c+=n.encode.bytes}),r.VisualSampleEntry.encode.bytes=c},r.VisualSampleEntry.decode=function(e,t,r){e=e.slice(t);for(var i=r-t,o=Math.min(e.readUInt8(42),31),a={dataReferenceIndex:e.readUInt16BE(6),width:e.readUInt16BE(24),height:e.readUInt16BE(26),hResolution:e.readUInt32BE(28),vResolution:e.readUInt32BE(32),frameCount:e.readUInt16BE(40),compressorName:e.toString("utf8",43,43+o),depth:e.readUInt16BE(74),children:[]},s=78;i-s>=8;){var u=n.decode(e,s,i);a.children.push(u),a[u.type]=u,s+=u.length}return a},r.VisualSampleEntry.encodingLength=function(e){var t=78;return(e.children||[]).forEach(function(e){t+=n.encodingLength(e)}),t},r.avcC={},r.avcC.encode=function(e,t,n){t=t?t.slice(n):o(e.buffer.length),e.buffer.copy(t),r.avcC.encode.bytes=e.buffer.length},r.avcC.decode=function(e,t,r){return{mimeCodec:(e=e.slice(t,r)).toString("hex",1,4),buffer:a(e)}},r.avcC.encodingLength=function(e){return e.buffer.length},r.mp4a=r.AudioSampleEntry={},r.AudioSampleEntry.encode=function(e,t,i){u(t=t?t.slice(i):o(r.AudioSampleEntry.encodingLength(e)),0,6),t.writeUInt16BE(e.dataReferenceIndex||0,6),u(t,8,16),t.writeUInt16BE(e.channelCount||2,16),t.writeUInt16BE(e.sampleSize||16,18),u(t,20,24),t.writeUInt32BE(e.sampleRate||0,24);var a=28;(e.children||[]).forEach(function(e){n.encode(e,t,a),a+=n.encode.bytes}),r.AudioSampleEntry.encode.bytes=a},r.AudioSampleEntry.decode=function(e,t,r){for(var i=r-t,o={dataReferenceIndex:(e=e.slice(t,r)).readUInt16BE(6),channelCount:e.readUInt16BE(16),sampleSize:e.readUInt16BE(18),sampleRate:e.readUInt32BE(24),children:[]},a=28;i-a>=8;){var s=n.decode(e,a,i);o.children.push(s),o[s.type]=s,a+=s.length}return o},r.AudioSampleEntry.encodingLength=function(e){var t=28;return(e.children||[]).forEach(function(e){t+=n.encodingLength(e)}),t},r.esds={},r.esds.encode=function(e,t,n){t=t?t.slice(n):o(e.buffer.length),e.buffer.copy(t,0),r.esds.encode.bytes=e.buffer.length},r.esds.decode=function(e,t,r){e=e.slice(t,r);var n=i.Descriptor.decode(e,0,e.length),o=("ESDescriptor"===n.tagName?n:{}).DecoderConfigDescriptor||{},s=o.oti||0,u=o.DecoderSpecificInfo,c=u?(248&u.buffer.readUInt8(0))>>3:0,l=null;return s&&(l=s.toString(16),c&&(l+="."+c)),{mimeCodec:l,buffer:a(e.slice(0))}},r.esds.encodingLength=function(e){return e.buffer.length},r.stsz={},r.stsz.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.stsz.encodingLength(e))).writeUInt32BE(0,0),t.writeUInt32BE(i.length,4);for(var a=0;a<i.length;a++)t.writeUInt32BE(i[a],4*a+8);return r.stsz.encode.bytes=8+4*i.length,t},r.stsz.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=e.readUInt32BE(4),i=new Array(n),o=0;o<n;o++)i[o]=0===r?e.readUInt32BE(4*o+8):r;return{entries:i}},r.stsz.encodingLength=function(e){return 8+4*e.entries.length},r.stss=r.stco={},r.stco.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.stco.encodingLength(e))).writeUInt32BE(i.length,0);for(var a=0;a<i.length;a++)t.writeUInt32BE(i[a],4*a+4);return r.stco.encode.bytes=4+4*i.length,t},r.stco.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=0;i<r;i++)n[i]=e.readUInt32BE(4*i+4);return{entries:n}},r.stco.encodingLength=function(e){return 4+4*e.entries.length},r.stts={},r.stts.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.stts.encodingLength(e))).writeUInt32BE(i.length,0);for(var a=0;a<i.length;a++){var s=8*a+4;t.writeUInt32BE(i[a].count||0,s),t.writeUInt32BE(i[a].duration||0,s+4)}return r.stts.encode.bytes=4+8*e.entries.length,t},r.stts.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=0;i<r;i++){var o=8*i+4;n[i]={count:e.readUInt32BE(o),duration:e.readUInt32BE(o+4)}}return{entries:n}},r.stts.encodingLength=function(e){return 4+8*e.entries.length},r.ctts={},r.ctts.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.ctts.encodingLength(e))).writeUInt32BE(i.length,0);for(var a=0;a<i.length;a++){var s=8*a+4;t.writeUInt32BE(i[a].count||0,s),t.writeUInt32BE(i[a].compositionOffset||0,s+4)}return r.ctts.encode.bytes=4+8*i.length,t},r.ctts.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=0;i<r;i++){var o=8*i+4;n[i]={count:e.readUInt32BE(o),compositionOffset:e.readInt32BE(o+4)}}return{entries:n}},r.ctts.encodingLength=function(e){return 4+8*e.entries.length},r.stsc={},r.stsc.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.stsc.encodingLength(e))).writeUInt32BE(i.length,0);for(var a=0;a<i.length;a++){var s=12*a+4;t.writeUInt32BE(i[a].firstChunk||0,s),t.writeUInt32BE(i[a].samplesPerChunk||0,s+4),t.writeUInt32BE(i[a].sampleDescriptionId||0,s+8)}return r.stsc.encode.bytes=4+12*i.length,t},r.stsc.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=0;i<r;i++){var o=12*i+4;n[i]={firstChunk:e.readUInt32BE(o),samplesPerChunk:e.readUInt32BE(o+4),sampleDescriptionId:e.readUInt32BE(o+8)}}return{entries:n}},r.stsc.encodingLength=function(e){return 4+12*e.entries.length},r.dref={},r.dref.encode=function(e,t,n){t=t?t.slice(n):o(r.dref.encodingLength(e));var i=e.entries||[];t.writeUInt32BE(i.length,0);for(var a=4,s=0;s<i.length;s++){var u=i[s],c=(u.buf?u.buf.length:0)+4+4;t.writeUInt32BE(c,a),a+=4,t.write(u.type,a,4,"ascii"),a+=4,u.buf&&(u.buf.copy(t,a),a+=u.buf.length)}return r.dref.encode.bytes=a,t},r.dref.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=4,o=0;o<r;o++){var a=e.readUInt32BE(i),s=e.toString("ascii",i+4,i+8),u=e.slice(i+8,i+a);i+=a,n[o]={type:s,buf:u}}return{entries:n}},r.dref.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var r=0;r<e.entries.length;r++){var n=e.entries[r].buf;t+=(n?n.length:0)+4+4}return t},r.elst={},r.elst.encode=function(e,t,n){var i=e.entries||[];(t=t?t.slice(n):o(r.elst.encodingLength(e))).writeUInt32BE(i.length,0);for(var a=0;a<i.length;a++){var s=12*a+4;t.writeUInt32BE(i[a].trackDuration||0,s),t.writeUInt32BE(i[a].mediaTime||0,s+4),l(i[a].mediaRate||0,t,s+8)}return r.elst.encode.bytes=4+12*i.length,t},r.elst.decode=function(e,t){for(var r=(e=e.slice(t)).readUInt32BE(0),n=new Array(r),i=0;i<r;i++){var o=12*i+4;n[i]={trackDuration:e.readUInt32BE(o),mediaTime:e.readInt32BE(o+4),mediaRate:p(e,o+8)}}return{entries:n}},r.elst.encodingLength=function(e){return 4+12*e.entries.length},r.hdlr={},r.hdlr.encode=function(e,t,n){t=t?t.slice(n):o(r.hdlr.encodingLength(e));var i=21+(e.name||"").length;return t.fill(0,0,i),t.write(e.handlerType||"",4,4,"ascii"),function(e,t,r){var n=a(e,"utf8");n.copy(t,r),t[r+n.length]=0}(e.name||"",t,20),r.hdlr.encode.bytes=i,t},r.hdlr.decode=function(e,t,r){return{handlerType:(e=e.slice(t)).toString("ascii",4,8),name:function(e,t,r){var n;for(n=0;n<r&&0!==e[t+n];n++);return e.toString("utf8",t,t+n)}(e,20,r)}},r.hdlr.encodingLength=function(e){return 21+(e.name||"").length},r.mehd={},r.mehd.encode=function(e,t,n){return(t=t?t.slice(n):o(4)).writeUInt32BE(e.fragmentDuration||0,0),r.mehd.encode.bytes=4,t},r.mehd.decode=function(e,t){return{fragmentDuration:(e=e.slice(t)).readUInt32BE(0)}},r.mehd.encodingLength=function(e){return 4},r.trex={},r.trex.encode=function(e,t,n){return(t=t?t.slice(n):o(20)).writeUInt32BE(e.trackId||0,0),t.writeUInt32BE(e.defaultSampleDescriptionIndex||0,4),t.writeUInt32BE(e.defaultSampleDuration||0,8),t.writeUInt32BE(e.defaultSampleSize||0,12),t.writeUInt32BE(e.defaultSampleFlags||0,16),r.trex.encode.bytes=20,t},r.trex.decode=function(e,t){return{trackId:(e=e.slice(t)).readUInt32BE(0),defaultSampleDescriptionIndex:e.readUInt32BE(4),defaultSampleDuration:e.readUInt32BE(8),defaultSampleSize:e.readUInt32BE(12),defaultSampleFlags:e.readUInt32BE(16)}},r.trex.encodingLength=function(e){return 20},r.mfhd={},r.mfhd.encode=function(e,t,n){return(t=t?t.slice(n):o(4)).writeUInt32BE(e.sequenceNumber||0,0),r.mfhd.encode.bytes=4,t},r.mfhd.decode=function(e,t){return{sequenceNumber:e.readUint32BE(0)}},r.mfhd.encodingLength=function(e){return 4},r.tfhd={},r.tfhd.encode=function(e,t,n){return(t=t?t.slice(n):o(4)).writeUInt32BE(e.trackId,0),r.tfhd.encode.bytes=4,t},r.tfhd.decode=function(e,t){},r.tfhd.encodingLength=function(e){return 4},r.tfdt={},r.tfdt.encode=function(e,t,n){return(t=t?t.slice(n):o(4)).writeUInt32BE(e.baseMediaDecodeTime||0,0),r.tfdt.encode.bytes=4,t},r.tfdt.decode=function(e,t){},r.tfdt.encodingLength=function(e){return 4},r.trun={},r.trun.encode=function(e,t,n){(t=t?t.slice(n):o(8+16*e.entries.length)).writeUInt32BE(e.entries.length,0),t.writeInt32BE(e.dataOffset,4);for(var i=8,a=0;a<e.entries.length;a++){var s=e.entries[a];t.writeUInt32BE(s.sampleDuration,i),i+=4,t.writeUInt32BE(s.sampleSize,i),i+=4,t.writeUInt32BE(s.sampleFlags,i),i+=4,t.writeUInt32BE(s.sampleCompositionTimeOffset,i),i+=4}r.trun.encode.bytes=i},r.trun.decode=function(e,t){},r.trun.encodingLength=function(e){return 8+16*e.entries.length},r.mdat={},r.mdat.encode=function(e,t,n){e.buffer?(e.buffer.copy(t,n),r.mdat.encode.bytes=e.buffer.length):r.mdat.encode.bytes=r.mdat.encodingLength(e)},r.mdat.decode=function(e,t,r){return{buffer:a(e.slice(t,r))}},r.mdat.encodingLength=function(e){return e.buffer?e.buffer.length:e.contentLength}},{"./descriptor":73,"./index":74,"buffer-alloc":31,"buffer-from":33}],73:[function(e,t,r){var n=e("buffer-from"),i={3:"ESDescriptor",4:"DecoderConfigDescriptor",5:"DecoderSpecificInfo",6:"SLConfigDescriptor"};r.Descriptor={},r.Descriptor.decode=function(e,t,o){var a,s,u=e.readUInt8(t),c=t+1,l=0;do{l=l<<7|127&(a=e.readUInt8(c++))}while(128&a);var f=i[u];return(s=r[f]?r[f].decode(e,c,o):{buffer:n(e.slice(c,c+l))}).tag=u,s.tagName=f,s.length=c-t+l,s.contentsLen=l,s},r.DescriptorArray={},r.DescriptorArray.decode=function(e,t,n){for(var o=t,a={};o+2<=n;){var s=r.Descriptor.decode(e,o,n);o+=s.length,a[i[s.tag]||"Descriptor"+s.tag]=s}return a},r.ESDescriptor={},r.ESDescriptor.decode=function(e,t,n){var i=e.readUInt8(t+2),o=t+3;(128&i&&(o+=2),64&i)&&(o+=e.readUInt8(o)+1);return 32&i&&(o+=2),r.DescriptorArray.decode(e,o,n)},r.DecoderConfigDescriptor={},r.DecoderConfigDescriptor.decode=function(e,t,n){var i=e.readUInt8(t),o=r.DescriptorArray.decode(e,t+13,n);return o.oti=i,o}},{"buffer-from":33}],74:[function(e,t,r){var n=e("uint64be"),i=e("buffer-alloc"),o=e("buffer-from"),a=e("./boxes"),s=r,u=r.containers={moov:["mvhd","meta","traks","mvex"],trak:["tkhd","tref","trgr","edts","meta","mdia","udta"],edts:["elst"],mdia:["mdhd","hdlr","elng","minf"],minf:["vmhd","smhd","hmhd","sthd","nmhd","dinf","stbl"],dinf:["dref"],stbl:["stsd","stts","ctts","cslg","stsc","stsz","stz2","stco","co64","stss","stsh","padb","stdp","sdtp","sbgps","sgpds","subss","saizs","saios"],mvex:["mehd","trexs","leva"],moof:["mfhd","meta","trafs"],traf:["tfhd","tfdt","trun","sbgps","sgpds","subss","saizs","saios","meta"]};s.encode=function(e,t,r){return s.encodingLength(e),r=r||0,t=t||i(e.length),s._encode(e,t,r)},s._encode=function(e,t,r){var i=e.type,o=e.length;o>4294967295&&(o=1),t.writeUInt32BE(o,r),t.write(e.type,r+4,4,"ascii");var c=r+8;if(1===o&&(n.encode(e.length,t,c),c+=8),a.fullBoxes[i]&&(t.writeUInt32BE(e.flags||0,c),t.writeUInt8(e.version||0,c),c+=4),u[i])u[i].forEach(function(r){if(5===r.length){var n=e[r]||[];r=r.substr(0,4),n.forEach(function(e){s._encode(e,t,c),c+=s.encode.bytes})}else e[r]&&(s._encode(e[r],t,c),c+=s.encode.bytes)}),e.otherBoxes&&e.otherBoxes.forEach(function(e){s._encode(e,t,c),c+=s.encode.bytes});else if(a[i]){var l=a[i].encode;l(e,t,c),c+=l.bytes}else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+i+"') or `buffer` must be set");e.buffer.copy(t,c),c+=e.buffer.length}return s.encode.bytes=c-r,t},s.readHeaders=function(e,t,r){if(t=t||0,(r=r||e.length)-t<8)return 8;var i,o,s=e.readUInt32BE(t),u=e.toString("ascii",t+4,t+8),c=t+8;if(1===s){if(r-t<16)return 16;s=n.decode(e,c),c+=8}return a.fullBoxes[u]&&(i=e.readUInt8(c),o=16777215&e.readUInt32BE(c),c+=4),{length:s,headersLen:c-t,contentLen:s-(c-t),type:u,version:i,flags:o}},s.decode=function(e,t,r){t=t||0,r=r||e.length;var n=s.readHeaders(e,t,r);if(!n||n.length>r-t)throw new Error("Data too short");return s.decodeWithoutHeaders(n,e,t+n.headersLen,t+n.length)},s.decodeWithoutHeaders=function(e,t,r,n){r=r||0,n=n||t.length;var i=e.type,c={};if(u[i]){c.otherBoxes=[];for(var l=u[i],f=r;n-f>=8;){var d=s.decode(t,f,n);if(f+=d.length,l.indexOf(d.type)>=0)c[d.type]=d;else if(l.indexOf(d.type+"s")>=0){var h=d.type+"s";(c[h]=c[h]||[]).push(d)}else c.otherBoxes.push(d)}}else if(a[i]){c=(0,a[i].decode)(t,r,n)}else c.buffer=o(t.slice(r,n));return c.length=e.length,c.contentLen=e.contentLen,c.type=e.type,c.version=e.version,c.flags=e.flags,c},s.encodingLength=function(e){var t=e.type,r=8;if(a.fullBoxes[t]&&(r+=4),u[t])u[t].forEach(function(t){if(5===t.length){var n=e[t]||[];t=t.substr(0,4),n.forEach(function(e){e.type=t,r+=s.encodingLength(e)})}else if(e[t]){var i=e[t];i.type=t,r+=s.encodingLength(i)}}),e.otherBoxes&&e.otherBoxes.forEach(function(e){r+=s.encodingLength(e)});else if(a[t])r+=a[t].encodingLength(e);else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+t+"') or `buffer` must be set");r+=e.buffer.length}return r>4294967295&&(r+=8),e.length=r,r}},{"./boxes":72,"buffer-alloc":31,"buffer-from":33,uint64be:153}],75:[function(e,t,r){(function(r){var n=e("readable-stream"),i=e("inherits"),o=e("next-event"),a=e("mp4-box-encoding"),s=e("buffer-alloc"),u=s(0);function c(){if(!(this instanceof c))return new c;n.Writable.call(this),this.destroyed=!1,this._pending=0,this._missing=0,this._buf=null,this._str=null,this._cb=null,this._ondrain=null,this._writeBuffer=null,this._writeCb=null,this._ondrain=null,this._kick()}function l(e){this._parent=e,this.destroyed=!1,n.PassThrough.call(this)}t.exports=c,i(c,n.Writable),c.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"))},c.prototype._write=function(e,t,r){if(!this.destroyed){for(var n=!this._str||!this._str._writableState.needDrain;e.length&&!this.destroyed;){if(!this._missing)return this._writeBuffer=e,void(this._writeCb=r);var i=e.length<this._missing?e.length:this._missing;if(this._buf?e.copy(this._buf,this._buf.length-this._missing):this._str&&(n=this._str.write(i===e.length?e:e.slice(0,i))),this._missing-=i,!this._missing){var o=this._buf,a=this._cb,s=this._str;this._buf=this._cb=this._str=this._ondrain=null,n=!0,s&&s.end(),a&&a(o)}e=i===e.length?u:e.slice(i)}if(this._pending&&!this._missing)return this._writeBuffer=e,void(this._writeCb=r);n?r():this._ondrain(r)}},c.prototype._buffer=function(e,t){this._missing=e,this._buf=s(e),this._cb=t},c.prototype._stream=function(e,t){var r=this;return this._missing=e,this._str=new l(this),this._ondrain=o(this._str,"drain"),this._pending++,this._str.on("end",function(){r._pending--,r._kick()}),this._cb=t,this._str},c.prototype._readBox=function(){var e=this;!function t(n,i){e._buffer(n,function(n){i=i?r.concat([i,n]):n;var o=a.readHeaders(i);"number"==typeof o?t(o-i.length,i):(e._pending++,e._headers=o,e.emit("box",o))})}(8)},c.prototype.stream=function(){if(!this._headers)throw new Error("this function can only be called once after 'box' is emitted");var e=this._headers;return this._headers=null,this._stream(e.contentLen,null)},c.prototype.decode=function(e){var t=this;if(!t._headers)throw new Error("this function can only be called once after 'box' is emitted");var r=t._headers;t._headers=null,t._buffer(r.contentLen,function(n){var i=a.decodeWithoutHeaders(r,n);e(i),t._pending--,t._kick()})},c.prototype.ignore=function(){var e=this;if(!e._headers)throw new Error("this function can only be called once after 'box' is emitted");var t=e._headers;e._headers=null,this._missing=t.contentLen,this._cb=function(){e._pending--,e._kick()}},c.prototype._kick=function(){if(!this._pending&&(this._buf||this._str||this._readBox(),this._writeBuffer)){var e=this._writeCb,t=this._writeBuffer;this._writeBuffer=null,this._writeCb=null,this._write(t,null,e)}},i(l,n.PassThrough),l.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}).call(this,e("buffer").Buffer)},{buffer:34,"buffer-alloc":31,inherits:60,"mp4-box-encoding":74,"next-event":80,"readable-stream":117}],76:[function(e,t,r){(function(r){var n=e("readable-stream"),i=e("inherits"),o=e("mp4-box-encoding"),a=e("buffer-alloc");function s(){}function u(){if(!(this instanceof u))return new u;n.Readable.call(this),this.destroyed=!1,this._reading=!1,this._stream=null,this._drain=null,this._want=!1,this._onreadable=function(){if(!e._want)return;e._want=!1,e._read()},this._onend=function(){e._stream=null};var e=this}function c(e){this._parent=e,this.destroyed=!1,n.PassThrough.call(this)}t.exports=u,i(u,n.Readable),u.prototype.mediaData=u.prototype.mdat=function(e,t){var r=new c(this);return this.box({type:"mdat",contentLength:e,encodeBufferLen:8,stream:r},t),r},u.prototype.box=function(e,t){if(t||(t=s),this.destroyed)return t(new Error("Encoder is destroyed"));var n;if(e.encodeBufferLen&&(n=a(e.encodeBufferLen)),e.stream)e.buffer=null,n=o.encode(e,n),this.push(n),this._stream=e.stream,this._stream.on("readable",this._onreadable),this._stream.on("end",this._onend),this._stream.on("end",t),this._forward();else{if(n=o.encode(e,n),this.push(n))return r.nextTick(t);this._drain=t}},u.prototype.destroy=function(e){if(!this.destroyed){if(this.destroyed=!0,this._stream&&this._stream.destroy&&this._stream.destroy(),this._stream=null,this._drain){var t=this._drain;this._drain=null,t(e)}e&&this.emit("error",e),this.emit("close")}},u.prototype.finalize=function(){this.push(null)},u.prototype._forward=function(){if(this._stream)for(;!this.destroyed;){var e=this._stream.read();if(!e)return void(this._want=!!this._stream);if(!this.push(e))return}},u.prototype._read=function(){if(!this._reading&&!this.destroyed){if(this._reading=!0,this._stream&&this._forward(),this._drain){var e=this._drain;this._drain=null,e()}this._reading=!1}},i(c,n.PassThrough),c.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}).call(this,e("_process"))},{_process:98,"buffer-alloc":31,inherits:60,"mp4-box-encoding":74,"readable-stream":117}],77:[function(e,t,r){r.decode=e("./decode"),r.encode=e("./encode")},{"./decode":75,"./encode":76}],78:[function(e,t,r){var n=1e3,i=60*n,o=60*i,a=24*o,s=365.25*a;function u(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*s;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?u(r=e,a,"day")||u(r,o,"hour")||u(r,i,"minute")||u(r,n,"second")||r+" ms":function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],79:[function(e,t,r){t.exports=o;var n=e("inherits"),i=e("readable-stream");function o(e,t){var r=this;if(!(r instanceof o))return new o(e,t);i.Readable.call(r,t),r.destroyed=!1,r._drained=!1,r._forwarding=!1,r._current=null,"function"==typeof e?r._queue=e:(r._queue=e.map(a),r._queue.forEach(function(e){"function"!=typeof e&&r._attachErrorListener(e)})),r._next()}function a(e){if(!e||"function"==typeof e||e._readableState)return e;var t=(new i.Readable).wrap(e);return e.destroy&&(t.destroy=e.destroy.bind(e)),t}n(o,i.Readable),o.obj=function(e){return new o(e,{objectMode:!0,highWaterMark:16})},o.prototype._read=function(){this._drained=!0,this._forward()},o.prototype._forward=function(){if(!this._forwarding&&this._drained&&this._current){var e;for(this._forwarding=!0;null!==(e=this._current.read());)this._drained=this.push(e);this._forwarding=!1}},o.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._current&&this._current.destroy&&this._current.destroy(),"function"!=typeof this._queue&&this._queue.forEach(function(e){e.destroy&&e.destroy()}),e&&this.emit("error",e),this.emit("close"))},o.prototype._next=function(){var e=this;if(e._current=null,"function"==typeof e._queue)e._queue(function(t,r){if(t)return e.destroy(t);r=a(r),e._attachErrorListener(r),e._gotNextStream(r)});else{var t=e._queue.shift();"function"==typeof t&&(t=a(t()),e._attachErrorListener(t)),e._gotNextStream(t)}},o.prototype._gotNextStream=function(e){var t=this;if(!e)return t.push(null),void t.destroy();function r(){t._forward()}function n(){e._readableState.ended||t.destroy()}t._current=e,t._forward(),e.on("readable",r),e.once("end",function i(){t._current=null;e.removeListener("readable",r);e.removeListener("end",i);e.removeListener("close",n);t._next()}),e.once("close",n)},o.prototype._attachErrorListener=function(e){var t=this;e&&e.once("error",function r(n){e.removeListener("error",r);t.destroy(n)})}},{inherits:60,"readable-stream":117}],80:[function(e,t,r){t.exports=function(e,t){var r=null;return e.on(t,function(e){if(r){var t=r;r=null,t(e)}}),function(e){r=e}}},{}],81:[function(e,t,r){var n=e("wrappy");function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=n(i),t.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},{wrappy:176}],82:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},a={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],83:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],84:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],85:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],86:[function(e,t,r){"use strict";var n,i=e("../utils/common"),o=e("./trees"),a=e("./adler32"),s=e("./crc32"),u=e("./messages"),c=0,l=1,f=3,d=4,h=5,p=0,m=1,g=-2,y=-3,v=-5,_=-1,b=1,w=2,E=3,S=4,T=0,k=2,A=8,R=9,x=15,L=8,I=286,C=30,O=19,D=2*I+1,P=15,M=3,F=258,N=F+M+1,U=32,B=42,j=69,H=73,G=91,z=103,W=113,q=666,Y=1,K=2,V=3,Z=4,X=3;function $(e,t){return e.msg=u[t],t}function J(e){return(e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function re(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-N?e.strstart-(e.w_size-N):0,c=e.window,l=e.w_mask,f=e.prev,d=e.strstart+F,h=c[o+a-1],p=c[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+a]===p&&c[r+a-1]===h&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2,r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<d);if(n=F-(d-o),o=d-F,n>a){if(e.match_start=t,a=n,n>=s)break;h=c[o+a-1],p=c[o+a]}}}while((t=f[t&l])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function oe(e){var t,r,n,o,u,c,l,f,d,h,p=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-N)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);o+=p}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,f=e.strstart+e.lookahead,d=o,h=void 0,(h=c.avail_in)>d&&(h=d),r=0===h?0:(c.avail_in-=h,i.arraySet(l,c.input,c.next_in,h,f),1===c.state.wrap?c.adler=a(c.adler,l,h,f):2===c.state.wrap&&(c.adler=s(c.adler,l,h,f)),c.next_in+=h,c.total_in+=h,h),e.lookahead+=r,e.lookahead+e.insert>=M)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+M-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<N&&0!==e.strm.avail_in)}function ae(e,t){for(var r,n;;){if(e.lookahead<N){if(oe(e),e.lookahead<N&&t===c)return Y;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-N&&(e.match_length=ie(e,r)),e.match_length>=M)if(n=o._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return Y}return e.insert=e.strstart<M-1?e.strstart:M-1,t===d?(te(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?Y:K}function se(e,t){for(var r,n,i;;){if(e.lookahead<N){if(oe(e),e.lookahead<N&&t===c)return Y;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-N&&(e.match_length=ie(e,r),e.match_length<=5&&(e.strategy===b||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M,n=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return Y}else if(e.match_available){if((n=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return Y}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===d?(te(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?Y:K}function ue(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*D),this.dyn_dtree=new i.Buf16(2*(2*C+1)),this.bl_tree=new i.Buf16(2*(2*O+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(P+1),this.heap=new i.Buf16(2*I+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*I+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function le(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:W,e.adler=2===t.wrap?0:1,t.last_flush=c,o._tr_init(t),p):$(e,g)}function fe(e){var t,r=le(e);return r===p&&((t=e.state).window_size=2*t.w_size,Q(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=M-1,t.match_available=0,t.ins_h=0),r}function de(e,t,r,n,o,a){if(!e)return g;var s=1;if(t===_&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),o<1||o>R||r!==A||n<8||n>15||t<0||t>9||a<0||a>S)return $(e,g);8===n&&(n=9);var u=new ce;return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+M-1)/M),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=r,fe(e)}n=[new ue(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),0===e.lookahead&&t===c)return Y;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return Y;if(e.strstart-e.block_start>=e.w_size-N&&(te(e,!1),0===e.strm.avail_out))return Y}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:Z):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),Y)}),new ue(4,4,8,4,ae),new ue(4,5,16,8,ae),new ue(4,6,32,32,ae),new ue(4,4,16,16,se),new ue(8,16,32,32,se),new ue(8,16,128,128,se),new ue(8,32,128,256,se),new ue(32,128,258,1024,se),new ue(32,258,258,4096,se)],r.deflateInit=function(e,t){return de(e,t,A,x,L,T)},r.deflateInit2=de,r.deflateReset=fe,r.deflateResetKeep=le,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,p):g},r.deflate=function(e,t){var r,i,a,u;if(!e||!e.state||t>h||t<0)return e?$(e,g):g;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===q&&t!==d)return $(e,0===e.avail_out?v:g);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===B)if(2===i.wrap)e.adler=0,re(i,31),re(i,139),re(i,8),i.gzhead?(re(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),re(i,255&i.gzhead.time),re(i,i.gzhead.time>>8&255),re(i,i.gzhead.time>>16&255),re(i,i.gzhead.time>>24&255),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(re(i,255&i.gzhead.extra.length),re(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=j):(re(i,0),re(i,0),re(i,0),re(i,0),re(i,0),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,X),i.status=W);else{var y=A+(i.w_bits-8<<4)<<8;y|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=U),y+=31-y%31,i.status=W,ne(i,y),0!==i.strstart&&(ne(i,e.adler>>>16),ne(i,65535&e.adler)),e.adler=1}if(i.status===j)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending!==i.pending_buf_size));)re(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=H)}else i.status=H;if(i.status===H)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,re(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=G)}else i.status=G;if(i.status===G)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),ee(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,re(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=z)}else i.status=z;if(i.status===z&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(re(i,255&e.adler),re(i,e.adler>>8&255),e.adler=0,i.status=W)):i.status=W),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&J(t)<=J(r)&&t!==d)return $(e,v);if(i.status===q&&0!==e.avail_in)return $(e,v);if(0!==e.avail_in||0!==i.lookahead||t!==c&&i.status!==q){var _=i.strategy===w?function(e,t){for(var r;;){if(0===e.lookahead&&(oe(e),0===e.lookahead)){if(t===c)return Y;break}if(e.match_length=0,r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return Y}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?Y:K}(i,t):i.strategy===E?function(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=F){if(oe(e),e.lookahead<=F&&t===c)return Y;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=e.strstart+F;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=F-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(r=o._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(te(e,!1),0===e.strm.avail_out))return Y}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:Z):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?Y:K}(i,t):n[i.level].func(i,t);if(_!==V&&_!==Z||(i.status=q),_===Y||_===V)return 0===e.avail_out&&(i.last_flush=-1),p;if(_===K&&(t===l?o._tr_align(i):t!==h&&(o._tr_stored_block(i,0,0,!1),t===f&&(Q(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==d?p:i.wrap<=0?m:(2===i.wrap?(re(i,255&e.adler),re(i,e.adler>>8&255),re(i,e.adler>>16&255),re(i,e.adler>>24&255),re(i,255&e.total_in),re(i,e.total_in>>8&255),re(i,e.total_in>>16&255),re(i,e.total_in>>24&255)):(ne(i,e.adler>>>16),ne(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:m)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==j&&t!==H&&t!==G&&t!==z&&t!==W&&t!==q?$(e,g):(e.state=null,t===W?$(e,y):p):g},r.deflateSetDictionary=function(e,t){var r,n,o,s,u,c,l,f,d=t.length;if(!e||!e.state)return g;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==B||r.lookahead)return g;for(1===s&&(e.adler=a(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===s&&(Q(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,t,d-r.w_size,r.w_size,0),t=f,d=r.w_size),u=e.avail_in,c=e.next_in,l=e.input,e.avail_in=d,e.next_in=0,e.input=t,oe(r);r.lookahead>=M;){n=r.strstart,o=r.lookahead-(M-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+M-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--o);r.strstart=n,r.lookahead=M-1,oe(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=M-1,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=u,r.wrap=s,p},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":82,"./adler32":83,"./crc32":85,"./messages":90,"./trees":91}],87:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,o,a,s,u,c,l,f,d,h,p,m,g,y,v,_,b,w,E,S,T,k,A;r=e.state,n=e.next_in,k=e.input,i=n+(e.avail_in-5),o=e.next_out,A=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,f=r.wnext,d=r.window,h=r.hold,p=r.bits,m=r.lencode,g=r.distcode,y=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(h+=k[n++]<<p,p+=8,h+=k[n++]<<p,p+=8),_=m[h&y];t:for(;;){if(h>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))A[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(h&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&_,(b&=15)&&(p<b&&(h+=k[n++]<<p,p+=8),w+=h&(1<<b)-1,h>>>=b,p-=b),p<15&&(h+=k[n++]<<p,p+=8,h+=k[n++]<<p,p+=8),_=g[h&v];r:for(;;){if(h>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(h&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&_,p<(b&=15)&&(h+=k[n++]<<p,(p+=8)<b&&(h+=k[n++]<<p,p+=8)),(E+=h&(1<<b)-1)>u){e.msg="invalid distance too far back",r.mode=30;break e}if(h>>>=b,p-=b,E>(b=o-a)){if((b=E-b)>l&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=0,T=d,0===f){if(S+=c-b,b<w){w-=b;do{A[o++]=d[S++]}while(--b);S=o-E,T=A}}else if(f<b){if(S+=c+f-b,(b-=f)<w){w-=b;do{A[o++]=d[S++]}while(--b);if(S=0,f<w){w-=b=f;do{A[o++]=d[S++]}while(--b);S=o-E,T=A}}}else if(S+=f-b,b<w){w-=b;do{A[o++]=d[S++]}while(--b);S=o-E,T=A}for(;w>2;)A[o++]=T[S++],A[o++]=T[S++],A[o++]=T[S++],w-=3;w&&(A[o++]=T[S++],w>1&&(A[o++]=T[S++]))}else{S=o-E;do{A[o++]=A[S++],A[o++]=A[S++],A[o++]=A[S++],w-=3}while(w>2);w&&(A[o++]=A[S++],w>1&&(A[o++]=A[S++]))}break}}break}}while(n<i&&o<s);n-=w=p>>3,h&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=h,r.bits=p}},{}],88:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),u=0,c=1,l=2,f=4,d=5,h=6,p=0,m=1,g=2,y=-2,v=-3,_=-4,b=-5,w=8,E=1,S=2,T=3,k=4,A=5,R=6,x=7,L=8,I=9,C=10,O=11,D=12,P=13,M=14,F=15,N=16,U=17,B=18,j=19,H=20,G=21,z=22,W=23,q=24,Y=25,K=26,V=27,Z=28,X=29,$=30,J=31,Q=32,ee=852,te=592,re=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function oe(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,p):y}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,oe(e)):y}function se(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?y:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,ae(e))):y}function ue(e,t){var r,n;return e?(n=new ie,e.state=n,n.window=null,(r=se(e,t))!==p&&(e.state=null),r):y}var ce,le,fe=!0;function de(e){if(fe){var t;for(ce=new n.Buf32(512),le=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(l,e.lens,0,32,le,0,e.work,{bits:5}),fe=!1}e.lencode=ce,e.lenbits=9,e.distcode=le,e.distbits=5}function he(e,t,r,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),n.arraySet(a.window,t,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=ae,r.inflateReset2=se,r.inflateResetKeep=oe,r.inflateInit=function(e){return ue(e,re)},r.inflateInit2=ue,r.inflate=function(e,t){var r,ee,te,re,ie,oe,ae,se,ue,ce,le,fe,pe,me,ge,ye,ve,_e,be,we,Ee,Se,Te,ke,Ae=0,Re=new n.Buf8(4),xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return y;(r=e.state).mode===D&&(r.mode=P),ie=e.next_out,te=e.output,ae=e.avail_out,re=e.next_in,ee=e.input,oe=e.avail_in,se=r.hold,ue=r.bits,ce=oe,le=ae,Se=p;e:for(;;)switch(r.mode){case E:if(0===r.wrap){r.mode=P;break}for(;ue<16;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(2&r.wrap&&35615===se){r.check=0,Re[0]=255&se,Re[1]=se>>>8&255,r.check=o(r.check,Re,2,0),se=0,ue=0,r.mode=S;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",r.mode=$;break}if((15&se)!==w){e.msg="unknown compression method",r.mode=$;break}if(ue-=4,Ee=8+(15&(se>>>=4)),0===r.wbits)r.wbits=Ee;else if(Ee>r.wbits){e.msg="invalid window size",r.mode=$;break}r.dmax=1<<Ee,e.adler=r.check=1,r.mode=512&se?C:D,se=0,ue=0;break;case S:for(;ue<16;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(r.flags=se,(255&r.flags)!==w){e.msg="unknown compression method",r.mode=$;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=$;break}r.head&&(r.head.text=se>>8&1),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=o(r.check,Re,2,0)),se=0,ue=0,r.mode=T;case T:for(;ue<32;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.head&&(r.head.time=se),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,Re[2]=se>>>16&255,Re[3]=se>>>24&255,r.check=o(r.check,Re,4,0)),se=0,ue=0,r.mode=k;case k:for(;ue<16;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.head&&(r.head.xflags=255&se,r.head.os=se>>8),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=o(r.check,Re,2,0)),se=0,ue=0,r.mode=A;case A:if(1024&r.flags){for(;ue<16;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.length=se,r.head&&(r.head.extra_len=se),512&r.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,r.check=o(r.check,Re,2,0)),se=0,ue=0}else r.head&&(r.head.extra=null);r.mode=R;case R:if(1024&r.flags&&((fe=r.length)>oe&&(fe=oe),fe&&(r.head&&(Ee=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,fe,Ee)),512&r.flags&&(r.check=o(r.check,ee,fe,re)),oe-=fe,re+=fe,r.length-=fe),r.length))break e;r.length=0,r.mode=x;case x:if(2048&r.flags){if(0===oe)break e;fe=0;do{Ee=ee[re+fe++],r.head&&Ee&&r.length<65536&&(r.head.name+=String.fromCharCode(Ee))}while(Ee&&fe<oe);if(512&r.flags&&(r.check=o(r.check,ee,fe,re)),oe-=fe,re+=fe,Ee)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=L;case L:if(4096&r.flags){if(0===oe)break e;fe=0;do{Ee=ee[re+fe++],r.head&&Ee&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ee))}while(Ee&&fe<oe);if(512&r.flags&&(r.check=o(r.check,ee,fe,re)),oe-=fe,re+=fe,Ee)break e}else r.head&&(r.head.comment=null);r.mode=I;case I:if(512&r.flags){for(;ue<16;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(se!==(65535&r.check)){e.msg="header crc mismatch",r.mode=$;break}se=0,ue=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=D;break;case C:for(;ue<32;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}e.adler=r.check=ne(se),se=0,ue=0,r.mode=O;case O:if(0===r.havedict)return e.next_out=ie,e.avail_out=ae,e.next_in=re,e.avail_in=oe,r.hold=se,r.bits=ue,g;e.adler=r.check=1,r.mode=D;case D:if(t===d||t===h)break e;case P:if(r.last){se>>>=7&ue,ue-=7&ue,r.mode=V;break}for(;ue<3;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}switch(r.last=1&se,ue-=1,3&(se>>>=1)){case 0:r.mode=M;break;case 1:if(de(r),r.mode=H,t===h){se>>>=2,ue-=2;break e}break;case 2:r.mode=U;break;case 3:e.msg="invalid block type",r.mode=$}se>>>=2,ue-=2;break;case M:for(se>>>=7&ue,ue-=7&ue;ue<32;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",r.mode=$;break}if(r.length=65535&se,se=0,ue=0,r.mode=F,t===h)break e;case F:r.mode=N;case N:if(fe=r.length){if(fe>oe&&(fe=oe),fe>ae&&(fe=ae),0===fe)break e;n.arraySet(te,ee,re,fe,ie),oe-=fe,re+=fe,ae-=fe,ie+=fe,r.length-=fe;break}r.mode=D;break;case U:for(;ue<14;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(r.nlen=257+(31&se),se>>>=5,ue-=5,r.ndist=1+(31&se),se>>>=5,ue-=5,r.ncode=4+(15&se),se>>>=4,ue-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=$;break}r.have=0,r.mode=B;case B:for(;r.have<r.ncode;){for(;ue<3;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.lens[xe[r.have++]]=7&se,se>>>=3,ue-=3}for(;r.have<19;)r.lens[xe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Te={bits:r.lenbits},Se=s(u,r.lens,0,19,r.lencode,0,r.work,Te),r.lenbits=Te.bits,Se){e.msg="invalid code lengths set",r.mode=$;break}r.have=0,r.mode=j;case j:for(;r.have<r.nlen+r.ndist;){for(;ye=(Ae=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ve=65535&Ae,!((ge=Ae>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(ve<16)se>>>=ge,ue-=ge,r.lens[r.have++]=ve;else{if(16===ve){for(ke=ge+2;ue<ke;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(se>>>=ge,ue-=ge,0===r.have){e.msg="invalid bit length repeat",r.mode=$;break}Ee=r.lens[r.have-1],fe=3+(3&se),se>>>=2,ue-=2}else if(17===ve){for(ke=ge+3;ue<ke;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}ue-=ge,Ee=0,fe=3+(7&(se>>>=ge)),se>>>=3,ue-=3}else{for(ke=ge+7;ue<ke;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}ue-=ge,Ee=0,fe=11+(127&(se>>>=ge)),se>>>=7,ue-=7}if(r.have+fe>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=$;break}for(;fe--;)r.lens[r.have++]=Ee}}if(r.mode===$)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=$;break}if(r.lenbits=9,Te={bits:r.lenbits},Se=s(c,r.lens,0,r.nlen,r.lencode,0,r.work,Te),r.lenbits=Te.bits,Se){e.msg="invalid literal/lengths set",r.mode=$;break}if(r.distbits=6,r.distcode=r.distdyn,Te={bits:r.distbits},Se=s(l,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Te),r.distbits=Te.bits,Se){e.msg="invalid distances set",r.mode=$;break}if(r.mode=H,t===h)break e;case H:r.mode=G;case G:if(oe>=6&&ae>=258){e.next_out=ie,e.avail_out=ae,e.next_in=re,e.avail_in=oe,r.hold=se,r.bits=ue,a(e,le),ie=e.next_out,te=e.output,ae=e.avail_out,re=e.next_in,ee=e.input,oe=e.avail_in,se=r.hold,ue=r.bits,r.mode===D&&(r.back=-1);break}for(r.back=0;ye=(Ae=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ve=65535&Ae,!((ge=Ae>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(ye&&0==(240&ye)){for(_e=ge,be=ye,we=ve;ye=(Ae=r.lencode[we+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ve=65535&Ae,!(_e+(ge=Ae>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}se>>>=_e,ue-=_e,r.back+=_e}if(se>>>=ge,ue-=ge,r.back+=ge,r.length=ve,0===ye){r.mode=K;break}if(32&ye){r.back=-1,r.mode=D;break}if(64&ye){e.msg="invalid literal/length code",r.mode=$;break}r.extra=15&ye,r.mode=z;case z:if(r.extra){for(ke=r.extra;ue<ke;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.length+=se&(1<<r.extra)-1,se>>>=r.extra,ue-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=W;case W:for(;ye=(Ae=r.distcode[se&(1<<r.distbits)-1])>>>16&255,ve=65535&Ae,!((ge=Ae>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(0==(240&ye)){for(_e=ge,be=ye,we=ve;ye=(Ae=r.distcode[we+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ve=65535&Ae,!(_e+(ge=Ae>>>24)<=ue);){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}se>>>=_e,ue-=_e,r.back+=_e}if(se>>>=ge,ue-=ge,r.back+=ge,64&ye){e.msg="invalid distance code",r.mode=$;break}r.offset=ve,r.extra=15&ye,r.mode=q;case q:if(r.extra){for(ke=r.extra;ue<ke;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}r.offset+=se&(1<<r.extra)-1,se>>>=r.extra,ue-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=$;break}r.mode=Y;case Y:if(0===ae)break e;if(fe=le-ae,r.offset>fe){if((fe=r.offset-fe)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=$;break}fe>r.wnext?(fe-=r.wnext,pe=r.wsize-fe):pe=r.wnext-fe,fe>r.length&&(fe=r.length),me=r.window}else me=te,pe=ie-r.offset,fe=r.length;fe>ae&&(fe=ae),ae-=fe,r.length-=fe;do{te[ie++]=me[pe++]}while(--fe);0===r.length&&(r.mode=G);break;case K:if(0===ae)break e;te[ie++]=r.length,ae--,r.mode=G;break;case V:if(r.wrap){for(;ue<32;){if(0===oe)break e;oe--,se|=ee[re++]<<ue,ue+=8}if(le-=ae,e.total_out+=le,r.total+=le,le&&(e.adler=r.check=r.flags?o(r.check,te,le,ie-le):i(r.check,te,le,ie-le)),le=ae,(r.flags?se:ne(se))!==r.check){e.msg="incorrect data check",r.mode=$;break}se=0,ue=0}r.mode=Z;case Z:if(r.wrap&&r.flags){for(;ue<32;){if(0===oe)break e;oe--,se+=ee[re++]<<ue,ue+=8}if(se!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=$;break}se=0,ue=0}r.mode=X;case X:Se=m;break e;case $:Se=v;break e;case J:return _;case Q:default:return y}return e.next_out=ie,e.avail_out=ae,e.next_in=re,e.avail_in=oe,r.hold=se,r.bits=ue,(r.wsize||le!==e.avail_out&&r.mode<$&&(r.mode<V||t!==f))&&he(e,e.output,e.next_out,le-e.avail_out)?(r.mode=J,_):(ce-=e.avail_in,le-=e.avail_out,e.total_in+=ce,e.total_out+=le,r.total+=le,r.wrap&&le&&(e.adler=r.check=r.flags?o(r.check,te,le,e.next_out-le):i(r.check,te,le,e.next_out-le)),e.data_type=r.bits+(r.last?64:0)+(r.mode===D?128:0)+(r.mode===H||r.mode===F?256:0),(0===ce&&0===le||t===f)&&Se===p&&(Se=b),Se)},r.inflateEnd=function(e){if(!e||!e.state)return y;var t=e.state;return t.window&&(t.window=null),e.state=null,p},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?y:(r.head=t,t.done=!1,p):y},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==O?y:r.mode===O&&i(1,t,n,0)!==r.check?v:he(e,t,n,n)?(r.mode=J,_):(r.havedict=1,p):y},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":82,"./adler32":83,"./crc32":85,"./inffast":87,"./inftrees":89}],89:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,u,c,l,f,d){var h,p,m,g,y,v,_,b,w,E=d.bits,S=0,T=0,k=0,A=0,R=0,x=0,L=0,I=0,C=0,O=0,D=null,P=0,M=new n.Buf16(16),F=new n.Buf16(16),N=null,U=0;for(S=0;S<=15;S++)M[S]=0;for(T=0;T<u;T++)M[t[r+T]]++;for(R=E,A=15;A>=1&&0===M[A];A--);if(R>A&&(R=A),0===A)return c[l++]=20971520,c[l++]=20971520,d.bits=1,0;for(k=1;k<A&&0===M[k];k++);for(R<k&&(R=k),I=1,S=1;S<=15;S++)if(I<<=1,(I-=M[S])<0)return-1;if(I>0&&(0===e||1!==A))return-1;for(F[1]=0,S=1;S<15;S++)F[S+1]=F[S]+M[S];for(T=0;T<u;T++)0!==t[r+T]&&(f[F[t[r+T]]++]=T);if(0===e?(D=N=f,v=19):1===e?(D=i,P-=257,N=o,U-=257,v=256):(D=a,N=s,v=-1),O=0,T=0,S=k,y=l,x=R,L=0,m=-1,g=(C=1<<R)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){_=S-L,f[T]<v?(b=0,w=f[T]):f[T]>v?(b=N[U+f[T]],w=D[P+f[T]]):(b=96,w=0),h=1<<S-L,k=p=1<<x;do{c[y+(O>>L)+(p-=h)]=_<<24|b<<16|w|0}while(0!==p);for(h=1<<S-1;O&h;)h>>=1;if(0!==h?(O&=h-1,O+=h):O=0,T++,0==--M[S]){if(S===A)break;S=t[r+f[T]]}if(S>R&&(O&g)!==m){for(0===L&&(L=R),y+=k,I=1<<(x=S-L);x+L<A&&!((I-=M[x+L])<=0);)x++,I<<=1;if(C+=1<<x,1===e&&C>852||2===e&&C>592)return 1;c[m=O&g]=R<<24|x<<16|y-l|0}}return 0!==O&&(c[y+O]=S-L<<24|64<<16|0),d.bits=R,0}},{"../utils/common":82}],90:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],91:[function(e,t,r){"use strict";var n=e("../utils/common"),i=4,o=0,a=1,s=2;function u(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,l=1,f=2,d=29,h=256,p=h+1+d,m=30,g=19,y=2*p+1,v=15,_=16,b=7,w=256,E=16,S=17,T=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(p+2));u(L);var I=new Array(2*m);u(I);var C=new Array(512);u(C);var O=new Array(256);u(O);var D=new Array(d);u(D);var P,M,F,N=new Array(m);function U(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function B(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function j(e){return e<256?C[e]:C[256+(e>>>7)]}function H(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function G(e,t,r){e.bi_valid>_-r?(e.bi_buf|=t<<e.bi_valid&65535,H(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=r-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function z(e,t,r){G(e,r[2*t],r[2*t+1])}function W(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function q(e,t,r){var n,i,o=new Array(v+1),a=0;for(n=1;n<=v;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=W(o[s]++,s))}}function Y(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?H(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function V(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function Z(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&V(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!V(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function X(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?z(e,i,t):(z(e,(o=O[i])+h+1,t),0!==(a=k[o])&&G(e,i-=D[o],a),z(e,o=j(--n),r),0!==(a=A[o])&&G(e,n-=N[o],a))}while(s<e.last_lit);z(e,w,t)}function $(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=y,r=0;r<u;r++)0!==o[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)Z(e,o,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Z(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,Z(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=v;o++)e.bl_count[o]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<y;r++)(o=u[2*u[2*(n=e.heap[r])+1]+1]+1)>p&&(o=p,m++),u[2*n+1]=o,n>c||(e.bl_count[o]++,a=0,n>=h&&(a=d[n-h]),s=u[2*n],e.opt_len+=s*(o+a),f&&(e.static_len+=s*(l[2*n+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>c||(u[2*i+1]!==o&&(e.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),n--)}}(e,t),q(o,c,e.bl_count)}function J(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<u&&i===a||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*E]++):s<=10?e.bl_tree[2*S]++:e.bl_tree[2*T]++,s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))}function Q(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<u&&i===a)){if(s<c)do{z(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(z(e,i,e.bl_tree),s--),z(e,E,e.bl_tree),G(e,s-3,2)):s<=10?(z(e,S,e.bl_tree),G(e,s-3,3)):(z(e,T,e.bl_tree),G(e,s-11,7));s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}}u(N);var ee=!1;function te(e,t,r,i){G(e,(c<<1)+(i?1:0),3),function(e,t,r,i){K(e),i&&(H(e,r),H(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){ee||(function(){var e,t,r,n,i,o=new Array(v+1);for(r=0,n=0;n<d-1;n++)for(D[n]=r,e=0;e<1<<k[n];e++)O[r++]=n;for(O[r-1]=n,i=0,n=0;n<16;n++)for(N[n]=i,e=0;e<1<<A[n];e++)C[i++]=n;for(i>>=7;n<m;n++)for(N[n]=i<<7,e=0;e<1<<A[n]-7;e++)C[256+i++]=n;for(t=0;t<=v;t++)o[t]=0;for(e=0;e<=143;)L[2*e+1]=8,e++,o[8]++;for(;e<=255;)L[2*e+1]=9,e++,o[9]++;for(;e<=279;)L[2*e+1]=7,e++,o[7]++;for(;e<=287;)L[2*e+1]=8,e++,o[8]++;for(q(L,p+1,o),e=0;e<m;e++)I[2*e+1]=5,I[2*e]=W(e,5);P=new U(L,k,h+1,p,v),M=new U(I,A,0,m,v),F=new U(new Array(0),R,0,g,b)}(),ee=!0),e.l_desc=new B(e.dyn_ltree,P),e.d_desc=new B(e.dyn_dtree,M),e.bl_desc=new B(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,Y(e)},r._tr_stored_block=te,r._tr_flush_block=function(e,t,r,n){var u,c,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<h;t++)if(0!==e.dyn_ltree[2*t])return a;return o}(e)),$(e,e.l_desc),$(e,e.d_desc),d=function(e){var t;for(J(e,e.dyn_ltree,e.l_desc.max_code),J(e,e.dyn_dtree,e.d_desc.max_code),$(e,e.bl_desc),t=g-1;t>=3&&0===e.bl_tree[2*x[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=u&&(u=c)):u=c=r+5,r+4<=u&&-1!==t?te(e,t,r,n):e.strategy===i||c===u?(G(e,(l<<1)+(n?1:0),3),X(e,L,I)):(G(e,(f<<1)+(n?1:0),3),function(e,t,r,n){var i;for(G(e,t-257,5),G(e,r-1,5),G(e,n-4,4),i=0;i<n;i++)G(e,e.bl_tree[2*x[i]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),X(e,e.dyn_ltree,e.dyn_dtree)),Y(e),n&&K(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(O[r]+h+1)]++,e.dyn_dtree[2*j(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){G(e,l<<1,3),z(e,w,L),function(e){16===e.bi_valid?(H(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":82}],92:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],93:[function(e,t,r){(function(r,n){var i=e("bencode"),o=e("blob-to-buffer"),a=e("fs"),s=e("simple-get"),u=e("magnet-uri"),c=e("path"),l=e("simple-sha1"),f=e("uniq");function d(e){if("string"==typeof e&&/^(stream-)?magnet:/.test(e))return u(e);if("string"==typeof e&&(/^[a-f0-9]{40}$/i.test(e)||/^[a-z2-7]{32}$/i.test(e)))return u("magnet:?xt=urn:btih:"+e);if(n.isBuffer(e)&&20===e.length)return u("magnet:?xt=urn:btih:"+e.toString("hex"));if(n.isBuffer(e))return function(e){n.isBuffer(e)&&(e=i.decode(e));p(e.info,"info"),p(e.info["name.utf-8"]||e.info.name,"info.name"),p(e.info["piece length"],"info['piece length']"),p(e.info.pieces,"info.pieces"),e.info.files?e.info.files.forEach(function(e){p("number"==typeof e.length,"info.files[0].length"),p(e["path.utf-8"]||e.path,"info.files[0].path")}):p("number"==typeof e.info.length,"info.length");var t={};t.info=e.info,t.infoBuffer=i.encode(e.info),t.infoHash=l.sync(t.infoBuffer),t.infoHashBuffer=n.from(t.infoHash,"hex"),t.name=(e.info["name.utf-8"]||e.info.name).toString(),void 0!==e.info.private&&(t.private=!!e.info.private);e["creation date"]&&(t.created=new Date(1e3*e["creation date"]));e["created by"]&&(t.createdBy=e["created by"].toString());n.isBuffer(e.comment)&&(t.comment=e.comment.toString());t.announce=[],Array.isArray(e["announce-list"])&&e["announce-list"].length>0?e["announce-list"].forEach(function(e){e.forEach(function(e){t.announce.push(e.toString())})}):e.announce&&t.announce.push(e.announce.toString());n.isBuffer(e["url-list"])&&(e["url-list"]=e["url-list"].length>0?[e["url-list"]]:[]);t.urlList=(e["url-list"]||[]).map(function(e){return e.toString()}),f(t.announce),f(t.urlList);var r=e.info.files||[e.info];t.files=r.map(function(e,n){var i=[].concat(t.name,e["path.utf-8"]||e.path||[]).map(function(e){return e.toString()});return{path:c.join.apply(null,[c.sep].concat(i)).slice(1),name:i[i.length-1],length:e.length,offset:r.slice(0,n).reduce(h,0)}}),t.length=r.reduce(h,0);var o=t.files[t.files.length-1];return t.pieceLength=e.info["piece length"],t.lastPieceLength=(o.offset+o.length)%t.pieceLength||t.pieceLength,t.pieces=function(e){for(var t=[],r=0;r<e.length;r+=20)t.push(e.slice(r,r+20).toString("hex"));return t}(e.info.pieces),t}(e);if(e&&e.infoHash)return e.infoHash=e.infoHash.toLowerCase(),e.announce||(e.announce=[]),"string"==typeof e.announce&&(e.announce=[e.announce]),e.urlList||(e.urlList=[]),e;throw new Error("Invalid torrent identifier")}function h(e,t){return e+t.length}function p(e,t){if(!e)throw new Error("Torrent is missing required field: "+t)}t.exports=d,t.exports.remote=function(e,t){var n;if("function"!=typeof t)throw new Error("second argument must be a Function");try{n=d(e)}catch(e){}n&&n.infoHash?r.nextTick(function(){t(null,n)}):(i=e,"undefined"!=typeof Blob&&i instanceof Blob?o(e,function(e,r){if(e)return t(new Error("Error converting Blob: "+e.message));u(r)}):"function"==typeof s&&/^https?:/.test(e)?s.concat({url:e,timeout:3e4,headers:{"user-agent":"WebTorrent (https://webtorrent.io)"}},function(e,r,n){if(e)return t(new Error("Error downloading torrent: "+e.message));u(n)}):"function"==typeof a.readFile&&"string"==typeof e?a.readFile(e,function(e,r){if(e)return t(new Error("Invalid torrent identifier"));u(r)}):r.nextTick(function(){t(new Error("Invalid torrent identifier"))}));var i;function u(e){try{n=d(e)}catch(e){return t(e)}n&&n.infoHash?t(null,n):t(new Error("Invalid torrent identifier"))}},t.exports.toMagnetURI=u.encode,t.exports.toTorrentFile=function(e){var t={info:e.info};t["announce-list"]=(e.announce||[]).map(function(e){return t.announce||(t.announce=e),[e=n.from(e,"utf8")]}),t["url-list"]=e.urlList||[],(!0===e.private||!1===e.private)&&(t.private=e.private);e.created&&(t["creation date"]=e.created.getTime()/1e3|0);e.createdBy&&(t["created by"]=e.createdBy);e.comment&&(t.comment=e.comment);return i.encode(t)},n.alloc(0)}).call(this,e("_process"),e("buffer").Buffer)},{_process:98,bencode:16,"blob-to-buffer":24,buffer:34,fs:29,"magnet-uri":68,path:94,"simple-get":130,"simple-sha1":132,uniq:154}],94:[function(e,t,r){(function(e){function t(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return n.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}r.resolve=function(){for(var r="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var a=i>=0?arguments[i]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(r=a+"/"+r,n="/"===a.charAt(0))}return(n?"/":"")+(r=t(o(r.split("/"),function(e){return!!e}),!n).join("/"))||"."},r.normalize=function(e){var n=r.isAbsolute(e),i="/"===a(e,-1);return(e=t(o(e.split("/"),function(e){return!!e}),!n).join("/"))||n||(e="."),e&&i&&(e+="/"),(n?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var i=n(e.split("/")),o=n(t.split("/")),a=Math.min(i.length,o.length),s=a,u=0;u<a;u++)if(i[u]!==o[u]){s=u;break}var c=[];for(u=s;u<i.length;u++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var t=i(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(e,t){var r=i(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},r.extname=function(e){return i(e)[3]};var a="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,e("_process"))},{_process:98}],95:[function(e,t,r){for(var n=e("closest-to"),i=Math.pow(2,10),o=13,a=[];o++<22;)a.push(Math.pow(2,o));t.exports=function(e){return n(e/i,a)}},{"closest-to":38}],96:[function(e,t,r){t.exports=function(e){if("number"!=typeof e||isNaN(e))throw new TypeError("Expected a number, got "+typeof e);var t=e<0,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];t&&(e=-e);if(e<1)return(t?"-":"")+e+" B";var n=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),r.length-1);e=Number(e/Math.pow(1e3,n));var i=r[n];return e>=10||e%1==0?(t?"-":"")+e.toFixed(0)+" "+i:(t?"-":"")+e.toFixed(1)+" "+i}},{}],97:[function(e,t,r){(function(e){"use strict";!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this,e("_process"))},{_process:98}],98:[function(e,t,r){var n,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,l=[],f=!1,d=-1;function h(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&p())}function p(){if(!f){var e=u(h);f=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,f=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||f||u(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],99:[function(e,t,r){(function(r){var n=e("once"),i=e("end-of-stream"),o=e("fs"),a=function(){},s=/^v?\.0/.test(r.version),u=function(e){return"function"==typeof e},c=function(e,t,r,c){c=n(c);var l=!1;e.on("close",function(){l=!0}),i(e,{readable:t,writable:r},function(e){if(e)return c(e);l=!0,c()});var f=!1;return function(t){if(!l&&!f)return f=!0,function(e){return!!s&&!!o&&(e instanceof(o.ReadStream||a)||e instanceof(o.WriteStream||a))&&u(e.close)}(e)?e.close(a):function(e){return e.setHeader&&u(e.abort)}(e)?e.abort():u(e.destroy)?e.destroy():void c(t||new Error("stream was destroyed"))}},l=function(e){e()},f=function(e,t){return e.pipe(t)};t.exports=function(){var e,t=Array.prototype.slice.call(arguments),r=u(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var n=t.map(function(i,o){var a=o<t.length-1;return c(i,a,o>0,function(t){e||(e=t),t&&n.forEach(l),a||(n.forEach(l),r(e))})});return t.reduce(f)}}).call(this,e("_process"))},{_process:98,"end-of-stream":49,fs:26,once:81}],100:[function(e,t,r){(function(e){!function(n){var i="object"==typeof r&&r&&!r.nodeType&&r,o="object"==typeof t&&t&&!t.nodeType&&t,a="object"==typeof e&&e;a.global!==a&&a.window!==a&&a.self!==a||(n=a);var s,u,c=2147483647,l=36,f=1,d=26,h=38,p=700,m=72,g=128,y="-",v=/^xn--/,_=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-f,S=Math.floor,T=String.fromCharCode;function k(e){throw new RangeError(w[e])}function A(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function R(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+A((e=e.replace(b,".")).split("."),t).join(".")}function x(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function L(e){return A(e,function(e){var t="";return e>65535&&(t+=T((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=T(e)}).join("")}function I(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,r){var n=0;for(e=r?S(e/p):e>>1,e+=S(e/t);e>E*d>>1;n+=l)e=S(e/E);return S(n+(E+1)*e/(e+h))}function O(e){var t,r,n,i,o,a,s,u,h,p,v,_=[],b=e.length,w=0,E=g,T=m;for((r=e.lastIndexOf(y))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&k("not-basic"),_.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<b;){for(o=w,a=1,s=l;i>=b&&k("invalid-input"),((u=(v=e.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||u>S((c-w)/a))&&k("overflow"),w+=u*a,!(u<(h=s<=T?f:s>=T+d?d:s-T));s+=l)a>S(c/(p=l-h))&&k("overflow"),a*=p;T=C(w-o,t=_.length+1,0==o),S(w/t)>c-E&&k("overflow"),E+=S(w/t),w%=t,_.splice(w++,0,E)}return L(_)}function D(e){var t,r,n,i,o,a,s,u,h,p,v,_,b,w,E,A=[];for(_=(e=x(e)).length,t=g,r=0,o=m,a=0;a<_;++a)(v=e[a])<128&&A.push(T(v));for(n=i=A.length,i&&A.push(y);n<_;){for(s=c,a=0;a<_;++a)(v=e[a])>=t&&v<s&&(s=v);for(s-t>S((c-r)/(b=n+1))&&k("overflow"),r+=(s-t)*b,t=s,a=0;a<_;++a)if((v=e[a])<t&&++r>c&&k("overflow"),v==t){for(u=r,h=l;!(u<(p=h<=o?f:h>=o+d?d:h-o));h+=l)E=u-p,w=l-p,A.push(T(I(p+E%w,0))),u=S(E/w);A.push(T(I(u,0))),o=C(r,b,n==i),r=0,++n}++r,++t}return A.join("")}if(s={version:"1.4.1",ucs2:{decode:x,encode:L},decode:O,encode:D,toASCII:function(e){return R(e,function(e){return _.test(e)?"xn--"+D(e):e})},toUnicode:function(e){return R(e,function(e){return v.test(e)?O(e.slice(4).toLowerCase()):e})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return s});else if(i&&o)if(t.exports==i)o.exports=s;else for(u in s)s.hasOwnProperty(u)&&(i[u]=s[u]);else n.punycode=s}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],101:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var f,d,h,p,m=e[l].replace(s,"%20"),g=m.indexOf(r);g>=0?(f=m.substr(0,g),d=m.substr(g+1)):(f=m,d=""),h=decodeURIComponent(f),p=decodeURIComponent(d),n(a,h)?i(a[h])?a[h].push(p):a[h]=[a[h],p]:a[h]=p}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],102:[function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?o(a(e),function(a){var s=encodeURIComponent(n(a))+r;return i(e[a])?o(e[a],function(e){return s+encodeURIComponent(n(e))}).join(t):s+encodeURIComponent(n(e[a]))}).join(t):s?encodeURIComponent(n(s))+r+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],103:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":101,"./encode":102}],104:[function(e,t,r){t.exports=function(e){var t=0;return function(){if(t===e.length)return null;var r=e.length-t,n=Math.random()*r|0,i=e[t+n],o=e[t];return e[t]=i,e[t+n]=o,t++,i}}},{}],105:[function(e,t,r){(function(r,n){"use strict";var i=e("safe-buffer").Buffer,o=n.crypto||n.msCrypto;o&&o.getRandomValues?t.exports=function(e,t){if(e>65536)throw new Error("requested too many random bytes");var a=new n.Uint8Array(e);e>0&&o.getRandomValues(a);var s=i.from(a.buffer);if("function"==typeof t)return r.nextTick(function(){t(null,s)});return s}:t.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:98,"safe-buffer":128}],106:[function(e,t,r){var n=e("inherits"),i=e("readable-stream");function o(e,t){if(!(this instanceof o))return new o(e);i.Writable.call(this,t),this.destroyed=!1,this._queue=[],this._position=e||0,this._cb=null,this._buffer=null,this._out=null}t.exports=o,n(o,i.Writable),o.prototype._write=function(e,t,r){for(var n=!0;;){if(this.destroyed)return;if(0===this._queue.length)return this._buffer=e,void(this._cb=r);this._buffer=null;var i,o=this._queue[0],a=Math.max(o.start-this._position,0),s=o.end-this._position;if(a>=e.length)return this._position+=e.length,r(null);if(s>e.length){this._position+=e.length,i=0===a?e:e.slice(a),n=o.stream.write(i)&&n;break}this._position+=s,i=0===a&&s===e.length?e:e.slice(a,s),n=o.stream.write(i)&&n,o.last&&o.stream.end(),e=e.slice(s),this._queue.shift()}n?r(null):o.stream.once("drain",r.bind(null,null))},o.prototype.slice=function(e){var t=this;if(t.destroyed)return null;e instanceof Array||(e=[e]);var r=new i.PassThrough;return e.forEach(function(n,i){t._queue.push({start:n.start,end:n.end,stream:r,last:i===e.length-1})}),t._buffer&&t._write(t._buffer,null,t._cb),r},o.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e))}},{inherits:60,"readable-stream":117}],107:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":108}],108:[function(e,t,r){"use strict";var n=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=f;var o=e("core-util-is");o.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");o.inherits(f,a);for(var u=i(s.prototype),c=0;c<u.length;c++){var l=u[c];f.prototype[l]||(f.prototype[l]=s.prototype[l])}function f(e){if(!(this instanceof f))return new f(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),f.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":110,"./_stream_writable":112,"core-util-is":39,inherits:60,"process-nextick-args":97}],109:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":111,"core-util-is":39,inherits:60}],110:[function(e,t,r){(function(r,n){"use strict";var i=e("process-nextick-args");t.exports=_;var o,a=e("isarray");_.ReadableState=v;e("events").EventEmitter;var s=function(e,t){return e.listeners(t).length},u=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,l=n.Uint8Array||function(){};var f=e("core-util-is");f.inherits=e("inherits");var d=e("util"),h=void 0;h=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=e("./internal/streams/BufferList"),g=e("./internal/streams/destroy");f.inherits(_,u);var y=["error","close","destroy","pause","resume"];function v(t,r){t=t||{};var n=r instanceof(o=o||e("./_stream_duplex"));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,a=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=e("string_decoder/").StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function _(t){if(o=o||e("./_stream_duplex"),!(this instanceof _))return new _(t);this._readableState=new v(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),u.call(this)}function b(e,t,r,n,i){var o,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,T(e)}(e,a)):(i||(o=function(e,t){var r;n=t,c.isBuffer(n)||n instanceof l||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(a,t)),o?e.emit("error",o):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?w(e,a,t,!1):A(e,a)):w(e,a,t,!1))):n||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&T(e)),A(e,t)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=c.from(e,t),t=""),r=!0),b(this,e,t,!1,r)},_.prototype.unshift=function(e){return b(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){return p||(p=e("string_decoder/").StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var E=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=E?e=E:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){h("emit readable"),e.emit("readable"),I(e)}function A(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(R,e,t))}function R(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function x(e){h("readable nexttick read 0"),e.read(0)}function L(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function C(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=c.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,a),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function O(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}_.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?O(this):T(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&O(this),null;var n,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=e>0?C(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&O(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,t);var u=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:_;function c(t,r){h("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,h("cleanup"),e.removeListener("close",y),e.removeListener("finish",v),e.removeListener("drain",f),e.removeListener("error",g),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",_),n.removeListener("data",m),d=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||f())}function l(){h("onend"),e.end()}o.endEmitted?i.nextTick(u):n.once("end",u),e.on("unpipe",c);var f=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,I(e))}}(n);e.on("drain",f);var d=!1;var p=!1;function m(t){h("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==P(o.pipes,e))&&!d&&(h("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function g(t){h("onerror",t),_(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",v),_()}function v(){h("onfinish"),e.removeListener("close",y),_()}function _(){h("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",y),e.once("finish",v),e.emit("pipe",n),o.flowing||(h("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=P(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},_.prototype.on=function(e,t){var r=u.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&T(this):i.nextTick(x,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(L,e,t))}(this,e)),this},_.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(h("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(h("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<y.length;o++)e.on(y[o],this.emit.bind(this,y[o]));return this._read=function(t){h("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=C}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":108,"./internal/streams/BufferList":113,"./internal/streams/destroy":114,"./internal/streams/stream":115,_process:98,"core-util-is":39,events:51,inherits:60,isarray:65,"process-nextick-args":97,"safe-buffer":128,"string_decoder/":143,util:26}],111:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_duplex"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush(function(t,r){s(e,t,r)}):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":108,"core-util-is":39,inherits:60}],112:[function(e,t,r){(function(r,n,i){"use strict";var o=e("process-nextick-args");function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}t.exports=v;var s,u=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?i:o.nextTick;v.WritableState=y;var c=e("core-util-is");c.inherits=e("inherits");var l={deprecate:e("util-deprecate")},f=e("./internal/streams/stream"),d=e("safe-buffer").Buffer,h=n.Uint8Array||function(){};var p,m=e("./internal/streams/destroy");function g(){}function y(t,r){s=s||e("./_stream_duplex"),t=t||{};var n=r instanceof s;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,c=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(c||0===c)?c:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===t.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(o.nextTick(i,n),o.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),T(e,t))}(e,r,n,t,i);else{var a=E(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?u(b,e,r,a,i):b(e,r,a,i)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function v(t){if(s=s||e("./_stream_duplex"),!(p.call(v,this)||this instanceof s))return new v(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),f.call(this)}function _(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function b(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var s=0,u=!0;r;)i[s]=r,r.isBuf||(u=!1),r=r.next,s+=1;i.allBuffers=u,_(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(_(e,t,!1,t.objectMode?1:c.length,c,l,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),T(e,t)})}function T(e,t){var r=E(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}c.inherits(v,f),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!p.call(this,e)||this===v&&(e&&e._writableState instanceof y)}})):p=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,r){var n,i=this._writableState,a=!1,s=!i.objectMode&&(n=e,d.isBuffer(n)||n instanceof h);return s&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=g),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),o.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),o.nextTick(n,a),i=!1),i}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,s,n,i,o);return u}(this,i,s,e,t,r)),a},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,T(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":108,"./internal/streams/destroy":114,"./internal/streams/stream":115,_process:98,"core-util-is":39,inherits:60,"process-nextick-args":97,"safe-buffer":128,timers:148,"util-deprecate":159}],113:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,i=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=o,i=s,t.copy(r,i),s+=a.data.length,a=a.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":128,util:26}],114:[function(e,t,r){"use strict";var n=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return o||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":97}],115:[function(e,t,r){t.exports=e("events").EventEmitter},{events:51}],116:[function(e,t,r){t.exports=e("./readable").PassThrough},{"./readable":117}],117:[function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":108,"./lib/_stream_passthrough.js":109,"./lib/_stream_readable.js":110,"./lib/_stream_transform.js":111,"./lib/_stream_writable.js":112}],118:[function(e,t,r){t.exports=e("./readable").Transform},{"./readable":117}],119:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":112}],120:[function(e,t,r){r.render=function(e,t,r,n){"function"==typeof r&&(n=r,r={});r||(r={});n||(n=function(){});_(e),b(r),"string"==typeof t&&(t=document.querySelector(t));y(e,function(r){if(t.nodeName!==r.toUpperCase()){var n=a.extname(e.name).toLowerCase();throw new Error('Cannot render "'+n+'" inside a "'+t.nodeName.toLowerCase()+'" element, expected "'+r+'"')}return t},r,n)},r.append=function(e,t,r,n){"function"==typeof r&&(n=r,r={});r||(r={});n||(n=function(){});_(e),b(r),"string"==typeof t&&(t=document.querySelector(t));if(t&&("VIDEO"===t.nodeName||"AUDIO"===t.nodeName))throw new Error("Invalid video/audio node argument. Argument must be root element that video/audio tag will be appended to.");function i(e){var r=document.createElement(e);return t.appendChild(r),r}y(e,function(e){return"video"===e||"audio"===e?function(e){var n=i(e);r.autoplay&&(n.autoplay=!0);r.muted&&(n.muted=!0);r.controls&&(n.controls=!0);return t.appendChild(n),n}(e):i(e)},r,function(e,t){e&&t&&t.remove();n(e,t)})},r.mime=e("./lib/mime.json");var n=e("debug")("render-media"),i=e("is-ascii"),o=e("mediasource"),a=e("path"),s=e("stream-to-blob-url"),u=e("videostream"),c=[".m4a",".m4v",".mp4"],l=[".m4v",".mkv",".mp4",".webm"],f=[].concat(l,[".m4a",".mp3"]),d=[".aac",".oga",".ogg",".wav",".flac"],h=[".bmp",".gif",".jpeg",".jpg",".png",".svg"],p=[".css",".html",".js",".md",".pdf",".txt"],m=2e8,g="undefined"!=typeof window&&window.MediaSource;function y(e,t,r,s){var m,y=a.extname(e.name).toLowerCase(),_=0;function b(){m.removeEventListener("loadstart",b),r.autoplay&&m.play()}function w(){m.removeEventListener("canplay",w),s(null,m)}function E(){v(e,function(e,r){if(e)return S(e);".pdf"!==y?((m=t("iframe")).sandbox="allow-forms allow-scripts",m.src=r):((m=t("object")).setAttribute("typemustmatch",!0),m.setAttribute("type","application/pdf"),m.setAttribute("data",r)),s(null,m)})}function S(t){t.message='Error rendering file "'+e.name+'": '+t.message,n(t.message),s(t)}f.indexOf(y)>=0?function(){var i=l.indexOf(y)>=0?"video":"audio";g?c.indexOf(y)>=0?(n("Use `videostream` package for "+e.name),p(),m.addEventListener("error",d),m.addEventListener("loadstart",b),m.addEventListener("canplay",w),u(e,m)):s():f();function s(){n("Use MediaSource API for "+e.name),p(),m.addEventListener("error",h),m.addEventListener("loadstart",b),m.addEventListener("canplay",w);var t,r=new o(m),i=r.createWriteStream((t=e.name,{".m4a":'audio/mp4; codecs="mp4a.40.5"',".m4v":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".mkv":'video/webm; codecs="avc1.640029, mp4a.40.5"',".mp3":"audio/mpeg",".mp4":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".webm":'video/webm; codecs="vorbis, vp8"'}[a.extname(t).toLowerCase()]));e.createReadStream().pipe(i),_&&(m.currentTime=_)}function f(){n("Use Blob URL for "+e.name),p(),m.addEventListener("error",S),m.addEventListener("loadstart",b),m.addEventListener("canplay",w),v(e,function(e,t){if(e)return S(e);m.src=t,_&&(m.currentTime=_)})}function d(e){n("videostream error: fallback to MediaSource API: %o",e.message||e),m.removeEventListener("error",d),m.removeEventListener("canplay",w),s()}function h(t){if(n("MediaSource API error: fallback to Blob URL: %o",t.message||t),"number"==typeof e.length&&e.length>r.maxBlobLength)return n("File length too large for Blob URL approach: %d (max: %d)",e.length,r.maxBlobLength),S(new Error("File length too large for Blob URL approach: "+e.length+" (max: "+r.maxBlobLength+")"));m.removeEventListener("error",h),m.removeEventListener("canplay",w),f()}function p(){m||(m=t(i)).addEventListener("progress",function(){_=m.currentTime})}}():d.indexOf(y)>=0?(m=t("audio"),v(e,function(e,t){if(e)return S(e);m.addEventListener("error",S),m.addEventListener("loadstart",b),m.addEventListener("canplay",w),m.src=t})):h.indexOf(y)>=0?(m=t("img"),v(e,function(t,r){if(t)return S(t);m.src=r,m.alt=e.name,s(null,m)})):p.indexOf(y)>=0?E():function(){n('Unknown file extension "%s" - will attempt to render into iframe',y);var t="";e.createReadStream({start:0,end:1e3}).setEncoding("utf8").on("data",function(e){t+=e}).on("end",function(){i(t)?(n('File extension "%s" appears ascii, so will render.',y),E()):(n('File extension "%s" appears non-ascii, will not render.',y),s(new Error('Unsupported file type "'+y+'": Cannot append to DOM')))}).on("error",s)}()}function v(e,t){var n=a.extname(e.name).toLowerCase();s(e.createReadStream(),r.mime[n],t)}function _(e){if(null==e)throw new Error("file cannot be null or undefined");if("string"!=typeof e.name)throw new Error("missing or invalid file.name property");if("function"!=typeof e.createReadStream)throw new Error("missing or invalid file.createReadStream property")}function b(e){null==e.autoplay&&(e.autoplay=!1),null==e.muted&&(e.muted=!1),null==e.controls&&(e.controls=!0),null==e.maxBlobLength&&(e.maxBlobLength=m)}},{"./lib/mime.json":121,debug:41,"is-ascii":61,mediasource:69,path:94,"stream-to-blob-url":140,videostream:165}],121:[function(e,t,r){t.exports={".3gp":"video/3gpp",".aac":"audio/aac",".aif":"audio/x-aiff",".aiff":"audio/x-aiff",".atom":"application/atom+xml",".avi":"video/x-msvideo",".bmp":"image/bmp",".bz2":"application/x-bzip2",".conf":"text/plain",".css":"text/css",".csv":"text/plain",".diff":"text/x-diff",".doc":"application/msword",".flv":"video/x-flv",".gif":"image/gif",".gz":"application/x-gzip",".htm":"text/html",".html":"text/html",".ico":"image/vnd.microsoft.icon",".ics":"text/calendar",".iso":"application/octet-stream",".jar":"application/java-archive",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/javascript",".json":"application/json",".less":"text/css",".log":"text/plain",".m3u":"audio/x-mpegurl",".m4a":"audio/mp4",".m4v":"video/mp4",".manifest":"text/cache-manifest",".markdown":"text/x-markdown",".mathml":"application/mathml+xml",".md":"text/x-markdown",".mid":"audio/midi",".midi":"audio/midi",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mp4v":"video/mp4",".mpeg":"video/mpeg",".mpg":"video/mpeg",".odp":"application/vnd.oasis.opendocument.presentation",".ods":"application/vnd.oasis.opendocument.spreadsheet",".odt":"application/vnd.oasis.opendocument.text",".oga":"audio/ogg",".ogg":"application/ogg",".pdf":"application/pdf",".png":"image/png",".pps":"application/vnd.ms-powerpoint",".ppt":"application/vnd.ms-powerpoint",".ps":"application/postscript",".psd":"image/vnd.adobe.photoshop",".qt":"video/quicktime",".rar":"application/x-rar-compressed",".rdf":"application/rdf+xml",".rss":"application/rss+xml",".rtf":"application/rtf",".svg":"image/svg+xml",".svgz":"image/svg+xml",".swf":"application/x-shockwave-flash",".tar":"application/x-tar",".tbz":"application/x-bzip-compressed-tar",".text":"text/plain",".tif":"image/tiff",".tiff":"image/tiff",".torrent":"application/x-bittorrent",".ttf":"application/x-font-ttf",".txt":"text/plain",".wav":"audio/wav",".webm":"video/webm",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xml":"application/xml",".yaml":"text/yaml",".yml":"text/yaml",".zip":"application/zip"}},{}],122:[function(e,t,r){t.exports=e("./lib/retry")},{"./lib/retry":123}],123:[function(e,t,r){var n=e("./retry_operation");r.operation=function(e){var t=r.timeouts(e);return new n(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort(function(e,t){return e-t}),n},r.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},r.wrap=function(e,t,n){if(t instanceof Array&&(n=t,t=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var o=0;o<n.length;o++){var a=n[o],s=e[a];e[a]=function(n){var i=r.operation(t),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))}),i.attempt(function(){n.apply(e,o)})}.bind(e,s),e[a].options=t}}},{"./retry_operation":124}],124:[function(e,t,r){function n(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r);return this._options.unref&&i.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,a=(e[o]||0)+1;e[o]=a,a>=r&&(t=i,r=a)}return t}},{}],125:[function(e,t,r){(function(e){t.exports=function(t,r,n){if("number"!=typeof r)throw new Error("second argument must be a Number");var i,o,a,s,u,c=!0;Array.isArray(t)?(i=[],a=o=t.length):(s=Object.keys(t),i={},a=o=s.length);function l(t){function r(){n&&n(t,i),n=null}c?e.nextTick(r):r()}function f(e,r,n){if(i[e]=n,r&&(u=!0),0==--a||r)l(r);else if(!u&&d<o){var c;s?(c=s[d],d+=1,t[c](function(e,t){f(c,e,t)})):(c=d,d+=1,t[c](function(e,t){f(c,e,t)}))}}var d=r;a?s?s.some(function(e,n){if(t[e](function(t,r){f(e,t,r)}),n===r-1)return!0}):t.some(function(e,t){if(e(function(e,r){f(t,e,r)}),t===r-1)return!0}):l(null);c=!1}}).call(this,e("_process"))},{_process:98}],126:[function(e,t,r){(function(e){t.exports=function(t,r){var n,i,o,a=!0;Array.isArray(t)?(n=[],i=t.length):(o=Object.keys(t),n={},i=o.length);function s(t){function i(){r&&r(t,n),r=null}a?e.nextTick(i):i()}function u(e,t,r){n[e]=r,(0==--i||t)&&s(t)}i?o?o.forEach(function(e){t[e](function(t,r){u(e,t,r)})}):t.forEach(function(e,t){e(function(e,r){u(t,e,r)})}):s(null);a=!1}}).call(this,e("_process"))},{_process:98}],127:[function(e,t,r){var n,i;n="undefined"!=typeof self?self:this,i=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){var n=r(5),i=r(1),o=i.toHex,a=i.ceilHeapSize,s=r(6),u=function(e){for(e+=9;e%64>0;e+=1);return e},c=function(e,t){var r=new Int32Array(e,t+320,5),n=new Int32Array(5),i=new DataView(n.buffer);return i.setInt32(0,r[0],!1),i.setInt32(4,r[1],!1),i.setInt32(8,r[2],!1),i.setInt32(12,r[3],!1),i.setInt32(16,r[4],!1),n},l=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t=t||65536)%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=t,this._padMaxChunkLen=u(t),this._heap=new ArrayBuffer(a(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new n({Int32Array:Int32Array},{},this._heap)}return e.prototype._initState=function(e,t){this._offset=0;var r=new Int32Array(e,t+320,5);r[0]=1732584193,r[1]=-271733879,r[2]=-1732584194,r[3]=271733878,r[4]=-1009589776},e.prototype._padChunk=function(e,t){var r=u(e),n=new Int32Array(this._heap,0,r>>2);return function(e,t){var r=new Uint8Array(e.buffer),n=t%4,i=t-n;switch(n){case 0:r[i+3]=0;case 1:r[i+2]=0;case 2:r[i+1]=0;case 3:r[i+0]=0}for(var o=1+(t>>2);o<e.length;o++)e[o]=0}(n,e),function(e,t,r){e[t>>2]|=128<<24-(t%4<<3),e[14+(2+(t>>2)&-16)]=r/(1<<29)|0,e[15+(2+(t>>2)&-16)]=r<<3}(n,e,t),r},e.prototype._write=function(e,t,r,n){s(e,this._h8,this._h32,t,r,n||0)},e.prototype._coreCall=function(e,t,r,n,i){var o=r;this._write(e,t,r),i&&(o=this._padChunk(r,n)),this._core.hash(o,this._padMaxChunkLen)},e.prototype.rawDigest=function(e){var t=e.byteLength||e.length||e.size||0;this._initState(this._heap,this._padMaxChunkLen);var r=0,n=this._maxChunkLen;for(r=0;t>r+n;r+=n)this._coreCall(e,r,n,t,!1);return this._coreCall(e,r,t-r,t,!0),c(this._heap,this._padMaxChunkLen)},e.prototype.digest=function(e){return o(this.rawDigest(e).buffer)},e.prototype.digestFromString=function(e){return this.digest(e)},e.prototype.digestFromBuffer=function(e){return this.digest(e)},e.prototype.digestFromArrayBuffer=function(e){return this.digest(e)},e.prototype.resetState=function(){return this._initState(this._heap,this._padMaxChunkLen),this},e.prototype.append=function(e){var t=0,r=e.byteLength||e.length||e.size||0,n=this._offset%this._maxChunkLen,i=void 0;for(this._offset+=r;t<r;)i=Math.min(r-t,this._maxChunkLen-n),this._write(e,t,i,n),t+=i,(n+=i)===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),n=0);return this},e.prototype.getState=function(){var e=void 0;if(this._offset%this._maxChunkLen)e=this._heap.slice(0);else{var t=new Int32Array(this._heap,this._padMaxChunkLen+320,5);e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}return{offset:this._offset,heap:e}},e.prototype.setState=function(e){(this._offset=e.offset,20===e.heap.byteLength)?new Int32Array(this._heap,this._padMaxChunkLen+320,5).set(new Int32Array(e.heap)):this._h32.set(new Int32Array(e.heap));return this},e.prototype.rawEnd=function(){var e=this._offset,t=e%this._maxChunkLen,r=this._padChunk(t,e);this._core.hash(r,this._padMaxChunkLen);var n=c(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),n},e.prototype.end=function(){return o(this.rawEnd().buffer)},e}();e.exports=l,e.exports._core=n},function(e,t){for(var r=new Array(256),n=0;n<256;n++)r[n]=(n<16?"0":"")+n.toString(16);e.exports.toHex=function(e){for(var t=new Uint8Array(e),n=new Array(e.byteLength),i=0;i<n.length;i++)n[i]=r[t[i]];return n.join("")},e.exports.ceilHeapSize=function(e){var t=0;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t},e.exports.isDedicatedWorkerScope=function(e){var t="WorkerGlobalScope"in e&&e instanceof e.WorkerGlobalScope,r="SharedWorkerGlobalScope"in e&&e instanceof e.SharedWorkerGlobalScope,n="ServiceWorkerGlobalScope"in e&&e instanceof e.ServiceWorkerGlobalScope;return t&&!r&&!n}},function(e,t,r){e.exports=function(){var e=r(0),t=function(e,r,n,i,o){var a=new self.FileReader;a.onloadend=function(){if(a.error)return o(a.error);var s=a.result;r+=a.result.byteLength;try{e.append(s)}catch(e){return void o(e)}r<i.size?t(e,r,n,i,o):o(null,e.end())},a.readAsArrayBuffer(i.slice(r,r+n))},n=!0;return self.onmessage=function(r){if(n){var i=r.data.data,o=r.data.file,a=r.data.id;if(void 0!==a&&(o||i)){var s=r.data.blockSize||4194304,u=new e(s);u.resetState();var c=function(e,t){e?self.postMessage({id:a,error:e.name}):self.postMessage({id:a,hash:t})};i&&function(e,t,r){try{r(null,e.digest(t))}catch(e){return r(e)}}(u,i,c),o&&t(u,0,s,o,c)}}},function(){n=!1}}},function(e,t,r){var n=r(4),i=r(0),o=r(7),a=r(2),s=r(1).isDedicatedWorkerScope,u="undefined"!=typeof self&&s(self);i.disableWorkerBehaviour=u?a():function(){},i.createWorker=function(){var e=n(2),t=e.terminate;return e.terminate=function(){URL.revokeObjectURL(e.objectURL),t.call(e)},e},i.createHash=o,e.exports=i},function(e,t,r){function n(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\((/\\*.*?\\*/)?s?.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,n){var s={};s[n]=[];var u=t.toString(),c=u.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return s;for(var l,f=c[1],d=new RegExp("(\\\\n|\\W)"+a(f)+o,"g");l=d.exec(u);)"dll-reference"!==l[3]&&s[n].push(l[3]);for(d=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");l=d.exec(u);)e[l[2]]||(s[n].push(l[1]),e[l[2]]=r(l[1]).m),s[l[2]]=s[l[2]]||[],s[l[2]].push(l[4]);return s}function u(e){return Object.keys(e).reduce(function(t,r){return t||e[r].length>0},!1)}e.exports=function(e,t){t=t||{};var i={main:r.m},o=t.all?{main:Object.keys(i)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};u(r);)for(var o=Object.keys(r),a=0;a<o.length;a++){var c=o[a],l=r[c].pop();if(i[c]=i[c]||{},!i[c][l]&&e[c][l]){i[c][l]=!0,n[c]=n[c]||[],n[c].push(l);for(var f=s(e,e[c][l],c),d=Object.keys(f),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(f[d[h]])}}return n}(i,e),a="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),a=a+"("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"})(self);";var c=new window.Blob([a],{type:"text/javascript"});if(t.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),f=new window.Worker(l);return f.objectURL=l,f}},function(e,t){e.exports=function(e,t,r){"use asm";var n=new e.Int32Array(r);function i(e,t){e=e|0;t=t|0;var r=0,i=0,o=0,a=0,s=0,u=0,c=0,l=0,f=0,d=0,h=0,p=0,m=0,g=0;o=n[t+320>>2]|0;s=n[t+324>>2]|0;c=n[t+328>>2]|0;f=n[t+332>>2]|0;h=n[t+336>>2]|0;for(r=0;(r|0)<(e|0);r=r+64|0){a=o;u=s;l=c;d=f;p=h;for(i=0;(i|0)<64;i=i+4|0){g=n[r+i>>2]|0;m=((o<<5|o>>>27)+(s&c|~s&f)|0)+((g+h|0)+1518500249|0)|0;h=f;f=c;c=s<<30|s>>>2;s=o;o=m;n[e+i>>2]=g}for(i=e+64|0;(i|0)<(e+80|0);i=i+4|0){g=(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])<<1|(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])>>>31;m=((o<<5|o>>>27)+(s&c|~s&f)|0)+((g+h|0)+1518500249|0)|0;h=f;f=c;c=s<<30|s>>>2;s=o;o=m;n[i>>2]=g}for(i=e+80|0;(i|0)<(e+160|0);i=i+4|0){g=(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])<<1|(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])>>>31;m=((o<<5|o>>>27)+(s^c^f)|0)+((g+h|0)+1859775393|0)|0;h=f;f=c;c=s<<30|s>>>2;s=o;o=m;n[i>>2]=g}for(i=e+160|0;(i|0)<(e+240|0);i=i+4|0){g=(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])<<1|(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])>>>31;m=((o<<5|o>>>27)+(s&c|s&f|c&f)|0)+((g+h|0)-1894007588|0)|0;h=f;f=c;c=s<<30|s>>>2;s=o;o=m;n[i>>2]=g}for(i=e+240|0;(i|0)<(e+320|0);i=i+4|0){g=(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])<<1|(n[i-12>>2]^n[i-32>>2]^n[i-56>>2]^n[i-64>>2])>>>31;m=((o<<5|o>>>27)+(s^c^f)|0)+((g+h|0)-899497514|0)|0;h=f;f=c;c=s<<30|s>>>2;s=o;o=m;n[i>>2]=g}o=o+a|0;s=s+u|0;c=c+l|0;f=f+d|0;h=h+p|0}n[t+320>>2]=o;n[t+324>>2]=s;n[t+328>>2]=c;n[t+332>>2]=f;n[t+336>>2]=h}return{hash:i}}},function(e,t){var r=this,n=void 0;"undefined"!=typeof self&&void 0!==self.FileReaderSync&&(n=new self.FileReaderSync);var i=function(e,t,r,n,i,o){var a=void 0,s=o%4,u=(i+s)%4,c=i-u;switch(s){case 0:t[o]=e[n+3];case 1:t[o+1-(s<<1)|0]=e[n+2];case 2:t[o+2-(s<<1)|0]=e[n+1];case 3:t[o+3-(s<<1)|0]=e[n]}if(!(i<u+(4-s))){for(a=4-s;a<c;a=a+4|0)r[o+a>>2|0]=e[n+a]<<24|e[n+a+1]<<16|e[n+a+2]<<8|e[n+a+3];switch(u){case 3:t[o+c+1|0]=e[n+c+2];case 2:t[o+c+2|0]=e[n+c+1];case 1:t[o+c+3|0]=e[n+c]}}};e.exports=function(e,t,o,a,s,u){if("string"==typeof e)return function(e,t,r,n,i,o){var a=void 0,s=o%4,u=(i+s)%4,c=i-u;switch(s){case 0:t[o]=e.charCodeAt(n+3);case 1:t[o+1-(s<<1)|0]=e.charCodeAt(n+2);case 2:t[o+2-(s<<1)|0]=e.charCodeAt(n+1);case 3:t[o+3-(s<<1)|0]=e.charCodeAt(n)}if(!(i<u+(4-s))){for(a=4-s;a<c;a=a+4|0)r[o+a>>2]=e.charCodeAt(n+a)<<24|e.charCodeAt(n+a+1)<<16|e.charCodeAt(n+a+2)<<8|e.charCodeAt(n+a+3);switch(u){case 3:t[o+c+1|0]=e.charCodeAt(n+c+2);case 2:t[o+c+2|0]=e.charCodeAt(n+c+1);case 1:t[o+c+3|0]=e.charCodeAt(n+c)}}}(e,t,o,a,s,u);if(e instanceof Array)return i(e,t,o,a,s,u);if(r&&r.Buffer&&r.Buffer.isBuffer(e))return i(e,t,o,a,s,u);if(e instanceof ArrayBuffer)return i(new Uint8Array(e),t,o,a,s,u);if(e.buffer instanceof ArrayBuffer)return i(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),t,o,a,s,u);if(e instanceof Blob)return function(e,t,r,i,o,a){var s=void 0,u=a%4,c=(o+u)%4,l=o-c,f=new Uint8Array(n.readAsArrayBuffer(e.slice(i,i+o)));switch(u){case 0:t[a]=f[3];case 1:t[a+1-(u<<1)|0]=f[2];case 2:t[a+2-(u<<1)|0]=f[1];case 3:t[a+3-(u<<1)|0]=f[0]}if(!(o<c+(4-u))){for(s=4-u;s<l;s=s+4|0)r[a+s>>2|0]=f[s]<<24|f[s+1]<<16|f[s+2]<<8|f[s+3];switch(c){case 3:t[a+l+1|0]=f[l+2];case 2:t[a+l+2|0]=f[l+1];case 1:t[a+l+3|0]=f[l]}}}(e,t,o,a,s,u);throw new Error("Unsupported data type.")}},function(e,t,r){var n=r(0),i=r(1).toHex,o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._rusha=new n,this._rusha.resetState()}return e.prototype.update=function(e){return this._rusha.append(e),this},e.prototype.digest=function(e){var t=this._rusha.rawEnd().buffer;if(!e)return t;if("hex"===e)return i(t);throw new Error("unsupported digest encoding")},e}();e.exports=function(){return new o}}])},"object"==typeof r&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof r?r.Rusha=i():n.Rusha=i()},{}],128:[function(e,t,r){var n=e("buffer"),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,r),r.Buffer=a),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:34}],129:[function(e,t,r){(function(e){t.exports=function(t,r){var n=[];t.on("data",function(e){n.push(e)}),t.once("end",function(){r&&r(null,e.concat(n)),r=null}),t.once("error",function(e){r&&r(e),r=null})}}).call(this,e("buffer").Buffer)},{buffer:34}],130:[function(e,t,r){(function(r){t.exports=f;const n=e("simple-concat"),i=e("decompress-response"),o=e("http"),a=e("https"),s=e("once"),u=e("querystring"),c=e("url"),l=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;function f(e,t){if(e=Object.assign({maxRedirects:10},"string"==typeof e?{url:e}:e),t=s(t),e.url){const{hostname:t,port:r,protocol:n,auth:i,path:o}=c.parse(e.url);delete e.url,t||r||n||i?Object.assign(e,{hostname:t,port:r,protocol:n,auth:i,path:o}):e.path=o}const n={"accept-encoding":"gzip, deflate"};let d;e.headers&&Object.keys(e.headers).forEach(t=>n[t.toLowerCase()]=e.headers[t]),e.headers=n,e.body?d=e.json&&!l(e.body)?JSON.stringify(e.body):e.body:e.form&&(d="string"==typeof e.form?e.form:u.stringify(e.form),e.headers["content-type"]="application/x-www-form-urlencoded"),delete e.body,delete e.form,d&&(e.method||(e.method="POST"),l(d)||(e.headers["content-length"]=r.byteLength(d)),e.json&&(e.headers["content-type"]="application/json")),e.json&&(e.headers.accept="application/json"),e.method&&(e.method=e.method.toUpperCase());const h=("https:"===e.protocol?a:o).request(e,r=>{if(r.statusCode>=300&&r.statusCode<400&&r.headers.location)return e.url=r.headers.location,delete e.headers.host,r.resume(),"POST"===e.method&&[301,302].includes(r.statusCode)&&(e.method="GET",delete e.headers["content-length"],delete e.headers["content-type"]),0==e.maxRedirects--?t(new Error("too many redirects")):f(e,t);const n="function"==typeof i&&"HEAD"!==e.method;t(null,n?i(r):r)});return h.on("timeout",()=>{h.abort(),t(new Error("Request timed out"))}),h.on("error",t),l(d)?d.on("error",t).pipe(h):h.end(d),h}f.concat=((e,t)=>f(e,(r,i)=>{if(r)return t(r);n(i,(r,n)=>{if(r)return t(r);if(e.json)try{n=JSON.parse(n.toString())}catch(r){return t(r,i,n)}t(null,i,n)})})),["get","post","put","patch","head","delete"].forEach(e=>{f[e]=((t,r)=>("string"==typeof t&&(t={url:t}),f(Object.assign({method:e.toUpperCase()},t),r)))})}).call(this,e("buffer").Buffer)},{buffer:34,"decompress-response":26,http:136,https:57,once:81,querystring:103,"simple-concat":129,url:156}],131:[function(e,t,r){(function(r){t.exports=u;var n=e("debug")("simple-peer"),i=e("get-browser-rtc"),o=e("inherits"),a=e("randombytes"),s=e("readable-stream");function u(e){var t=this;if(!(t instanceof u))return new u(e);if(t._id=a(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),s.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||a(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||u.channelConfig,t.config=e.config||u.config,t.constraints=t._transformConstraints(e.constraints||u.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.reconnectTimer=e.reconnectTimer||!1,t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!t._wrtc)throw"undefined"==typeof window?c("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):c("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!1,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new WeakMap,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._reconnectTimeout=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},"addTrack"in t._pc&&(t.streams&&t.streams.forEach(function(e){t.addStream(e)}),t._pc.ontrack=function(e){t._onTrack(e)}),t.initiator&&t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function c(e,t){var r=new Error(e);return r.code=t,r}function l(){}o(u,s.Duplex),u.WEBRTC_SUPPORT=!!i(),u.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},u.constraints={},u.channelConfig={},Object.defineProperty(u.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),u.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},u.prototype.signal=function(e){var t=this;if(t.destroyed)throw c("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug("signal()"),e.renegotiate&&(t._debug("got request to renegotiate"),t._needsNegotiation()),e.candidate&&(t._pc.remoteDescription&&t._pc.remoteDescription.type?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())},function(e){t.destroy(c(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||t.destroy(c("signal() called with invalid signal data","ERR_SIGNALING"))},u.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),l,function(e){t.destroy(c(e,"ERR_ADD_ICE_CANDIDATE"))})}catch(e){t.destroy(c("error adding candidate: "+e.message,"ERR_ADD_ICE_CANDIDATE"))}},u.prototype.send=function(e){this._channel.send(e)},u.prototype.addStream=function(e){var t=this;t._debug("addStream()"),e.getTracks().forEach(function(r){t.addTrack(r,e)})},u.prototype.addTrack=function(e,t){this._debug("addTrack()");var r=this._pc.addTrack(e,t),n=this._senderMap.get(e)||new WeakMap;n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()},u.prototype.removeTrack=function(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;n||this.destroy(new Error("Cannot remove track that was never added."));try{this._pc.removeTrack(n)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(n):this.destroy(e)}},u.prototype.removeStream=function(e){var t=this;t._debug("removeSenders()"),e.getTracks().forEach(function(r){t.removeTrack(r,e)})},u.prototype._needsNegotiation=function(){var e=this;e._debug("_needsNegotiation"),e._batchedNegotiation||(e._batchedNegotiation=!0,setTimeout(function(){e._batchedNegotiation=!1,e._debug("starting batched negotiation"),e.negotiate()},0))},u.prototype.negotiate=function(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),this._createOffer()):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0},u.prototype.destroy=function(e){this._destroy(e,function(){})},u.prototype._destroy=function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._interval),clearTimeout(this._reconnectTimeout),this._interval=null,this._reconnectTimeout=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,"addTrack"in this._pc&&(this._pc.ontrack=null),this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}},u.prototype._setupData=function(e){var t=this;if(!e.channel)return t.destroy(c("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t.destroy(c(e,"ERR_DATA_CHANNEL"))}},u.prototype._read=function(){},u.prototype._write=function(e,t,r){if(this.destroyed)return r(c("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(this.connected){try{this.send(e)}catch(e){return this.destroy(c(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r},u.prototype._onFinish=function(){var e=this;function t(){setTimeout(function(){e.destroy()},1e3)}e.destroyed||(e.connected?t():e.once("connect",t))},u.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer(function(t){function r(){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){if(e._debug("createOffer success"),e.destroyed)return;e.trickle||e._iceComplete?r():e.once("_iceComplete",r)},function(t){e.destroy(c(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(c(t,"ERR_CREATE_OFFER"))},e.offerConstraints)},u.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer(function(t){function r(){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){if(e.destroyed)return;e.trickle||e._iceComplete?r():e.once("_iceComplete",r)},function(t){e.destroy(c(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(c(t,"ERR_CREATE_ANSWER"))},e.answerConstraints)},u.prototype._onIceStateChange=function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(clearTimeout(this._reconnectTimeout),this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(c("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(new Error("Ice connection closed."))}},u.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(t){var r=[];t.forEach(function(e){r.push(e)}),e(null,r)},function(t){e(t)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(t){var r=[];t.forEach(function(e){r.push(e)}),e(null,r)},function(t){e(t)}):t._pc.getStats.length>0?t._pc.getStats(function(r){if(!t.destroyed){var n=[];r.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),e(null,n)}},function(t){e(t)}):e(null,[])},u.prototype._maybeReady=function(){var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,function t(){e.destroyed||e.getStats(function(r,n){if(!e.destroyed){r&&(n=[]);var i={},o={},a={},s=!1;if(n.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(a[e.id]=e)}),n.forEach(function(e){"transport"===e.type&&e.selectedCandidatePairId&&l(a[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&l(e)}),s||Object.keys(a).length&&!Object.keys(o).length){if(e._connecting=!1,e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(r){return e.destroy(c(r,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var u=e._cb;e._cb=null,u(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval(function(){e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}function l(t){s=!0;var r=o[t.localCandidateId];r&&r.ip?(e.localAddress=r.ip,e.localPort=Number(r.port)):r&&r.ipAddress?(e.localAddress=r.ipAddress,e.localPort=Number(r.portNumber)):"string"==typeof t.googLocalAddress&&(r=t.googLocalAddress.split(":"),e.localAddress=r[0],e.localPort=Number(r[1]));var n=i[t.remoteCandidateId];n&&n.ip?(e.remoteAddress=n.ip,e.remotePort=Number(n.port)):n&&n.ipAddress?(e.remoteAddress=n.ipAddress,e.remotePort=Number(n.portNumber)):"string"==typeof t.googRemoteAddress&&(n=t.googRemoteAddress.split(":"),e.remoteAddress=n[0],e.remotePort=Number(n[1])),e.remoteFamily="IPv4",e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)}})}())},u.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},u.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||("stable"===e._pc.signalingState&&(e._isNegotiating=!1,e._debug("flushing sender queue",e._sendersAwaitingStable),e._sendersAwaitingStable.forEach(function(t){e.removeTrack(t),e._queuedNegotiation=!0}),e._sendersAwaitingStable=[],e._queuedNegotiation&&(e._debug("flushing negotiation queue"),e._queuedNegotiation=!1,e._needsNegotiation()),e._debug("negotiate"),e.emit("negotiate")),e._debug("signalingStateChange %s",e._pc.signalingState),e.emit("signalingStateChange",e._pc.signalingState))},u.prototype._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},u.prototype._onChannelMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=r.from(t)),this.push(t)}},u.prototype._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},u.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},u.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},u.prototype._onTrack=function(e){var t=this;t.destroyed||e.streams.forEach(function(r){t._debug("on track"),t.emit("track",e.track,r),t._remoteTracks.push({track:e.track,stream:r}),t._remoteStreams.some(function(e){return e.id===r.id})||(t._remoteStreams.push(r),setTimeout(function(){t.emit("stream",r)},0))})},u.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],n.apply(null,e)},u.prototype._transformConstraints=function(e){if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!this._isChromium){var t=Object.assign({},e.optional,e.mandatory);return void 0!==t.OfferToReceiveVideo&&(t.offerToReceiveVideo=t.OfferToReceiveVideo,delete t.OfferToReceiveVideo),void 0!==t.OfferToReceiveAudio&&(t.offerToReceiveAudio=t.OfferToReceiveAudio,delete t.OfferToReceiveAudio),t}return e.mandatory||e.optional||!this._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(this,e("buffer").Buffer)},{buffer:34,debug:41,"get-browser-rtc":55,inherits:60,randombytes:105,"readable-stream":117}],132:[function(e,t,r){var n=new(e("rusha")),i="undefined"!=typeof window?window:self,o=i.crypto||i.msCrypto||{},a=o.subtle||o.webkitSubtle;function s(e){return n.digest(e)}try{a.digest({name:"sha-1"},new Uint8Array).catch(function(){a=!1})}catch(e){a=!1}t.exports=function(e,t){a?("string"==typeof e&&(e=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}(e)),a.digest({name:"sha-1"},e).then(function(e){t(function(e){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n];r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")}(new Uint8Array(e)))},function(r){t(s(e))})):setTimeout(t,0,s(e))},t.exports.sync=s},{rusha:127}],133:[function(e,t,r){(function(r){t.exports=l;var n=e("safe-buffer").Buffer,i=e("debug")("simple-websocket"),o=e("inherits"),a=e("randombytes"),s=e("readable-stream"),u=e("ws"),c="function"!=typeof u?WebSocket:u;function l(e){var t=this;if(!(t instanceof l))return new l(e);if(e||(e={}),"string"==typeof e&&(e={url:e}),null==e.url&&null==e.socket)throw new Error("Missing required `url` or `socket` option");if(null!=e.url&&null!=e.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(t._id=a(4).toString("hex").slice(0,7),t._debug("new websocket: %o",e),e=Object.assign({allowHalfOpen:!1},e),s.Duplex.call(t,e),t.connected=!1,t.destroyed=!1,t._chunk=null,t._cb=null,t._interval=null,e.socket)t.url=e.socket.url,t._ws=e.socket;else{t.url=e.url;try{t._ws="function"==typeof u?new c(e.url,e):new c(e.url)}catch(e){return void r.nextTick(function(){t.destroy(e)})}}t._ws.binaryType="arraybuffer",t._ws.onopen=function(){t._onOpen()},t._ws.onmessage=function(e){t._onMessage(e)},t._ws.onclose=function(){t._onClose()},t._ws.onerror=function(){t.destroy(new Error("connection error to "+t.url))},t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}o(l,s.Duplex),l.WEBSOCKET_SUPPORT=!!c,l.prototype.send=function(e){this._ws.send(e)},l.prototype.destroy=function(e){this._destroy(e,function(){})},l.prototype._destroy=function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._ws){var r=this._ws,n=function(){r.onclose=null};if(r.readyState===c.CLOSED)n();else try{r.onclose=n,r.close()}catch(e){n()}r.onopen=null,r.onmessage=null,r.onerror=function(){}}if(this._ws=null,e){if("undefined"!=typeof DOMException&&e instanceof DOMException){var i=e.code;(e=new Error(e.message)).code=i}this.emit("error",e)}this.emit("close"),t()}},l.prototype._read=function(){},l.prototype._write=function(e,t,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(e){return this.destroy(e)}"function"!=typeof u&&this._ws.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r},l.prototype._onFinish=function(){var e=this;function t(){setTimeout(function(){e.destroy()},1e3)}e.destroyed||(e.connected?t():e.once("connect",t))},l.prototype._onMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=n.from(t)),this.push(t)}},l.prototype._onOpen=function(){var e=this;if(!e.connected&&!e.destroyed){if(e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(t){return e.destroy(t)}e._chunk=null,e._debug('sent chunk from "write before connect"');var t=e._cb;e._cb=null,t(null)}"function"!=typeof u&&(e._interval=setInterval(function(){e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}},l.prototype._onInterval=function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>65536)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},l.prototype._onClose=function(){this.destroyed||(this._debug("on close"),this.destroy())},l.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],i.apply(null,e)}}).call(this,e("_process"))},{_process:98,debug:41,inherits:60,randombytes:105,"readable-stream":117,"safe-buffer":128,ws:26}],134:[function(e,t,r){var n=1,i=setInterval(function(){n=n+1&65535},250);i.unref&&i.unref(),t.exports=function(e){var t=4*(e||5),r=[0],i=1,o=n-1&65535;return function(e){var a=n-o&65535;for(a>t&&(a=t),o=n;a--;)i===t&&(i=0),r[i]=r[0===i?t-1:i-1],i++;e&&(r[i-1]+=e);var s=r[i-1],u=r.length<t?0:r[i===t?0:i];return r.length<4?s:4*(s-u)/r.length}}},{}],135:[function(e,t,r){t.exports=i;var n=e("events").EventEmitter;function i(){n.call(this)}e("inherits")(i,n),i.Readable=e("readable-stream/readable.js"),i.Writable=e("readable-stream/writable.js"),i.Duplex=e("readable-stream/duplex.js"),i.Transform=e("readable-stream/transform.js"),i.PassThrough=e("readable-stream/passthrough.js"),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",u));var a=!1;function s(){a||(a=!0,e.end())}function u(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",s),r.removeListener("close",u),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",l),r.removeListener("close",l),e.removeListener("close",l)}return r.on("error",c),e.on("error",c),r.on("end",l),r.on("close",l),e.on("close",l),e.emit("pipe",r),e}},{events:51,inherits:60,"readable-stream/duplex.js":107,"readable-stream/passthrough.js":116,"readable-stream/readable.js":117,"readable-stream/transform.js":118,"readable-stream/writable.js":119}],136:[function(e,t,r){(function(t){var n=e("./lib/request"),i=e("./lib/response"),o=e("xtend"),a=e("builtin-status-codes"),s=e("url"),u=r;u.request=function(e,r){e="string"==typeof e?s.parse(e):o(e);var i=-1===t.location.protocol.search(/^https?:$/)?"http:":"",a=e.protocol||i,u=e.hostname||e.host,c=e.port,l=e.path||"/";u&&-1!==u.indexOf(":")&&(u="["+u+"]"),e.url=(u?a+"//"+u:"")+(c?":"+c:"")+l,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var f=new n(e);return r&&f.on("response",r),f},u.get=function(e,t){var r=u.request(e,t);return r.end(),r},u.ClientRequest=n,u.IncomingMessage=i.IncomingMessage,u.Agent=function(){},u.Agent.defaultMaxSockets=4,u.globalAgent=new u.Agent,u.STATUS_CODES=a,u.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":138,"./lib/response":139,"builtin-status-codes":35,url:156,xtend:177}],137:[function(e,t,r){(function(e){r.fetch=s(e.fetch)&&s(e.ReadableStream),r.writableStream=s(e.WritableStream),r.abortController=s(e.AbortController),r.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),r.blobConstructor=!0}catch(e){}var t;function n(){if(void 0!==t)return t;if(e.XMLHttpRequest){t=new e.XMLHttpRequest;try{t.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){t=null}}else t=null;return t}function i(e){var t=n();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}var o=void 0!==e.ArrayBuffer,a=o&&s(e.ArrayBuffer.prototype.slice);function s(e){return"function"==typeof e}r.arraybuffer=r.fetch||o&&i("arraybuffer"),r.msstream=!r.fetch&&a&&i("ms-stream"),r.mozchunkedarraybuffer=!r.fetch&&o&&i("moz-chunked-arraybuffer"),r.overrideMimeType=r.fetch||!!n()&&s(n().overrideMimeType),r.vbArray=s(e.VBArray),t=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],138:[function(e,t,r){(function(r,n,i){var o=e("./capability"),a=e("inherits"),s=e("./response"),u=e("readable-stream"),c=e("to-arraybuffer"),l=s.IncomingMessage,f=s.readyStates;var d=t.exports=function(e){var t,r=this;u.Writable.call(r),r._opts=e,r._body=[],r._headers={},e.auth&&r.setHeader("Authorization","Basic "+new i(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(t){r.setHeader(t,e.headers[t])});var n=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!o.abortController)n=!1,t=!0;else if("prefer-streaming"===e.mode)t=!1;else if("allow-wrong-content-type"===e.mode)t=!o.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");t=!0}r._mode=function(e,t){return o.fetch&&t?"fetch":o.mozchunkedarraybuffer?"moz-chunked-arraybuffer":o.msstream?"ms-stream":o.arraybuffer&&e?"arraybuffer":o.vbArray&&e?"text:vbarray":"text"}(t,n),r._fetchTimer=null,r.on("finish",function(){r._onFinish()})};a(d,u.Writable),d.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===h.indexOf(r)&&(this._headers[r]={name:e,value:t})},d.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},d.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},d.prototype._onFinish=function(){var e=this;if(!e._destroyed){var t=e._opts,a=e._headers,s=null;"GET"!==t.method&&"HEAD"!==t.method&&(s=o.arraybuffer?c(i.concat(e._body)):o.blobConstructor?new n.Blob(e._body.map(function(e){return c(e)}),{type:(a["content-type"]||{}).value||""}):i.concat(e._body).toString());var u=[];if(Object.keys(a).forEach(function(e){var t=a[e].name,r=a[e].value;Array.isArray(r)?r.forEach(function(e){u.push([t,e])}):u.push([t,r])}),"fetch"===e._mode){var l=null;if(o.abortController){var d=new AbortController;l=d.signal,e._fetchAbortController=d,"requestTimeout"in t&&0!==t.requestTimeout&&(e._fetchTimer=n.setTimeout(function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()},t.requestTimeout))}n.fetch(e._opts.url,{method:e._opts.method,headers:u,body:s||void 0,mode:"cors",credentials:t.withCredentials?"include":"same-origin",signal:l}).then(function(t){e._fetchResponse=t,e._connect()},function(t){n.clearTimeout(e._fetchTimer),e._destroyed||e.emit("error",t)})}else{var h=e._xhr=new n.XMLHttpRequest;try{h.open(e._opts.method,e._opts.url,!0)}catch(t){return void r.nextTick(function(){e.emit("error",t)})}"responseType"in h&&(h.responseType=e._mode.split(":")[0]),"withCredentials"in h&&(h.withCredentials=!!t.withCredentials),"text"===e._mode&&"overrideMimeType"in h&&h.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in t&&(h.timeout=t.requestTimeout,h.ontimeout=function(){e.emit("requestTimeout")}),u.forEach(function(e){h.setRequestHeader(e[0],e[1])}),e._response=null,h.onreadystatechange=function(){switch(h.readyState){case f.LOADING:case f.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(h.onprogress=function(){e._onXHRProgress()}),h.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{h.send(s)}catch(t){return void r.nextTick(function(){e.emit("error",t)})}}}},d.prototype._onXHRProgress=function(){(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},d.prototype._connect=function(){var e=this;e._destroyed||(e._response=new l(e._xhr,e._fetchResponse,e._mode,e._fetchTimer),e._response.on("error",function(t){e.emit("error",t)}),e.emit("response",e._response))},d.prototype._write=function(e,t,r){this._body.push(e),r()},d.prototype.abort=d.prototype.destroy=function(){this._destroyed=!0,n.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},d.prototype.end=function(e,t,r){"function"==typeof e&&(r=e,e=void 0),u.Writable.prototype.end.call(this,e,t,r)},d.prototype.flushHeaders=function(){},d.prototype.setTimeout=function(){},d.prototype.setNoDelay=function(){},d.prototype.setSocketKeepAlive=function(){};var h=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":137,"./response":139,_process:98,buffer:34,inherits:60,"readable-stream":117,"to-arraybuffer":149}],139:[function(e,t,r){(function(t,n,i){var o=e("./capability"),a=e("inherits"),s=e("readable-stream"),u=r.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},c=r.IncomingMessage=function(e,r,a,u){var c=this;if(s.Readable.call(c),c._mode=a,c.headers={},c.rawHeaders=[],c.trailers={},c.rawTrailers=[],c.on("end",function(){t.nextTick(function(){c.emit("close")})}),"fetch"===a){if(c._fetchResponse=r,c.url=r.url,c.statusCode=r.status,c.statusMessage=r.statusText,r.headers.forEach(function(e,t){c.headers[t.toLowerCase()]=e,c.rawHeaders.push(t,e)}),o.writableStream){var l=new WritableStream({write:function(e){return new Promise(function(t,r){c._destroyed?r():c.push(new i(e))?t():c._resumeFetch=t})},close:function(){n.clearTimeout(u),c._destroyed||c.push(null)},abort:function(e){c._destroyed||c.emit("error",e)}});try{return void r.body.pipeTo(l).catch(function(e){n.clearTimeout(u),c._destroyed||c.emit("error",e)})}catch(e){}}var f=r.body.getReader();!function e(){f.read().then(function(t){if(!c._destroyed){if(t.done)return n.clearTimeout(u),void c.push(null);c.push(new i(t.value)),e()}}).catch(function(e){n.clearTimeout(u),c._destroyed||c.emit("error",e)})}()}else{if(c._xhr=e,c._pos=0,c.url=e.responseURL,c.statusCode=e.status,c.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var r=t[1].toLowerCase();"set-cookie"===r?(void 0===c.headers[r]&&(c.headers[r]=[]),c.headers[r].push(t[2])):void 0!==c.headers[r]?c.headers[r]+=", "+t[2]:c.headers[r]=t[2],c.rawHeaders.push(t[1],t[2])}}),c._charset="x-user-defined",!o.overrideMimeType){var d=c.rawHeaders["mime-type"];if(d){var h=d.match(/;\s*charset=([^;])(;|$)/);h&&(c._charset=h[1].toLowerCase())}c._charset||(c._charset="utf-8")}}};a(c,s.Readable),c.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},c.prototype._onXHRProgress=function(){var e=this,t=e._xhr,r=null;switch(e._mode){case"text:vbarray":if(t.readyState!==u.DONE)break;try{r=new n.VBArray(t.responseBody).toArray()}catch(e){}if(null!==r){e.push(new i(r));break}case"text":try{r=t.responseText}catch(t){e._mode="text:vbarray";break}if(r.length>e._pos){var o=r.substr(e._pos);if("x-user-defined"===e._charset){for(var a=new i(o.length),s=0;s<o.length;s++)a[s]=255&o.charCodeAt(s);e.push(a)}else e.push(o,e._charset);e._pos=r.length}break;case"arraybuffer":if(t.readyState!==u.DONE||!t.response)break;r=t.response,e.push(new i(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=t.response,t.readyState!==u.LOADING||!r)break;e.push(new i(new Uint8Array(r)));break;case"ms-stream":if(r=t.response,t.readyState!==u.LOADING)break;var c=new n.MSStreamReader;c.onprogress=function(){c.result.byteLength>e._pos&&(e.push(new i(new Uint8Array(c.result.slice(e._pos)))),e._pos=c.result.byteLength)},c.onload=function(){e.push(null)},c.readAsArrayBuffer(r)}e._xhr.readyState===u.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":137,_process:98,buffer:34,inherits:60,"readable-stream":117}],140:[function(e,t,r){var n=e("stream-to-blob");t.exports=function e(t,r,i){if("function"==typeof r)return e(t,null,r);n(t,r,function(e,t){if(e)return i(e);var r=URL.createObjectURL(t);i(null,r)})}},{"stream-to-blob":141}],141:[function(e,t,r){var n=e("once");t.exports=function e(t,r,i){if("function"==typeof r)return e(t,null,r);i=n(i);var o=[];t.on("data",function(e){o.push(e)}).on("end",function(){var e=r?new Blob(o,{type:r}):new Blob(o);i(null,e)}).on("error",i)}},{once:81}],142:[function(e,t,r){(function(r){var n=e("once");t.exports=function(e,t,i){i=n(i);var o=r.alloc(t),a=0;e.on("data",function(e){e.copy(o,a),a+=e.length}).on("end",function(){i(null,o)}).on("error",i)}}).call(this,e("buffer").Buffer)},{buffer:34,once:81}],143:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=f,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}r.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":128}],144:[function(e,t,r){var n=e("./thirty-two");r.encode=n.encode,r.decode=n.decode},{"./thirty-two":145}],145:[function(e,t,r){(function(e){"use strict";var t=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];r.encode=function(t){e.isBuffer(t)||(t=new e(t));for(var r,n,i=0,o=0,a=0,s=0,u=new e(8*(r=t,n=Math.floor(r.length/5),r.length%5==0?n:n+1));i<t.length;){var c=t[i];a>3?(s=(s=c&255>>a)<<(a=(a+5)%8)|(i+1<t.length?t[i+1]:0)>>8-a,i++):(s=c>>8-(a+5)&31,0===(a=(a+5)%8)&&i++),u[o]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(s),o++}for(i=o;i<u.length;i++)u[i]=61;return u},r.decode=function(r){var n,i=0,o=0,a=0;e.isBuffer(r)||(r=new e(r));for(var s=new e(Math.ceil(5*r.length/8)),u=0;u<r.length&&61!==r[u];u++){var c=r[u]-48;if(!(c<t.length))throw new Error("Invalid input - it is not base32 encoded string");o=t[c],i<=3?0===(i=(i+5)%8)?(n|=o,s[a]=n,a++,n=0):n|=255&o<<8-i:(n|=255&o>>>(i=(i+5)%8),s[a]=n,a++,n=255&o<<8-i)}return s.slice(0,a)}}).call(this,e("buffer").Buffer)},{buffer:34}],146:[function(e,t,r){t.exports=function(e,t){var r,n,i,o,a=0;return function(){r=this,n=arguments;var e=new Date-a;return o||(e>=t?s():o=setTimeout(s,t-e)),i};function s(){o=0,a=+new Date,i=e.apply(r,n),r=null,n=null}}},{}],147:[function(e,t,r){(function(e){"use strict";var r=function(t,r,n){e.nextTick(function(){t(r,n)})};function n(){}function i(e,t){e.apply(null,t)}e.nextTick(function(t){42===t&&(r=e.nextTick)},42),t.exports=function(e){var t=function(n){var a=[n];t=function(e){a.push(e)};e(function(e){var n=arguments;t=function(e){return"[object Error]"===Object.prototype.toString.call(e)}(e)?o:s;for(;a.length;)s(a.shift());function s(e){r(i,e,n)}})};return function(e){t(e||n)};function o(n){var a=[n];t=function(e){a.push(e)},e(function(e){var n=arguments;t=function(e){return"[object Error]"===Object.prototype.toString.call(e)}(e)?o:s;for(;a.length;)s(a.shift());function s(e){r(i,e,n)}})}}}).call(this,e("_process"))},{_process:98}],148:[function(e,t,r){(function(t,n){var i=e("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,s={},u=0;function c(e,t){this._id=e,this._clearFn=t}r.setTimeout=function(){return new c(o.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new c(o.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r.setImmediate="function"==typeof t?t:function(e){var t=u++,n=!(arguments.length<2)&&a.call(arguments,1);return s[t]=!0,i(function(){s[t]&&(n?e.apply(null,n):e.call(null),r.clearImmediate(t))}),t},r.clearImmediate="function"==typeof n?n:function(e){delete s[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":98,timers:148}],149:[function(e,t,r){var n=e("buffer").Buffer;t.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(n.isBuffer(e)){for(var t=new Uint8Array(e.length),r=e.length,i=0;i<r;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},{buffer:34}],150:[function(e,t,r){(function(r){t.exports=l;var n=e("debug")("torrent-discovery"),i=e("bittorrent-dht/client"),o=e("events").EventEmitter,a=e("xtend"),s=e("inherits"),u=e("run-parallel"),c=e("bittorrent-tracker/client");function l(e){var t=this;if(!(t instanceof l))return new l(e);if(o.call(t),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!r.browser&&!e.port)throw new Error("Option `port` is required");function n(e,r){var n=new i(r);return n.on("warning",t._onWarning),n.on("error",t._onError),n.listen(e),t._internalDHT=!0,n}t.peerId="string"==typeof e.peerId?e.peerId:e.peerId.toString("hex"),t.infoHash="string"==typeof e.infoHash?e.infoHash.toLowerCase():e.infoHash.toString("hex"),t._port=e.port,t._userAgent=e.userAgent,t.destroyed=!1,t._announce=e.announce||[],t._intervalMs=e.intervalMs||9e5,t._trackerOpts=null,t._dhtAnnouncing=!1,t._dhtTimeout=!1,t._internalDHT=!1,t._onWarning=function(e){t.emit("warning",e)},t._onError=function(e){t.emit("error",e)},t._onDHTPeer=function(e,r){r.toString("hex")===t.infoHash&&t.emit("peer",e.host+":"+e.port,"dht")},t._onTrackerPeer=function(e){t.emit("peer",e,"tracker")},t._onTrackerAnnounce=function(){t.emit("trackerAnnounce")},!1===e.tracker?t.tracker=null:e.tracker&&"object"==typeof e.tracker?(t._trackerOpts=a(e.tracker),t.tracker=t._createTracker()):t.tracker=t._createTracker(),!1===e.dht||"function"!=typeof i?t.dht=null:e.dht&&"function"==typeof e.dht.addNode?t.dht=e.dht:e.dht&&"object"==typeof e.dht?t.dht=n(e.dhtPort,e.dht):t.dht=n(e.dhtPort),t.dht&&(t.dht.on("peer",t._onDHTPeer),t._dhtAnnounce())}s(l,o),l.prototype.updatePort=function(e){var t=this;e!==t._port&&(t._port=e,t.dht&&t._dhtAnnounce(),t.tracker&&(t.tracker.stop(),t.tracker.destroy(function(){t.tracker=t._createTracker()})))},l.prototype.complete=function(e){this.tracker&&this.tracker.complete(e)},l.prototype.destroy=function(e){var t=this;if(!t.destroyed){t.destroyed=!0,clearTimeout(t._dhtTimeout);var r=[];t.tracker&&(t.tracker.stop(),t.tracker.removeListener("warning",t._onWarning),t.tracker.removeListener("error",t._onError),t.tracker.removeListener("peer",t._onTrackerPeer),t.tracker.removeListener("update",t._onTrackerAnnounce),r.push(function(e){t.tracker.destroy(e)})),t.dht&&t.dht.removeListener("peer",t._onDHTPeer),t._internalDHT&&(t.dht.removeListener("warning",t._onWarning),t.dht.removeListener("error",t._onError),r.push(function(e){t.dht.destroy(e)})),u(r,e),t.dht=null,t.tracker=null,t._announce=null}},l.prototype._createTracker=function(){var e=a(this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent}),t=new c(e);return t.on("warning",this._onWarning),t.on("error",this._onError),t.on("peer",this._onTrackerPeer),t.on("update",this._onTrackerAnnounce),t.setInterval(this._intervalMs),t.start(),t},l.prototype._dhtAnnounce=function(){var e=this;e._dhtAnnouncing||(n("dht announce"),e._dhtAnnouncing=!0,clearTimeout(e._dhtTimeout),e.dht.announce(e.infoHash,e._port,function(t){e._dhtAnnouncing=!1,n("dht announce complete"),t&&e.emit("warning",t),e.emit("dhtAnnounce"),e.destroyed||(e._dhtTimeout=setTimeout(function(){e._dhtAnnounce()},e._intervalMs+Math.floor(Math.random()*e._intervalMs/5)),e._dhtTimeout.unref&&e._dhtTimeout.unref())}))}}).call(this,e("_process"))},{_process:98,"bittorrent-dht/client":26,"bittorrent-tracker/client":20,debug:41,events:51,inherits:60,"run-parallel":126,xtend:177}],151:[function(e,t,r){(function(e){t.exports=n;var r=16384;function n(e){if(!(this instanceof n))return new n(e);this.length=e,this.missing=e,this.sources=null,this._chunks=Math.ceil(e/r),this._remainder=e%r||r,this._buffered=0,this._buffer=null,this._cancellations=null,this._reservations=0,this._flushed=!1}n.BLOCK_LENGTH=r,n.prototype.chunkLength=function(e){return e===this._chunks-1?this._remainder:r},n.prototype.chunkLengthRemaining=function(e){return this.length-e*r},n.prototype.chunkOffset=function(e){return e*r},n.prototype.reserve=function(){return this.init()?this._cancellations.length?this._cancellations.pop():this._reservations<this._chunks?this._reservations++:-1:-1},n.prototype.reserveRemaining=function(){if(!this.init())return-1;if(this._reservations<this._chunks){var e=this._reservations;return this._reservations=this._chunks,e}return-1},n.prototype.cancel=function(e){this.init()&&this._cancellations.push(e)},n.prototype.cancelRemaining=function(e){this.init()&&(this._reservations=e)},n.prototype.get=function(e){return this.init()?this._buffer[e]:null},n.prototype.set=function(e,t,n){if(!this.init())return!1;for(var i=t.length,o=Math.ceil(i/r),a=0;a<o;a++)if(!this._buffer[e+a]){var s=a*r,u=t.slice(s,s+r);this._buffered++,this._buffer[e+a]=u,this.missing-=u.length,-1===this.sources.indexOf(n)&&this.sources.push(n)}return this._buffered===this._chunks},n.prototype.flush=function(){if(!this._buffer||this._chunks!==this._buffered)return null;var t=e.concat(this._buffer,this.length);return this._buffer=null,this._cancellations=null,this.sources=null,this._flushed=!0,t},n.prototype.init=function(){return!this._flushed&&(!!this._buffer||(this._buffer=new Array(this._chunks),this._cancellations=[],this.sources=[],!0))}}).call(this,e("buffer").Buffer)},{buffer:34}],152:[function(e,t,r){(function(r){var n=e("is-typedarray").strict;t.exports=function(e){if(n(e)){var t=r.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return r.from(e)}}).call(this,e("buffer").Buffer)},{buffer:34,"is-typedarray":64}],153:[function(e,t,r){(function(e){r.encodingLength=function(){return 8},r.encode=function(t,r,n){r||(r=new e(8)),n||(n=0);var i=Math.floor(t/4294967295),o=t-4294967295*i;return r.writeUInt32BE(i,n),r.writeUInt32BE(o,n+4),r},r.decode=function(t,r){return r||(r=0),t||(t=new e(4)),r||(r=0),4294967295*t.readUInt32BE(r)+t.readUInt32BE(r+4)},r.encode.bytes=8,r.decode.bytes=8}).call(this,e("buffer").Buffer)},{buffer:34}],154:[function(e,t,r){"use strict";t.exports=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,i=e[0],o=e[0],a=1;a<n;++a)if(o=i,t(i=e[a],o)){if(a===r){r++;continue}e[r++]=i}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],i=e[0],o=1;o<r;++o,i=n)if(i=n,(n=e[o])!==i){if(o===t){t++;continue}e[t++]=n}return e.length=t,e}(e))}},{}],155:[function(e,t,r){t.exports=function(e,t){if(t>=e.length||t<0)return;var r=e.pop();if(t<e.length){var n=e[t];return e[t]=r,n}return r}},{}],156:[function(e,t,r){"use strict";var n=e("punycode"),i=e("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=_,r.resolve=function(e,t){return _(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},r.format=function(e){i.isString(e)&&(e=_(e));return e instanceof o?e.format():o.prototype.format.call(e)},r.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),f=["%","/","?",";","#"].concat(l),d=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=e("querystring");function _(e,t,r){if(e&&i.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var _=e=c.join(s);if(_=_.trim(),!r&&1===e.split("#").length){var b=u.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=a.exec(_);if(w){var E=(w=w[0]).toLowerCase();this.protocol=E,_=_.substr(w.length)}if(r||w||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===_.substr(0,2);!S||w&&g[w]||(_=_.substr(2),this.slashes=!0)}if(!g[w]&&(S||w&&!y[w])){for(var T,k,A=-1,R=0;R<d.length;R++){-1!==(x=_.indexOf(d[R]))&&(-1===A||x<A)&&(A=x)}-1!==(k=-1===A?_.lastIndexOf("@"):_.lastIndexOf("@",A))&&(T=_.slice(0,k),_=_.slice(k+1),this.auth=decodeURIComponent(T)),A=-1;for(R=0;R<f.length;R++){var x;-1!==(x=_.indexOf(f[R]))&&(-1===A||x<A)&&(A=x)}-1===A&&(A=_.length),this.host=_.slice(0,A),_=_.slice(A),this.parseHost(),this.hostname=this.hostname||"";var L="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!L)for(var I=this.hostname.split(/\./),C=(R=0,I.length);R<C;R++){var O=I[R];if(O&&!O.match(h)){for(var D="",P=0,M=O.length;P<M;P++)O.charCodeAt(P)>127?D+="x":D+=O[P];if(!D.match(h)){var F=I.slice(0,R),N=I.slice(R+1),U=O.match(p);U&&(F.push(U[1]),N.unshift(U[2])),N.length&&(_="/"+N.join(".")+_),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),L||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+B,this.href+=this.host,L&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!m[E])for(R=0,C=l.length;R<C;R++){var H=l[R];if(-1!==_.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),_=_.split(H).join(G)}}var z=_.indexOf("#");-1!==z&&(this.hash=_.substr(z),_=_.slice(0,z));var W=_.indexOf("?");if(-1!==W?(this.search=_.substr(W),this.query=_.substr(W+1),t&&(this.query=v.parse(this.query)),_=_.slice(0,W)):t&&(this.search="",this.query={}),_&&(this.pathname=_),y[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var q=this.search||"";this.path=B+q}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=v.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),a=0;a<n.length;a++){var s=n[a];r[s]=this[s]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(r[l]=e[l])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!y[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var h=f[d];r[h]=e[h]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||g[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",v=r.search||"";r.path=m+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||_||r.host&&e.pathname,E=w,S=r.pathname&&r.pathname.split("/")||[],T=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===S[0]?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===S[0])),b)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=p;else if(p.length)S||(S=[]),S.pop(),S=S.concat(p),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(T)r.hostname=r.host=S.shift(),(L=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=L.shift(),r.host=r.hostname=L.shift());return r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var k=S.slice(-1)[0],A=(r.host||e.host||S.length>1)&&("."===k||".."===k)||""===k,R=0,x=S.length;x>=0;x--)"."===(k=S[x])?S.splice(x,1):".."===k?(S.splice(x,1),R++):R&&(S.splice(x,1),R--);if(!w&&!E)for(;R--;R)S.unshift("..");!w||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),A&&"/"!==S.join("/").substr(-1)&&S.push("");var L,I=""===S[0]||S[0]&&"/"===S[0].charAt(0);T&&(r.hostname=r.host=I?"":S.length?S.shift():"",(L=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=L.shift(),r.host=r.hostname=L.shift()));return(w=w||r.host&&S.length)&&!I&&S.unshift(""),S.length?r.pathname=S.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":157,punycode:100,querystring:103}],157:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],158:[function(e,t,r){var n=e("bencode"),i=e("bitfield"),o=e("safe-buffer").Buffer,a=e("debug")("ut_metadata"),s=e("events").EventEmitter,u=e("inherits"),c=e("simple-sha1"),l=1e3;t.exports=function(e){function t(t){s.call(this),this._wire=t,this._metadataComplete=!1,this._metadataSize=null,this._remainingRejects=null,this._fetching=!1,this._bitfield=new i(0,{grow:l}),o.isBuffer(e)&&this.setMetadata(e)}return u(t,s),t.prototype.name="ut_metadata",t.prototype.onHandshake=function(e,t,r){this._infoHash=e},t.prototype.onExtendedHandshake=function(e){return e.m&&e.m.ut_metadata?e.metadata_size?"number"!=typeof e.metadata_size||1e7<e.metadata_size||e.metadata_size<=0?this.emit("warning",new Error("Peer gave invalid metadata size")):(this._metadataSize=e.metadata_size,this._numPieces=Math.ceil(this._metadataSize/16384),this._remainingRejects=2*this._numPieces,void(this._fetching&&this._requestPieces())):this.emit("warning",new Error("Peer does not have metadata")):this.emit("warning",new Error("Peer does not support ut_metadata"))},t.prototype.onMessage=function(e){var t,r;try{var i=e.toString(),o=i.indexOf("ee")+2;t=n.decode(i.substring(0,o)),r=e.slice(o)}catch(e){return}switch(t.msg_type){case 0:this._onRequest(t.piece);break;case 1:this._onData(t.piece,r,t.total_size);break;case 2:this._onReject(t.piece)}},t.prototype.fetch=function(){this._metadataComplete||(this._fetching=!0,this._metadataSize&&this._requestPieces())},t.prototype.cancel=function(){this._fetching=!1},t.prototype.setMetadata=function(e){if(this._metadataComplete)return!0;a("set metadata");try{var t=n.decode(e).info;t&&(e=n.encode(t))}catch(e){}return(!this._infoHash||this._infoHash===c.sync(e))&&(this.cancel(),this.metadata=e,this._metadataComplete=!0,this._metadataSize=this.metadata.length,this._wire.extendedHandshake.metadata_size=this._metadataSize,this.emit("metadata",n.encode({info:n.decode(this.metadata)})),!0)},t.prototype._send=function(e,t){var r=n.encode(e);o.isBuffer(t)&&(r=o.concat([r,t])),this._wire.extended("ut_metadata",r)},t.prototype._request=function(e){this._send({msg_type:0,piece:e})},t.prototype._data=function(e,t,r){var n={msg_type:1,piece:e};"number"==typeof r&&(n.total_size=r),this._send(n,t)},t.prototype._reject=function(e){this._send({msg_type:2,piece:e})},t.prototype._onRequest=function(e){if(this._metadataComplete){var t=16384*e,r=t+16384;r>this._metadataSize&&(r=this._metadataSize);var n=this.metadata.slice(t,r);this._data(e,n,this._metadataSize)}else this._reject(e)},t.prototype._onData=function(e,t,r){t.length>16384||(t.copy(this.metadata,16384*e),this._bitfield.set(e),this._checkDone())},t.prototype._onReject=function(e){this._remainingRejects>0&&this._fetching?(this._request(e),this._remainingRejects-=1):this.emit("warning",new Error('Peer sent "reject" too much'))},t.prototype._requestPieces=function(){this.metadata=o.alloc(this._metadataSize);for(var e=0;e<this._numPieces;e++)this._request(e)},t.prototype._checkDone=function(){for(var e=!0,t=0;t<this._numPieces;t++)if(!this._bitfield.get(t)){e=!1;break}e&&(this.setMetadata(this.metadata)||this._failedMetadata())},t.prototype._failedMetadata=function(){this._bitfield=new i(0,{grow:l}),this._remainingRejects-=this._numPieces,this._remainingRejects>0?this._requestPieces():this.emit("warning",new Error("Peer sent invalid metadata"))},t}},{bencode:16,bitfield:18,debug:41,events:51,inherits:60,"safe-buffer":128,"simple-sha1":132}],159:[function(e,t,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],160:[function(e,t,r){arguments[4][60][0].apply(r,arguments)},{dup:60}],161:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],162:[function(e,t,r){(function(t,n){var i=/%[sdj%]/g;r.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<o;u=n[++r])m(u)||!b(u)?a+=" "+u:a+=" "+s(u);return a},r.deprecate=function(e,i){if(v(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,a={};function s(e,t){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(t)?n.showHidden=t:t&&r._extend(n,t),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),l(n,e,n.depth)}function u(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function c(e,t){return e}function l(e,t,n){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return y(i)||(i=l(e,i,n)),i}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(g(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,t);if(o)return o;var a=Object.keys(t),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),E(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(t);if(0===a.length){if(S(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(E(t))return f(t)}var c,b="",T=!1,k=["{","}"];(h(t)&&(T=!0,k=["[","]"]),S(t))&&(b=" [Function"+(t.name?": "+t.name:"")+"]");return _(t)&&(b=" "+RegExp.prototype.toString.call(t)),w(t)&&(b=" "+Date.prototype.toUTCString.call(t)),E(t)&&(b=" "+f(t)),0!==a.length||T&&0!=t.length?n<0?_(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=T?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)R(t,String(a))?o.push(d(e,t,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(d(e,t,r,n,i,!0))}),o}(e,t,n,s,a):a.map(function(r){return d(e,t,n,s,r,T)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,b,k)):k[0]+b+k[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),R(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=m(r)?l(e,u.value,null):l(e,u.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),v(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function _(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function w(e){return b(e)&&"[object Date]"===T(e)}function E(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function S(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=t.pid;a[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else a[e]=function(){};return a[e]},r.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=h,r.isBoolean=p,r.isNull=m,r.isNullOrUndefined=function(e){return null==e},r.isNumber=g,r.isString=y,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=v,r.isRegExp=_,r.isObject=b,r.isDate=w,r.isError=E,r.isFunction=S,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),A[e.getMonth()],t].join(" ")),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":161,_process:98,inherits:160}],163:[function(e,t,r){(function(r){var n=e("binary-search"),i=e("events").EventEmitter,o=e("inherits"),a=e("mp4-stream"),s=e("mp4-box-encoding"),u=e("range-slice-stream");function c(e){i.call(this),this._tracks=[],this._fragmentSequence=1,this._file=e,this._decoder=null,this._findMoov(0)}function l(e,t){this._entries=e,this._countName=t||"count",this._index=0,this._offset=0,this.value=this._entries[0]}t.exports=c,o(c,i),c.prototype._findMoov=function(e){var t=this;t._decoder&&t._decoder.destroy(),t._decoder=a.decode();var r=t._file.createReadStream({start:e});r.pipe(t._decoder),t._decoder.once("box",function(n){"moov"===n.type?t._decoder.decode(function(e){r.destroy();try{t._processMoov(e)}catch(e){e.message="Cannot parse mp4 file: "+e.message,t.emit("error",e)}}):(r.destroy(),t._findMoov(e+n.length))})},l.prototype.inc=function(){this._offset++,this._offset>=this._entries[this._index][this._countName]&&(this._index++,this._offset=0),this.value=this._entries[this._index]},c.prototype._processMoov=function(e){var t=e.traks;this._tracks=[],this._hasVideo=!1,this._hasAudio=!1;for(var n=0;n<t.length;n++){var i,o,a=t[n],u=a.mdia.minf.stbl,c=u.stsd.entries[0],f=a.mdia.hdlr.handlerType;if("vide"===f&&"avc1"===c.type){if(this._hasVideo)continue;this._hasVideo=!0,i="avc1",c.avcC&&(i+="."+c.avcC.mimeCodec),o='video/mp4; codecs="'+i+'"'}else{if("soun"!==f||"mp4a"!==c.type)continue;if(this._hasAudio)continue;this._hasAudio=!0,i="mp4a",c.esds&&c.esds.mimeCodec&&(i+="."+c.esds.mimeCodec),o='audio/mp4; codecs="'+i+'"'}var d=[],h=0,p=0,m=0,g=0,y=0,v=0,_=new l(u.stts.entries),b=null;u.ctts&&(b=new l(u.ctts.entries));for(var w=0;;){var E=u.stsc.entries[y],S=u.stsz.entries[h],T=_.value.duration,k=b?b.value.compositionOffset:0,A=!0;if(u.stss&&(A=u.stss.entries[w]===h+1),d.push({size:S,duration:T,dts:v,presentationOffset:k,sync:A,offset:g+u.stco.entries[m]}),++h>=u.stsz.entries.length)break;if(g+=S,++p>=E.samplesPerChunk){p=0,g=0,m++;var R=u.stsc.entries[y+1];R&&m+1>=R.firstChunk&&y++}v+=T,_.inc(),b&&b.inc(),A&&w++}a.mdia.mdhd.duration=0,a.tkhd.duration=0;var x=E.sampleDescriptionId,L={type:"moov",mvhd:e.mvhd,traks:[{tkhd:a.tkhd,mdia:{mdhd:a.mdia.mdhd,hdlr:a.mdia.hdlr,elng:a.mdia.elng,minf:{vmhd:a.mdia.minf.vmhd,smhd:a.mdia.minf.smhd,dinf:a.mdia.minf.dinf,stbl:{stsd:u.stsd,stts:{version:0,flags:0,entries:[]},ctts:{version:0,flags:0,entries:[]},stsc:{version:0,flags:0,entries:[]},stsz:{version:0,flags:0,entries:[]},stco:{version:0,flags:0,entries:[]},stss:{version:0,flags:0,entries:[]}}}}}],mvex:{mehd:{fragmentDuration:e.mvhd.duration},trexs:[{trackId:a.tkhd.trackId,defaultSampleDescriptionIndex:x,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0}]}};this._tracks.push({trackId:a.tkhd.trackId,timeScale:a.mdia.mdhd.timeScale,samples:d,currSample:null,currTime:null,moov:L,mime:o})}if(0!==this._tracks.length){e.mvhd.duration=0,this._ftyp={type:"ftyp",brand:"iso5",brandVersion:0,compatibleBrands:["iso5"]};var I=s.encode(this._ftyp),C=this._tracks.map(function(e){var t=s.encode(e.moov);return{mime:e.mime,init:r.concat([I,t])}});this.emit("ready",C)}else this.emit("error",new Error("no playable tracks"))},c.prototype.seek=function(e){var t=this;if(!t._tracks)throw new Error("Not ready yet; wait for 'ready' event");t._fileStream&&(t._fileStream.destroy(),t._fileStream=null);var r=-1;if(t._tracks.map(function(n,i){n.outStream&&n.outStream.destroy(),n.inStream&&(n.inStream.destroy(),n.inStream=null);var o=n.outStream=a.encode(),s=t._generateFragment(i,e);if(!s)return o.finalize();(-1===r||s.ranges[0].start<r)&&(r=s.ranges[0].start),function e(r){if(o.destroyed)return;o.box(r.moof,function(a){if(a)return t.emit("error",a);if(!o.destroyed){var s=n.inStream.slice(r.ranges);s.pipe(o.mediaData(r.length,function(r){if(r)return t.emit("error",r);if(!o.destroyed){var n=t._generateFragment(i);if(!n)return o.finalize();e(n)}}))}})}(s)}),r>=0){var n=t._fileStream=t._file.createReadStream({start:r});t._tracks.forEach(function(e){e.inStream=new u(r,{highWaterMark:1e7}),n.pipe(e.inStream)})}return t._tracks.map(function(e){return e.outStream})},c.prototype._findSampleBefore=function(e,t){var r=this._tracks[e],i=Math.floor(r.timeScale*t),o=n(r.samples,i,function(e,t){return e.dts+e.presentationOffset-t});for(-1===o?o=0:o<0&&(o=-o-2);!r.samples[o].sync;)o--;return o};c.prototype._generateFragment=function(e,t){var r,n=this._tracks[e];if((r=void 0!==t?this._findSampleBefore(e,t):n.currSample)>=n.samples.length)return null;for(var i=n.samples[r].dts,o=0,a=[],s=r;s<n.samples.length;s++){var u=n.samples[s];if(u.sync&&u.dts-i>=1*n.timeScale)break;o+=u.size;var c=a.length-1;c<0||a[c].end!==u.offset?a.push({start:u.offset,end:u.offset+u.size}):a[c].end+=u.size}return n.currSample=s,{moof:this._generateMoof(e,r,s),ranges:a,length:o}},c.prototype._generateMoof=function(e,t,r){for(var n=this._tracks[e],i=[],o=t;o<r;o++){var a=n.samples[o];i.push({sampleDuration:a.duration,sampleSize:a.size,sampleFlags:a.sync?33554432:16842752,sampleCompositionTimeOffset:a.presentationOffset})}var u={type:"moof",mfhd:{sequenceNumber:this._fragmentSequence++},trafs:[{tfhd:{flags:131072,trackId:n.trackId},tfdt:{baseMediaDecodeTime:n.samples[t].dts},trun:{flags:3841,dataOffset:8,entries:i}}]};return u.trafs[0].trun.dataOffset+=s.encodingLength(u),u}}).call(this,e("buffer").Buffer)},{"binary-search":17,buffer:34,events:51,inherits:60,"mp4-box-encoding":74,"mp4-stream":77,"range-slice-stream":106}],164:[function(e,t,r){var n=e("once"),i=e("end-of-stream"),o=e("fs"),a=function(){},s=function(e){return"function"==typeof e},u=function(e,t,r,u){u=n(u);var c=!1;e.on("close",function(){c=!0}),i(e,{readable:t,writable:r},function(e){if(e)return u(e);c=!0,u()});var l=!1;return function(t){if(!c&&!l)return l=!0,function(e){return!!o&&(e instanceof(o.ReadStream||a)||e instanceof(o.WriteStream||a))&&s(e.close)}(e)?e.close(a):function(e){return e.setHeader&&s(e.abort)}(e)?e.abort():s(e.destroy)?e.destroy():void u(t||new Error("stream was destroyed"))}},c=function(e){e()},l=function(e,t){return e.pipe(t)};t.exports=function(){var e,t=Array.prototype.slice.call(arguments),r=s(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var n=t.map(function(i,o){var a=o<t.length-1;return u(i,a,o>0,function(t){e||(e=t),t&&n.forEach(c),a||(n.forEach(c),r(e))})});return t.reduce(l)}},{"end-of-stream":49,fs:26,once:81}],165:[function(e,t,r){var n=e("mediasource"),i=e("pump"),o=e("./mp4-remuxer");function a(e,t,r){var i=this;if(!(this instanceof a))return new a(e,t,r);r=r||{},i.detailedError=null,i._elem=t,i._elemWrapper=new n(t),i._waitingFired=!1,i._trackMeta=null,i._file=e,i._tracks=null,"none"!==i._elem.preload&&i._createMuxer(),i._onError=function(e){i.detailedError=i._elemWrapper.detailedError,i.destroy()},i._onWaiting=function(){i._waitingFired=!0,i._muxer?i._tracks&&i._pump():i._createMuxer()},i._elem.addEventListener("waiting",i._onWaiting),i._elem.addEventListener("error",i._onError)}t.exports=a,a.prototype._createMuxer=function(){var e=this;e._muxer=new o(e._file),e._muxer.on("ready",function(t){e._tracks=t.map(function(t){var r=e._elemWrapper.createWriteStream(t.mime);r.on("error",function(t){e._elemWrapper.error(t)});var n={muxed:null,mediaSource:r,initFlushed:!1,onInitFlushed:null};return r.write(t.init,function(e){n.initFlushed=!0,n.onInitFlushed&&n.onInitFlushed(e)}),n}),(e._waitingFired||"auto"===e._elem.preload)&&e._pump()}),e._muxer.on("error",function(t){e._elemWrapper.error(t)})},a.prototype._pump=function(){var e=this,t=e._muxer.seek(e._elem.currentTime,!e._tracks);e._tracks.forEach(function(r,n){var o=function(){r.muxed&&(r.muxed.destroy(),r.mediaSource=e._elemWrapper.createWriteStream(r.mediaSource),r.mediaSource.on("error",function(t){e._elemWrapper.error(t)})),r.muxed=t[n],i(r.muxed,r.mediaSource)};r.initFlushed?o():r.onInitFlushed=function(t){t?e._elemWrapper.error(t):o()}})},a.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this._elem.removeEventListener("waiting",this._onWaiting),this._elem.removeEventListener("error",this._onError),this._tracks&&this._tracks.forEach(function(e){e.muxed.destroy()}),this._elem.src="")}},{"./mp4-remuxer":163,mediasource:69,pump:164}],166:[function(e,t,r){e("./lib/global"),t.exports=e("webtorrent")},{"./lib/global":167,webtorrent:168}],167:[function(e,t,r){(function(t,r){var n=e("create-torrent"),i=e("electron-webrtc");r.WEBTORRENT_ANNOUNCE=n.announceList.map(function(e){return e[0]}).filter(function(e){return 0===e.indexOf("wss://")||0===e.indexOf("ws://")}),r.WRTC=function(){var e=i();function r(){t.removeListener("SIGINT",r),t.removeListener("SIGTERM",r),e.close()}return t.on("SIGINT",r),t.on("SIGTERM",r),e.on("error",function(e,t){"Daemon already closed"!==e.message&&console.error(e,t)}),e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:98,"create-torrent":40,"electron-webrtc":48}],168:[function(e,t,r){(function(r,n){t.exports=k;var i=e("safe-buffer").Buffer,o=e("simple-concat"),a=e("create-torrent"),s=e("debug")("webtorrent"),u=e("bittorrent-dht/client"),c=e("events").EventEmitter,l=e("xtend"),f=e("inherits"),d=e("load-ip-set"),h=e("run-parallel"),p=e("parse-torrent"),m=e("path"),g=e("simple-peer"),y=e("randombytes"),v=e("speedometer"),_=e("zero-fill"),b=e("./lib/tcp-pool"),w=e("./lib/torrent"),E=e("./package.json").version,S=E.match(/([0-9]+)/g).slice(0,2).map(function(e){return _(2,e)}).join(""),T="-WW"+S+"-";function k(e){var t=this;if(!(t instanceof k))return new k(e);function o(){t.destroyed||(t.ready=!0,t.emit("ready"))}c.call(t),e||(e={}),"string"==typeof e.peerId?t.peerId=e.peerId:i.isBuffer(e.peerId)?t.peerId=e.peerId.toString("hex"):t.peerId=i.from(T+y(9).toString("base64")).toString("hex"),t.peerIdBuffer=i.from(t.peerId,"hex"),"string"==typeof e.nodeId?t.nodeId=e.nodeId:i.isBuffer(e.nodeId)?t.nodeId=e.nodeId.toString("hex"):t.nodeId=y(20).toString("hex"),t.nodeIdBuffer=i.from(t.nodeId,"hex"),t._debugId=t.peerId.toString("hex").substring(0,7),t.destroyed=!1,t.listening=!1,t.torrentPort=e.torrentPort||0,t.dhtPort=e.dhtPort||0,t.tracker=void 0!==e.tracker?e.tracker:{},t.torrents=[],t.maxConns=Number(e.maxConns)||55,t._debug("new webtorrent (peerId %s, nodeId %s, port %s)",t.peerId,t.nodeId,t.torrentPort),t.tracker&&("object"!=typeof t.tracker&&(t.tracker={}),e.rtcConfig&&(console.warn("WebTorrent: opts.rtcConfig is deprecated. Use opts.tracker.rtcConfig instead"),t.tracker.rtcConfig=e.rtcConfig),e.wrtc&&(console.warn("WebTorrent: opts.wrtc is deprecated. Use opts.tracker.wrtc instead"),t.tracker.wrtc=e.wrtc),n.WRTC&&!t.tracker.wrtc&&(t.tracker.wrtc=n.WRTC)),"function"==typeof b?t._tcpPool=new b(t):r.nextTick(function(){t._onListening()}),t._downloadSpeed=v(),t._uploadSpeed=v(),!1!==e.dht&&"function"==typeof u?(t.dht=new u(l({nodeId:t.nodeId},e.dht)),t.dht.once("error",function(e){t._destroy(e)}),t.dht.once("listening",function(){var e=t.dht.address();e&&(t.dhtPort=e.port)}),t.dht.setMaxListeners(0),t.dht.listen(t.dhtPort)):t.dht=!1,t.enableWebSeeds=!1!==e.webSeeds,"function"==typeof d&&null!=e.blocklist?d(e.blocklist,{headers:{"user-agent":"WebTorrent/"+E+" (https://webtorrent.io)"}},function(e,r){if(e)return t.error("Failed to load blocklist: "+e.message);t.blocked=r,o()}):r.nextTick(o)}f(k,c),k.WEBRTC_SUPPORT=g.WEBRTC_SUPPORT,k.VERSION=E,Object.defineProperty(k.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(k.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(k.prototype,"progress",{get:function(){var e=this.torrents.filter(function(e){return 1!==e.progress});return e.reduce(function(e,t){return e+t.downloaded},0)/(e.reduce(function(e,t){return e+(t.length||0)},0)||1)}}),Object.defineProperty(k.prototype,"ratio",{get:function(){return this.torrents.reduce(function(e,t){return e+t.uploaded},0)/(this.torrents.reduce(function(e,t){return e+t.received},0)||1)}}),k.prototype.get=function(e){var t,r,n=this.torrents.length;if(e instanceof w){for(t=0;t<n;t++)if((r=this.torrents[t])===e)return r}else{var i;try{i=p(e)}catch(e){}if(!i)return null;if(!i.infoHash)throw new Error("Invalid torrent identifier");for(t=0;t<n;t++)if((r=this.torrents[t]).infoHash===i.infoHash)return r}return null},k.prototype.download=function(e,t,r){return console.warn("WebTorrent: client.download() is deprecated. Use client.add() instead"),this.add(e,t,r)},k.prototype.add=function(e,t,r){var n=this;if(n.destroyed)throw new Error("client is destroyed");if("function"==typeof t)return n.add(e,null,t);n._debug("add"),t=t?l(t):{};var i=new w(e,n,t);function o(){if(!n.destroyed)for(var e=0,t=n.torrents.length;e<t;e++){var r=n.torrents[e];if(r.infoHash===i.infoHash&&r!==i)return void i._destroy(new Error("Cannot add duplicate torrent "+i.infoHash))}}function a(){n.destroyed||("function"==typeof r&&r(i),n.emit("torrent",i))}return n.torrents.push(i),i.once("_infoHash",o),i.once("ready",a),i.once("close",function e(){i.removeListener("_infoHash",o);i.removeListener("ready",a);i.removeListener("close",e)}),i},k.prototype.seed=function(e,t,r){var n=this;if(n.destroyed)throw new Error("client is destroyed");if("function"==typeof t)return n.seed(e,null,t);n._debug("seed"),t=t?l(t):{},"string"==typeof e&&(t.path=m.dirname(e)),t.createdBy||(t.createdBy="WebTorrent/"+S);var i,s,u=n.add(null,t,function(e){var t=[function(t){e.load(i,t)}];n.dht&&t.push(function(t){e.once("dhtAnnounce",t)});h(t,function(t){if(!n.destroyed)return t?e._destroy(t):void function(e){n._debug("on seed"),"function"==typeof r&&r(e);e.emit("seed"),n.emit("seed",e)}(e)})});return s=e,"undefined"!=typeof FileList&&s instanceof FileList&&(e=Array.prototype.slice.call(e)),Array.isArray(e)||(e=[e]),h(e.map(function(e){return function(t){var r;"object"==typeof(r=e)&&null!=r&&"function"==typeof r.pipe?o(e,t):t(null,e)}}),function(e,r){if(!n.destroyed)return e?u._destroy(e):void a.parseInput(r,t,function(e,o){if(!n.destroyed){if(e)return u._destroy(e);i=o.map(function(e){return e.getStream}),a(r,t,function(e,t){if(!n.destroyed){if(e)return u._destroy(e);var r=n.get(t);r?u._destroy(new Error("Cannot add duplicate torrent "+r.infoHash)):u._onTorrentId(t)}})}})}),u},k.prototype.remove=function(e,t){if(this._debug("remove"),!this.get(e))throw new Error("No torrent with id "+e);this._remove(e,t)},k.prototype._remove=function(e,t){var r=this.get(e);r&&(this.torrents.splice(this.torrents.indexOf(r),1),r.destroy(t))},k.prototype.address=function(){return this.listening?this._tcpPool?this._tcpPool.server.address():{address:"0.0.0.0",family:"IPv4",port:0}:null},k.prototype.destroy=function(e){if(this.destroyed)throw new Error("client already destroyed");this._destroy(null,e)},k.prototype._destroy=function(e,t){var r=this;r._debug("client destroy"),r.destroyed=!0;var n=r.torrents.map(function(e){return function(t){e.destroy(t)}});r._tcpPool&&n.push(function(e){r._tcpPool.destroy(e)}),r.dht&&n.push(function(e){r.dht.destroy(e)}),h(n,t),e&&r.emit("error",e),r.torrents=[],r._tcpPool=null,r.dht=null},k.prototype._onListening=function(){if(this._debug("listening"),this.listening=!0,this._tcpPool){var e=this._tcpPool.server.address();e&&(this.torrentPort=e.port)}this.emit("listening")},k.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._debugId+"] "+e[0],s.apply(null,e)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/tcp-pool":26,"./lib/torrent":173,"./package.json":175,_process:98,"bittorrent-dht/client":26,"create-torrent":40,debug:41,events:51,inherits:60,"load-ip-set":26,"parse-torrent":93,path:94,randombytes:105,"run-parallel":126,"safe-buffer":128,"simple-concat":129,"simple-peer":131,speedometer:134,xtend:177,"zero-fill":179}],169:[function(e,t,r){t.exports=a;var n=e("debug")("webtorrent:file-stream"),i=e("inherits"),o=e("readable-stream");function a(e,t){o.Readable.call(this,t),this.destroyed=!1,this._torrent=e._torrent;var r=t&&t.start||0,n=t&&t.end&&t.end<e.length?t.end:e.length-1,i=e._torrent.pieceLength;this._startPiece=(r+e.offset)/i|0,this._endPiece=(n+e.offset)/i|0,this._piece=this._startPiece,this._offset=r+e.offset-this._startPiece*i,this._missing=n-r+1,this._reading=!1,this._notifying=!1,this._criticalLength=Math.min(1048576/i|0,2)}i(a,o.Readable),a.prototype._read=function(){this._reading||(this._reading=!0,this._notify())},a.prototype._notify=function(){var e=this;if(e._reading&&0!==e._missing){if(!e._torrent.bitfield.get(e._piece))return e._torrent.critical(e._piece,e._piece+e._criticalLength);if(!e._notifying){if(e._notifying=!0,e._torrent.destroyed)return e._destroy(new Error("Torrent removed"));var t=e._piece;e._torrent.store.get(t,function(r,i){if(e._notifying=!1,!e.destroyed){if(r)return e._destroy(r);n("read %s (length %s) (err %s)",t,i.length,r&&r.message),e._offset&&(i=i.slice(e._offset),e._offset=0),e._missing<i.length&&(i=i.slice(0,e._missing)),e._missing-=i.length,n("pushing buffer of length %s",i.length),e._reading=!1,e.push(i),0===e._missing&&e.push(null)}}),e._piece+=1}}},a.prototype.destroy=function(e){this._destroy(null,e)},a.prototype._destroy=function(e,t){this.destroyed||(this.destroyed=!0,this._torrent.destroyed||this._torrent.deselect(this._startPiece,this._endPiece,!0),e&&this.emit("error",e),this.emit("close"),t&&t())}},{debug:41,inherits:60,"readable-stream":117}],170:[function(e,t,r){(function(r){t.exports=h;var n=e("end-of-stream"),i=e("events").EventEmitter,o=e("./file-stream"),a=e("inherits"),s=e("path"),u=e("render-media"),c=e("readable-stream"),l=e("stream-to-blob"),f=e("stream-to-blob-url"),d=e("stream-with-known-length-to-buffer");function h(e,t){i.call(this),this._torrent=e,this._destroyed=!1,this.name=t.name,this.path=t.path,this.length=t.length,this.offset=t.offset,this.done=!1;var r=t.offset,n=r+t.length-1;this._startPiece=r/this._torrent.pieceLength|0,this._endPiece=n/this._torrent.pieceLength|0,0===this.length&&(this.done=!0,this.emit("done"))}a(h,i),Object.defineProperty(h.prototype,"downloaded",{get:function(){if(!this._torrent.bitfield)return 0;for(var e=0,t=this._startPiece;t<=this._endPiece;++t)if(this._torrent.bitfield.get(t))e+=t===this._endPiece?this._torrent.lastPieceLength:this._torrent.pieceLength;else{var r=this._torrent.pieces[t];e+=r.length-r.missing}return e}}),Object.defineProperty(h.prototype,"progress",{get:function(){return this.length?this.downloaded/this.length:0}}),h.prototype.select=function(e){0!==this.length&&this._torrent.select(this._startPiece,this._endPiece,e)},h.prototype.deselect=function(){0!==this.length&&this._torrent.deselect(this._startPiece,this._endPiece,!1)},h.prototype.createReadStream=function(e){var t=this;if(0===this.length){var i=new c.PassThrough;return r.nextTick(function(){i.end()}),i}var a=new o(t,e);return t._torrent.select(a._startPiece,a._endPiece,!0,function(){a._notify()}),n(a,function(){t._destroyed||t._torrent.destroyed||t._torrent.deselect(a._startPiece,a._endPiece,!0)}),a},h.prototype.getBuffer=function(e){d(this.createReadStream(),this.length,e)},h.prototype.getBlob=function(e){if("undefined"==typeof window)throw new Error("browser-only method");l(this.createReadStream(),this._getMimeType(),e)},h.prototype.getBlobURL=function(e){if("undefined"==typeof window)throw new Error("browser-only method");f(this.createReadStream(),this._getMimeType(),e)},h.prototype.appendTo=function(e,t,r){if("undefined"==typeof window)throw new Error("browser-only method");u.append(this,e,t,r)},h.prototype.renderTo=function(e,t,r){if("undefined"==typeof window)throw new Error("browser-only method");u.render(this,e,t,r)},h.prototype._getMimeType=function(){return u.mime[s.extname(this.name).toLowerCase()]},h.prototype._destroy=function(){this._destroyed=!0,this._torrent=null}}).call(this,e("_process"))},{"./file-stream":169,_process:98,"end-of-stream":49,events:51,inherits:60,path:94,"readable-stream":117,"render-media":120,"stream-to-blob":141,"stream-to-blob-url":140,"stream-with-known-length-to-buffer":142}],171:[function(e,t,r){var n=e("unordered-array-remove"),i=e("debug")("webtorrent:peer"),o=e("bittorrent-protocol"),a=e("./webconn");function s(e,t){this.id=e,this.type=t,i("new Peer %s",e),this.addr=null,this.conn=null,this.swarm=null,this.wire=null,this.connected=!1,this.destroyed=!1,this.timeout=null,this.retries=0,this.sentHandshake=!1}function u(){}r.createWebRTCPeer=function(e,t){var r=new s(e.id,"webrtc");return r.conn=e,r.swarm=t,r.conn.connected?r.onConnect():(r.conn.once("connect",function(){r.onConnect()}),r.conn.once("error",function(e){r.destroy(e)}),r.startConnectTimeout()),r},r.createTCPIncomingPeer=function(e){var t=e.remoteAddress+":"+e.remotePort,r=new s(t,"tcpIncoming");return r.conn=e,r.addr=t,r.onConnect(),r},r.createTCPOutgoingPeer=function(e,t){var r=new s(e,"tcpOutgoing");return r.addr=e,r.swarm=t,r},r.createWebSeedPeer=function(e,t){var r=new s(e,"webSeed");return r.swarm=t,r.conn=new a(e,t),r.onConnect(),r},s.prototype.onConnect=function(){var e=this;if(!e.destroyed){e.connected=!0,i("Peer %s connected",e.id),clearTimeout(e.connectTimeout);var t=e.conn;t.once("end",function(){e.destroy()}),t.once("close",function(){e.destroy()}),t.once("finish",function(){e.destroy()}),t.once("error",function(t){e.destroy(t)});var r=e.wire=new o;r.type=e.type,r.once("end",function(){e.destroy()}),r.once("close",function(){e.destroy()}),r.once("finish",function(){e.destroy()}),r.once("error",function(t){e.destroy(t)}),r.once("handshake",function(t,r){e.onHandshake(t,r)}),e.startHandshakeTimeout(),t.pipe(r).pipe(t),e.swarm&&!e.sentHandshake&&e.handshake()}},s.prototype.onHandshake=function(e,t){if(this.swarm&&!this.destroyed){if(this.swarm.destroyed)return this.destroy(new Error("swarm already destroyed"));if(e!==this.swarm.infoHash)return this.destroy(new Error("unexpected handshake info hash for this swarm"));if(t===this.swarm.peerId)return this.destroy(new Error("refusing to connect to ourselves"));i("Peer %s got handshake %s",this.id,e),clearTimeout(this.handshakeTimeout),this.retries=0;var r=this.addr;!r&&this.conn.remoteAddress&&this.conn.remotePort&&(r=this.conn.remoteAddress+":"+this.conn.remotePort),this.swarm._onWire(this.wire,r),this.swarm&&!this.swarm.destroyed&&(this.sentHandshake||this.handshake())}},s.prototype.handshake=function(){var e={dht:!this.swarm.private&&!!this.swarm.client.dht};this.wire.handshake(this.swarm.infoHash,this.swarm.client.peerId,e),this.sentHandshake=!0},s.prototype.startConnectTimeout=function(){var e=this;clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout(function(){e.destroy(new Error("connect timeout"))},"webrtc"===e.type?25e3:5e3),e.connectTimeout.unref&&e.connectTimeout.unref()},s.prototype.startHandshakeTimeout=function(){var e=this;clearTimeout(e.handshakeTimeout),e.handshakeTimeout=setTimeout(function(){e.destroy(new Error("handshake timeout"))},25e3),e.handshakeTimeout.unref&&e.handshakeTimeout.unref()},s.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0,this.connected=!1,i("destroy %s (error: %s)",this.id,e&&(e.message||e)),clearTimeout(this.connectTimeout),clearTimeout(this.handshakeTimeout);var t=this.swarm,r=this.conn,o=this.wire;this.swarm=null,this.conn=null,this.wire=null,t&&o&&n(t.wires,t.wires.indexOf(o)),r&&(r.on("error",u),r.destroy()),o&&o.destroy(),t&&t.removePeer(this.id)}}},{"./webconn":174,"bittorrent-protocol":19,debug:41,"unordered-array-remove":155}],172:[function(e,t,r){function n(e){var t=this;t._torrent=e,t._numPieces=e.pieces.length,t._pieces=[],t._onWire=function(e){t.recalculate(),t._initWire(e)},t._onWireHave=function(e){t._pieces[e]+=1},t._onWireBitfield=function(){t.recalculate()},t._torrent.wires.forEach(function(e){t._initWire(e)}),t._torrent.on("wire",t._onWire),t.recalculate()}function i(){return!0}t.exports=n,n.prototype.getRarestPiece=function(e){e||(e=i);for(var t=[],r=1/0,n=0;n<this._numPieces;++n)if(e(n)){var o=this._pieces[n];o===r?t.push(n):o<r&&(t=[n],r=o)}return t.length>0?t[Math.random()*t.length|0]:-1},n.prototype.destroy=function(){var e=this;e._torrent.removeListener("wire",e._onWire),e._torrent.wires.forEach(function(t){e._cleanupWireEvents(t)}),e._torrent=null,e._pieces=null,e._onWire=null,e._onWireHave=null,e._onWireBitfield=null},n.prototype._initWire=function(e){var t=this;e._onClose=function(){t._cleanupWireEvents(e);for(var r=0;r<this._numPieces;++r)t._pieces[r]-=e.peerPieces.get(r)},e.on("have",t._onWireHave),e.on("bitfield",t._onWireBitfield),e.once("close",e._onClose)},n.prototype.recalculate=function(){var e;for(e=0;e<this._numPieces;++e)this._pieces[e]=0;var t=this._torrent.wires.length;for(e=0;e<t;++e)for(var r=this._torrent.wires[e],n=0;n<this._numPieces;++n)this._pieces[n]+=r.peerPieces.get(n)},n.prototype._cleanupWireEvents=function(e){e.removeListener("have",this._onWireHave),e.removeListener("bitfield",this._onWireBitfield),e._onClose&&e.removeListener("close",e._onClose),e._onClose=null}},{}],173:[function(e,t,r){(function(r,n){t.exports=H;var i,o=e("addr-to-ip-port"),a=e("bitfield"),s=e("chunk-store-stream/write"),u=e("debug")("webtorrent:torrent"),c=e("torrent-discovery"),l=e("events").EventEmitter,f=e("xtend"),d=e("xtend/mutable"),h=e("fs"),p=e("fs-chunk-store"),m=e("simple-get"),g=e("immediate-chunk-store"),y=e("inherits"),v=e("multistream"),_=e("net"),b=e("os"),w=e("run-parallel"),E=e("run-parallel-limit"),S=e("parse-torrent"),T=e("path"),k=e("torrent-piece"),A=e("pump"),R=e("random-iterate"),x=e("simple-sha1"),L=e("speedometer"),I=e("uniq"),C=e("ut_metadata"),O=e("ut_pex"),D=e("./file"),P=e("./peer"),M=e("./rarity-map"),F=e("./server"),N=5e3,U=3*k.BLOCK_LENGTH,B=[1e3,5e3,15e3],j="WebTorrent/"+e("../package.json").version+" (https://webtorrent.io)";try{i=T.join(h.statSync("/tmp")&&"/tmp","webtorrent")}catch(e){i=T.join("function"==typeof b.tmpdir?b.tmpdir():"/","webtorrent")}function H(e,t,r){l.call(this),this._debugId="unknown infohash",this.client=t,this.announce=r.announce,this.urlList=r.urlList,this.path=r.path,this._store=r.store||p,this._getAnnounceOpts=r.getAnnounceOpts,this.strategy=r.strategy||"sequential",this.maxWebConns=r.maxWebConns||4,this._rechokeNumSlots=!1===r.uploads||0===r.uploads?0:+r.uploads||10,this._rechokeOptimisticWire=null,this._rechokeOptimisticTime=0,this._rechokeIntervalId=null,this.ready=!1,this.destroyed=!1,this.paused=!1,this.done=!1,this.metadata=null,this.store=null,this.files=[],this.pieces=[],this._amInterested=!1,this._selections=[],this._critical=[],this.wires=[],this._queue=[],this._peers={},this._peersLength=0,this.received=0,this.uploaded=0,this._downloadSpeed=L(),this._uploadSpeed=L(),this._servers=[],this._xsRequests=[],this._fileModtimes=r.fileModtimes,null!==e&&this._onTorrentId(e),this._debug("new torrent")}function G(e,t){return 2+Math.ceil(t*e.downloadSpeed()/k.BLOCK_LENGTH)}function z(){}y(H,l),Object.defineProperty(H.prototype,"timeRemaining",{get:function(){return this.done?0:0===this.downloadSpeed?1/0:(this.length-this.downloaded)/this.downloadSpeed*1e3}}),Object.defineProperty(H.prototype,"downloaded",{get:function(){if(!this.bitfield)return 0;for(var e=0,t=0,r=this.pieces.length;t<r;++t)if(this.bitfield.get(t))e+=t===r-1?this.lastPieceLength:this.pieceLength;else{var n=this.pieces[t];e+=n.length-n.missing}return e}}),Object.defineProperty(H.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(H.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(H.prototype,"progress",{get:function(){return this.length?this.downloaded/this.length:0}}),Object.defineProperty(H.prototype,"ratio",{get:function(){return this.uploaded/(this.received||1)}}),Object.defineProperty(H.prototype,"numPeers",{get:function(){return this.wires.length}}),Object.defineProperty(H.prototype,"torrentFileBlobURL",{get:function(){if("undefined"==typeof window)throw new Error("browser-only property");return this.torrentFile?URL.createObjectURL(new Blob([this.torrentFile],{type:"application/x-bittorrent"})):null}}),Object.defineProperty(H.prototype,"_numQueued",{get:function(){return this._queue.length+(this._peersLength-this._numConns)}}),Object.defineProperty(H.prototype,"_numConns",{get:function(){var e=0;for(var t in this._peers)this._peers[t].connected&&(e+=1);return e}}),Object.defineProperty(H.prototype,"swarm",{get:function(){return console.warn("WebTorrent: `torrent.swarm` is deprecated. Use `torrent` directly instead."),this}}),H.prototype._onTorrentId=function(e){var t=this;if(!t.destroyed){var n;try{n=S(e)}catch(e){}n?(t.infoHash=n.infoHash,t._debugId=n.infoHash.toString("hex").substring(0,7),r.nextTick(function(){t.destroyed||t._onParsedTorrent(n)})):S.remote(e,function(e,r){if(!t.destroyed)return e?t._destroy(e):void t._onParsedTorrent(r)})}},H.prototype._onParsedTorrent=function(e){var t=this;if(!t.destroyed){if(t._processParsedTorrent(e),!t.infoHash)return t._destroy(new Error("Malformed torrent data: No info hash"));t.path||(t.path=T.join(i,t.infoHash)),t._rechokeIntervalId=setInterval(function(){t._rechoke()},1e4),t._rechokeIntervalId.unref&&t._rechokeIntervalId.unref(),t.emit("_infoHash",t.infoHash),t.destroyed||(t.emit("infoHash",t.infoHash),t.destroyed||(t.client.listening?t._onListening():t.client.once("listening",function(){t._onListening()})))}},H.prototype._processParsedTorrent=function(e){this._debugId=e.infoHash.toString("hex").substring(0,7),this.announce&&(e.announce=e.announce.concat(this.announce)),this.client.tracker&&n.WEBTORRENT_ANNOUNCE&&!this.private&&(e.announce=e.announce.concat(n.WEBTORRENT_ANNOUNCE)),this.urlList&&(e.urlList=e.urlList.concat(this.urlList)),I(e.announce),I(e.urlList),d(this,e),this.magnetURI=S.toMagnetURI(e),this.torrentFile=S.toTorrentFile(e)},H.prototype._onListening=function(){var e=this;if(!e.discovery&&!e.destroyed){var t=e.client.tracker;t&&(t=f(e.client.tracker,{getAnnounceOpts:function(){var t={uploaded:e.uploaded,downloaded:e.downloaded,left:Math.max(e.length-e.downloaded,0)};return e.client.tracker.getAnnounceOpts&&d(t,e.client.tracker.getAnnounceOpts()),e._getAnnounceOpts&&d(t,e._getAnnounceOpts()),t}})),e.discovery=new c({infoHash:e.infoHash,announce:e.announce,peerId:e.client.peerId,dht:!e.private&&e.client.dht,tracker:t,port:e.client.torrentPort,userAgent:j}),e.discovery.on("error",function(t){e._destroy(t)}),e.discovery.on("peer",function(t){if("string"==typeof t&&e.done)return;e.addPeer(t)}),e.discovery.on("trackerAnnounce",function(){e.emit("trackerAnnounce"),0===e.numPeers&&e.emit("noPeers","tracker")}),e.discovery.on("dhtAnnounce",function(){e.emit("dhtAnnounce"),0===e.numPeers&&e.emit("noPeers","dht")}),e.discovery.on("warning",function(t){e.emit("warning",t)}),e.info?e._onMetadata(e):e.xs&&e._getMetadataFromServer()}},H.prototype._getMetadataFromServer=function(){var e=this,t=(Array.isArray(e.xs)?e.xs:[e.xs]).map(function(t){return function(r){!function(t,r){if(0!==t.indexOf("http://")&&0!==t.indexOf("https://"))return e.emit("warning",new Error("skipping non-http xs param: "+t)),r(null);var n,i={url:t,method:"GET",headers:{"user-agent":j}};try{n=m.concat(i,function(n,i,o){if(e.destroyed)return r(null);if(e.metadata)return r(null);if(n)return e.emit("warning",new Error("http error from xs param: "+t)),r(null);if(200!==i.statusCode)return e.emit("warning",new Error("non-200 status code "+i.statusCode+" from xs param: "+t)),r(null);var a;try{a=S(o)}catch(n){}if(!a)return e.emit("warning",new Error("got invalid torrent file from xs param: "+t)),r(null);if(a.infoHash!==e.infoHash)return e.emit("warning",new Error("got torrent file with incorrect info hash from xs param: "+t)),r(null);e._onMetadata(a),r(null)})}catch(n){return e.emit("warning",new Error("skipping invalid url xs param: "+t)),r(null)}e._xsRequests.push(n)}(t,r)}});w(t)},H.prototype._onMetadata=function(e){var t=this;if(!t.metadata&&!t.destroyed){var r;if(t._debug("got metadata"),t._xsRequests.forEach(function(e){e.abort()}),t._xsRequests=[],e&&e.infoHash)r=e;else try{r=S(e)}catch(e){return t._destroy(e)}t._processParsedTorrent(r),t.metadata=t.torrentFile,t.client.enableWebSeeds&&t.urlList.forEach(function(e){t.addWebSeed(e)}),0!==t.pieces.length&&t.select(0,t.pieces.length-1,!1),t._rarityMap=new M(t),t.store=new g(new t._store(t.pieceLength,{torrent:{infoHash:t.infoHash},files:t.files.map(function(e){return{path:T.join(t.path,e.path),length:e.length,offset:e.offset}}),length:t.length})),t.files=t.files.map(function(e){return new D(t,e)}),t._hashes=t.pieces,t.pieces=t.pieces.map(function(e,r){var n=r===t.pieces.length-1?t.lastPieceLength:t.pieceLength;return new k(n)}),t._reservations=t.pieces.map(function(){return[]}),t.bitfield=new a(t.pieces.length),t.wires.forEach(function(e){e.ut_metadata&&e.ut_metadata.setMetadata(t.metadata),t._onWireWithMetadata(e)}),t._debug("verifying existing torrent data"),t._fileModtimes&&t._store===p?t.getFileModtimes(function(e,r){if(e)return t._destroy(e);if(t.files.map(function(e,n){return r[n]===t._fileModtimes[n]}).every(function(e){return e})){for(var n=0;n<t.pieces.length;n++)t._markVerified(n);t._onStore()}else t._verifyPieces()}):t._verifyPieces(),t.emit("metadata")}},H.prototype.getFileModtimes=function(e){var t=this,r=[];E(t.files.map(function(e,n){return function(i){h.stat(T.join(t.path,e.path),function(e,t){if(e&&"ENOENT"!==e.code)return i(e);r[n]=t&&t.mtime.getTime(),i(null)})}}),2,function(n){t._debug("done getting file modtimes"),e(n,r)})},H.prototype._verifyPieces=function(){var e=this;E(e.pieces.map(function(t,n){return function(t){if(e.destroyed)return t(new Error("torrent is destroyed"));e.store.get(n,function(i,o){return e.destroyed?t(new Error("torrent is destroyed")):i?r.nextTick(t,null):void x(o,function(r){if(e.destroyed)return t(new Error("torrent is destroyed"));if(r===e._hashes[n]){if(!e.pieces[n])return;e._debug("piece verified %s",n),e._markVerified(n)}else e._debug("piece invalid %s",n);t(null)})})}}),2,function(t){if(t)return e._destroy(t);e._debug("done verifying"),e._onStore()})},H.prototype._markVerified=function(e){this.pieces[e]=null,this._reservations[e]=null,this.bitfield.set(e,!0)},H.prototype._onStore=function(){this.destroyed||(this._debug("on store"),this.ready=!0,this.emit("ready"),this._checkDone(),this._updateSelections())},H.prototype.destroy=function(e){this._destroy(null,e)},H.prototype._destroy=function(e,t){var r=this;if(!r.destroyed){for(var n in r.destroyed=!0,r._debug("destroy"),r.client._remove(r),clearInterval(r._rechokeIntervalId),r._xsRequests.forEach(function(e){e.abort()}),r._rarityMap&&r._rarityMap.destroy(),r._peers)r.removePeer(n);r.files.forEach(function(e){e instanceof D&&e._destroy()});var i=r._servers.map(function(e){return function(t){e.destroy(t)}});r.discovery&&i.push(function(e){r.discovery.destroy(e)}),r.store&&i.push(function(e){r.store.close(e)}),w(i,t),e&&(0===r.listenerCount("error")?r.client.emit("error",e):r.emit("error",e)),r.emit("close"),r.client=null,r.files=[],r.discovery=null,r.store=null,r._rarityMap=null,r._peers=null,r._servers=null,r._xsRequests=null}},H.prototype.addPeer=function(e){if(this.destroyed)throw new Error("torrent is destroyed");if(!this.infoHash)throw new Error("addPeer() must not be called before the `infoHash` event");if(this.client.blocked){var t;if("string"==typeof e){var r;try{r=o(e)}catch(t){return this._debug("ignoring peer: invalid %s",e),this.emit("invalidPeer",e),!1}t=r[0]}else"string"==typeof e.remoteAddress&&(t=e.remoteAddress);if(t&&this.client.blocked.contains(t))return this._debug("ignoring peer: blocked %s",e),"string"!=typeof e&&e.destroy(),this.emit("blockedPeer",e),!1}var n=!!this._addPeer(e);return n?this.emit("peer",e):this.emit("invalidPeer",e),n},H.prototype._addPeer=function(e){if(this.destroyed)return"string"!=typeof e&&e.destroy(),null;if("string"==typeof e&&!this._validAddr(e))return this._debug("ignoring peer: invalid %s",e),null;var t,r=e&&e.id||e;return this._peers[r]?(this._debug("ignoring peer: duplicate (%s)",r),"string"!=typeof e&&e.destroy(),null):this.paused?(this._debug("ignoring peer: torrent is paused"),"string"!=typeof e&&e.destroy(),null):(this._debug("add peer %s",r),t="string"==typeof e?P.createTCPOutgoingPeer(e,this):P.createWebRTCPeer(e,this),this._peers[t.id]=t,this._peersLength+=1,"string"==typeof e&&(this._queue.push(t),this._drain()),t)},H.prototype.addWebSeed=function(e){if(this.destroyed)throw new Error("torrent is destroyed");if(!/^https?:\/\/.+/.test(e))return this.emit("warning",new Error("ignoring invalid web seed: "+e)),void this.emit("invalidPeer",e);if(this._peers[e])return this.emit("warning",new Error("ignoring duplicate web seed: "+e)),void this.emit("invalidPeer",e);this._debug("add web seed %s",e);var t=P.createWebSeedPeer(e,this);this._peers[t.id]=t,this._peersLength+=1,this.emit("peer",e)},H.prototype._addIncomingPeer=function(e){return this.destroyed?e.destroy(new Error("torrent is destroyed")):this.paused?e.destroy(new Error("torrent is paused")):(this._debug("add incoming peer %s",e.id),this._peers[e.id]=e,void(this._peersLength+=1))},H.prototype.removePeer=function(e){var t=e&&e.id||e;(e=this._peers[t])&&(this._debug("removePeer %s",t),delete this._peers[t],this._peersLength-=1,e.destroy(),this._drain())},H.prototype.select=function(e,t,r,n){if(this.destroyed)throw new Error("torrent is destroyed");if(e<0||t<e||this.pieces.length<=t)throw new Error("invalid selection ",e,":",t);r=Number(r)||0,this._debug("select %s-%s (priority %s)",e,t,r),this._selections.push({from:e,to:t,offset:0,priority:r,notify:n||z}),this._selections.sort(function(e,t){return t.priority-e.priority}),this._updateSelections()},H.prototype.deselect=function(e,t,r){if(this.destroyed)throw new Error("torrent is destroyed");r=Number(r)||0,this._debug("deselect %s-%s (priority %s)",e,t,r);for(var n=0;n<this._selections.length;++n){var i=this._selections[n];if(i.from===e&&i.to===t&&i.priority===r){this._selections.splice(n,1);break}}this._updateSelections()},H.prototype.critical=function(e,t){if(this.destroyed)throw new Error("torrent is destroyed");this._debug("critical %s-%s",e,t);for(var r=e;r<=t;++r)this._critical[r]=!0;this._updateSelections()},H.prototype._onWire=function(e,t){var n=this;if(n._debug("got wire %s (%s)",e._debugId,t||"Unknown"),e.on("download",function(e){n.destroyed||(n.received+=e,n._downloadSpeed(e),n.client._downloadSpeed(e),n.emit("download",e),n.client.emit("download",e))}),e.on("upload",function(e){n.destroyed||(n.uploaded+=e,n._uploadSpeed(e),n.client._uploadSpeed(e),n.emit("upload",e),n.client.emit("upload",e))}),n.wires.push(e),t){var i=o(t);e.remoteAddress=i[0],e.remotePort=i[1]}n.client.dht&&n.client.dht.listening&&e.on("port",function(r){if(!n.destroyed&&!n.client.dht.destroyed){if(!e.remoteAddress)return n._debug("ignoring PORT from peer with no address");if(0===r||r>65536)return n._debug("ignoring invalid PORT from peer");n._debug("port: %s (from %s)",r,t),n.client.dht.addNode({host:e.remoteAddress,port:r})}}),e.on("timeout",function(){n._debug("wire timeout (%s)",t),e.destroy()}),e.setTimeout(3e4,!0),e.setKeepAlive(!0),e.use(C(n.metadata)),e.ut_metadata.on("warning",function(e){n._debug("ut_metadata warning: %s",e.message)}),n.metadata||(e.ut_metadata.on("metadata",function(e){n._debug("got metadata via ut_metadata"),n._onMetadata(e)}),e.ut_metadata.fetch()),"function"!=typeof O||n.private||(e.use(O()),e.ut_pex.on("peer",function(e){n.done||(n._debug("ut_pex: got peer: %s (from %s)",e,t),n.addPeer(e))}),e.ut_pex.on("dropped",function(e){var r=n._peers[e];r&&!r.connected&&(n._debug("ut_pex: dropped peer: %s (from %s)",e,t),n.removePeer(e))}),e.once("close",function(){e.ut_pex.reset()})),n.emit("wire",e,t),n.metadata&&r.nextTick(function(){n._onWireWithMetadata(e)})},H.prototype._onWireWithMetadata=function(e){var t,r=this,n=null;function i(){r.destroyed||e.destroyed||(r._numQueued>2*(r._numConns-r.numPeers)&&e.amInterested?e.destroy():(n=setTimeout(i,N)).unref&&n.unref())}function o(){if(e.peerPieces.buffer.length===r.bitfield.buffer.length){for(t=0;t<r.pieces.length;++t)if(!e.peerPieces.get(t))return;e.isSeeder=!0,e.choke()}}e.on("bitfield",function(){o(),r._update()}),e.on("have",function(){o(),r._update()}),e.once("interested",function(){e.unchoke()}),e.once("close",function(){clearTimeout(n)}),e.on("choke",function(){clearTimeout(n),(n=setTimeout(i,N)).unref&&n.unref()}),e.on("unchoke",function(){clearTimeout(n),r._update()}),e.on("request",function(t,n,i,o){if(i>131072)return e.destroy();r.pieces[t]||r.store.get(t,{offset:n,length:i},o)}),e.bitfield(r.bitfield),e.interested(),e.peerExtensions.dht&&r.client.dht&&r.client.dht.listening&&e.port(r.client.dht.address().port),"webSeed"!==e.type&&(n=setTimeout(i,N)).unref&&n.unref(),e.isSeeder=!1,o()},H.prototype._updateSelections=function(){var e=this;e.ready&&!e.destroyed&&(r.nextTick(function(){e._gcSelections()}),e._updateInterest(),e._update())},H.prototype._gcSelections=function(){for(var e=0;e<this._selections.length;++e){for(var t=this._selections[e],r=t.offset;this.bitfield.get(t.from+t.offset)&&t.from+t.offset<t.to;)t.offset+=1;r!==t.offset&&t.notify(),t.to===t.from+t.offset&&(this.bitfield.get(t.from+t.offset)&&(this._selections.splice(e,1),e-=1,t.notify(),this._updateInterest()))}this._selections.length||this.emit("idle")},H.prototype._updateInterest=function(){var e=this,t=e._amInterested;e._amInterested=!!e._selections.length,e.wires.forEach(function(t){e._amInterested?t.interested():t.uninterested()}),t!==e._amInterested&&(e._amInterested?e.emit("interested"):e.emit("uninterested"))},H.prototype._update=function(){if(!this.destroyed)for(var e,t=R(this.wires);e=t();)this._updateWire(e)},H.prototype._updateWire=function(e){var t=this;if(!e.peerChoking){if(!e.downloaded)return function(){if(e.requests.length)return;var r=t._selections.length;for(;r--;){var n,o=t._selections[r];if("rarest"===t.strategy)for(var a=o.from+o.offset,s=o.to,u=s-a+1,c={},l=0,f=i(a,s,c);l<u&&!((n=t._rarityMap.getRarestPiece(f))<0);){if(t._request(e,n,!1))return;c[n]=!0,l+=1}else for(n=o.to;n>=o.from+o.offset;--n)if(e.peerPieces.get(n)&&t._request(e,n,!1))return}}();var r=G(e,.5);if(!(e.requests.length>=r)){var n=G(e,1);a(!1)||a(!0)}}function i(t,r,n,i){return function(o){return o>=t&&o<=r&&!(o in n)&&e.peerPieces.get(o)&&(!i||i(o))}}function o(e){for(var r=e,n=e;n<t._selections.length&&t._selections[n].priority;n++)r=n;var i=t._selections[e];t._selections[e]=t._selections[r],t._selections[r]=i}function a(r){if(e.requests.length>=n)return!0;for(var a=function(){var r=e.downloadSpeed()||1;if(r>U)return function(){return!0};var n=Math.max(1,e.requests.length)*k.BLOCK_LENGTH/r,i=10,o=0;return function(e){if(!i||t.bitfield.get(e))return!0;for(var a=t.pieces[e].missing;o<t.wires.length;o++){var s=t.wires[o],u=s.downloadSpeed();if(!(u<U)&&!(u<=r)&&s.peerPieces.get(e)&&!((a-=u*n)>0))return i--,!1}return!0}}(),s=0;s<t._selections.length;s++){var u,c=t._selections[s];if("rarest"===t.strategy)for(var l=c.from+c.offset,f=c.to,d=f-l+1,h={},p=0,m=i(l,f,h,a);p<d&&!((u=t._rarityMap.getRarestPiece(m))<0);){for(;t._request(e,u,t._critical[u]||r););if(!(e.requests.length<n))return c.priority&&o(s),!0;h[u]=!0,p++}else for(u=c.from+c.offset;u<=c.to;u++)if(e.peerPieces.get(u)&&a(u)){for(;t._request(e,u,t._critical[u]||r););if(!(e.requests.length<n))return c.priority&&o(s),!0}}return!1}},H.prototype._rechoke=function(){var e=this;if(e.ready){e._rechokeOptimisticTime>0?e._rechokeOptimisticTime-=1:e._rechokeOptimisticWire=null;var t=[];e.wires.forEach(function(r){r.isSeeder||r===e._rechokeOptimisticWire||t.push({wire:r,downloadSpeed:r.downloadSpeed(),uploadSpeed:r.uploadSpeed(),salt:Math.random(),isChoked:!0})}),t.sort(function(e,t){if(e.downloadSpeed!==t.downloadSpeed)return t.downloadSpeed-e.downloadSpeed;if(e.uploadSpeed!==t.uploadSpeed)return t.uploadSpeed-e.uploadSpeed;if(e.wire.amChoking!==t.wire.amChoking)return e.wire.amChoking?1:-1;return e.salt-t.salt});for(var r,n=0,i=0;i<t.length&&n<e._rechokeNumSlots;++i)t[i].isChoked=!1,t[i].wire.peerInterested&&(n+=1);if(!e._rechokeOptimisticWire&&i<t.length&&e._rechokeNumSlots){var o=t.slice(i).filter(function(e){return e.wire.peerInterested}),a=o[(r=o.length,Math.random()*r|0)];a&&(a.isChoked=!1,e._rechokeOptimisticWire=a.wire,e._rechokeOptimisticTime=2)}t.forEach(function(e){e.wire.amChoking!==e.isChoked&&(e.isChoked?e.wire.choke():e.wire.unchoke())})}},H.prototype._hotswap=function(e,t){var r=e.downloadSpeed();if(r<k.BLOCK_LENGTH)return!1;if(!this._reservations[t])return!1;var n=this._reservations[t];if(!n)return!1;var i,o,a=1/0;for(o=0;o<n.length;o++){var s=n[o];if(s&&s!==e){var u=s.downloadSpeed();u>=U||2*u>r||u>a||(i=s,a=u)}}if(!i)return!1;for(o=0;o<n.length;o++)n[o]===i&&(n[o]=null);for(o=0;o<i.requests.length;o++){var c=i.requests[o];c.piece===t&&this.pieces[t].cancel(c.offset/k.BLOCK_LENGTH|0)}return this.emit("hotswap",i,e,t),!0},H.prototype._request=function(e,t,n){var i=this,o=e.requests.length,a="webSeed"===e.type;if(i.bitfield.get(t))return!1;if(o>=(a?Math.min(function(e,t,r){return 1+Math.ceil(t*e.downloadSpeed()/r)}(e,1,i.pieceLength),i.maxWebConns):G(e,1)))return!1;var s=i.pieces[t],u=a?s.reserveRemaining():s.reserve();if(-1===u&&n&&i._hotswap(e,t)&&(u=a?s.reserveRemaining():s.reserve()),-1===u)return!1;var c=i._reservations[t];c||(c=i._reservations[t]=[]);var l=c.indexOf(null);-1===l&&(l=c.length),c[l]=e;var f=s.chunkOffset(u),d=a?s.chunkLengthRemaining(u):s.chunkLength(u);function h(){r.nextTick(function(){i._update()})}return e.request(t,f,d,function r(n,o){if(!i.destroyed){if(!i.ready)return i.once("ready",function(){r(n,o)});if(c[l]===e&&(c[l]=null),s!==i.pieces[t])return h();if(n)return i._debug("error getting piece %s (offset: %s length: %s) from %s: %s",t,f,d,e.remoteAddress+":"+e.remotePort,n.message),a?s.cancelRemaining(u):s.cancel(u),void h();if(i._debug("got piece %s (offset: %s length: %s) from %s",t,f,d,e.remoteAddress+":"+e.remotePort),!s.set(u,o,e))return h();var p=s.flush();x(p,function(e){if(!i.destroyed){if(e===i._hashes[t]){if(!i.pieces[t])return;i._debug("piece verified %s",t),i.pieces[t]=null,i._reservations[t]=null,i.bitfield.set(t,!0),i.store.put(t,p),i.wires.forEach(function(e){e.have(t)}),i._checkDone()&&!i.destroyed&&i.discovery.complete()}else i.pieces[t]=new k(s.length),i.emit("warning",new Error("Piece "+t+" failed verification"));h()}})}}),!0},H.prototype._checkDone=function(){var e=this;if(!e.destroyed){e.files.forEach(function(t){if(!t.done){for(var r=t._startPiece;r<=t._endPiece;++r)if(!e.bitfield.get(r))return;t.done=!0,t.emit("done"),e._debug("file done: "+t.name)}});for(var t=!0,r=0;r<e._selections.length;r++){for(var n=e._selections[r],i=n.from;i<=n.to;i++)if(!e.bitfield.get(i)){t=!1;break}if(!t)break}return!e.done&&t&&(e.done=!0,e._debug("torrent done: "+e.infoHash),e.emit("done")),e._gcSelections(),t}},H.prototype.load=function(e,t){var r=this;if(r.destroyed)throw new Error("torrent is destroyed");if(!r.ready)return r.once("ready",function(){r.load(e,t)});Array.isArray(e)||(e=[e]),t||(t=z);var n=new v(e),i=new s(r.store,r.pieceLength);A(n,i,function(e){if(e)return t(e);r.pieces.forEach(function(e,t){r.pieces[t]=null,r._reservations[t]=null,r.bitfield.set(t,!0)}),r._checkDone(),t(null)})},H.prototype.createServer=function(e){if("function"!=typeof F)throw new Error("node.js-only method");if(this.destroyed)throw new Error("torrent is destroyed");var t=new F(this,e);return this._servers.push(t),t},H.prototype.pause=function(){this.destroyed||(this._debug("pause"),this.paused=!0)},H.prototype.resume=function(){this.destroyed||(this._debug("resume"),this.paused=!1,this._drain())},H.prototype._debug=function(){if(!this.destroyed){var e=[].slice.call(arguments);e[0]="["+this.client._debugId+"] ["+this._debugId+"] "+e[0],u.apply(null,e)}},H.prototype._drain=function(){var e=this;if(this._debug("_drain numConns %s maxConns %s",e._numConns,e.client.maxConns),!("function"!=typeof _.connect||e.destroyed||e.paused||e._numConns>=e.client.maxConns)){this._debug("drain (%s queued, %s/%s peers)",e._numQueued,e.numPeers,e.client.maxConns);var t=e._queue.shift();if(t){this._debug("tcp connect attempt to %s",t.addr);var r=o(t.addr),n={host:r[0],port:r[1]},i=t.conn=_.connect(n);i.once("connect",function(){t.onConnect()}),i.once("error",function(e){t.destroy(e)}),t.startConnectTimeout(),i.on("close",function(){if(!e.destroyed)if(t.retries>=B.length)e._debug("conn %s closed: will not re-add (max %s attempts)",t.addr,B.length);else{var r=B[t.retries];e._debug("conn %s closed: will re-add to queue in %sms (attempt %s)",t.addr,r,t.retries+1);var n=setTimeout(function(){var r=e._addPeer(t.addr);r&&(r.retries=t.retries+1)},r);n.unref&&n.unref()}})}}},H.prototype._validAddr=function(e){var t;try{t=o(e)}catch(e){return!1}var r=t[0],n=t[1];return n>0&&n<65535&&!("127.0.0.1"===r&&n===this.client.torrentPort)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../package.json":175,"./file":170,"./peer":171,"./rarity-map":172,"./server":26,_process:98,"addr-to-ip-port":10,bitfield:18,"chunk-store-stream/write":37,debug:41,events:51,fs:29,"fs-chunk-store":70,"immediate-chunk-store":59,inherits:60,multistream:79,net:26,os:26,"parse-torrent":93,path:94,pump:99,"random-iterate":104,"run-parallel":126,"run-parallel-limit":125,"simple-get":130,"simple-sha1":132,speedometer:134,"torrent-discovery":150,"torrent-piece":151,uniq:154,ut_metadata:158,ut_pex:26,xtend:177,"xtend/mutable":178}],174:[function(e,t,r){t.exports=f;var n=e("bitfield"),i=e("safe-buffer").Buffer,o=e("debug")("webtorrent:webconn"),a=e("simple-get"),s=e("inherits"),u=e("simple-sha1"),c=e("bittorrent-protocol"),l=e("../package.json").version;function f(e,t){c.call(this),this.url=e,this.webPeerId=u.sync(e),this._torrent=t,this._init()}s(f,c),f.prototype._init=function(){var e=this;e.setKeepAlive(!0),e.once("handshake",function(t,r){if(!e.destroyed){e.handshake(t,e.webPeerId);for(var i=e._torrent.pieces.length,o=new n(i),a=0;a<=i;a++)o.set(a,!0);e.bitfield(o)}}),e.once("interested",function(){o("interested"),e.unchoke()}),e.on("uninterested",function(){o("uninterested")}),e.on("choke",function(){o("choke")}),e.on("unchoke",function(){o("unchoke")}),e.on("bitfield",function(){o("bitfield")}),e.on("request",function(t,r,n,i){o("request pieceIndex=%d offset=%d length=%d",t,r,n),e.httpRequest(t,r,n,i)})},f.prototype.httpRequest=function(e,t,r,n){var s,u=this,c=e*u._torrent.pieceLength+t,f=c+r-1,d=u._torrent.files;if(d.length<=1)s=[{url:u.url,start:c,end:f}];else{var h=d.filter(function(e){return e.offset<=f&&e.offset+e.length>c});if(h.length<1)return n(new Error("Could not find file corresponnding to web seed range request"));s=h.map(function(e){var t=e.offset+e.length-1;return{url:u.url+("/"===u.url[u.url.length-1]?"":"/")+e.path,fileOffsetInRange:Math.max(e.offset-c,0),start:Math.max(c-e.offset,0),end:Math.min(t,f-e.offset)}})}var p,m=0,g=!1;s.length>1&&(p=i.alloc(r)),s.forEach(function(i){var u=i.url,c=i.start,f=i.end;o("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",u,e,t,r,c,f);var d={url:u,method:"GET",headers:{"user-agent":"WebTorrent/"+l+" (https://webtorrent.io)",range:"bytes="+c+"-"+f}};function h(e,t){if(e.statusCode<200||e.statusCode>=300)return g=!0,n(new Error("Unexpected HTTP status code "+e.statusCode));o("Got data of length %d",t.length),1===s.length?n(null,t):(t.copy(p,i.fileOffsetInRange),++m===s.length&&n(null,p))}a.concat(d,function(e,t,r){if(!g)return e?"undefined"==typeof window||u.startsWith(window.location.origin+"/")?(g=!0,n(e)):a.head(u,function(t,r){if(!g){if(t)return g=!0,n(t);if(r.statusCode<200||r.statusCode>=300)return g=!0,n(new Error("Unexpected HTTP status code "+r.statusCode));if(r.url===u)return g=!0,n(e);d.url=r.url,a.concat(d,function(e,t,r){if(!g)return e?(g=!0,n(e)):void h(t,r)})}}):void h(t,r)})})},f.prototype.destroy=function(){c.prototype.destroy.call(this),this._torrent=null}},{"../package.json":175,bitfield:18,"bittorrent-protocol":19,debug:41,inherits:60,"safe-buffer":128,"simple-get":130,"simple-sha1":132}],175:[function(e,t,r){t.exports={version:"0.99.4"}},{}],176:[function(e,t,r){t.exports=function e(t,r){if(t&&r)return e(t)(r);if("function"!=typeof t)throw new TypeError("need wrapper function");Object.keys(t).forEach(function(e){n[e]=t[e]});return n;function n(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var n=t.apply(this,e),i=e[e.length-1];return"function"==typeof n&&n!==i&&Object.keys(i).forEach(function(e){n[e]=i[e]}),n}}},{}],177:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}],178:[function(e,t,r){t.exports=function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}],179:[function(e,t,r){t.exports=function e(t,r,n){return void 0===r?function(r,n){return e(t,r,n)}:(void 0===n&&(n="0"),(t-=r.toString().length)>0?new Array(t+(/\./.test(r)?2:1)).join(n)+r:r+"")}},{}],180:[function(e,t,r){t.exports={name:"dht-stream",version:"1.0.0",description:"",main:"index.js",scripts:{test:'echo "Error: no test specified" && exit 1'},author:"lezo",license:"ISC",dependencies:{arch:"^2.1.0","capture-frame":"^2.0.0","cp-file":"^6.0.0","create-torrent":"^3.31.0","deep-equal":"^1.0.1","drag-drop":"^4.1.0","es6-error":"^4.1.1","fn-getter":"^1.0.0","hls.js":"^0.11.0",http:"0.0.0","location-history":"^1.1.0",moment:"^2.22.1","node-stun":"^0.1.2","prettier-bytes":"^1.0.4",retry:"^0.12.0","simple-get":"^3.0.2",throttleit:"^1.0.0",thunky:"^1.0.2",webtorrent:"^0.99.4","webtorrent-hybrid":"^1.0.6"},devDependencies:{browserify:"^16.2.2",gulp:"^3.9.1","gulp-streamify":"^1.0.2","gulp-uglify-es":"^1.0.4","vinyl-source-stream":"^2.0.0"}}},{}],181:[function(e,t,r){const n=e("../lib/torrent-player"),i=e("../lib/torrent-summary"),o=e("./../ipc-renderer"),a=e("../lib/cast"),{UnplayableFileError:s,UnplayableTorrentError:u}=e("../lib/errors"),c=e("./../lib/html-casts");function l(e,...t){o.send("dispatch",e,...t)}function f(e){return"htmlcast"===e.playing.location}t.exports=class{constructor(e,t,r){this.state=e,this.config=t,this.update=r}playFile(e,t){if(this.pauseActiveTorrents(e),function(e,t){return e&&t.playing&&t.playing.infoHash==e}(e,this.state))this.updatePlayer(e,t,!1,e=>{e?l("error",e):this.play()});else{const r=i.getByKey(state,e);if(void 0===(t=void 0===t?r.mostRecentFileIndex:t)&&r.files&&(t=r.files.findIndex(n.isPlayable)),void 0===t)return void l("error",new u);this.openPlayer(e,t,e=>{e||this.play()})}}playPause(){const e=this.state;if("player"!==e.location.url())return;const t=document.querySelector("video,audio");!e.window.isVisible&&t&&(e.playing.isPaused?t.play():t.pause()),e.playing.isPaused?this.play():this.pause()}pauseActiveTorrents(e){if(!this.state.saved.prefs.highestPlaybackPriority)return;const t=i.getByKey(this.state,e);t&&"seeding"!==t.status&&l("prioritizeTorrent",t.infoHash)}play(){const e=this.state;e.playing.isPaused&&(e.playing.isPaused=!1,f(e)&&a.play(),o.send("onPlayerPlay"))}pause(){const e=this.state;e.playing.isPaused||(e.playing.isPaused=!0,f(e)&&a.pause(),o.send("onPlayerPause"))}skip(e){this.skipTo(this.state.playing.currentTime+e)}skipTo(e){if(!Number.isFinite(e))return console.error("Tried to skip to a non-finite time "+e),console.trace();f(this.state)?a.seek(e):this.state.playing.jumpToTime=e}changePlaybackRate(e){const t=this.state;let r=t.playing.playbackRate;e>0&&r<2?r+=.25:e<0&&r>.25&&r<=2?r-=.25:e>0&&r>=1&&r<16?r*=2:e<0&&r>1&&r<=16&&(r/=2),t.playing.playbackRate=r,f(t)&&!a.setRate(r)&&(t.playing.playbackRate=1),t.playing.mouseStationarySince=(new Date).getTime()}changeVolume(e){this.setVolume(this.state.playing.volume+e)}setVolume(e){e=Math.max(0,Math.min(1,e));const t=this.state;t.playing.setVolume=e,f(t)?a.setVolume(e):t.playing.setVolume=e}startServer(e,t){const r=this.state;function n(){l("selectCastDevice",c.indexDevice(r=>!!r.match(e.infoHash)&&(r.selectFile(t),r.torrentKey(e.torrentKey),!0))),o.send("wt-start-server",e.infoHash),o.once("wt-server-running",()=>{r.playing.isReady=!0})}"paused"===e.status?(l("startTorrentingSummary",e.torrentKey),o.once("wt-ready-"+e.infoHash,()=>n())):n()}updatePlayer(e,t,r,a){const u=this.state,c=i.getByKey(u,e),f=c.files[t];if(!n.isPlayable(f))return c.mostRecentFileIndex=void 0,a(new s);c.mostRecentFileIndex=t,u.playing.infoHash=c.infoHash,u.playing.fileIndex=t,u.playing.type=n.isVideo(f)?"video":n.isAudio(f)?"audio":"other";let d=0;if(r&&f.currentTime){const e=f.currentTime/f.duration,t=f.duration-f.currentTime;e<.9&&t>10&&(d=f.currentTime)}function h(){"audio"!==u.playing.type||f.audioInfo||o.send("wt-get-audio-metadata",c.infoHash,t)}u.playing.jumpToTime=d,"paused"===c.status?o.once("wt-ready-"+c.infoHash,h):h(),f.selectedSubtitle&&l("addSubtitles",[f.selectedSubtitle],!0),u.window.title=f.name,this.update(),a()}openPlayer(e,t,r){const n=this.state,a=i.getByKey(n,e);n.playing.infoHash=a.infoHash,n.playing.isReady=!1,this.startServer(a,t),o.send("onPlayerOpen"),this.updatePlayer(e,t,!0,r)}closePlayer(){console.log("closePlayer");const e=this.state;f(e)&&a.stop(),e.previousVolume=e.playing.volume,e.playing=State.getDefaultPlayState(),e.server=null,o.send("wt-stop-server"),o.send("onPlayerClose"),this.state.saved.prefs.highestPlaybackPriority&&l("resumePausedTorrents"),this.update()}}},{"../lib/cast":185,"../lib/errors":186,"../lib/torrent-player":189,"../lib/torrent-summary":191,"./../ipc-renderer":184,"./../lib/html-casts":187}],182:[function(e,t,r){const n=e("path"),i=e("./../ipc-renderer"),o=e("../lib/torrent-summary");function a(e,...t){i.send(e,...t)}t.exports=class{constructor(e){this.state=e}torrentInfoHash(e,t){let r=this.getTorrentSummary(e);if(!r){const n=this.state.saved.torrents,o=n.find(e=>e.infoHash===t);if(o&&o.torrentKey&&"paused"!=o.status)return i.send("wt-stop-torrenting",t),a("error","Cannot add duplicate torrent:"+t);r={torrentKey:e,status:"new"},n.unshift(r)}r.infoHash=t,a("update")}torrentWarning(e,t){console.log("warning for torrent %s: %s",e,t)}torrentError(e,t){t.startsWith("Cannot add duplicate torrent")&&(t="Cannot add duplicate torrent"),a("error",t);const r=this.getTorrentSummary(e);r&&(console.log("Pausing torrent %s due to error: %s",r.infoHash,t),r.status="paused",a("update"))}torrentMetadata(e,t){const r=this.getTorrentSummary(e);r.status="downloading",r.name=r.displayName||t.name,r.path=t.path,r.magnetURI=t.magnetURI,r.files&&r.files[0].path||(r.files=t.files),r.selections||(r.selections=r.files.map(e=>!0)),a("update"),r.torrentFileName||i.send("wt-save-torrent-file",e),r.posterFileName=r.posterFileName||r.infoHash+".jpg",r.posterFileName||i.send("wt-generate-torrent-poster",e)}torrentDone(e,t){const r=this.getTorrentSummary(e);var s;r.status="seeding",t.bytesReceived>0&&(this.state.window.isFocused||(this.state.dock.badge+=1),s=r,new window.Notification("Download Complete",{body:s.name,silent:!0}).onclick=function(){i.send("show")},i.send("downloadFinished",function(e){let t=o.getFileOrFolder(e);e.files.length>1&&(t=n.dirname(t));return t}(r))),a("update")}torrentProgress(e){const t=e.hasActiveTorrents&&1!==e.progress?e.progress:-1;this.state.dock.progress=t,e.torrents.forEach(e=>{const t=this.getTorrentSummary(e.torrentKey);t?t.progress=e:console.log("warning: got progress for missing torrent %s",e.torrentKey)})}torrentFileModtimes(e,t){const r=this.getTorrentSummary(e);if(!r)throw new Error("Not saving modtimes for deleted torrent "+e);r.fileModtimes=t,a("stateSave")}torrentFileSaved(e,t){console.log("torrent file saved %s: %s",e,t),this.getTorrentSummary(e).torrentFileName=t,a("stateSave")}torrentPosterSaved(e,t){this.getTorrentSummary(e).posterFileName=t,a("stateSave")}torrentAudioMetadata(e,t,r){this.getTorrentSummary(e).files[t].audioInfo=r,a("update")}torrentServerRunning(e){this.state.server=e}getTorrentSummary(e){return o.getByKey(this.state,e)}}},{"../lib/torrent-summary":191,"./../ipc-renderer":184,path:94}],183:[function(e,t,r){const n=e("fs"),i=e("path"),{TorrentKeyNotFoundError:o}=e("../lib/errors"),a=e("../lib/torrent-summary"),s=e("./../ipc-renderer"),u=/xt=urn:btih:([0-9a-zA-Z]{20,})/i;function c(e,...t){s.send(e,...t)}t.exports=class{constructor(e){this.state=e}addTorrent(e,t){var r;e.path&&(e=e.path),"string"==typeof e&&(e=e.trim(),u.test(e)&&(r=RegExp.$1));const n=a.getByKey(this.state,r);a.getTorrentId(n,(r,i)=>{let o;o=null!=n&&null!=n.torrentKey&&n.torrentKey>=0?n.torrentKey:this.state.nextTorrentKey++,e=i||e;const a=this.state.saved.prefs.downloadPath;s.send("wt-start-torrenting",o,e,a,null,null,t),c("backToList")})}createTorrent(e){const t=this.state,r=t.nextTorrentKey++;s.send("wt-create-torrent",r,e),t.location.cancel()}startTorrentingSummary(e){const t=a.getByKey(this.state,e);if(!t)throw new o(e);if(!t.path)return t.path=this.state.saved.prefs.downloadPath,void s.send("wt-start-torrenting",t.torrentKey,a.getTorrentId(t),t.path,t.fileModtimes,t.selections)}toggleTorrent(e){const t=a.getByKey(this.state,e);"paused"!==t.status?this.pauseTorrent(t,!0):this.resumeTorrent(t)}pauseAllTorrents(){this.state.saved.torrents.forEach(e=>{"downloading"!==e.status&&"seeding"!==e.status||(e.status="paused",this.pauseTorrent(e))})}resumeAllTorrents(){this.state.saved.torrents.forEach(e=>{"paused"===e.status&&(e.status="downloading",this.resumeTorrent(e.infoHash))})}pauseTorrent(e,t){"paused"!=e.status&&(e.status="paused",console.log("pauseTorrent:%s, wt-pause-torrenting",e.infoHash),s.send("wt-pause-torrenting",e.infoHash))}resumeTorrent(e){"paused"==e.status&&(e.status="downloading",console.log("resumeTorrent:%s, wt-resume-torrenting",e.infoHash),s.send("wt-resume-torrenting",e.infoHash))}prioritizeTorrent(e){this.state.saved.torrents.filter(e=>-1!==["downloading","seeding"].indexOf(e.status)).map(t=>{e!==t.infoHash&&(this.state.saved.torrentsToResume.push(t.infoHash),this.pauseTorrent(t,!1))}),console.log("Playback Priority: paused torrents: ",this.state.saved.torrentsToResume)}resumePausedTorrents(){console.log("Playback Priority: resuming paused torrents"),this.state.saved.torrentsToResume&&this.state.saved.torrentsToResume.length&&(this.state.saved.torrentsToResume.map(e=>{this.toggleTorrent(e)}),this.state.saved.torrentsToResume=[])}toggleTorrentFile(e,t){const r=a.getByKey(this.state,e);r.selections[t]=!r.selections[t],"paused"!==r.status&&s.send("wt-select-files",e,r.selections)}confirmDeleteTorrent(e,t){this.state.modal={id:"remove-torrent-modal",infoHash:e,deleteData:t}}deleteTorrent(e,t){console.log("deleteTorrent:%s, wt-stop-torrenting",e),s.send("wt-stop-torrenting",e);const r=this.state.saved.torrents.findIndex(t=>t.infoHash===e);if(r>-1){const e=this.state.saved.torrents[r];deleteFile(a.getTorrentPath(e)),deleteFile(a.getPosterPath(e)),t&&moveItemToTrash(e),this.state.saved.torrents.splice(r,1),c("stateSave")}this.state.location.clearForward("player")}toggleSelectTorrent(e){this.state.selectedInfoHash===e?this.state.selectedInfoHash=null:this.state.selectedInfoHash=e}saveTorrentFileAs(e){const t=a.getByKey(this.state,e);if(!t)throw new Error("Missing torrentKey: "+e);const r=this.state.saved.prefs.downloadPath,o=i.parse(t.name).name+".torrent",s=electron.remote.getCurrentWindow(),u={title:"Save Torrent File",defaultPath:i.join(r,o),filters:[{name:"Torrent Files",extensions:["torrent"]},{name:"All Files",extensions:["*"]}]};electron.remote.dialog.showSaveDialog(s,u,function(r){if(console.log("Saving torrent "+e+" to "+r),!r)return;const i=a.getTorrentPath(t);n.readFile(i,function(e,t){if(e)return c("error",e);n.writeFile(r,t,function(e){if(e)return c("error",e)})})})}}},{"../lib/errors":186,"../lib/torrent-summary":191,"./../ipc-renderer":184,fs:29,path:94}],184:[function(e,t,r){const{EventEmitter:n}=e("events");e("./../lib/utils"),window.ipc=t.exports=Object.assign(new n,{send:function(e,...t){var r=t[0],n=null;r instanceof Error&&(n=r,t=t.slice(1));this.emit(e,n,...t)}})},{"./../lib/utils":9,events:51}],185:[function(e,t,r){e("./torrent-summary");const n=e("../../config"),{CastingError:i}=e("./errors"),o=e("./html-casts");let a,s;t.exports={init:function(e,t){s=t,(a=e).devices.htmlcast=function(){const e={device:null,addDevice:function(e){s()},getDevices:function(){return o.players},open:function(){e.device.play(null,{open:!0,type:"video/mp4",title:n.APP_NAME},function(e){e?(a.playing.location="local",a.errors.push({time:(new Date).getTime(),message:"Could not connect to htmlcast. "+e.message})):a.playing.location="htmlcast"})},play:function(t){e.device.play(null,null,t)},pause:function(t){e.device.pause(t)},stop:function(t){e.device.stop(t)},status:function(){e.device.status(c)},seek:function(t,r){e.device.seek(t,r)},volume:function(t,r){e.device.volume(t,r)}};return e}(),o.on("update",function(e){a.devices.htmlcast.addDevice(e)})},toggleMenu:l,selectDevice:function(e){a.devices.castMenu||l("htmlcast");const{location:t,devices:r}=a.devices.castMenu,n=d(t);n.device=r[e],n.open(),u=setInterval(function(){const e=d();e&&e.status()},1e3),a.devices.castMenu=null,a.playing.castName=r[e].name,a.playing.location=t+"-pending",s()},stop:function(){const e=d();e?(e.stop(function(){e.device=null,f()}),clearInterval(u)):f()},play:function(){const e=d();e&&e.play(h)},pause:function(){const e=d();e&&e.pause(h)},seek:function(e){const t=d();t&&t.seek(e,h)},setVolume:function(e){const t=d();t&&t.volume(e,h)},setRate:function(e){const t=d();t&&t.rate(e,h)}};let u=null;function c(e,t){if(e||!t)return console.log("error getting %s status: %o",a.playing.location,e||"missing response");a.playing.isPaused="PAUSED"===t.playerState,a.playing.currentTime=t.currentTime,a.playing.volume=t.volume.muted?0:t.volume.level,s()}function l(e){if(a.devices.castMenu&&a.devices.castMenu.location===e)return;const t=d(e),r=t?t.getDevices():[];r.length,a.devices.castMenu={location:e,devices:r}}function f(){a.playing.location="local",a.playing.jumpToTime=Number.isFinite(a.playing.currentTime)?a.playing.currentTime:0,s()}function d(e){return e?a.devices[e]:"htmlcast"===a.playing.location?a.devices.htmlcast:null}function h(){console.log("%s callback: %o",a.playing.location,arguments)}},{"../../config":1,"./errors":186,"./html-casts":187,"./torrent-summary":191}],186:[function(e,t,r){const n=e("es6-error");class i extends n{}class o extends n{}class a extends n{}t.exports={CastingError:class extends n{},PlaybackError:i,SoundError:o,TorrentError:a,UnplayableTorrentError:class extends i{constructor(){super("Can't play any files in torrent")}},UnplayableFileError:class extends i{constructor(){super("Can't play that file")}},InvalidSoundNameError:class extends o{constructor(e){super(`Invalid sound name: ${e}`)}},TorrentKeyNotFoundError:class extends a{constructor(e){super(`Can't resolve torrent key ${e}`)}}}},{"es6-error":50}],187:[function(e,t,r){const{EventEmitter:n}=e("events"),i=e("./html-player"),o=[];t.exports=Object.assign(new n,{addDevice:function(e,t){if(!e)return;const r=new i(e,t);o.push(r),this.emit("update",r)},indexDevice:function(e){if(!e)return;return o.findIndex(t=>e(t))},players:o})},{"./html-player":188,events:51}],188:[function(e,t,r){const n=e("./../ipc-renderer"),i=(e("./torrent-summary"),e("./torrent-player")),o={controls:!0,autoplay:!1,muted:!1,maxBlobLength:2e9};t.exports=class{constructor(e,t){var r=this;r.element=e,t&&/magnet:\?xt=urn:btih:([0-9a-zA-Z]{20,})/i.test(t)?r.infoHash=RegExp.$1:r.infoHash=t,r.element.setAttribute("controls",!0);const a={},s=document.querySelector('meta[name="_cdn_host"]');if(s){const e=s.getAttribute("content");if(e){const t=e+"/piece/"+r.infoHash+".raw",n=(r.infoHash,[]);n.push(t),a.urlList=n}}n.send("dispatch","addTorrent",t,a),n.on("wt-ready-"+r.infoHash,(e,t,a)=>{r.element.setAttribute("torrentkey",t);var s=r.element.getAttribute("select-file");void 0===(s=null==s?void 0:s)&&a&&a.files&&(s=a.files.findIndex(i.isPlayable),r.selectFile(s)),void 0!==s?(o.autoplay=!r.element.paused,n.send("wt-render-to",a.infoHash,s,r.element,o,(e,t)=>{console.info("randerTo:"+t)})):dispatch("error",new UnplayableTorrentError(torrentId))})}match(e){return this.infoHash===e}selectFile(e){this.element.setAttribute("select-file",e)}torrentKey(e){this.torrentKey=e,this.element.setAttribute("torrentkey",e)}play(e,t,r){this.element.play(),r()}pause(e){this.element.pause(),e()}stop(e){return this.pause(e)}status(){return this.element.readyState}seek(e,t){t(null)}volume(e,t){this.element.volume=e,t(null,this.element.volume)}rate(e,t){this.element.playbackRate=e,t(null,this.element.playbackRate)}}},{"./../ipc-renderer":184,"./torrent-player":189,"./torrent-summary":191}],189:[function(e,t,r){t.exports={isPlayable:i,isVideo:o,isAudio:a,isTorrent:function(e){const t=".torrent"===s(e),r="string"==typeof e&&/^(stream-)?magnet:/.test(e);return t||r},isPlayableTorrentSummary:function(e){return e.files&&e.files.some(i)}};const n=e("path");function i(e){return o(e)||a(e)}function o(e){return[".avi",".m4v",".mkv",".mov",".mp4",".mpg",".ogv",".webm",".wmv"].includes(s(e))}function a(e){return[".aac",".aiff",".ape",".ac3",".flac",".m4a",".mp2",".mp3",".oga",".ogg",".opus",".wav",".wma"].includes(s(e))}function s(e){const t="string"==typeof e?e:e.name;return n.extname(t).toLowerCase()}},{path:94}],190:[function(e,t,r){t.exports=function(e,t){const r=e.files.filter(function(e){return/^poster\.(jpg|png|gif)$/.test(e.name)})[0];if(r)return u(r,t);const c=["audio","video","image"].map(t=>({type:t,size:function(e,t){const r=s(e,t);return 0===r.length?0:r.map(e=>e.length).reduce((e,t)=>e+t)}(e,o[t])})).sort((e,t)=>t.size-e.size)[0];if(0===c.size)return t(new Error("Cannot generate a poster from any files in the torrent"));switch(c.type){case"audio":return function(e,t){const r=s(e,o.image).map(e=>({file:e,score:function(e){const t=i.basename(e.name,i.extname(e.name)).toLowerCase(),r={cover:80,folder:80,album:80,front:80,back:20};for(let e in r){if(t===e)return r[e];if(-1!==t.indexOf(e))return.8*r[e]}return 0}(e)})).reduce((e,t)=>e.score>t.score?e:t.score>e.score?t:e.file.length>t.file.length?e:t);if(!r)return t(new Error("Generated poster contains no data"));const n=i.extname(r.file.name);r.file.getBuffer((e,r)=>t(e,r,n))}(e,t);case"image":return function(e,t){u(a(e,o.image),t)}(e,t);case"video":return function(e,t){const r=a(e,o.video),i=e.files.indexOf(r),s=e.createServer(0);s.listen(0,function(){const e="http://localhost:"+s.address().port+"/"+i,r=document.createElement("video");function o(){r.removeEventListener("seeked",o);const e=n(r);if(r.pause(),r.src="",r.load(),s.destroy(),0===e.length)return t(new Error("Generated poster contains no data"));t(null,e,".jpg")}r.addEventListener("canplay",function e(){r.removeEventListener("canplay",e);r.addEventListener("seeked",o);r.currentTime=Math.min(.03*(r.duration||600),60)}),r.volume=0,r.src=e,r.play()})}(e,t)}};const n=e("capture-frame"),i=e("path"),o={audio:[".aac",".asf",".flac",".m2a",".m4a",".mp2",".mp4",".mp3",".oga",".ogg",".opus",".wma",".wav",".wv",".wvp"],video:[".mp4",".m4v",".webm",".mov",".mkv"],image:[".gif",".jpg",".jpeg",".png"]};function a(e,t){const r=s(e,t);if(0!==r.length)return r.reduce((e,t)=>e.length>t.length?e:t)}function s(e,t){return e.files.filter(e=>{const r=i.extname(e.name).toLowerCase();return-1!==t.indexOf(r)})}function u(e,t){const r=i.extname(e.name);e.getBuffer((e,n)=>t(e,n,r))}},{"capture-frame":36,path:94}],191:[function(e,t,r){(function(r){t.exports={getPosterPath:function(e){if(!e||!e.posterFileName)return null;return n.join(i.POSTER_PATH,e.posterFileName).replace(/\\/g,"/")},getTorrentPath:function(e){return e&&e.torrentFileName?n.join(i.TORRENT_PATH,e.torrentFileName):null},getByKey:function(e,t){return t?e.saved.torrents.find(e=>e.torrentKey===t||e.infoHash===t):void 0},getTorrentId:function(e,t){if(!e)return t("torrentSummary is null");const s=e;var u=n.join(i.TORRENT_PATH,s.infoHash),c=o.get(u,!0);if(c&&c.length>100){var l=new r(c,"base64");if(l)return t(null,l)}a.metaGet(s.infoHash,(e,n)=>{if(n&&n.data&&n.data.length>100){var i=new r(n.data,"base64");if(i)return t(null,i)}return t(null,s.magnetURI||s.infoHash)})},getFileOrFolder:function(e){const t=e;if(!t.path||!t.files||0===t.files.length)return null;const r=t.files[0].path.split(n.sep)[0];return n.join(t.path,r)}};const n=e("path"),i=e("../../config"),o=e("./../../lib/storage"),a=e("./../../lib/indexer")}).call(this,e("buffer").Buffer)},{"../../config":1,"./../../lib/indexer":6,"./../../lib/storage":8,buffer:34,path:94}],192:[function(e,t,r){console.time("initMain");const n=e("fn-getter"),i=e("./../lib/utils"),o=e("./../lib/client-listener"),a=e("./ipc-renderer"),s=e("./../config"),u=e("./lib/cast");let c=null,l=!1,f=null;function d(){h().toggleMenu("htmlcast")}function h(){return l||(u.init(c,g),l=!0),u}o.init((t,r)=>{if(t)return m(t);c=window.state=r,f={torrent:n(()=>{return new(e("./controllers/torrent-controller"))(c)}),torrentList:n(()=>{return new(e("./controllers/torrent-list-controller"))(c)}),playback:n(()=>{return new(e("./controllers/playback-controller"))(c,s,g)})},c.saved.torrents.map(e=>(e.torrentKey=c.nextTorrentKey++,e)).filter(e=>"paused"!==e.status).forEach(e=>f.torrentList().startTorrentingSummary(e.torrentKey)),function(){a.on("log",(e,...t)=>console.log(...t)),a.on("error",(e,...t)=>console.error(...t)),a.on("dispatch",(e,...t)=>(function(e,...t){const r=p[e];r?r(...t):console.error("Missing dispatch handler: "+e)})(...t));const e=f.torrent();a.on("wt-infohash",(t,...r)=>e.torrentInfoHash(...r)),a.on("wt-metadata",(t,...r)=>e.torrentMetadata(...r)),a.on("wt-done",(t,...r)=>e.torrentDone(...r)),a.on("wt-done",()=>f.torrentList().resumePausedTorrents()),a.on("wt-warning",(t,...r)=>e.torrentWarning(...r)),a.on("wt-error",(t,...r)=>e.torrentError(...r)),a.on("wt-progress",(t,...r)=>e.torrentProgress(...r)),a.on("wt-file-modtimes",(t,...r)=>e.torrentFileModtimes(...r)),a.on("wt-file-saved",(t,...r)=>e.torrentFileSaved(...r)),a.on("wt-poster",(t,...r)=>e.torrentPosterSaved(...r)),a.on("wt-audio-metadata",(t,...r)=>e.torrentAudioMetadata(...r)),a.on("wt-server-running",(t,...r)=>e.torrentServerRunning(...r)),a.on("wt-uncaught-error",(e,t)=>{console.error("main.error:",t||e)}),a.send("ipcReady")}(),window.setTimeout(d,s.DELAYED_INIT),console.timeEnd("initMain")});const p={addTorrent:(e,t)=>f.torrentList().addTorrent(e,t),showCreateTorrent:e=>f.torrentList().showCreateTorrent(e),createTorrent:e=>f.torrentList().createTorrent(e),toggleTorrent:e=>f.torrentList().toggleTorrent(e),pauseAllTorrents:()=>f.torrentList().pauseAllTorrents(),resumeAllTorrents:()=>f.torrentList().resumeAllTorrents(),toggleTorrentFile:(e,t)=>f.torrentList().toggleTorrentFile(e,t),confirmDeleteTorrent:(e,t)=>f.torrentList().confirmDeleteTorrent(e,t),deleteTorrent:(e,t)=>f.torrentList().deleteTorrent(e,t),toggleSelectTorrent:e=>f.torrentList().toggleSelectTorrent(e),openTorrentContextMenu:e=>f.torrentList().openTorrentContextMenu(e),startTorrentingSummary:e=>f.torrentList().startTorrentingSummary(e),saveTorrentFileAs:e=>f.torrentList().saveTorrentFileAs(e),prioritizeTorrent:e=>f.torrentList().prioritizeTorrent(e),resumePausedTorrents:()=>f.torrentList().resumePausedTorrents(),playFile:(e,t)=>f.playback().playFile(e,t),playPause:()=>f.playback().playPause(),skip:e=>f.playback().skip(e),skipTo:e=>f.playback().skipTo(e),changePlaybackRate:e=>f.playback().changePlaybackRate(e),changeVolume:e=>f.playback().changeVolume(e),setVolume:e=>f.playback().setVolume(e),toggleCastMenu:e=>h().toggleMenu(e),selectCastDevice:e=>h().selectDevice(e),stopCasting:()=>h().stop(),error:m,uncaughtError:(e,t)=>i.error(t),stateSaveImmediate:()=>State.saveImmediate(c),update:()=>{}};function m(e){console.error(e.stack||e)}function g(){}},{"./../config":1,"./../lib/client-listener":4,"./../lib/utils":9,"./controllers/playback-controller":181,"./controllers/torrent-controller":182,"./controllers/torrent-list-controller":183,"./ipc-renderer":184,"./lib/cast":185,"fn-getter":54}],193:[function(e,t,r){(function(t){const r=e("capture-frame");e("./../lib/utils"),e("./../render/lib/html-casts"),e("prettier-bytes");e("./../render/ipc-renderer");const n=e("./events");var i=document.querySelectorAll(".editor-ul .video-inner");Array.from(i).reverse().forEach(function(e,t){var r=e.querySelector(".video-box-cms"),i=document.createElement("video");r.appendChild(i);var o=e.querySelector("a[src]").getAttribute("src"),a=o;/magnet:\?xt=urn:btih:([0-9a-zA-Z]{20,})/i.test(o)&&(a=RegExp.$1),i.style.display="none",i.setAttribute("data-infohash",a),n.addEvents(i,e,a)}),i.length>0&&document.body.addEventListener("keydown",function(e){if(1==e.ctrlKey&&1==e.shiftKey&&13==e.keyCode){var n=document.querySelector('.video-box-cms[captured="upload"]');if(n){var i=n.querySelector('.video-cover .file-input .file-default-preview img.video-img[src^="data:"]').getAttribute("src"),o=i.indexOf("base64,"),a=i.substring(o+"base64,".length),s=function(e){var t=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}(e);return new Blob([t],{type:"image/jpeg"})}(new t(a,"base64")),u=n.querySelector("[id^=input-img]"),c=document.createEvent("CustomEvent");c.initCustomEvent("doupload",!1,!1,{imgblob:s}),u.dispatchEvent(c)}}else if(1==e.ctrlKey&&13==e.keyCode){var l=document.querySelectorAll(".editor-ul .video-inner video[src][torrentkey]");Array.from(l).forEach((e,t)=>{if(!e.paused){e.pause();var n=e.parentNode,i=n.querySelector(".video-cover"),o=n.querySelector(".video-cover .file-input .file-default-preview img.video-img"),a=r(e,"jpeg");document.createElement("img");var s="data:image/jpeg;base64,"+a.toString("base64");return o.setAttribute("src",s),i.style.display="block",e.style.display="none",n.setAttribute("captured","upload"),!1}})}})}).call(this,e("buffer").Buffer)},{"./../lib/utils":9,"./../render/ipc-renderer":184,"./../render/lib/html-casts":187,"./events":194,buffer:34,"capture-frame":36,"prettier-bytes":96}],194:[function(e,t,r){var n=e("prettier-bytes"),i=e("hls.js");const o=e("./../render/ipc-renderer"),a=e("./../render/lib/html-casts");t.exports={addEvents:function(e,t,r){var i=t.querySelector(".video-play"),a=t.querySelector(".video-cover"),u=t.querySelector(".downloaded"),c=t.querySelector(".total"),l=t.querySelector(".progressBar");if(e.setAttribute("data-url",r),/magnet:\?xt=urn:btih:([0-9a-zA-Z]{20,})/i.test(r)){var f=RegExp.$1;e.setAttribute("data-infohash",f)}i.addEventListener("click",function(){if(e.readyState<3){0!=e.readyState||e.getAttribute("src")||s(e);var t=e.getAttribute("data-infohash");t&&o.send("dispatch","prioritizeTorrent",t)}e.play()}),e.addEventListener("play",()=>{a.style.display="none",e.style.display="block";var t=document.createEvent("HTMLEvents");t.initEvent("progress",!1,!1),t.eventType="message",e.dispatchEvent(t)}),e.addEventListener("ended",()=>{a.style.display="block",e.style.display="none"}),e.addEventListener("progress",()=>{}),(f=e.getAttribute("data-infohash"))&&o.on("wt-progress",(t,r)=>{const i=e.getAttribute("torrentkey");if(!r||!r.torrents||null==i||null==i)return;const o=r.torrents.find(e=>e.torrentKey==i);if(o){var a=Math.round(o.downloaded/o.length*100*100)/100;l.style.width=a+"%",u.innerHTML=n(o.downloaded),c.innerHTML=n(o.length),a>=10&&!e.paused&&1==e.readyState&&(e.readyState=3,e.pause(),e.play())}})},addDevice:s};function s(e){var t=document.querySelector('meta[name="_cdn_host"]').getAttribute("content");t=encodeURIComponent(t);var r=e.getAttribute("data-infohash");if(r){var n="magnet:?xt=urn:btih:"+r;n=(n=n.indexOf("?")>0?n:n+"?")+"&xs="+t+"/meta/"+r+".torrent",a.addDevice(e,n)}else{var o=e.getAttribute("data-url");if(e.canPlayType("application/vnd.apple.mpegurl"))e.src=o,e.addEventListener("loadedmetadata",function(){e.play()});else if(i.isSupported()){var s=new i;s.loadSource(o),s.attachMedia(e),s.on(i.Events.MANIFEST_PARSED,function(){})}}}},{"./../render/ipc-renderer":184,"./../render/lib/html-casts":187,"hls.js":56,"prettier-bytes":96}],195:[function(e,t,r){e("./../lib/utils"),e("./../render/lib/html-casts"),e("prettier-bytes");e("./../render/ipc-renderer");const n=e("./events");document.querySelector('meta[name="_cdn_host"]');var i=document.querySelectorAll(".feed-ul .video-inner,.video-detail .video-inner");Array.from(i).forEach(function(e,t){var r=e.querySelector(".video-box"),i=e.querySelector("video");i||(i=document.createElement("video"),r.appendChild(i));var o=i.getAttribute("data-url");o||(o=e.querySelector("a[src]").getAttribute("src")),n.addEvents(i,e,o)})},{"./../lib/utils":9,"./../render/ipc-renderer":184,"./../render/lib/html-casts":187,"./events":194,"prettier-bytes":96}],196:[function(e,t,r){var n=e("moment"),i=(e("./../lib/utils"),e("prettier-bytes"));const o=e("./../render/ipc-renderer"),a=e("./events");var s=document.querySelector("#post-video");s&&s.addEventListener("click",function(){document.querySelector('meta[name="_cdn_host"]');var e=document.querySelector("#link"),t=document.querySelectorAll("#post-video");Array.from(t).reverse().forEach(function(t,r){var s=t.querySelector(".video"),u=document.createElement("video");s.appendChild(u);var c=e.value.trim();u.style.display="none",u.setAttribute("autoplay",!0),function(e,t,r){var a=t.querySelector("#post-video"),s=t.querySelector(".video-cover-detail"),u=document.querySelector(".progressBar"),c=(document.querySelector("#numPeers"),document.querySelector("#downloaded")),l=document.querySelector("#total"),f=document.querySelector("#remaining"),d=document.querySelector("#downloadSpeed");a.addEventListener("click",function(){e.play(),e.readyState<3&&o.send("dispatch","prioritizeTorrent",r)}),e.addEventListener("pause",()=>{console.log("pause..........")}),e.addEventListener("play",()=>{s.style.display="none",e.style.display="block";var t=document.createEvent("HTMLEvents");t.initEvent("progress",!1,!1),t.eventType="message",e.dispatchEvent(t)}),e.addEventListener("ended",()=>{s.style.display="block"}),e.addEventListener("progress",()=>{e.paused||(0===e.readyState?e.style.display="none":e.style.display="block")}),e.addEventListener("canplaythrough",()=>{}),o.on("wt-progress",(t,r)=>{const o=e.getAttribute("torrentkey");if(!r||!r.torrents||null==o||null==o)return;const a=r.torrents.find(e=>e.torrentKey==o);if(a){var s,h=Math.round(a.downloaded/a.length*100*100)/100;if(u.style.width=h+"%",c.innerHTML=i(a.downloaded),l.innerHTML=i(a.length),1==a.progress)s="",d.innerHTML="-";else{if(0!=a.downloadSpeed&&a.length>0){var p=(a.length-a.downloaded)/a.downloadSpeed;s=(s=n.duration(p,"seconds").as("minutes")).toFixed(2)+""}else s="";d.innerHTML=i(a.downloadSpeed)+"/S"}f.innerHTML=s,h>=10&&!e.paused&&1==e.readyState&&(e.readyState=3,e.pause(),e.play())}})}(u,document,c),a.addDevice(u);var l=u.getAttribute("data-infohash");l&&o.on("wt-ready-"+l,(e,t,r)=>{o.send("dispatch","playFile",r.infoHash)})})})},{"./../lib/utils":9,"./../render/ipc-renderer":184,"./events":194,moment:71,"prettier-bytes":96}],197:[function(e,t,r){const n=e("run-parallel-limit"),i=e("zlib"),o=e("drag-drop"),a=e("parse-torrent");var s=e("http"),u=e("util"),c=(e("querystring"),e("./../lib/client")),l=e("./../lib/utils"),f=e("throttleit"),d=e("debug")("dhtstream:upload"),h=e("retry"),p=null,m=document.querySelector("#upload-count"),g=document.querySelector("#upload-log"),y=document.querySelector("#video-share-target");m&&g&&y&&c.getClient(function(e,t){if(e)return l.error(e);p=t,o(".video-share-box",_),function(e,t){var r=document.querySelector(e),n=document.createElement("INPUT");n.setAttribute("type","file"),n.type="file",n.accept="video/*",n.accept="video/*,.mkv,.flv",n.style.display="none",r.addEventListener("click",function(){n.click()}),n.addEventListener("change",function(){t(n.files)})}(".video-upload",_)});var v={};function _(e){var t;if(e&&(t=Array.from(e).filter(function(e){return/(mp4|rmvb|mkv|avi)$/gi.test(e.name)})),!t||t.length<1)g.innerHTML="";else{var r={createdBy:"lezomao.com",maxPeers:5},o=t[0].name;o=o.replace(/(\.[a-zA-Z34]{3,5})$/,".lezomao.com$1"),r.name="."+o,p.seed(t,r,function(e,r){if(r)r.message&&r.message.indexOf("duplicate torrent")>0&&(g.innerHTML="");else if(console.log("hash:"+e.infoHash+",Client is seeding "+e.magnetURI),console.log("instant:"+e.torrentFileBlobURL),v[e.infoHash])g.innerHTML="";else{e.on("warning",l.warning),e.on("download",f(function(t){l.info("download:"+e.name+",speed:"+t)},250)),e.on("upload",f(function(t){l.info("upload:"+e.name+",speed:"+t)},250));var o=function(e){var t=a(e.torrentFile);t.announce&&(t.announce=t.announce.filter(function(e){return!(e.indexOf("localhost")>0||e.indexOf("lezomao.com")>0)&&(0===e.indexOf("wss://")||0===e.indexOf("ws://"))}));t.urlList&&(t.urlList=t.urlList.filter(function(e){if(e.indexOf("localhost")>0||e.indexOf("lezomao.com")>0)return!1}));return a.toTorrentFile(t)}(e).toString("base64"),c=e.infoHash.toLowerCase(),p={};p.link="magnet:?xt=urn:btih:"+c,p.title=t[0].name,p.space=e.length,p.infoHash=c,p.torrentFile=o;var _=e.pieces.length,b=0;n(e.pieces.map(function(t,r){return function(t){e.store.get(r,function(n,o){if(n||!o)return console.error(u.format("UploadPieceErr.torrent=%s,pieceIndex=%d,pieceHash=%s,cause:",p.infoHash,r,c),n),t(n);var a=r*e.pieceLength,c=e._hashes[r],l={};l.infoHash=p.infoHash,l.start=a,i.gzip(o,function(e,n){var i=n.length>o.length;l.data=i?o.toString("base64"):n.toString("base64"),d("UploadPiece.torrent=%s,pieceIndex=%d,pieceHash=%s,rangeStart=%d,buf=%d,zbuf=%d,base64=%d,larger=%s",p.infoHash,r,c,a,o.length,n.length,l.data.length,i),function(e,t){var r=h.operation({retries:5,factor:3,minTimeout:1e3,maxTimeout:6e4,randomize:!0});r.attempt(function(n){!function(e,t){var r=JSON.stringify(e),n={path:"/api/movie/piece.post",method:"POST",headers:{"Content-Type":"application/json","Content-Length":r.length}},i=s.request(n,function(e){var r="";e.on("data",function(e){r+=e}),e.on("end",function(){t(null,JSON.parse(r))}),e.on("error",function(e){t(e)})});i.write(r),i.end()}(e,function(e,n){r.retry(e)||t(e?r.mainError():null,n)})})}(l,(e,r)=>{if(e)console.error("postPiece.params:"+JSON.stringify(l)+",ret:"+JSON.stringify(r)+",error:",e);else{var n=100*++b/_;n=parseInt(n),g.innerHTML=n+"%",t(e,r)}})})})}}),2,function(t){if(t)return console.error("upload.torrent,cause:",t),!1;console.info(u.format("UploadPiece.torrent=%s,pieceCount=%d",p.infoHash,e.pieces.length)),function(e,t){var r=JSON.stringify(e),n={path:"/api/movie/vmeta.post",method:"POST",headers:{"Content-Type":"application/json","Content-Length":r.length}},i=s.request(n,function(e){var r="";e.on("data",function(e){r+=e}),e.on("end",function(){t(null,JSON.parse(r))}),e.on("error",function(e){t(e)})});i.write(r),i.end()}(p,function(t,r){if(r&&r.data&&200==r.code){var n=0;m.innerHTML&&!isNaN(m.innerHTML)&&(n=m.innerHTML.trim()-0),n+=e.files.length,m.innerHTML=""+n,g.innerHTML="",y.innerHTML='<a href="/movie/torrent/'+r.data.id+'.html" target="_blank">'+p.title+"</a>",v[e.infoHash]=1}else g.innerHTML=""})})}})}}},{"./../lib/client":5,"./../lib/utils":9,debug:41,"drag-drop":47,http:136,"parse-torrent":93,querystring:103,retry:122,"run-parallel-limit":125,throttleit:146,util:162,zlib:28}]},{},[2]);