{(decorator/header.html)}

<link rel="canonical" href="{*context.header.canonical*}"/>
<meta name="description" content="{*context.header.description*}"/>
<meta name="keywords" content="{*context.header.keywords*}" />
<meta name="title" content="{*context.header.title*}" />
<!-- <script type="text/javascript" src="{{static_host}}/assets/js/jquery.ajax-cross-origin.min.js?v={{version}}"></script>
 -->
</head>
{# end of head #}

<body>

{(decorator/navbar.html)}
{(decorator/blankbar.html)}


<div class="container">
  <div class="row">
	   <div class="col-md-8">

		
<div class="checking-box" data-example-id="alerts-with-links">

              <img src="{{static_host}}/assets/img/checking.gif">
			 <span>正在检测，</span>
	  		  <div class="progress">
				  <div id="progress" class="progress-bar" role="progressbar" 
				     aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
				    60%
				  </div>
			  </div>

			<div class="checking-highlight" id="checking">
				    <div class="alert alert-success" role="alert">
				      <strong>(1).获取链接与提取码:</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.
				    </div>
				    <div class="alert alert-info" role="alert">
				      <strong>Heads up!</strong> This <a href="#" class="alert-link">alert needs your attention</a>, but it's not super important.
				    </div>
				    <div class="alert alert-warning" role="alert">
				      <strong>Warning!</strong> Better check yourself, you're <a href="#" class="alert-link">not looking too good</a>.
				    </div>
				    <div class="alert alert-danger" role="alert">
				      <strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.
				    </div>
				  </div>
			</div>

	   </div> 
	   <div class="col-md-4">
	  	
	   </div>
  </div>
</div>
<script language='javascript'>

  function Checker() {
  	var self = this
  	self.progress = 0
  	var index = -1
  	var checkers = self.checkers = []

    var oRule = {}

  	oRule.execute = function(oRule, doc){
  		var selfFunc = this
  		var html = ''
  		// delete doc.link
      var count  = $('#checking > div.alert').length + 1
  		if (doc.link) {
			  html += '<div class="alert alert-success" role="alert">'
  			html += '<strong>('+count+').</strong>获取资源，【' + doc.title +'】'
  			if (doc.secret) {
  				html += '(提取码：'+ doc.secret +')'
	  			html += '<a id="jumpTo" class="jumpTo alert-link" href="javascript:void(0)"  onclick="jumpTo(\''+doc.link+'\')">复制提取码并跳转[?]</a> '
  			} else {
	  			html += '<a id="jumpTo" class="jumpTo alert-link" href="javascript:void(0)" onclick="jumpTo(\''+doc.link+'\')">直接跳转[?]</a> '
  			}
  			html += '</div>'
  		} else {
  			html += '<div class="alert alert-danger" role="alert">'
  			html += '<strong>('+count+').</strong>获取资源， 资源失效或不存在！'
  			html += '</div>'
  			selfFunc.next = self.stop
  			// delete selfFunc.next
  		}
        $('#checking').append(html)
        self.doNext(oRule, doc)
  	}
    checkers[checkers.length] = oRule

    oRule = {}
    oRule.execute = function(oRule, doc){
      var selfFunc = this
      var html = ''
      // delete doc.link
      var count  = $('#checking > div.alert').length + 1
      html += '<div class="alert alert-success" role="alert">'
      html += '<strong>('+count+').</strong>链接校验，资源有效'
      html += '</div>'
      $('#checking').append(html)
      self.doNext(oRule, doc)
    }
    checkers[checkers.length] = oRule

    var incrArr = [30,50]
  	for (var i = 0; i < checkers.length; i++) {
      checkers[i].next = checkers[i + 1] || self.end
  		checkers[i].incr = incrArr[i]
  	}
  }

  Checker.prototype.start = function(doc){
  	var self = this
  	self.doProgress()
  	console.log('target:' + JSON.stringify(doc))
    var oRule = self.checkers[0];
  	oRule.execute(oRule, doc)
  }

  Checker.prototype.stop = function(){
	  var self = this
  	self.tprogress && clearTimeout(self.tprogress)
  }

 Checker.prototype.doNext = function(oRule, doc){
	  var self = this
    console.log('checker.next:' + JSON.stringify(oRule.next))

	  self.doIncr(oRule.incr)
  	if(oRule.next) {
      oRule = oRule.next
      if(oRule.execute) {
          return oRule.execute(oRule,doc)
      } else {
         return oRule.next()
      }
  	} else {
  	  // return self.stop()
  	}
  }

  Checker.prototype.end = function(){
	 var self = this
   self.progress = 100
	 self.stop()
  }

  Checker.prototype.doIncr = function(incr){
  	 var self = this
  	 if(!incr) {
  	 	return
  	 }
  	 self.progress = self.progress + incr
  }  

  Checker.prototype.doProgress = function(){
  	 var self = this
  	 var num = self.progress;
     if (self.checktimes) {
        self.checktimes += 1
     } else {
        self.checktimes = 1
     }
  	 console.info("progrs:" + JSON.stringify(num) +",checktimes:" + self.checktimes);
  	 var pEle = $("#progress");
  	 pEle.attr('aria-valuenow', ""+ num);
  	 pEle.attr('style', "width: "+num+"%;");
  	 pEle.text( num + "%")
  	 self.tprogress = setTimeout(function () {
  		if(self.progress < 100) {
	  		self.doProgress()
  		} else {
		    self.end()
  		}
  	},1000); 
  }
  var target = {*link_doc*}
  var chekcer = new Checker()
  chekcer.start(target)

  function filterData(data){
    data = data.replace(/<?\/body[^>]*>/g,'');
    data = data.replace(/[\r|\n]+/g,'');
    data = data.replace(/<--[\S\s]*?-->/g,'');
    data = data.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,'');
    data = data.replace(/<script[^>]*>[\S\s]*?<\/script>/g,'');
    data = data.replace(/<script.*\/>/,'');
    return data;
  }

  function jumpTo(tid){
    var jumpEle = $("#jumpTo")
    chekcer.stop()
    jumpEle.attr('disabled',"disabled");
    tid = 'https://pan.baidu.com/s/1kVyrYYj'
    console.log('tid:' + tid)
    location.href = tid
    return false;
  }

</script>


{(decorator/footer.html)}